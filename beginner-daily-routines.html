<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Routines - English Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .lesson-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.5s forwards;
        }

        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff4757;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            display: none;
            animation: pulse 1s infinite;
            z-index: 1000;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .question-container {
            margin: 20px 0;
        }

        .question {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            font-weight: 600;
        }

        .options {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }

        .option {
            background: #f8f9ff;
            border: 2px solid #e1e8ff;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .option:hover:not(.disabled) {
            background: #e8f0ff;
            border-color: #667eea;
            transform: translateX(5px);
        }

        .option.correct {
            background: #d4edda !important;
            border-color: #4CAF50 !important;
            color: #155724;
        }

        .option.incorrect {
            background: #f8d7da !important;
            border-color: #dc3545 !important;
            color: #721c24;
        }
        
        .option.selected {
            background: #e8f0ff;
            border-color: #667eea;
            font-weight: bold;
        }

        .option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .reading-text {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
            line-height: 1.6;
            font-style: italic;
        }

        .reading-text strong {
            font-style: normal;
            color: #667eea;
        }

        .achievement {
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            color: #333;
            padding: 15px;
            border-radius: 15px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            display: none;
            animation: achievementPop 0.5s ease;
        }

        @keyframes achievementPop {
            0% { transform: scale(0.8) rotate(-5deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(2deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .sticker {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 5rem;
            opacity: 0;
            animation: stickerPop 1s forwards;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes stickerPop {
            0% { transform: translate(-50%, -50%) scale(0.5) rotate(-20deg); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2) rotate(10deg); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0; }
        }

        .gap-fill-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .gap-sentence {
            font-size: 18px;
            line-height: 1.8;
            padding: 10px 0;
        }

        .gap-fill-drop-zone {
            display: inline-block;
            border-bottom: 3px solid #667eea;
            min-width: 80px;
            text-align: center;
            padding: 8px 15px;
            font-size: 16px;
            margin: 0 8px;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #667eea;
            min-height: 30px;
        }

        .gap-fill-drop-zone.filled {
            background: #e8f0ff;
            border-radius: 5px;
        }
        
        .gap-fill-drop-zone.correct-answer {
            background: #d4edda;
            border-color: #4CAF50;
            color: #155724;
        }

        .gap-fill-drop-zone.incorrect-answer {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .word-bank-drag {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 15px;
            border: 2px dashed #667eea;
        }

        .word-bank-title {
            width: 100%;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .word-item-drag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: grab;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .word-item-drag:hover:not(.used) {
            background: linear-gradient(135deg, #764ba2, #667eea);
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .word-item-drag:active {
            cursor: grabbing;
        }

        .word-item-drag.used {
            background: #ccc;
            cursor: not-allowed;
            transform: scale(0.9);
            opacity: 0.5;
            box-shadow: none;
        }

        .sortable-list {
            list-style: none;
            padding: 0;
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
        }

        .sortable-item {
            background: white;
            border: 2px solid #e1e8ff;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer; /* Changed to pointer */
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .sortable-item:hover {
            background: #e8f0ff;
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }
        
        .sortable-item.selected-item {
            background: #667eea;
            color: white;
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            transform: scale(1.02); /* Maintain hover effect on select */
        }

        .sortable-list.correct-order .sortable-item {
            background: #d4edda;
            border-color: #4CAF50;
            color: #155724;
            transform: none !important;
        }

        .sortable-list.incorrect-order .sortable-item {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
            animation: shake 0.5s;
            transform: none !important;
        }

        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .matching-column h4 {
            text-align: center;
            color: #667eea;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
            font-weight: bold;
        }

        .match-item {
            background: white;
            border: 2px solid #e1e8ff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .match-item:hover:not(.correct):not(.disabled) {
            background: #e8f0ff;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .match-item.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .match-item.correct {
            background: #4CAF50 !important;
            color: white !important;
            border-color: #4CAF50 !important;
            cursor: not-allowed;
        }

        .match-item.incorrect {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
            animation: shake 0.5s;
        }

        .match-item.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .match-score {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
            font-weight: bold;
            color: #667eea;
        }

        .hidden {
            display: none !important;
        }

        .level-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .points-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 24px;
            font-weight: bold;
            z-index: 1000;
            animation: pointsFloat 2s ease-out forwards;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        @keyframes pointsFloat {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            30% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -80px) scale(1); }
        }

        .activity-instructions {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 4px solid #2196f3;
            font-weight: 500;
        }

        .feedback-message {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            display: none;
            font-size: 16px;
        }

        .feedback-correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #4CAF50;
        }

        .feedback-incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .next-activity-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            margin-top: 20px;
            display: none;
        }

        .try-again-btn {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            margin-top: 20px;
            display: none;
        }

        .check-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üåü English Adventure: Daily Routines üåü</h1>
            <div class="level-badge">Level <span id="currentLevel">1</span></div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="totalPoints">0</div>
                <div>Points</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="streak">0</div>
                <div>Streak</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="timeLeft">--</div>
                <div>Time</div>
            </div>
        </div>

        <div class="timer" id="timer">‚è∞ 30s</div>
        <div class="achievement" id="achievement"></div>

        <div class="lesson-card" id="activity1">
            <h2>üéØ Activity 1: Vocabulary Matching Game</h2>
            <div class="activity-instructions">
                Match the daily routine activities with their meanings. Click on a word from the left column, then click on its matching definition from the right column! To undo, just click your selection again.
            </div>
            
            <div class="matching-container">
                <div class="matching-column">
                    <h4>üîµ Activities</h4>
                    <div class="match-item vocabulary" data-match="1">get up</div>
                    <div class="match-item vocabulary" data-match="2">brush teeth</div>
                    <div class="match-item vocabulary" data-match="3">take a shower</div>
                    <div class="match-item vocabulary" data-match="4">have breakfast</div>
                    <div class="match-item vocabulary" data-match="5">go to school</div>
                    <div class="match-item vocabulary" data-match="6">do homework</div>
                    <div class="match-item vocabulary" data-match="7">have dinner</div>
                    <div class="match-item vocabulary" data-match="8">go to sleep</div>
                </div>
                
                <div class="matching-column">
                    <h4>üü° Meanings</h4>
                    <div class="match-item definition" data-match="3">wash your body</div>
                    <div class="match-item definition" data-match="1">get out of bed</div>
                    <div class="match-item definition" data-match="7">eat evening meal</div>
                    <div class="match-item definition" data-match="2">clean your teeth</div>
                    <div class="match-item definition" data-match="8">go to bed</div>
                    <div class="match-item definition" data-match="4">eat morning meal</div>
                    <div class="match-item definition" data-match="6">complete school work</div>
                    <div class="match-item definition" data-match="5">travel to school</div>
                </div>
            </div>
            
            <div class="match-score">
                <span id="matchScore">Matches: 0/8</span>
            </div>
            
            <div class="feedback-message" id="matching-feedback"></div>
            <button class="btn next-activity-btn" id="matching-next" onclick="nextActivity()">Continue to Next Activity ‚û°Ô∏è</button>
        </div>

        <div class="lesson-card hidden" id="activity2">
            <h2>üìñ Activity 2: Reading Comprehension</h2>
            <div class="activity-instructions">
                Read about Sarah's daily routine, then answer the questions below.
            </div>
            
            <div class="reading-text">
                <strong>Sarah's Daily Routine</strong><br><br>
                Sarah is a busy student. She <strong>gets up at 7:00 AM</strong> every morning. First, she <strong>brushes her teeth</strong> and <strong>takes a shower</strong>. Then she <strong>has breakfast</strong> with her family. She usually eats cereal and <strong>drinks orange juice</strong>. After breakfast, she <strong>goes to school</strong> by bus. School starts at 8:30 AM. In the afternoon, she comes home and <strong>does her homework</strong>. She <strong>has dinner</strong> at 6:00 PM. Before bed, she <strong>reads a book</strong> and <strong>goes to sleep</strong> at 10:00 PM.
            </div>

            <div class="question-container" id="reading-q1">
                <div class="question">1. What time does Sarah get up?</div>
                <div class="options">
                    <div class="option" data-answer="wrong">8:00 AM</div>
                    <div class="option" data-answer="correct">7:00 AM</div>
                    <div class="option" data-answer="wrong">6:30 AM</div>
                </div>
            </div>
            
            <div class="question-container" id="reading-q2">
                <div class="question">2. Sarah has breakfast before she brushes her teeth.</div>
                <div class="options">
                    <div class="option" data-answer="wrong">True</div>
                    <div class="option" data-answer="correct">False</div>
                </div>
            </div>

            <div class="question-container" id="reading-q3">
                <div class="question">3. What does Sarah drink at breakfast?</div>
                <div class="options">
                    <div class="option" data-answer="wrong">Coffee</div>
                    <div class="option" data-answer="correct">Orange juice</div>
                    <div class="option" data-answer="wrong">Water</div>
                </div>
            </div>
            
            <div class="feedback-message" id="reading-feedback"></div>
            <button class="btn check-btn" id="reading-check-btn" onclick="checkReadingAnswers()">Check Answers ‚úì</button>
            <button class="btn next-activity-btn" id="reading-next" onclick="nextActivity()">Continue to Next Activity ‚û°Ô∏è</button>
            <button class="btn try-again-btn" id="reading-retry" onclick="retryActivity(2)">Try Again üîÑ</button>
        </div>

        <div class="lesson-card hidden" id="activity3">
            <h2>‚ö° Activity 3: 30-Second Speed Challenge!</h2>
            <div class="activity-instructions">
                How many daily routine activities can you identify? You have 30 seconds to select ALL the correct daily routine activities. Wrong answers will reduce your score!
            </div>
            
            <button class="btn" id="speed-start-btn" onclick="startSpeedChallenge()">üöÄ START CHALLENGE</button>
            
            <div id="speedChallenge" class="hidden">
                <div class="question">Select all DAILY ROUTINE activities:</div>
                <div class="options" id="speedOptions">
                    <div class="option" data-speed="correct">wake up</div>
                    <div class="option" data-speed="correct">brush teeth</div>
                    <div class="option" data-speed="wrong">climb mountains</div>
                    <div class="option" data-speed="correct">have breakfast</div>
                    <div class="option" data-speed="wrong">fly to space</div>
                    <div class="option" data-speed="correct">go to school</div>
                    <div class="option" data-speed="wrong">build robots</div>
                    <div class="option" data-speed="correct">do homework</div>
                    <div class="option" data-speed="correct">have dinner</div>
                    <div class="option" data-speed="wrong">become invisible</div>
                </div>
                <button class="btn check-btn" id="speed-check-btn" onclick="checkSpeedAnswers()">Check Answers ‚úì</button>
            </div>
            
            <div class="feedback-message" id="speed-feedback"></div>
            <button class="btn next-activity-btn" id="speed-next" onclick="nextActivity()">Continue to Next Activity ‚û°Ô∏è</button>
            <button class="btn try-again-btn" id="speed-retry" onclick="retryActivity(3)">Try Again üîÑ</button>
        </div>

        <div class="lesson-card hidden" id="activity4">
            <h2>üéØ Activity 4: Drag and Drop - Fill in the Gaps</h2>
            <div class="activity-instructions">
                Drag the words from the word bank to the correct empty spaces to complete the sentences about Sarah's routine.
            </div>
            
            <div class="word-bank-drag" id="wordBankGap">
                <div class="word-bank-title">üìù Word Bank - Drag these words:</div>
                <span class="word-item-drag" data-word="wakes" draggable="true">wakes</span>
                <span class="word-item-drag" data-word="brushes" draggable="true">brushes</span>
                <span class="word-item-drag" data-word="has" draggable="true">has</span>
                <span class="word-item-drag" data-word="goes" draggable="true">goes</span>
                <span class="word-item-drag" data-word="reads" draggable="true">reads</span>
            </div>
            
            <div class="gap-fill-container">
                <div class="gap-sentence">Sarah <span class="gap-fill-drop-zone" data-correct="wakes"></span> up at 7:00 AM.</div>
                <div class="gap-sentence">She <span class="gap-fill-drop-zone" data-correct="brushes"></span> her teeth.</div>
                <div class="gap-sentence">Then she <span class="gap-fill-drop-zone" data-correct="has"></span> breakfast.</div>
                <div class="gap-sentence">She <span class="gap-fill-drop-zone" data-correct="goes"></span> to school by bus.</div>
                <div class="gap-sentence">Before bed, she <span class="gap-fill-drop-zone" data-correct="reads"></span> a book.</div>
            </div>
            
            <button class="btn check-btn" id="gap-check-btn" onclick="checkGapFill()">Check Answers ‚úì</button>
            
            <div class="feedback-message" id="gap-feedback"></div>
            <button class="btn next-activity-btn" id="gap-next" onclick="nextActivity()">Continue to Next Activity ‚û°Ô∏è</button>
            <button class="btn try-again-btn" id="gap-retry" onclick="retryActivity(4)">Try Again üîÑ</button>
        </div>

        <div class="lesson-card hidden" id="activity5">
            <h2>üîÑ Activity 5: Put Words in Order</h2>
            <div class="activity-instructions">
                Arrange the words to make a correct sentence: "Sarah has breakfast with her family". Tap one word to select it, then tap another to swap their positions.
            </div>
            
            <ul class="sortable-list" id="wordOrder">
                <li class="sortable-item">breakfast</li>
                <li class="sortable-item">has</li>
                <li class="sortable-item">Sarah</li>
                <li class="sortable-item">family</li>
                <li class="sortable-item">with</li>
                <li class="sortable-item">her</li>
            </ul>
            
            <button class="btn check-btn" id="order-check-btn" onclick="checkWordOrder()">Check Order ‚úì</button>
            
            <div class="feedback-message" id="order-feedback"></div>
            <button class="btn next-activity-btn" id="order-next" onclick="nextActivity()">Continue to Next Activity ‚û°Ô∏è</button>
            <button class="btn try-again-btn" id="order-retry" onclick="retryActivity(5)">Try Again üîÑ</button>
        </div>

        <div class="lesson-card hidden" id="activity6">
            <h2>üìö Activity 6: Grammar Challenge</h2>
            <div class="activity-instructions">
                Choose the correct verb form for third person singular (she/he/it).
            </div>
            
            <div class="question-container">
                <div class="question">Choose the correct form: "She _____ her homework every day."</div>
                <div class="options" id="grammar-options">
                    <div class="option" data-grammar="wrong">do</div>
                    <div class="option" data-grammar="correct">does</div>
                    <div class="option" data-grammar="wrong">doing</div>
                    <div class="option" data-grammar="wrong">done</div>
                </div>
            </div>
            
            <div class="feedback-message" id="grammar-feedback"></div>
            <button class="btn check-btn" id="grammar-check-btn" onclick="checkGrammar()">Check Answer ‚úì</button>
            <button class="btn next-activity-btn" id="grammar-next" onclick="nextActivity()">Continue to Final Results ‚û°Ô∏è</button>
            <button class="btn try-again-btn" id="grammar-retry" onclick="retryActivity(6)">Try Again üîÑ</button>
        </div>

        <div class="lesson-card hidden" id="results">
            <h2>üéâ Congratulations!</h2>
            <div id="finalResults"></div>
            <button class="btn" onclick="restartLesson()">üîÑ Play Again</button>
        </div>
    </div>

    <script>
        // --- Global Variables ---
        let currentActivity = 1;
        let totalPoints = 0;
        let streak = 0;
        let currentLevel = 1;
        let timer = null;
        let timeLeft = 0;

        const achievements = [
            { points: 100, text: "üåü Getting Started!", unlocked: false },
            { points: 300, text: "üî• On Fire!", unlocked: false },
            { points: 500, text: "üíé Reading Master!", unlocked: false },
            { points: 700, text: "‚ö° Speed Demon!", unlocked: false },
            { points: 1000, text: "üèÜ English Champion!", unlocked: false }
        ];

        // --- Utility Functions ---
        function updateStats() {
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('streak').textContent = streak;
            document.getElementById('currentLevel').textContent = currentLevel;
            const totalActivities = 6;
            const progress = ((currentActivity - 1) / totalActivities) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            if (totalPoints >= 300 && currentLevel === 1) {
                currentLevel = 2;
                showAchievement("üéä Level Up! Welcome to Level 2!");
            } else if (totalPoints >= 600 && currentLevel === 2) {
                currentLevel = 3;
                showAchievement("üöÄ Level Up! You reached Level 3!");
            }

            achievements.forEach(achievement => {
                if (totalPoints >= achievement.points && !achievement.unlocked) {
                    achievement.unlocked = true;
                    showAchievement(achievement.text);
                }
            });
        }

        function showAchievement(text) {
            const achievement = document.getElementById('achievement');
            achievement.textContent = text;
            achievement.style.display = 'block';
            setTimeout(() => {
                achievement.style.display = 'none';
            }, 3000);
        }

        function showPointsAnimation(points) {
            const animation = document.createElement('div');
            animation.className = 'points-animation';
            animation.textContent = '+' + points + ' points!';
            document.body.appendChild(animation);
            setTimeout(() => {
                animation.remove();
            }, 2000);
        }

        function showSticker(type) {
            const sticker = document.createElement('div');
            sticker.className = 'sticker';
            if (type === 'great') {
                sticker.innerHTML = 'üíØ';
            } else if (type === 'good') {
                sticker.innerHTML = '‚ú®';
            } else {
                sticker.innerHTML = 'ü§î';
            }
            document.body.appendChild(sticker);
            setTimeout(() => {
                sticker.remove();
            }, 1000);
        }

        function showFeedback(activityId, isCorrect, message) {
            const feedbackEl = document.getElementById(activityId + '-feedback');
            feedbackEl.className = 'feedback-message ' + (isCorrect ? 'feedback-correct' : 'feedback-incorrect');
            feedbackEl.textContent = message;
            feedbackEl.style.display = 'block';
            
            const nextBtn = document.getElementById(activityId + '-next');
            const retryBtn = document.getElementById(activityId + '-retry');
            
            if (isCorrect) {
                if (nextBtn) nextBtn.style.display = 'inline-block';
                if (retryBtn) retryBtn.style.display = 'none';
            } else {
                if (nextBtn) nextBtn.style.display = 'none';
                if (retryBtn) retryBtn.style.display = 'inline-block';
            }
        }

        function nextActivity() {
            document.getElementById('activity' + currentActivity).classList.add('hidden');
            currentActivity++;
            if (currentActivity <= 6) {
                setTimeout(() => {
                    const nextActivityEl = document.getElementById('activity' + currentActivity);
                    nextActivityEl.classList.remove('hidden');
                    window.scrollTo({ top: nextActivityEl.offsetTop - 50, behavior: 'smooth' });
                }, 300);
            } else {
                showResults();
            }
        }
        
        function retryActivity(activityNum) {
            if (activityNum === 1) resetMatchingActivity();
            else if (activityNum === 2) resetReadingActivity();
            else if (activityNum === 3) resetSpeedActivity();
            else if (activityNum === 4) resetGapFillActivity();
            else if (activityNum === 5) resetWordOrderActivity();
            else if (activityNum === 6) resetGrammarActivity();
        }
        
        function showResults() {
            document.getElementById('results').classList.remove('hidden');
            let grade = 'Good effort!';
            let emoji = 'üòä';
            if (totalPoints >= 800) {
                grade = 'LEGENDARY! üèÜ';
                emoji = 'üèÜ';
            } else if (totalPoints >= 600) {
                grade = 'Excellent! üåü';
                emoji = 'üåü';
            } else if (totalPoints >= 400) {
                grade = 'Very Good! üëç';
                emoji = 'üëç';
            } else if (totalPoints >= 200) {
                grade = 'Good Job! üòä';
                emoji = 'üòä';
            }
            
            const finalResultsText = `${emoji} You completed all activities!\n\nTotal Points: ${totalPoints}\nFinal Level: ${currentLevel}\nGrade: ${grade}\n\nYou've mastered daily routines vocabulary and grammar!`;
            document.getElementById('finalResults').textContent = finalResultsText;
            window.scrollTo({ top: document.getElementById('results').offsetTop - 50, behavior: 'smooth' });
        }

        function restartLesson() {
            currentActivity = 1;
            totalPoints = 0;
            streak = 0;
            currentLevel = 1;
            achievements.forEach(a => a.unlocked = false);
            
            // Reset all activities
            for (let i = 1; i <= 6; i++) {
                retryActivity(i);
            }
            
            // Show first activity
            document.querySelectorAll('.lesson-card').forEach(card => card.classList.add('hidden'));
            document.getElementById('activity1').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            
            updateStats();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- Activity 1: Matching Game ---
        let selectedVocab = null;
        let selectedDefinition = null;
        let matchesFound = 0;

        function resetMatchingActivity() {
            selectedVocab = null;
            selectedDefinition = null;
            matchesFound = 0;
            document.querySelectorAll('.vocabulary, .definition').forEach(item => {
                item.classList.remove('selected', 'correct', 'incorrect', 'disabled');
            });
            document.getElementById('matchScore').textContent = 'Matches: 0/8';
            document.getElementById('matching-feedback').style.display = 'none';
            document.getElementById('matching-next').style.display = 'none';
        }

        function initializeMatchingGame() {
            document.querySelectorAll('.vocabulary, .definition').forEach(item => {
                item.addEventListener('click', function() {
                    if (this.classList.contains('correct') || this.classList.contains('disabled')) return;
                    
                    if (this.classList.contains('vocabulary')) {
                        if (selectedVocab === this) {
                            selectedVocab.classList.remove('selected');
                            selectedVocab = null;
                        } else {
                            if (selectedVocab) selectedVocab.classList.remove('selected');
                            this.classList.add('selected');
                            selectedVocab = this;
                        }
                    } else if (this.classList.contains('definition')) {
                        if (selectedDefinition === this) {
                            selectedDefinition.classList.remove('selected');
                            selectedDefinition = null;
                        } else {
                            if (selectedDefinition) selectedDefinition.classList.remove('selected');
                            this.classList.add('selected');
                            selectedDefinition = this;
                        }
                    }

                    checkMatch();
                });
            });
        }

        function checkMatch() {
            if (!selectedVocab || !selectedDefinition) return;

            if (selectedVocab.dataset.match === selectedDefinition.dataset.match) {
                // Correct match
                selectedVocab.classList.remove('selected');
                selectedVocab.classList.add('correct');
                selectedDefinition.classList.remove('selected');
                selectedDefinition.classList.add('correct');

                matchesFound++;
                document.getElementById('matchScore').textContent = `Matches: ${matchesFound}/8`;
                totalPoints += 25;
                streak++;
                showPointsAnimation(25);
                showSticker('good');
                updateStats();
                
                if (matchesFound === 8) {
                    totalPoints += 50; // Bonus for completing all
                    showPointsAnimation(50);
                    showFeedback('matching', true, 'Amazing! You matched all the vocabulary words! üéâ');
                }
            } else {
                // Incorrect match
                selectedVocab.classList.remove('selected');
                selectedDefinition.classList.remove('selected');
                selectedVocab.classList.add('incorrect');
                selectedDefinition.classList.add('incorrect');
                
                setTimeout(() => {
                    selectedVocab.classList.remove('incorrect');
                    selectedDefinition.classList.remove('incorrect');
                }, 1000);
                
                streak = 0;
                updateStats();
                showSticker('oops');
            }
            
            selectedVocab = null;
            selectedDefinition = null;
        }

        // --- Activity 2: Reading Comprehension ---
        function initializeReadingActivity() {
            document.querySelectorAll('#activity2 .option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.classList.contains('disabled')) return;
                    
                    const parent = this.closest('.options');
                    parent.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }

        function checkReadingAnswers() {
            let correctAnswers = 0;
            const totalQuestions = 3;
            const answers = [];
            
            // Get all selected answers
            for (let i = 1; i <= 3; i++) {
                const selected = document.querySelector(`#reading-q${i} .option.selected`);
                answers.push(selected);
            }

            // Check if all questions are answered
            if (answers.some(answer => !answer)) {
                showFeedback('reading', false, 'Please answer all three questions before checking.');
                return;
            }

            // Check each answer
            answers.forEach((answer, index) => {
                if (answer.dataset.answer === 'correct') {
                    correctAnswers++;
                    answer.classList.add('correct');
                } else {
                    answer.classList.add('incorrect');
                    // Show correct answer
                    const correctOption = document.querySelector(`#reading-q${index + 1} .option[data-answer="correct"]`);
                    if (correctOption) correctOption.classList.add('correct');
                }
            });
            
            // Disable all options
            document.querySelectorAll('#activity2 .option').forEach(option => option.classList.add('disabled'));
            document.getElementById('reading-check-btn').style.display = 'none';

            if (correctAnswers === totalQuestions) {
                totalPoints += 150;
                streak++;
                updateStats();
                showPointsAnimation(150);
                showSticker('great');
                showFeedback('reading', true, 'Perfect! You answered all the reading comprehension questions correctly! üìö');
            } else {
                totalPoints += correctAnswers * 25; // Partial credit
                streak = 0;
                updateStats();
                showSticker('oops');
                showFeedback('reading', false, `You got ${correctAnswers} out of ${totalQuestions} correct. Keep studying! üìñ`);
            }
        }
        
        function resetReadingActivity() {
            document.querySelectorAll('#activity2 .option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect', 'disabled');
            });
            document.getElementById('reading-check-btn').style.display = 'inline-block';
            document.getElementById('reading-feedback').style.display = 'none';
            document.getElementById('reading-next').style.display = 'none';
            document.getElementById('reading-retry').style.display = 'none';
        }

        // --- Activity 3: Speed Challenge ---
        function initializeSpeedActivity() {
            document.querySelectorAll('#speedOptions .option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.classList.contains('disabled')) return;
                    this.classList.toggle('selected');
                });
            });
        }

        function startSpeedChallenge() {
            document.getElementById('speed-start-btn').classList.add('hidden');
            document.getElementById('speedChallenge').classList.remove('hidden');
            document.getElementById('timer').style.display = 'block';
            timeLeft = 30;
            updateTimer();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimer();
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    checkSpeedAnswers();
                }
            }, 1000);
        }

        function updateTimer() {
            document.getElementById('timeLeft').textContent = timeLeft + 's';
            document.getElementById('timer').textContent = `‚è∞ ${timeLeft}s`;
        }

        function checkSpeedAnswers() {
            clearInterval(timer);
            const options = document.querySelectorAll('#speedOptions .option');
            let score = 0;
            let correctSelected = 0;
            let totalCorrect = 0;
            let incorrectSelected = 0;

            options.forEach(option => {
                option.classList.add('disabled');
                
                if (option.dataset.speed === 'correct') {
                    totalCorrect++;
                    if (option.classList.contains('selected')) {
                        option.classList.add('correct');
                        correctSelected++;
                        score += 20;
                    } else {
                        option.classList.add('incorrect');
                    }
                } else {
                    if (option.classList.contains('selected')) {
                        option.classList.add('incorrect');
                        incorrectSelected++;
                        score -= 10;
                    }
                }
            });

            document.getElementById('timer').style.display = 'none';
            document.getElementById('speed-check-btn').style.display = 'none';

            const isCompleteSuccess = (correctSelected === totalCorrect && incorrectSelected === 0);
            
            if (isCompleteSuccess) {
                totalPoints += 150;
                streak++;
                updateStats();
                showPointsAnimation(150);
                showSticker('great');
                showFeedback('speed', true, `PERFECT! You found all ${totalCorrect} daily routine activities! ‚ö°`);
            } else {
                totalPoints += Math.max(0, score);
                streak = 0;
                updateStats();
                showSticker('oops');
                showFeedback('speed', false, `You found ${correctSelected}/${totalCorrect} correct activities but also selected ${incorrectSelected} wrong ones. Score: ${Math.max(0, score)} points.`);
            }
        }

        function resetSpeedActivity() {
            clearInterval(timer);
            document.getElementById('speed-start-btn').classList.add('hidden');
            document.getElementById('speedChallenge').classList.add('hidden');
            document.getElementById('speed-check-btn').style.display = 'inline-block';
            document.getElementById('speed-feedback').style.display = 'none';
            document.getElementById('speed-next').style.display = 'none';
            document.getElementById('speed-retry').style.display = 'none';
            document.getElementById('timer').style.display = 'none';
            document.getElementById('timeLeft').textContent = '--';
            
            document.querySelectorAll('#speedOptions .option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect', 'disabled');
            });
        }

        // --- Activity 4: Drag and Drop Fill in the Gaps ---
        let draggedItem = null;

        function initializeGapFillActivity() {
            // Randomize word order on load/reset
            const wordBank = document.getElementById('wordBankGap');
            const words = Array.from(wordBank.children).filter(el => el.classList.contains('word-item-drag'));
            words.sort(() => Math.random() - 0.5);
            words.forEach(word => wordBank.appendChild(word));


            document.querySelectorAll('.word-item-drag').forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    if (item.classList.contains('used')) {
                        e.preventDefault();
                        return;
                    }
                    draggedItem = e.target;
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', draggedItem.dataset.word);
                });

                item.addEventListener('dragend', () => {
                    draggedItem = null;
                });
            });

            document.querySelectorAll('.gap-fill-drop-zone').forEach(dropZone => {
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });
                
                dropZone.addEventListener('dragenter', (e) => {
                    e.preventDefault();
                    if (!dropZone.textContent.trim()) {
                        dropZone.style.backgroundColor = '#e8f0ff';
                    }
                });
                
                dropZone.addEventListener('dragleave', (e) => {
                    dropZone.style.backgroundColor = '';
                });
                
                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.style.backgroundColor = '';
                    
                    if (!draggedItem) return;
                    
                    const data = e.dataTransfer.getData('text/plain');
                    
                    // Only allow drop if zone is empty
                    if (!dropZone.textContent.trim()) {
                        dropZone.textContent = data;
                        dropZone.classList.add('filled');
                        draggedItem.classList.add('used');
                        draggedItem.draggable = false;
                    }
                });

                // Allow clicking to remove word
                dropZone.addEventListener('click', () => {
                    if (dropZone.textContent.trim()) {
                        const word = dropZone.textContent.trim();
                        const wordItem = document.querySelector(`.word-item-drag[data-word="${word}"]`);
                        if (wordItem) {
                            wordItem.classList.remove('used');
                            wordItem.draggable = true;
                        }
                        dropZone.textContent = '';
                        dropZone.classList.remove('filled');
                    }
                });
            });
        }

        function checkGapFill() {
            const dropZones = document.querySelectorAll('.gap-fill-drop-zone');
            let correctCount = 0;
            const totalZones = dropZones.length;

            dropZones.forEach(zone => {
                const userAnswer = zone.textContent.trim().toLowerCase();
                const correctAnswer = zone.dataset.correct.toLowerCase();
                
                if (userAnswer === correctAnswer) {
                    zone.classList.add('correct-answer');
                    correctCount++;
                } else {
                    zone.classList.add('incorrect-answer');
                }
            });

            document.getElementById('gap-check-btn').style.display = 'none';

            if (correctCount === totalZones) {
                totalPoints += 120;
                streak++;
                updateStats();
                showPointsAnimation(120);
                showSticker('great');
                showFeedback('gap', true, 'Excellent! All the sentences are completed correctly! üéØ');
            } else {
                totalPoints += correctCount * 15; // Partial credit
                streak = 0;
                updateStats();
                showSticker('oops');
                showFeedback('gap', false, `You got ${correctCount} out of ${totalZones} correct. Try dragging the words again! üîÑ`);
            }
        }

        function resetGapFillActivity() {
            document.querySelectorAll('.gap-fill-drop-zone').forEach(zone => {
                zone.textContent = '';
                zone.classList.remove('filled', 'correct-answer', 'incorrect-answer');
                zone.style.backgroundColor = '';
            });
            
            document.querySelectorAll('.word-item-drag').forEach(item => {
                item.classList.remove('used');
                item.draggable = true;
            });
            
            document.getElementById('gap-check-btn').style.display = 'inline-block';
            document.getElementById('gap-feedback').style.display = 'none';
            document.getElementById('gap-next').style.display = 'none';
            document.getElementById('gap-retry').style.display = 'none';
            
            // Re-randomize on reset
            const wordBank = document.getElementById('wordBankGap');
            const words = Array.from(wordBank.children).filter(el => el.classList.contains('word-item-drag'));
            words.sort(() => Math.random() - 0.5);
            words.forEach(word => wordBank.appendChild(word));
        }

        // --- Activity 5: Word Order ---
        let correctOrder = ["Sarah", "has", "breakfast", "with", "her", "family"];
        let selectedWordForSwap = null;
        
        function initializeWordOrderActivity() {
            const list = document.getElementById('wordOrder');
            
            // Refactored to only use tap-to-swap
            list.addEventListener('click', (e) => {
                const clickedItem = e.target.closest('.sortable-item');
                if (!clickedItem || list.classList.contains('correct-order') || list.classList.contains('incorrect-order')) return;

                if (!selectedWordForSwap) {
                    selectedWordForSwap = clickedItem;
                    selectedWordForSwap.classList.add('selected-item');
                } else if (selectedWordForSwap === clickedItem) {
                    selectedWordForSwap.classList.remove('selected-item');
                    selectedWordForSwap = null;
                } else {
                    swapElements(selectedWordForSwap, clickedItem);
                    selectedWordForSwap.classList.remove('selected-item');
                    selectedWordForSwap = null;
                }
            });
        }
        
        function swapElements(el1, el2) {
            const parent = el1.parentNode;
            const temp = document.createElement('div');
            parent.insertBefore(temp, el1);
            parent.insertBefore(el1, el2);
            parent.insertBefore(el2, temp);
            parent.removeChild(temp);
        }

        function checkWordOrder() {
            const list = document.getElementById('wordOrder');
            const items = Array.from(list.children);
            let isCorrect = true;
            
            items.forEach((item, index) => {
                if (item.textContent.trim() !== correctOrder[index]) {
                    isCorrect = false;
                }
            });

            document.getElementById('order-check-btn').style.display = 'none';
            document.querySelectorAll('.sortable-item').forEach(item => item.classList.remove('selected-item'));

            if (isCorrect) {
                list.classList.add('correct-order');
                totalPoints += 100;
                streak++;
                updateStats();
                showPointsAnimation(100);
                showSticker('great');
                showFeedback('order', true, 'Perfect! You put the sentence in the correct order: "Sarah has breakfast with her family" üîÑ');
            } else {
                list.classList.add('incorrect-order');
                setTimeout(() => list.classList.remove('incorrect-order'), 1500);
                streak = 0;
                updateStats();
                showSticker('oops');
                showFeedback('order', false, 'That\'s not quite right. The correct order is: "Sarah has breakfast with her family". Try again! üîÑ');
            }
        }
        
        function resetWordOrderActivity() {
            const list = document.getElementById('wordOrder');
            const items = Array.from(list.children);
            
            // Shuffle the items
            for (let i = items.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [items[i], items[j]] = [items[j], items[i]];
            }
            
            list.innerHTML = '';
            items.forEach(item => list.appendChild(item));

            list.classList.remove('correct-order', 'incorrect-order');
            document.getElementById('order-check-btn').style.display = 'inline-block';
            document.getElementById('order-feedback').style.display = 'none';
            document.getElementById('order-next').style.display = 'none';
            document.getElementById('order-retry').style.display = 'none';
            selectedWordForSwap = null; // Clear selected word
        }

        // --- Activity 6: Grammar Challenge ---
        function initializeGrammarActivity() {
            document.querySelectorAll('#grammar-options .option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.classList.contains('disabled')) return;
                    
                    document.querySelectorAll('#grammar-options .option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }

        function checkGrammar() {
            const selectedOption = document.querySelector('#grammar-options .option.selected');
            if (!selectedOption) {
                showFeedback('grammar', false, 'Please select an answer before checking.');
                return;
            }

            document.querySelectorAll('#grammar-options .option').forEach(option => option.classList.add('disabled'));
            document.getElementById('grammar-check-btn').style.display = 'none';

            const isCorrect = selectedOption.dataset.grammar === 'correct';

            if (isCorrect) {
                selectedOption.classList.add('correct');
                totalPoints += 80;
                streak++;
                updateStats();
                showPointsAnimation(80);
                showSticker('good');
                showFeedback('grammar', true, 'Correct! The third person singular form is "does." You\'ve completed the lesson! üí™');
            } else {
                selectedOption.classList.add('incorrect');
                const correctAnswer = document.querySelector('#grammar-options .option[data-grammar="correct"]');
                if (correctAnswer) correctAnswer.classList.add('correct');
                streak = 0;
                updateStats();
                showSticker('oops');
                showFeedback('grammar', false, 'Not quite right. Remember: for third person singular (she/he/it), we add "s" or "es" to the verb. üìù');
            }
        }

        function resetGrammarActivity() {
            document.querySelectorAll('#grammar-options .option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect', 'disabled');
            });
            document.getElementById('grammar-check-btn').style.display = 'inline-block';
            document.getElementById('grammar-feedback').style.display = 'none';
            document.getElementById('grammar-next').style.display = 'none';
            document.getElementById('grammar-retry').style.display = 'none';
        }

        // --- Initialization ---
        function initializeGame() {
            updateStats();
            initializeMatchingGame();
            initializeReadingActivity();
            initializeSpeedActivity();
            initializeGapFillActivity();
            initializeWordOrderActivity();
            initializeGrammarActivity();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeGame);
    </script>
</body>
</html>
