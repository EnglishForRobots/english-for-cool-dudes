<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Culture Quest: Business Communication Challenge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #1a202c; /* Dark background for a gaming feel */
        }
        .container-main {
            background-color: #2d3748; /* Darker main container */
        }
        .lesson-section {
            background-color: #4a5568; /* Even darker section background */
        }
        .game-title {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .progress-bar {
            height: 16px;
            background-color: #4a5568;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #667eea);
            transition: width 0.5s ease-in-out;
        }
        .interactive-element {
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .interactive-element:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .correct-answer {
            transform: scale(1.05);
            background-color: #48bb78 !important;
            box-shadow: 0 0 10px #48bb78;
        }
        .incorrect-answer {
            transform: scale(0.95);
            background-color: #f56565 !important;
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        .fill-in-box {
            background-color: #5b6473;
            min-width: 150px;
            padding: 8px 12px;
            border-radius: 6px;
            text-align: center;
        }
        .conversation-fill-box {
            min-width: 150px;
            display: inline-block;
            text-align: center;
            padding: 8px 12px;
            background-color: #5b6473;
            border-radius: 6px;
            font-style: italic;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="container-main mx-auto max-w-6xl rounded-xl shadow-2xl overflow-hidden my-10 border-4 border-gray-700">

        <header class="bg-gradient-to-br from-blue-700 to-purple-800 text-white p-8 md:p-12 text-center relative overflow-hidden">
            <div class="relative z-10">
                <h1 class="text-4xl md:text-6xl font-extrabold mb-2 tracking-tight game-title">Culture Quest</h1>
                <p class="text-xl md:text-2xl font-light opacity-90">Your Business English Adventure</p>
            </div>
        </header>

        <main class="p-4 sm:p-6 md:p-10">
            <div class="bg-gray-800 rounded-lg p-4 mb-8 border border-gray-700 shadow-xl">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xl font-bold text-yellow-400">Score: <span id="score">0</span></span>
                    <span id="feedback-message" class="text-lg font-medium text-green-400 hidden"></span>
                    <span class="text-sm text-gray-400" id="progress-text">0/5 activities complete</span>
                </div>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
                </div>
            </div>
            
            <section id="reading-section" class="lesson-section p-6 md:p-8 rounded-xl shadow-lg mb-8 border border-gray-700">
                <h2 class="text-2xl md:text-3xl font-bold text-yellow-400 mb-4">üìñ Reading: Communication Across Cultures</h2>
                <div class="text-gray-300 space-y-4 text-sm md:text-base">
                    <p>When working with international colleagues, understanding their communication style is key. Anthropologist Edward T. Hall coined the terms "high-context" and "low-context" cultures to describe this difference. In a high-context culture, like Japan or China, much of the communication is implicit‚Äîmeaning is conveyed through non-verbal cues, shared history, and the surrounding context. A simple "yes" might not mean agreement, and a direct "no" is often avoided to preserve harmony. Therefore, it's crucial to read between the lines and pay attention to body language.</p>
                    <p>In contrast, a low-context culture, like Germany or the United States, relies on explicit communication. Information is conveyed primarily through direct language. Messages are clear, detailed, and to the point. What you say is what you mean. In these settings, being too indirect can be seen as evasive or confusing. As a business professional, adapting your style is essential for building trust and avoiding misinterpretations. For example, a project manager from a low-context culture might provide a detailed written plan, while their counterpart from a high-context culture might prefer a verbal discussion to build consensus.</p>
                </div>
                <div class="mt-6">
                    <h3 class="text-xl font-bold text-gray-100 mb-4">Quiz: Reading Check</h3>
                    <p class="text-gray-300 mb-4">According to the text, in which type of culture is a simple "yes" less likely to mean "agreement"?</p>
                    <div id="reading-quiz" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="checkReadingQuiz('A')" class="quiz-option interactive-element bg-gray-600 hover:bg-gray-500 rounded-lg p-4 font-semibold text-left">A) A low-context culture</button>
                        <button onclick="checkReadingQuiz('B')" class="quiz-option interactive-element bg-gray-600 hover:bg-gray-500 rounded-lg p-4 font-semibold text-left">B) A high-context culture</button>
                    </div>
                    <p id="reading-feedback" class="mt-4 text-sm font-medium"></p>
                </div>
            </section>

            <section id="true-false-section" class="lesson-section p-6 md:p-8 rounded-xl shadow-lg mb-8 border border-gray-700">
                <h2 class="text-2xl md:text-3xl font-bold text-yellow-400 mb-4">‚öñÔ∏è True or False?</h2>
                <div class="space-y-4">
                    <p class="text-lg font-medium" id="tf-question">1. A high-context culture relies heavily on clear, explicit written communication.</p>
                    <div class="flex gap-4">
                        <button onclick="checkTrueFalse(false)" class="tf-btn interactive-element bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-6 rounded-full shadow-md">True</button>
                        <button onclick="checkTrueFalse(true)" class="tf-btn interactive-element bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-6 rounded-full shadow-md">False</button>
                    </div>
                    <p id="tf-feedback" class="text-sm italic text-gray-400"></p>
                </div>
            </section>
            
            <section id="idioms-section" class="lesson-section p-6 md:p-8 rounded-xl shadow-lg mb-8 border border-gray-700">
                <h2 class="text-2xl md:text-3xl font-bold text-yellow-400 mb-4">üîó Idioms & Jargon Match</h2>
                <p class="text-gray-400 text-center mb-6">Click an idiom, then click its meaning to make a match!</p>
                <div class="flex flex-col md:flex-row justify-center items-center gap-6">
                    <div id="idioms-container" class="grid grid-cols-1 md:grid-cols-1 gap-4 w-full md:w-1/2">
                        </div>
                    <div id="meanings-container" class="grid grid-cols-1 md:grid-cols-1 gap-4 w-full md:w-1/2">
                        </div>
                </div>
                <div class="text-center mt-6">
                    <span id="idiom-progress" class="text-lg font-medium text-gray-400">0/5 matched</span>
                </div>
            </section>

            <section id="conversation-section" class="lesson-section p-6 md:p-8 rounded-xl shadow-lg mb-8 border border-gray-700">
                <h2 class="text-2xl md:text-3xl font-bold text-yellow-400 mb-4">üó£Ô∏è Business Speak</h2>
                <p class="text-gray-300 mb-4">Fill in the blanks in the conversation below using the words from the bank.</p>
                <div id="conversation-word-bank" class="flex flex-wrap gap-2 justify-center bg-gray-700 p-4 rounded-lg mb-6">
                    </div>
                <div id="conversation-text" class="text-lg text-gray-300 leading-relaxed space-y-4">
                    <p><span class="font-bold text-yellow-400">Alex:</span> Hey, Mark. I'm really happy with where we're headed on the new marketing campaign. It feels like we're finally <span class="conversation-fill-box interactive-element" data-word-index="0"></span>. What are your thoughts?</p>
                    <p><span class="font-bold text-yellow-400">Mark:</span> I agree, Alex. I think the team's initial ideas were a bit too conventional, but once we encouraged them to <span class="conversation-fill-box interactive-element" data-word-index="1"></span>, we saw a lot of innovative proposals.</p>
                    <p><span class="font-bold text-yellow-400">Alex:</span> Totally. That kind of <span class="conversation-fill-box interactive-element" data-word-index="2"></span> is exactly what this project needed. We have to keep innovating to stay ahead of the competition.</p>
                    <p><span class="font-bold text-yellow-400">Mark:</span> Absolutely. I have to run to a meeting now, but let's <span class="conversation-fill-box interactive-element" data-word-index="3"></span> later this afternoon to review the final numbers.</p>
                </div>
                <button onclick="checkConversationBlanks()" class="mt-6 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105">Check Answers</button>
                <div id="conversation-feedback" class="mt-4 text-sm font-medium"></div>
            </section>

            <section id="fill-in-section" class="lesson-section p-6 md:p-8 rounded-xl shadow-lg mb-8 border border-gray-700">
                <h2 class="text-2xl md:text-3xl font-bold text-yellow-400 mb-4">üìù Fill-in-the-Blanks</h2>
                <p class="text-gray-300 mb-4">Complete the sentences with the correct word from the bank below.</p>
                <div id="word-bank" class="flex flex-wrap gap-2 justify-center bg-gray-700 p-4 rounded-lg mb-6">
                    </div>
                <div id="fill-in-text" class="text-lg text-gray-300 leading-relaxed mb-6">
                    <p>When you enter a new market, it's crucial to first understand the local cultural <span class="fill-in-box interactive-element" data-word-index="0"></span>. Misunderstandings often arise from differences in communication styles, especially between high-context and low-context cultures. In high-context settings, a handshake and a respectful tone can be more important than a written contract. By being <span class="fill-in-box interactive-element" data-word-index="1"></span> and observant, you can build trust and establish a strong <span class="fill-in-box interactive-element" data-word-index="2"></span> with your new partners. A strong business relationship is often a key to long-term success, and it's built on a foundation of mutual <span class="fill-in-box interactive-element" data-word-index="3"></span>.</p>
                    <p>A proactive approach to cross-cultural communication involves both a desire to learn and a willingness to <span class="fill-in-box interactive-element" data-word-index="4"></span> to new environments. To succeed, a business must have a clear understanding of the local rules and etiquette, which are often not spelled out in a formal document. It is therefore vital to <span class="fill-in-box interactive-element" data-word-index="5"></span> with local experts who can provide valuable insights and guidance. Effective communication is the <span class="fill-in-box interactive-element" data-word-index="6"></span> for building lasting partnerships and a strong brand <span class="fill-in-box interactive-element" data-word-index="7"></span>.</p>
                </div>
                <button onclick="checkFillInBlanks()" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105">Check Answers</button>
                <div id="fill-in-feedback" class="mt-4 text-sm font-medium"></div>
            </section>

        </main>
        
        <footer class="bg-gray-900 text-center text-gray-500 p-6 md:p-8">
            <p>&copy; 2025 Culture Quest. All rights reserved.</p>
        </footer>

    </div>

    <script>
        // Global state variables for all activities
        let score = 0;
        let matchedIdioms = 0;
        let selectedIdiom = null;
        let selectedMeaning = null;
        let activitiesCompleted = 0;
        let readingQuizDone = false;
        let tfQuizDone = false;
        let idiomsDone = false;
        let conversationDone = false;
        let fillInDone = false;
        
        const idioms = [
            { id: 1, idiom: 'Synergy', meaning: 'The combined effect is greater than the sum of individual efforts.' },
            { id: 2, idiom: 'Paradigm Shift', meaning: 'A fundamental change in approach or underlying assumptions.' },
            { id: 3, idiom: 'Low-hanging fruit', meaning: 'The most easily achieved goals or tasks.' },
            { id: 4, idiom: 'Best practice', meaning: 'A technique or method that has been proven to be superior.' },
            { id: 5, idiom: 'Bandwidth', meaning: 'The capacity to handle a particular task or project.' }
        ];

        const businessIdioms = [
            { id: 6, idiom: 'on the same page', meaning: 'To be in agreement about something.' },
            { id: 7, idiom: 'think outside the box', meaning: 'To think unconventionally or creatively.' },
            { id: 8, idiom: 'blue sky thinking', meaning: 'Creative thinking that is not limited by current reality.' },
            { id: 9, idiom: 'touch base', meaning: 'To briefly make or renew contact with someone.' }
        ];
        
        const conversationBlanksData = ['on the same page', 'think outside the box', 'blue sky thinking', 'touch base'];
        let userConversationWords = new Array(conversationBlanksData.length).fill(null);
        let selectedConversationBlankIndex = null;
        
        const fillInBlanksData = ['norms', 'adaptable', 'rapport', 'trust', 'adjust', 'liaise', 'blueprint', 'identity'];
        let userFillInWords = new Array(fillInBlanksData.length).fill(null);
        let selectedFillInBlankIndex = null;
        
        const totalActivities = 5; // Reading Quiz, T/F, Idioms, Conversation, Gap-Fill

        /**
         * Utility function to update the score, progress bar, and provide feedback.
         * @param {number} points - The points to add to the score.
         * @param {string} message - The feedback message to display.
         * @param {string} type - 'correct' or 'incorrect'.
         */
        function updateScore(points, message, type) {
            score += points;
            document.getElementById('score').textContent = score;

            const feedbackEl = document.getElementById('feedback-message');
            feedbackEl.textContent = message;
            feedbackEl.classList.remove('text-green-400', 'text-red-400', 'hidden');
            if (type === 'correct') {
                feedbackEl.classList.add('text-green-400');
            } else {
                feedbackEl.classList.add('text-red-400');
            }
            setTimeout(() => {
                feedbackEl.classList.add('hidden');
            }, 3000);
        }

        /**
         * Updates the overall progress bar.
         */
        function updateProgress() {
            activitiesCompleted = [readingQuizDone, tfQuizDone, idiomsDone, conversationDone, fillInDone].filter(Boolean).length;
            const percentage = (activitiesCompleted / totalActivities) * 100;
            document.getElementById('progress-fill').style.width = `${percentage}%`;
            document.getElementById('progress-text').textContent = `${activitiesCompleted}/${totalActivities} activities complete`;

            if (activitiesCompleted === totalActivities) {
                updateScore(100, 'All activities completed! You are a Culture Quest Master! üëë', 'correct');
            }
        }
        
        /**
         * Checks the reading comprehension multiple-choice quiz answer.
         * @param {string} selectedOption - The option selected by the user.
         */
        function checkReadingQuiz(selectedOption) {
            if (readingQuizDone) return;
            const feedbackEl = document.getElementById('reading-feedback');
            const quizOptions = document.querySelectorAll('#reading-quiz button');
            
            quizOptions.forEach(btn => btn.classList.remove('correct-answer', 'incorrect-answer'));

            if (selectedOption === 'B') {
                feedbackEl.textContent = 'Correct! In high-context cultures, meaning is often implied, so a "yes" might not be direct agreement.';
                feedbackEl.className = 'mt-4 text-sm font-medium text-green-400';
                document.querySelector(`[onclick="checkReadingQuiz('${selectedOption}')"]`).classList.add('correct-answer');
                updateScore(20, 'Reading quiz correct!', 'correct');
                readingQuizDone = true;
                updateProgress();
            } else {
                feedbackEl.textContent = 'Incorrect. Try again. Remember to read about implicit communication.';
                feedbackEl.className = 'mt-4 text-sm font-medium text-red-400';
                document.querySelector(`[onclick="checkReadingQuiz('${selectedOption}')"]`).classList.add('incorrect-answer');
                updateScore(-5, 'Reading quiz incorrect.', 'incorrect');
            }
        }

        /**
         * Checks the answer for the True/False question.
         * @param {boolean} answer - The correct answer to check against.
         */
        function checkTrueFalse(answer) {
            if (tfQuizDone) return;
            const feedbackEl = document.getElementById('tf-feedback');
            
            if (answer) {
                feedbackEl.textContent = 'Correct! High-context cultures rely on implicit communication, not explicit language.';
                feedbackEl.className = 'text-sm italic text-green-400';
                document.querySelector('.tf-btn.bg-red-600').classList.add('correct-answer');
                updateScore(15, 'True/False question correct!', 'correct');
                tfQuizDone = true;
                updateProgress();
            } else {
                feedbackEl.textContent = 'Incorrect. That statement is false.';
                feedbackEl.className = 'text-sm italic text-red-400';
                document.querySelector('.tf-btn.bg-green-600').classList.add('incorrect-answer');
                updateScore(-5, 'True/False question incorrect.', 'incorrect');
            }
        }

        /**
         * Initializes the idioms matching game by shuffling and displaying pairs.
         */
        function setupIdioms() {
            const idiomsShuffled = [...idioms].sort(() => Math.random() - 0.5);
            const meaningsShuffled = [...idioms].sort(() => Math.random() - 0.5);

            const idiomsContainer = document.getElementById('idioms-container');
            const meaningsContainer = document.getElementById('meanings-container');
            
            idiomsContainer.innerHTML = '';
            meaningsContainer.innerHTML = '';

            idiomsShuffled.forEach(item => {
                const button = document.createElement('button');
                button.textContent = item.idiom;
                button.className = 'idiom-btn interactive-element bg-gray-600 hover:bg-gray-500 rounded-lg p-4 font-semibold shadow-md';
                button.dataset.id = item.id;
                button.onclick = () => selectIdiom(button);
                idiomsContainer.appendChild(button);
            });

            meaningsShuffled.forEach(item => {
                const button = document.createElement('button');
                button.textContent = item.meaning;
                button.className = 'meaning-btn interactive-element bg-gray-600 hover:bg-gray-500 rounded-lg p-4 font-semibold shadow-md';
                button.dataset.id = item.id;
                button.onclick = () => selectMeaning(button);
                meaningsContainer.appendChild(button);
            });
        }

        /**
         * Handles the selection of an idiom button.
         * @param {HTMLElement} button - The button element that was clicked.
         */
        function selectIdiom(button) {
            if (button.disabled) return;
            document.querySelectorAll('.idiom-btn').forEach(btn => btn.classList.remove('bg-yellow-600'));
            button.classList.add('bg-yellow-600');
            selectedIdiom = button;
            checkMatch();
        }

        /**
         * Handles the selection of a meaning button.
         * @param {HTMLElement} button - The button element that was clicked.
         */
        function selectMeaning(button) {
            if (button.disabled) return;
            document.querySelectorAll('.meaning-btn').forEach(btn => btn.classList.remove('bg-yellow-600'));
            button.classList.add('bg-yellow-600');
            selectedMeaning = button;
            checkMatch();
        }

        /**
         * Checks if the selected idiom and meaning match.
         */
        function checkMatch() {
            if (selectedIdiom && selectedMeaning) {
                if (selectedIdiom.dataset.id === selectedMeaning.dataset.id) {
                    selectedIdiom.classList.remove('bg-yellow-600', 'hover:bg-gray-500');
                    selectedMeaning.classList.remove('bg-yellow-600', 'hover:bg-gray-500');
                    selectedIdiom.classList.add('correct-answer');
                    selectedMeaning.classList.add('correct-answer');
                    selectedIdiom.disabled = true;
                    selectedMeaning.disabled = true;
                    selectedIdiom = null;
                    selectedMeaning = null;
                    matchedIdioms++;
                    document.getElementById('idiom-progress').textContent = `${matchedIdioms}/${idioms.length} matched`;
                    updateScore(15, 'Correct! Great match.', 'correct');
                    if (matchedIdioms === idioms.length) {
                        updateScore(50, 'Section complete! All idioms matched! üèÜ', 'correct');
                        idiomsDone = true;
                        updateProgress();
                    }
                } else {
                    updateScore(-5, 'Incorrect match. Try again.', 'incorrect');
                    selectedIdiom.classList.add('incorrect-answer');
                    selectedMeaning.classList.add('incorrect-answer');
                    setTimeout(() => {
                        selectedIdiom.classList.remove('bg-yellow-600', 'incorrect-answer');
                        selectedMeaning.classList.remove('bg-yellow-600', 'incorrect-answer');
                        selectedIdiom = null;
                        selectedMeaning = null;
                    }, 500);
                }
            }
        }
        
        /**
         * Sets up the conversation fill-in-the-blanks section.
         */
        function setupConversationBlanks() {
            const wordBankEl = document.getElementById('conversation-word-bank');
            const words = [...conversationBlanksData].sort(() => Math.random() - 0.5);
            
            wordBankEl.innerHTML = '';
            words.forEach(word => {
                const button = document.createElement('button');
                button.textContent = word;
                button.className = 'fill-in-box interactive-element bg-gray-600 hover:bg-gray-500 rounded-lg p-2 font-semibold shadow-md';
                button.onclick = () => handleConversationWordClick(button, word);
                wordBankEl.appendChild(button);
            });
            
            userConversationWords = new Array(conversationBlanksData.length).fill(null);

            const textEl = document.getElementById('conversation-text');
            textEl.innerHTML = `
                <p><span class="font-bold text-yellow-400">Alex:</span> Hey, Mark. I'm really happy with where we're headed on the new marketing campaign. It feels like we're finally <span class="conversation-fill-box interactive-element" data-word-index="0"></span>. What are your thoughts?</p>
                <p><span class="font-bold text-yellow-400">Mark:</span> I agree, Alex. I think the team's initial ideas were a bit too conventional, but once we encouraged them to <span class="conversation-fill-box interactive-element" data-word-index="1"></span>, we saw a lot of innovative proposals.</p>
                <p><span class="font-bold text-yellow-400">Alex:</span> Totally. That kind of <span class="conversation-fill-box interactive-element" data-word-index="2"></span> is exactly what this project needed. We have to keep innovating to stay ahead of the competition.</p>
                <p><span class="font-bold text-yellow-400">Mark:</span> Absolutely. I have to run to a meeting now, but let's <span class="conversation-fill-box interactive-element" data-word-index="3"></span> later this afternoon to review the final numbers.</p>
            `;
            
            // Add click handlers for the blank boxes
            document.querySelectorAll('.conversation-fill-box').forEach(blank => {
                blank.onclick = () => handleConversationBlankClick(blank);
            });
        }
        
        /**
         * Handles clicks on the word bank buttons for the conversation.
         * @param {HTMLElement} button - The button element that was clicked.
         * @param {string} word - The word on the button.
         */
        function handleConversationWordClick(button, word) {
            if (selectedConversationBlankIndex !== null) {
                userConversationWords[selectedConversationBlankIndex] = word;
                const blankEl = document.querySelector(`#conversation-text [data-word-index="${selectedConversationBlankIndex}"]`);
                blankEl.textContent = word;
                blankEl.classList.add('bg-gray-500');
                button.disabled = true;
                selectedConversationBlankIndex = null; // Deselect the blank
                document.querySelectorAll('.conversation-fill-box').forEach(b => b.classList.remove('bg-blue-600'));
            }
        }

        /**
         * Handles clicks on the conversation blank boxes.
         * @param {HTMLElement} blank - The blank element that was clicked.
         */
        function handleConversationBlankClick(blank) {
            const word = blank.textContent;
            if (word && word !== '') {
                const wordIndex = parseInt(blank.dataset.wordIndex);
                userConversationWords[wordIndex] = null;
                blank.textContent = '';
                blank.classList.remove('bg-gray-500');

                // Re-enable the corresponding button in the word bank
                const wordBankButtons = document.querySelectorAll('#conversation-word-bank button');
                const correspondingButton = Array.from(wordBankButtons).find(btn => btn.textContent === word);
                if (correspondingButton) {
                    correspondingButton.disabled = false;
                }
            } else {
                // Deselect any currently selected blank
                document.querySelectorAll('.conversation-fill-box').forEach(b => b.classList.remove('bg-blue-600'));

                // Select this blank
                selectedConversationBlankIndex = parseInt(blank.dataset.wordIndex);
                blank.classList.add('bg-blue-600');
            }
        }

        /**
         * Checks the user's answers for the conversation activity.
         */
        function checkConversationBlanks() {
            if (conversationDone) return;
            const feedbackEl = document.getElementById('conversation-feedback');
            const blanks = document.querySelectorAll('#conversation-text span.conversation-fill-box');
            let allCorrect = true;
            
            const correctOrder = ['on the same page', 'think outside the box', 'blue sky thinking', 'touch base'];

            blanks.forEach((blank, index) => {
                const isCorrect = userConversationWords[index] === correctOrder[index];
                if (isCorrect) {
                    blank.classList.remove('bg-gray-500');
                    blank.classList.add('correct-answer');
                } else {
                    blank.classList.remove('bg-gray-500');
                    blank.classList.add('incorrect-answer');
                    allCorrect = false;
                }
            });

            if (allCorrect) {
                feedbackEl.textContent = "Excellent! You've used all the phrases correctly in a real-life context.";
                feedbackEl.className = 'mt-4 text-sm font-medium text-green-400';
                updateScore(30, 'Conversation correct!', 'correct');
                conversationDone = true;
                updateProgress();
            } else {
                feedbackEl.textContent = "Some answers are incorrect. Take another shot!";
                feedbackEl.className = 'mt-4 text-sm font-medium text-red-400';
                updateScore(-15, 'Conversation incorrect.', 'incorrect');
                setTimeout(() => {
                    setupConversationBlanks();
                }, 2000);
            }
        }

        /**
         * Sets up the fill-in-the-blanks section.
         */
        function setupFillInBlanks() {
            const wordBankEl = document.getElementById('word-bank');
            const words = [...fillInBlanksData].sort(() => Math.random() - 0.5);

            wordBankEl.innerHTML = '';
            words.forEach(word => {
                const button = document.createElement('button');
                button.textContent = word;
                button.className = 'fill-in-box interactive-element bg-gray-600 hover:bg-gray-500 rounded-lg p-2 font-semibold shadow-md';
                button.onclick = () => handleFillInWordClick(button, word);
                wordBankEl.appendChild(button);
            });
            
            userFillInWords = new Array(fillInBlanksData.length).fill(null);

            document.querySelectorAll('#fill-in-text .fill-in-box').forEach(blank => {
                blank.onclick = () => handleFillInBlankClick(blank);
            });
        }
        
        /**
         * Handles clicks on the word bank buttons for the fill-in activity.
         * @param {HTMLElement} button - The button element that was clicked.
         * @param {string} word - The word on the button.
         */
        function handleFillInWordClick(button, word) {
            if (selectedFillInBlankIndex !== null) {
                userFillInWords[selectedFillInBlankIndex] = word;
                const blankEl = document.querySelector(`#fill-in-text [data-word-index="${selectedFillInBlankIndex}"]`);
                blankEl.textContent = word;
                blankEl.classList.add('bg-gray-500');
                button.disabled = true;
                selectedFillInBlankIndex = null; // Deselect the blank
                document.querySelectorAll('#fill-in-text .fill-in-box').forEach(b => b.classList.remove('bg-blue-600'));
            }
        }
        
        /**
         * Handles clicks on the fill-in blank boxes.
         * @param {HTMLElement} blank - The blank element that was clicked.
         */
        function handleFillInBlankClick(blank) {
            const word = blank.textContent;
            if (word && word !== '') {
                const wordIndex = parseInt(blank.dataset.wordIndex);
                userFillInWords[wordIndex] = null;
                blank.textContent = '';
                blank.classList.remove('bg-gray-500');

                const wordBankButtons = document.querySelectorAll('#word-bank button');
                const correspondingButton = Array.from(wordBankButtons).find(btn => btn.textContent === word);
                if (correspondingButton) {
                    correspondingButton.disabled = false;
                }
            } else {
                document.querySelectorAll('#fill-in-text .fill-in-box').forEach(b => b.classList.remove('bg-blue-600'));
                selectedFillInBlankIndex = parseInt(blank.dataset.wordIndex);
                blank.classList.add('bg-blue-600');
            }
        }

        /**
         * Checks the user's answers for the fill-in-the-blanks activity.
         */
        function checkFillInBlanks() {
            if (fillInDone) return;
            const feedbackEl = document.getElementById('fill-in-feedback');
            const blanks = document.querySelectorAll('#fill-in-text span.fill-in-box');
            let allCorrect = true;
            
            const correctOrder = ['norms', 'adaptable', 'rapport', 'trust', 'adjust', 'liaise', 'blueprint', 'identity'];

            blanks.forEach((blank, index) => {
                const isCorrect = userFillInWords[index] === correctOrder[index];
                if (isCorrect) {
                    blank.classList.remove('bg-gray-500');
                    blank.classList.add('correct-answer');
                } else {
                    blank.classList.remove('bg-gray-500');
                    blank.classList.add('incorrect-answer');
                    allCorrect = false;
                }
            });

            if (allCorrect) {
                feedbackEl.textContent = "Great job! All of your answers are correct.";
                feedbackEl.className = 'mt-4 text-sm font-medium text-green-400';
                updateScore(30, 'Fill-in-blanks correct!', 'correct');
                fillInDone = true;
                updateProgress();
            } else {
                feedbackEl.textContent = "Some answers are incorrect. Let's try that again.";
                feedbackEl.className = 'mt-4 text-sm font-medium text-red-400';
                updateScore(-15, 'Fill-in-blanks incorrect.', 'incorrect');
                setTimeout(() => {
                    setupFillInBlanks();
                }, 2000);
            }
        }
        
        // Initialize all activities on window load
        window.onload = function() {
            setupIdioms();
            setupConversationBlanks();
            setupFillInBlanks();
        };

    </script>
</body>
</html>
