<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="manifest" href="/manifest.json">
    <title>Reset Password - English For Cool Dudes</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* --- GLOBAL STYLES --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; background: #F8F9FB; color: #2C3E50; line-height: 1.6; font-weight: 400; -webkit-font-smoothing: antialiased; }

        /* Header */
        .header { background: #FFFFFF; border-bottom: 1px solid #E5E9F2; padding: 20px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.04); margin-bottom: 20px; }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; gap: 15px; }
        .logo { width: 36px; height: 36px; background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .site-title { font-size: 20px; font-weight: 600; color: #1A202C; letter-spacing: -0.02em; text-decoration: none; }

        .header-buttons { display: flex; align-items: center; gap: 8px; margin-left: 25px; }
        .header-button { text-decoration: none; padding: 7px 14px; border-radius: 6px; font-size: 14px; font-weight: 600; transition: all 0.2s; white-space: nowrap; }
        .header-button.login { background: #F8F9FB; color: #4A5568; border: 1px solid #E5E9F2; }
        .header-button.login:hover { background: #FFFFFF; color: #2C3E50; border-color: #718096; }
        .header-button.signup { background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); color: white; border: 1px solid transparent; }
        .header-button.signup:hover { background: linear-gradient(135deg, #5A6AD0 0%, #6D4396 100%); box-shadow: 0 2px 5px rgba(102, 126, 234, 0.4); }

        /* Ticker Styles */
        #latest-updates-ticker { position: fixed; top: 20px; right: 50%; margin-right: -580px; z-index: 1000; cursor: pointer; background: #FFC107; color: #92400E; padding: 8px 15px; border-radius: 20px; font-size: 14px; font-weight: 600; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); transition: transform 0.2s, background-color 0.2s, opacity 0.2s; border: 2px solid #F59E0B; animation: pulse 2s infinite ease-in-out; text-decoration: none; white-space: nowrap; max-width: 450px; text-overflow: ellipsis; overflow: hidden; display: inline-block; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); } 50% { transform: scale(1.03); box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.6); } 100% { transform: scale(1); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); } }
        #latest-updates-ticker:hover { background: #FFD54F; transform: scale(1.05); animation: none; }

        /* Reset Password Styles */
        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; display: flex; justify-content: center; }
        .reset-box { width: 100%; max-width: 400px; background: #FFFFFF; border: 1px solid #E5E9F2; border-radius: 12px; padding: 40px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
        .reset-title { font-size: 28px; font-weight: 600; color: #1A202C; text-align: center; margin-bottom: 15px; }
        .reset-description { font-size: 14px; color: #718096; text-align: center; margin-bottom: 30px; line-height: 1.5; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 14px; font-weight: 600; color: #4A5568; margin-bottom: 8px; }
        .form-group input { width: 100%; padding: 12px 15px; border: 1px solid #E5E9F2; border-radius: 8px; font-size: 16px; color: #2C3E50; transition: border-color 0.2s, box-shadow 0.2s; }
        .form-group input:focus { border-color: #667EEA; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); outline: none; }
        .reset-submit { width: 100%; padding: 14px 20px; border: none; border-radius: 8px; background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: background-color 0.2s, box-shadow 0.2s; margin-top: 15px; }
        .reset-submit:hover:not(:disabled) { background: linear-gradient(135deg, #5A6AD0 0%, #6D4396 100%); box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3); }
        .reset-submit:disabled { opacity: 0.6; cursor: not-allowed; }
        .reset-links { text-align: center; margin-top: 20px; font-size: 14px; }
        .reset-links a { color: #667EEA; text-decoration: none; font-weight: 600; transition: color 0.2s; }
        .reset-links a:hover { color: #764BA2; text-decoration: underline; }

        .footer { background: #FFFFFF; border-top: 1px solid #E5E9F2; padding: 32px 20px; margin-top: 60px; text-align: center; }
        .footer-text { font-size: 14px; color: #718096; }

        /* Responsive */
        @media (max-width: 1240px) { #latest-updates-ticker { right: 20px; margin-right: 0; } }
        @media (max-width: 480px) { 
            .header-content { gap: 10px; } .logo { font-size: 28px; } .site-title { font-size: 18px; }
            .container { padding: 20px 15px 80px 15px; } .header-buttons { margin-left: 10px; gap: 5px; }
            .header-button { padding: 5px 8px; font-size: 12px; } .reset-box { padding: 30px 20px; }
            .reset-title { font-size: 24px; margin-bottom: 15px; } .form-group input { padding: 10px 12px; }
            #latest-updates-ticker { top: auto; bottom: 0; right: 0; left: 0; margin-right: 0; border-radius: 0; font-size: 13px; padding: 12px 15px; max-width: 100%; text-align: center; border: none; border-top: 2px solid #F59E0B; box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1); }
        }
        @media (max-width: 896px) and (max-height: 480px) and (orientation: landscape) {
            #latest-updates-ticker { top: auto; bottom: 0; right: 0; left: 0; margin-right: 0; border-radius: 0; font-size: 12px; padding: 10px 15px; max-width: 100%; text-align: center; border: none; border-top: 2px solid #F59E0B; box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1); }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <span class="logo">ðŸ˜Ž</span>
            <a href="/" class="site-title">English For Cool Dudes</a>

            <div class="header-buttons">
                <a href="/login/" class="header-button login">Login</a>
                <a href="/signup/" class="header-button signup">Sign Up</a>
            </div>
        </div>
    </header>

    <a href="#" id="latest-updates-ticker" style="opacity: 0;"></a>

    <main class="container">
        <div class="reset-box">
            <h2 class="reset-title">Reset Your Password</h2>
            <p class="reset-description">Enter your email address and we'll send you a link to reset your password.</p>

            <div id="message" style="display: none; margin-bottom: 20px; text-align: center; font-weight: 600; padding: 12px; border-radius: 8px; font-size: 14px;"></div>

            <form id="reset-form" method="POST" action="javascript:void(0);">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" placeholder="you@example.com" required autocomplete="email">
                </div>

                <button type="submit" id="reset-btn" class="reset-submit">
                    Send Reset Link
                </button>
            </form>

            <div class="reset-links">
                Remember your password? <a href="/login/">Log in here</a>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p class="footer-text">Â© 2026 English For Cool Dudes - ðŸ˜Ž</p>
        <div style="margin-top: 10px;">
            <a href="/impressum/" style="color: #667EEA; margin-right: 15px; text-decoration: none;">Impressum</a>
            <a href="/datenschutz/" style="color: #667EEA; text-decoration: none;">DatenschutzerklÃ¤rung</a>
        </div>
    </footer>

    <script src="/tickerData.js"></script>

    <script>
        (function() {
            'use strict';

            // Initialize Supabase
            if (window.supabaseClient) {
                console.log('Supabase already initialized');
                return;
            }

            const SUPABASE_URL = 'https://knwgmrgwbpchqyqxbxea.supabase.co'; 
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtud2dtcmd3YnBjaHF5cXhieGVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MDkyODgsImV4cCI6MjA3ODA4NTI4OH0.qnp2ScwSE77_idmPhpLE98sr46WvLpKtg6refFfC7s8';
            
            const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            window.supabaseClient = supabaseClient;

            const resetForm = document.getElementById('reset-form');
            const emailInput = document.getElementById('email');
            const messageDiv = document.getElementById('message');
            const resetButton = document.getElementById('reset-btn');
            
            function displayMessage(text, isError = false) {
                messageDiv.textContent = text;
                messageDiv.style.color = isError ? '#E53E3E' : '#38A169';
                messageDiv.style.backgroundColor = isError ? '#FFF5F5' : '#F0FFF4';
                messageDiv.style.borderLeft = isError ? '4px solid #E53E3E' : '4px solid #38A169';
                messageDiv.style.display = 'block';
            }
            
            async function handlePasswordReset(event) {
                event.preventDefault();
                event.stopPropagation();
                
                const email = emailInput.value.trim();
                
                if (!email) {
                    displayMessage('Please enter your email address.', true);
                    return;
                }

                resetButton.disabled = true;
                resetButton.textContent = 'Sending...';
                displayMessage('Sending password reset email...', false);
                
                try {
                    // Get the current domain for the redirect URL
                    const redirectUrl = `${window.location.origin}/reset-password/`;
                    
                    const { data, error } = await supabaseClient.auth.resetPasswordForEmail(email, {
                        redirectTo: redirectUrl,
                    });

                    resetButton.disabled = false;
                    resetButton.textContent = 'Send Reset Link'; 

                    if (error) {
                        console.error('Password Reset Error:', error);
                        displayMessage('Failed to send reset email. Please try again.', true);
                    } else {
                        console.log('Password reset email sent:', data);
                        displayMessage('âœ… Check your email! We sent you a password reset link.', false);
                        resetForm.reset();
                        
                        // Optional: Redirect to login after 5 seconds
                        setTimeout(() => {
                            window.location.href = '/login/';
                        }, 5000);
                    }
                } catch (err) {
                    console.error('Unexpected error:', err);
                    displayMessage('An unexpected error occurred. Please try again.', true);
                    resetButton.disabled = false;
                    resetButton.textContent = 'Send Reset Link';
                }
            }

            document.addEventListener('DOMContentLoaded', () => {
                if (typeof startTickerAnimation === "function") {
                    startTickerAnimation();
                }
                
                if (resetForm) {
                    resetForm.addEventListener('submit', handlePasswordReset);
                }
            });
            
            // Service Worker
            if ('serviceWorker' in navigator) {
                const swUrl = '/sw.js?v=' + new Date().getTime();
                navigator.serviceWorker.register(swUrl).catch(err => {
                    console.log('Service Worker registration:', err.message);
                });
            }
        })();
    </script>
</body>
</html>
