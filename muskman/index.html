<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <title>ğŸš€ Elon Musk's Big Bet â€” English For Cool Dudes</title>

    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/init-auth.js"></script>

    <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOKENS â€” exact copy from homepage :root
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
        --blue:         #1CB0F6;
        --blue-shadow:  #1899D6;
        --yellow:       #FFC800;
        --yellow-shadow:#E5B400;
        --green:        #58CC02;
        --green-shadow: #58A700;
        --punch:        #FF4B4B;
        --punch-shadow: #EA2B2B;
        --purple:       #CE82FF;
        --purple-shadow:#A559D9;
        --teal:         #2BDECC;
        --teal-shadow:  #1FBFAF;
        --bg:           #F7F9FA;
        --white:        #FFFFFF;
        --ink:          #4B4B4B;
        --ink-bold:     #111827;
        --ink-3:        #AFAFAF;
        --border:       #E5E5E5;
        --border-heavy: #CECECE;
        --r:            24px;
        --rsm:          16px;
        --rxs:          10px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESET & BASE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }
    body {
        background: var(--bg);
        color: var(--ink);
        font-family: 'Nunito', -apple-system, system-ui, sans-serif;
        line-height: 1.5;
        overflow-x: hidden;
        padding-bottom: 84px;
    }
    @media(min-width:768px){ body { padding-bottom: 0; } }
    a { color: inherit; text-decoration: none; }
    button { font-family: inherit; cursor: pointer; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ANIMATIONS â€” exact from homepage
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @keyframes up    { from{opacity:0;transform:translateY(22px)} to{opacity:1;transform:translateY(0)} }
    @keyframes popin { 0%{opacity:0;transform:scale(.88)} 70%{transform:scale(1.03)} 100%{opacity:1;transform:scale(1)} }
    @keyframes flick { 0%,100%{transform:rotate(-4deg) scale(1)} 50%{transform:rotate(4deg) scale(1.12)} }
    @keyframes shim  { 0%{background-position:-400px 0} 100%{background-position:400px 0} }
    @keyframes nudge { 0%,100%{transform:translateX(0)} 30%{transform:translateX(5px)} }
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
    @keyframes slideIn  { from{opacity:0;transform:translateX(28px)} to{opacity:1;transform:translateX(0)} }
    @keyframes slideOut { from{opacity:1;transform:translateX(0)} to{opacity:0;transform:translateX(-28px)} }
    @keyframes confetti { 0%{opacity:1;transform:translateY(0) rotate(0deg)} 100%{opacity:0;transform:translateY(130px) rotate(400deg)} }

    .u1{animation:up .44s ease both .04s} .u2{animation:up .44s ease both .14s}
    .u3{animation:up .44s ease both .24s} .u4{animation:up .44s ease both .34s}
    .u5{animation:up .44s ease both .44s} .u6{animation:up .44s ease both .54s}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER â€” mirrors homepage exactly
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .header {
        background: var(--white);
        border-bottom: 2px solid var(--border);
        position: sticky; top: 0; z-index: 200;
        padding: 0 20px; height: 60px;
        display: flex; align-items: center;
    }
    .hc { max-width: 900px; width: 100%; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
    .hl { display: flex; align-items: center; gap: 10px; }
    .logo {
        width: 40px; height: 40px; border-radius: 12px;
        background: var(--yellow); border: 2px solid var(--border-heavy);
        display: flex; align-items: center; justify-content: center;
        font-size: 22px; flex-shrink: 0;
        box-shadow: 0 3px 0 var(--border-heavy);
    }
    .site-title { font-size: 18px; font-weight: 900; color: var(--ink-bold); letter-spacing: -.4px; }
    @media(max-width:380px){ .site-title{display:none} }

    /* header stats â€” same chunky pill as homepage auth area */
    .hdr-stats { display: flex; align-items: center; gap: 8px; }
    .hdr-pill {
        display: flex; align-items: center; gap: 5px;
        background: var(--bg); border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy);
        padding: 5px 12px; border-radius: var(--rxs);
        font-size: 14px; font-weight: 900; color: var(--ink-bold);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .page { max-width: 900px; margin: 0 auto; padding: 24px 16px 24px; display: flex; flex-direction: column; gap: 16px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LESSON BANNER â€” blue hero, same treatment as homepage hero
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .lesson-banner {
        background: var(--blue);
        border: 2px solid var(--blue-shadow);
        border-bottom: 6px solid var(--blue-shadow);
        border-radius: var(--r);
        padding: 24px 20px 20px;
        position: relative; overflow: hidden;
    }
    .lesson-banner::after {
        content: 'ğŸš€';
        position: absolute; bottom: -16px; right: 8px;
        font-size: 120px; opacity: .12; pointer-events: none;
        transform: rotate(-20deg);
    }
    .lesson-eyebrow {
        display: inline-block;
        background: var(--yellow); color: var(--ink-bold);
        font-size: 12px; font-weight: 900;
        text-transform: uppercase; letter-spacing: 1.5px;
        padding: 4px 12px; border-radius: 8px;
        border: 2px solid var(--yellow-shadow);
        margin-bottom: 12px;
    }
    .lesson-title {
        font-size: clamp(24px, 6vw, 38px);
        font-weight: 900; color: var(--white);
        letter-spacing: -1px; line-height: 1.1;
        margin-bottom: 6px; position: relative; z-index: 1;
        text-shadow: 0 2px 0 var(--blue-shadow);
    }
    .lesson-sub { font-size: 15px; font-weight: 700; color: rgba(255,255,255,.9); position: relative; z-index: 1; }

    /* progress bar â€” same as hero XP bar */
    .prog-wrap { margin-top: 18px; position: relative; z-index: 1; background: rgba(255,255,255,.2); padding: 12px; border-radius: var(--rsm); }
    .prog-row  { display: flex; justify-content: space-between; font-size: 13px; font-weight: 800; color: var(--white); margin-bottom: 8px; }
    .prog-track{ height: 16px; background: rgba(0,0,0,.15); border-radius: 99px; overflow: hidden; border: 2px solid rgba(0,0,0,.1); }
    .prog-fill { height: 100%; width: 0%; border-radius: 99px; background: var(--yellow); border-top: 4px solid rgba(255,255,255,.4); transition: width .7s cubic-bezier(.4,0,.2,1); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION CARD â€” the chunky-card pattern from homepage
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .sec-card {
        background: var(--white);
        border: 2px solid var(--border-heavy);
        border-bottom: 6px solid var(--border-heavy);
        border-radius: var(--r);
        overflow: hidden;
        opacity: 0; transform: translateY(16px);
        transition: opacity .4s ease, transform .4s ease;
    }
    .sec-card.visible { opacity: 1; transform: translateY(0); }

    /* colour-coded top strip â€” mirrors course card ::before */
    .sec-card::before {
        content: '';
        display: block; height: 8px;
        border-radius: var(--r) var(--r) 0 0;
        margin: -2px -2px 0;  /* bleed to card edge */
    }
    .strip-yellow::before { background: var(--yellow); }
    .strip-blue::before   { background: var(--blue);   }
    .strip-green::before  { background: var(--green);  }
    .strip-purple::before { background: var(--purple); }
    .strip-punch::before  { background: var(--punch);  }
    .strip-teal::before   { background: var(--teal);   }

    .sec-head {
        padding: 14px 20px 12px;
        border-bottom: 2px solid var(--border);
        display: flex; align-items: center; justify-content: space-between; gap: 10px;
    }
    .sec-head-left { display: flex; align-items: center; gap: 10px; }
    .sec-head-icon {
        width: 40px; height: 40px; border-radius: 12px;
        display: flex; align-items: center; justify-content: center;
        font-size: 20px; flex-shrink: 0;
        background: var(--bg); border: 2px solid var(--border-heavy);
        border-bottom: 3px solid var(--border-heavy);
    }
    .sec-head-title { font-size: 16px; font-weight: 900; color: var(--ink-bold); letter-spacing: -.3px; }
    .sec-head-sub   { font-size: 12px; font-weight: 700; color: var(--ink-3); margin-top: 1px; }

    .sec-body { padding: 20px; }
    @media(min-width:768px){ .sec-body { padding: 24px; } }

    /* skeleton */
    .sk { background: linear-gradient(90deg,#EBEBEB 25%,#F5F5F5 50%,#EBEBEB 75%); background-size: 400px 100%; animation: shim 1.4s infinite; border-radius: var(--rsm); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HOT TAKES
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .ht-dots { display: flex; justify-content: center; gap: 6px; margin-bottom: 18px; }
    .ht-dot {
        width: 10px; height: 10px; border-radius: 50%;
        background: var(--border-heavy);
        border: 2px solid var(--border-heavy);
        transition: all .3s;
    }
    .ht-dot.active { width: 26px; border-radius: 6px; background: var(--blue); border-color: var(--blue-shadow); }
    .ht-dot.done   { background: var(--green); border-color: var(--green-shadow); }

    /* take card */
    .ht-card {
        background: var(--bg);
        border: 2px solid var(--border);
        border-radius: var(--rsm);
        padding: 20px;
        animation: slideIn .32s ease both;
    }
    .ht-card.exit { animation: slideOut .22s ease both; }

    .ht-num {
        font-size: 11px; font-weight: 900; color: var(--ink-3);
        text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px;
    }

    /* heat badge â€” uses homepage colour variables exactly */
    .ht-heat {
        display: inline-flex; align-items: center; gap: 5px;
        font-size: 11px; font-weight: 900; text-transform: uppercase;
        letter-spacing: 1px; padding: 4px 12px;
        border-radius: 8px; margin-bottom: 14px;
        border: 2px solid;
    }
    .h1 { background: rgba(88,204,2,.1);  border-color: var(--green-shadow); color: var(--green-shadow); }
    .h2 { background: rgba(255,200,0,.18); border-color: var(--yellow-shadow); color: #8A6400; }
    .h3 { background: rgba(255,75,75,.1);  border-color: var(--punch-shadow);  color: var(--punch-shadow); }

    .ht-statement {
        font-size: clamp(18px, 4.5vw, 24px);
        font-weight: 900; color: var(--ink-bold);
        line-height: 1.3; letter-spacing: -.4px;
        margin-bottom: 18px;
    }

    /* vote buttons â€” the signature press effect */
    .ht-votes { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .ht-btn {
        display: flex; align-items: center; justify-content: center; gap: 6px;
        padding: 14px 12px; min-height: 54px;
        font-size: 15px; font-weight: 900; font-family: inherit;
        border-radius: var(--rsm); border: 2px solid;
        border-bottom-width: 5px;
        -webkit-appearance: none;
        transition: transform .1s, border-bottom-width .1s;
    }
    .ht-btn:active { border-bottom-width: 2px; transform: translateY(3px); }
    .ht-btn { touch-action: manipulation; }
    .opt-btn { touch-action: manipulation; }
    .wb-word { touch-action: manipulation; }
    .btn-check,.btn-reveal,.btn-reset,.briefing-go,.ht-next-btn { touch-action: manipulation; }
    .ht-btn.agree    { background: rgba(88,204,2,.08);   border-color: var(--green-shadow); color: var(--green-shadow); }
    .ht-btn.disagree { background: rgba(255,75,75,.08);  border-color: var(--punch-shadow); color: var(--punch-shadow); }
    .ht-btn.sel-agree    { background: var(--green)  !important; color: var(--white) !important; border-color: var(--green-shadow)  !important; }
    .ht-btn.sel-disagree { background: var(--punch)  !important; color: var(--white) !important; border-color: var(--punch-shadow)  !important; }
    .ht-btn:disabled { opacity: .8; cursor: default; }

    /* reveal â€” appears below votes */
    .ht-reveal {
        margin-top: 14px; overflow: hidden;
        border: 2px solid var(--border-heavy);
        border-radius: var(--rsm);
        display: none;
        animation: up .2s ease both;
    }
    .ht-reveal.show { display: block; }

    .ht-verdict {
        padding: 13px 16px;
        font-size: 16px; font-weight: 900;
        letter-spacing: -.3px;
    }
    /* heat Ã— correct/wrong */
    /* green = you were RIGHT, red = you were WRONG â€” always */
    .ht-verdict.right { background: var(--green); color: var(--white); }
    .ht-verdict.wrong { background: var(--punch); color: var(--white); }
    /* heat only affects size, never colour */
    .ht-verdict.h2    { font-size: 17px; }
    .ht-verdict.h3    { font-size: 18px; font-weight: 900; }

    .ht-explanation {
        padding: 14px 16px;
        font-size: 15px; font-weight: 700; line-height: 1.65;
        color: var(--ink-bold); background: var(--white);
        border-top: 2px solid var(--border);
    }
    .ht-voc {
        color: var(--blue); font-weight: 900;
        border-bottom: 2.5px solid rgba(28,176,246,.4);
        cursor: pointer;
    }

    /* next / finish CTA â€” green with press */
    .ht-next-btn {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; margin-top: 14px; padding: 15px;
        background: var(--blue); color: var(--white);
        font-size: 16px; font-weight: 900; font-family: inherit;
        border: 2px solid var(--blue-shadow); border-bottom: 5px solid var(--blue-shadow);
        border-radius: var(--rsm);
        transition: transform .1s, border-bottom-width .1s;
        animation: float 3s ease-in-out infinite;
    }
    .ht-next-btn:active { border-bottom-width: 2px; transform: translateY(3px); }

    /* complete screen */
    .ht-done {
        text-align: center; padding: 32px 20px;
        animation: popin .4s cubic-bezier(.175,.885,.32,1.275) both;
    }
    .ht-done-icon  { font-size: 60px; display: block; margin-bottom: 10px; }
    .ht-done-title { font-size: 24px; font-weight: 900; color: var(--ink-bold); letter-spacing: -.5px; margin-bottom: 8px; }
    .ht-done-sub   { font-size: 14px; font-weight: 700; color: var(--ink-3); margin-bottom: 22px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BRIEFING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .briefing-skip {
        font-size: 12px; font-weight: 900; color: var(--ink-3);
        background: var(--bg); border: 2px solid var(--border);
        padding: 5px 12px; border-radius: var(--rxs);
        transition: color .15s, border-color .15s;
        -webkit-appearance: none;
    }
    .briefing-skip:hover { color: var(--ink-bold); border-color: var(--border-heavy); }

    .b-block {
        background: var(--bg);
        border: 2px solid var(--border);
        border-left-width: 5px;
        border-radius: 0 var(--rsm) var(--rsm) 0;
        padding: 14px 16px; margin-bottom: 12px;
        animation: up .35s ease both;
    }
    .b-block[data-heat="1"] { border-left-color: var(--blue); }
    .b-block[data-heat="2"] { border-left-color: var(--yellow-shadow); }
    .b-block[data-heat="3"] { border-left-color: var(--punch); }

    .b-label {
        font-size: 11px; font-weight: 900; text-transform: uppercase;
        letter-spacing: 1.5px; margin-bottom: 10px;
    }
    .b-block[data-heat="1"] .b-label { color: var(--blue-shadow); }
    .b-block[data-heat="2"] .b-label { color: #8A6400; }
    .b-block[data-heat="3"] .b-label { color: var(--punch-shadow); }

    .b-rows { display: flex; flex-direction: column; gap: 7px; }
    .b-row  { display: flex; align-items: baseline; gap: 10px; font-size: 14px; }
    .b-key  { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: .8px; min-width: 100px; flex-shrink: 0; }
    .b-val      { font-weight: 800; color: var(--ink-bold); }
    .b-val.hot  { color: var(--punch-shadow); }
    .b-val.warm { color: #8A6400; }
    .b-val.cool { color: var(--blue-shadow); }
    .b-voc { color: var(--blue); font-weight: 900; border-bottom: 2px solid rgba(28,176,246,.35); cursor: pointer; }

    .b-alert {
        margin-top: 12px; padding: 12px 14px;
        background: rgba(255,75,75,.07);
        border: 2px solid rgba(255,75,75,.25);
        border-radius: var(--rsm);
        font-size: 14px; font-weight: 700; color: var(--punch-shadow); line-height: 1.5;
    }
    .b-alert strong { font-weight: 900; }

    /* green go button */
    .briefing-go {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; margin-top: 18px; padding: 16px;
        background: var(--green); color: var(--white);
        font-size: 16px; font-weight: 900; font-family: inherit;
        border: 2px solid var(--green-shadow); border-bottom: 5px solid var(--green-shadow);
        border-radius: var(--rsm);
        transition: transform .1s, border-bottom-width .1s;
    }
    .briefing-go:active { border-bottom-width: 2px; transform: translateY(3px); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUESTION BOXES
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .q-box {
        background: var(--bg);
        border: 2px solid var(--border);
        border-radius: var(--rsm);
        padding: 15px; margin-bottom: 10px;
    }
    .q-text { font-size: 15px; font-weight: 800; color: var(--ink-bold); margin-bottom: 10px; line-height: 1.4; }

    /* option buttons â€” exact homepage press mechanic */
    .opt-btn {
        display: block; width: 100%; text-align: left;
        padding: 13px 15px; min-height: 50px; margin-top: 7px;
        background: var(--white);
        border: 2px solid var(--border-heavy);
        border-bottom: 5px solid var(--border-heavy);
        border-radius: var(--rsm);
        font-size: 14px; font-weight: 800; color: var(--ink);
        font-family: inherit; -webkit-appearance: none;
        transition: transform .1s, border-bottom-width .1s, border-color .15s;
        cursor: pointer;
    }
    .opt-btn:active   { border-bottom-width: 2px; transform: translateY(3px); }
    .opt-btn.selected { border-color: var(--blue); border-bottom-color: var(--blue-shadow); color: var(--blue); background: rgba(28,176,246,.06); }
    .opt-btn.correct  { background: var(--green)  !important; color: var(--white) !important; border-color: var(--green-shadow)  !important; }
    .opt-btn.incorrect{ background: var(--punch)  !important; color: var(--white) !important; border-color: var(--punch-shadow)  !important; }

    /* word bank */
    .word-bank { background: var(--bg); border: 2px solid var(--border); border-radius: var(--rsm); padding: 14px; margin-bottom: 14px; }
    .wb-label  { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px; }
    .wb-words  { display: flex; flex-wrap: wrap; gap: 8px; }
    .wb-word {
        background: var(--white); color: var(--blue);
        padding: 8px 14px; border-radius: var(--rsm);
        border: 2px solid var(--blue-shadow);
        border-bottom: 4px solid var(--blue-shadow);
        font-weight: 900; font-size: 13px; font-family: inherit;
        -webkit-appearance: none;
        transition: transform .1s, border-bottom-width .1s;
    }
    .wb-word:active { border-bottom-width: 2px; transform: translateY(2px); }
    .wb-word.sel  { background: var(--blue); color: var(--white); }
    .wb-word.used { opacity: .22; pointer-events: none; }

    /* gaps */
    .gap-sents { font-size: 15px; font-weight: 700; line-height: 3.6; color: var(--ink); }
    .gap {
        display: inline-block; text-align: center; min-width: 112px;
        background: var(--white); border: 2px dashed var(--blue);
        border-radius: var(--rsm); padding: 4px 10px; margin: 0 3px;
        font-weight: 900; color: var(--blue); font-size: 13px;
        cursor: pointer; min-height: 34px;
        transition: background .15s;
    }
    .gap.correct   { background: var(--green)  !important; border-color: var(--green-shadow)  !important; border-style: solid; color: var(--white); pointer-events: none; }
    .gap.incorrect { background: var(--punch)  !important; border-color: var(--punch-shadow)  !important; border-style: solid; color: var(--white); }

    /* word forms */
    .wf-item   { margin-bottom: 16px; }
    .wf-prompt { font-weight: 800; color: var(--ink-bold); margin-bottom: 7px; font-size: 14px; font-style: italic; line-height: 1.4; }
    .wf-input {
        width: 100%; padding: 13px 15px; min-height: 50px;
        background: var(--white);
        border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy);
        border-radius: var(--rsm);
        font-size: 15px; font-weight: 800; color: var(--ink-bold);
        font-family: inherit;
        transition: border-color .2s;
    }
    .wf-input:focus { outline: none; border-color: var(--blue); border-bottom-color: var(--blue-shadow); }
    .wf-input::placeholder { color: var(--ink-3); font-weight: 700; }
    .wf-input.ok  { border-color: var(--green-shadow) !important; background: rgba(88,204,2,.06); color: var(--green-shadow); }
    .wf-input.bad { border-color: var(--punch-shadow) !important; background: rgba(255,75,75,.06); color: var(--punch-shadow); }

    /* grammar */
    .gram-expl {
        background: var(--bg);
        border: 2px solid var(--border);
        border-left: 5px solid var(--purple);
        border-radius: 0 var(--rsm) var(--rsm) 0;
        padding: 16px; margin-bottom: 16px;
    }
    .gram-expl h4 { font-size: 11px; font-weight: 900; color: var(--purple-shadow); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 8px; }
    .gram-expl p  { font-size: 14px; font-weight: 700; color: var(--ink); margin-bottom: 8px; line-height: 1.5; }
    .gram-ex { padding: 8px 12px; margin: 5px 0; background: rgba(206,130,255,.1); border-left: 3px solid var(--purple); border-radius: 0 8px 8px 0; font-size: 13px; font-weight: 700; line-height: 1.5; }
    .gram-ex strong { color: var(--purple-shadow); font-weight: 900; }

    .gram-card {
        background: var(--bg); border: 2px solid var(--border);
        border-radius: var(--rsm); padding: 15px; margin-bottom: 10px;
    }
    @media(min-width:640px){ .gram-card { display: flex; align-items: center; gap: 16px; } }
    .gc-body { margin-bottom: 10px; flex: 1; }
    @media(min-width:640px){ .gc-body { margin-bottom: 0; } }
    .gc-sent { font-weight: 800; color: var(--ink-bold); font-size: 15px; margin-bottom: 4px; line-height: 1.4; }
    .gc-hint { font-size: 12px; font-weight: 700; color: var(--ink-3); font-style: italic; }
    .gram-sel {
        width: 100%; padding: 12px 14px; min-height: 48px;
        background: var(--white); border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy);
        border-radius: var(--rsm); font-size: 14px; font-weight: 800;
        color: var(--ink); font-family: inherit; -webkit-appearance: none;
        transition: border-color .15s;
    }
    @media(min-width:640px){ .gram-sel { width: auto; min-width: 210px; } }
    .gram-sel.correct  { background: var(--green); color: var(--white); border-color: var(--green-shadow); }
    .gram-sel.incorrect{ background: var(--punch); color: var(--white); border-color: var(--punch-shadow); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BUTTONS (check / reveal / reset)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn-row { margin-top: 18px; display: flex; flex-direction: column; gap: 10px; align-items: stretch; }
    @media(min-width:640px){ .btn-row { flex-direction: row; justify-content: center; align-items: center; } }

    .btn-check, .btn-reveal, .btn-reset {
        padding: 13px 24px; min-height: 50px;
        font-size: 15px; font-weight: 900; font-family: inherit;
        border-radius: var(--rsm); border: 2px solid;
        border-bottom-width: 5px;
        -webkit-appearance: none;
        transition: transform .1s, border-bottom-width .1s;
    }
    @media(min-width:640px){ .btn-check,.btn-reveal,.btn-reset { width: auto; } }
    .btn-check:active, .btn-reveal:active, .btn-reset:active { border-bottom-width: 2px; transform: translateY(3px); }

    .btn-check  { background: var(--blue);   color: var(--white); border-color: var(--blue-shadow);   }
    .btn-reveal { background: rgba(206,130,255,.15); color: var(--purple-shadow); border-color: var(--purple); }
    .btn-reset  { background: var(--bg); color: var(--ink-3); border-color: var(--border-heavy); }

    /* result feedback */
    .result {
        margin-top: 12px; padding: 13px 16px;
        border-radius: var(--rsm); font-weight: 800; font-size: 15px;
        border: 2px solid; display: none;
    }
    .result.ok  { background: rgba(88,204,2,.09);  color: var(--green-shadow); border-color: var(--green-shadow); }
    .result.bad { background: rgba(255,75,75,.09); color: var(--punch-shadow); border-color: var(--punch-shadow); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOTTOM NAV â€” mobile only, mirrors homepage tabs
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .bot-nav {
        position: fixed; bottom: 0; left: 0; right: 0;
        background: var(--white); border-top: 2px solid var(--border);
        padding: 10px 16px;
        padding-bottom: calc(10px + env(safe-area-inset-bottom));
        display: flex; align-items: center; gap: 10px; z-index: 200;
    }
    @media(min-width:768px){ .bot-nav { display: none; } }
    .bn-btn {
        flex: 1; background: var(--bg); color: var(--ink-bold);
        border: 2px solid var(--border-heavy); border-bottom: 4px solid var(--border-heavy);
        padding: 12px; border-radius: var(--rsm);
        font-weight: 900; font-size: 15px; min-height: 50px;
        font-family: inherit; -webkit-appearance: none;
        transition: transform .1s, border-bottom-width .1s;
    }
    .bn-btn:active { border-bottom-width: 2px; transform: translateY(2px); }
    .bn-btn.primary { flex: 2; background: var(--blue); color: var(--white); border-color: var(--blue-shadow); }
    .bn-btn:disabled { opacity: .35; cursor: not-allowed; }
    .bn-ind { font-size: 12px; font-weight: 900; color: var(--ink-3); white-space: nowrap; text-align: center; min-width: 40px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VOCAB POPUP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #voc-popup {
        position: fixed; bottom: 76px; left: 12px; right: 12px;
        background: var(--white);
        border: 2px solid var(--border-heavy);
        border-bottom: 6px solid var(--border-heavy);
        border-top: 4px solid var(--blue);
        padding: 18px 18px 20px; border-radius: var(--r) var(--r) var(--rsm) var(--rsm);
        z-index: 500; display: none;
        box-shadow: 0 -8px 32px rgba(0,0,0,.12);
        animation: up .22s ease both;
        max-height: 46vh; overflow-y: auto;
    }
    @media(min-width:768px){
        #voc-popup { position: fixed; bottom: 24px; right: 24px; left: auto; max-width: 310px; border-radius: var(--r); border-top-width: 4px; }
    }
    .vp-close {
        position: absolute; top: 10px; right: 10px;
        width: 32px; height: 32px; border-radius: var(--rxs);
        background: var(--bg); border: 2px solid var(--border-heavy);
        font-size: 18px; font-weight: 900; color: var(--ink-3);
        display: flex; align-items: center; justify-content: center;
        -webkit-appearance: none;
    }
    .voc-word { font-size: 22px; font-weight: 900; color: var(--blue-shadow); letter-spacing: -.4px; margin-bottom: 2px; }
    .voc-type { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
    .voc-def  { font-size: 14px; font-weight: 700; color: var(--ink); line-height: 1.65; margin-bottom: 14px; }
    .voc-hear {
        width: 100%; padding: 13px;
        background: var(--blue); color: var(--white);
        border: 2px solid var(--blue-shadow); border-bottom: 5px solid var(--blue-shadow);
        border-radius: var(--rsm); font-size: 15px; font-weight: 900; font-family: inherit;
        transition: transform .1s, border-bottom-width .1s;
    }
    .voc-hear:active { border-bottom-width: 2px; transform: translateY(3px); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BADGES
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .badge-wrap { position: fixed; top: 70px; right: 12px; display: flex; flex-direction: column; gap: 8px; z-index: 999; }
    .badge {
        background: var(--white);
        border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy);
        border-left: 4px solid var(--yellow);
        padding: 10px 14px; border-radius: var(--rsm);
        display: flex; align-items: center; gap: 8px;
        transform: translateX(240px); opacity: 0;
        transition: transform .4s, opacity .4s;
        box-shadow: 0 4px 14px rgba(0,0,0,.1);
    }
    .badge.show { transform: translateX(0); opacity: 1; }
    .badge-icon { font-size: 22px; }
    .badge-text { font-size: 13px; font-weight: 900; color: var(--ink-bold); }

    /* confetti */
    .confetti-dot {
        position: fixed; width: 10px; height: 10px; border-radius: 3px;
        pointer-events: none; z-index: 9999;
        animation: confetti .9s ease-out both;
    }

    /* â”€â”€ SECTION DIVIDERS â€” exact homepage pattern â”€â”€ */
    .sec-label {
        font-size: 13px; font-weight: 900; color: var(--ink-3);
        text-transform: uppercase; letter-spacing: 1.5px;
        margin-bottom: 0; display: flex; align-items: center; gap: 12px;
    }
    .sec-label::after { content: ''; flex: 1; height: 2px; background: var(--border); border-radius: 2px; }

    /* â”€â”€ VOCAB GLOSSARY CARD â”€â”€ */
    .voc-grid { display: grid; grid-template-columns: 1fr; gap: 8px; }
    @media(min-width:600px){ .voc-grid { grid-template-columns: 1fr 1fr; } }
    .voc-item {
        background: var(--bg); border: 2px solid var(--border);
        border-radius: var(--rsm); padding: 12px 14px;
        display: flex; flex-direction: column; gap: 3px;
        cursor: pointer; transition: border-color .15s;
    }
    .voc-item:hover { border-color: var(--blue); }
    .voc-item-word { font-size: 15px; font-weight: 900; color: var(--blue-shadow); letter-spacing: -.2px; }
    .voc-item-type { font-size: 10px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 1px; }
    .voc-item-def  { font-size: 13px; font-weight: 700; color: var(--ink); line-height: 1.45; margin-top: 2px; }

    /* â”€â”€ MOBILE KEYBOARD NUDGE â”€â”€ */
    @media(max-width:768px){
        .wf-input:focus, .gram-sel:focus { font-size: 16px; /* prevents iOS zoom */ }
    }

    /* â”€â”€ HINT SYSTEM â”€â”€ */
    .hint-btn {
        display: inline-flex; align-items: center; gap: 4px;
        font-size: 12px; font-weight: 900; color: var(--ink-3);
        background: none; border: none; padding: 4px 0;
        cursor: pointer; font-family: inherit;
        transition: color .15s;
    }
    .hint-btn:hover { color: var(--purple-shadow); }
    .hint-text {
        font-size: 12px; font-weight: 700; color: var(--purple-shadow);
        background: rgba(206,130,255,.1); border: 1px solid rgba(206,130,255,.3);
        border-radius: 8px; padding: 6px 10px; margin-top: 6px;
        display: none; line-height: 1.4;
    }
    .hint-text.show { display: block; }

    /* â”€â”€ SMOOTH SCROLL OFFSET for sticky header â”€â”€ */
    .sec-card { scroll-margin-top: 72px; }

    </style>
</head>
<body>

<!-- â”€â”€ HEADER â”€â”€ -->
<header class="header">
    <div class="hc">
        <div class="hl">
            <a href="/" class="logo">ğŸš€</a>
            <a href="/" class="site-title">English For Cool Dudes</a>
        </div>
        <div class="hdr-stats">
            <div class="hdr-pill">ğŸ”¥ <span id="hdr-streak">0</span></div>
            <div class="hdr-pill">âš¡ <span id="hdr-xp">0</span> XP</div>
        </div>
    </div>
</header>

<!-- Floating elements -->
<div class="badge-wrap" id="badge-wrap"></div>
<div id="voc-popup">
    <button class="vp-close" onclick="closeVoc()">Ã—</button>
    <div id="vp-body"></div>
</div>

<div class="page">

    <!-- â‘  LESSON BANNER -->
    <div class="lesson-banner u1">
        <div class="lesson-eyebrow">âš¡ Intermediate Â· Business English</div>
        <div class="lesson-title">Elon Musk's Big Bet</div>
        <div class="lesson-sub">SpaceX + X + xAI â€” the $1.5 trillion IPO. Fact or hype?</div>
        <div class="prog-wrap">
            <div class="prog-row">
                <span id="prog-label">0 / 7 sections</span>
                <span id="prog-pct">0%</span>
            </div>
            <div class="prog-track"><div class="prog-fill" id="prog-fill"></div></div>
        </div>
    </div>

    <!-- â‘¡ SECTIONS â€” injected by JS -->
    <div id="sections"></div>

</div>

<!-- Mobile bottom nav -->
<nav class="bot-nav">
    <button class="bn-btn" id="bn-prev" onclick="prevSec()" disabled>â† Back</button>
    <span class="bn-ind" id="bn-ind">1/7</span>
    <button class="bn-btn primary" id="bn-next" onclick="nextSec()">Next â†’</button>
</nav>

<script src="/supabase-auth-gamified.js"></script>
<script src="/daily-challenges-system.js"></script>
<script src="/word-match-game.js"></script>

<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LESSON DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const L = {
    title:      "ğŸš€ Elon Musk's Big Bet",
    lessonId:   "spacex-elon-musk",
    lessonLink: "/spacex-elon-musk/",
    levelPage:  "/intermediate/",
    level:      "Intermediate",

    vocabulary: [
        { word:"IPO",          type:"noun",
          definition:"Initial Public Offering â€” when a private company sells shares to the public for the first time." },
        { word:"Valuation",    type:"noun",
          definition:"The estimated financial worth of a company, based on investor belief â€” not just cash in the bank." },
        { word:"Merger",       type:"noun",
          definition:"When two or more companies combine and become a single entity." },
        { word:"Revenue",      type:"noun",
          definition:"The total money a company earns from its business activities, before costs are deducted." },
        { word:"Profitable",   type:"adjective",
          definition:"Making more money than is spent â€” generating a net profit." },
        { word:"Prospectus",   type:"noun",
          definition:"An official legal document published before an IPO, containing full financial details for investors." },
        { word:"Run rate",     type:"phrase",
          definition:"A projection of annual performance based on current short-term figures." },
        { word:"Shares",       type:"noun",
          definition:"Units of ownership in a company that can be bought and sold by investors." },
        { word:"Tripartite",   type:"adjective",
          definition:"Consisting of or involving three parties, groups or elements." },
        { word:"Far-fetched",  type:"adjective",
          definition:"Unlikely or difficult to believe â€” implausible or unrealistic." }
    ],

    /* heat: 1=warm 2=spicy 3=nuclear â€” drives colour + size of verdict */
    hotTakes: [
        {
            statement: "SpaceX is worth more than the entire economy of the Netherlands. ğŸ‡³ğŸ‡±",
            answer: true, heat: 2,
            verdict: { right:"ğŸ”¥ Correct â€” and genuinely wild.", wrong:"ğŸ˜¬ Actually TRUE â€” wild, right?" },
            explain:`SpaceX's <span data-voc="Valuation" class="ht-voc">valuation</span>: $1.5 trillion. Netherlands GDP: $1.1 trillion. One rocket company, worth more than an entire country's output.`
        },
        {
            statement: "Buying SpaceX shares means buying Twitter too. Whether you like it or not. ğŸ¦",
            answer: true, heat: 3,
            verdict: { right:"ğŸŒ¶ï¸ Nailed it â€” it's all or nothing.", wrong:"ğŸ¤¯ Yep â€” it's a bundle deal." },
            explain:`X merged with xAI, then both merged with SpaceX â€” a <span data-voc="Tripartite" class="ht-voc">tripartite</span> deal. One <span data-voc="IPO" class="ht-voc">IPO</span>, three companies. No Ã  la carte.`
        },
        {
            statement: "xAI losing $5B a year makes the whole SpaceX deal a bad investment. ğŸ“‰",
            answer: false, heat: 3,
            verdict: { right:"ğŸš€ Exactly â€” it's more nuanced than that.", wrong:"ğŸ”¥ Not necessarily â€” SpaceX profits $8B." },
            explain:`xAI's <span data-voc="Run rate" class="ht-voc">run rate</span> is âˆ’$5B/year. But SpaceX made $8B profit. Combined: still +$3B. A bad deal? Only if you think AI will never pay off.`
        },
        {
            statement: "Paying 500Ã— a company's earnings for its shares is normal in tech. ğŸ’¸",
            answer: false, heat: 3,
            verdict: { right:"ğŸ’¯ Right â€” 500Ã— is extreme, even for Silicon Valley.", wrong:"ğŸŒ¶ï¸ Nope â€” that's seriously far-fetched." },
            explain:`Typical tech P/E ratio: 30â€“60Ã—. SpaceX implies 500Ã—. Most analysts won't invest until they've read the <span data-voc="Prospectus" class="ht-voc">prospectus</span>.`
        },
        {
            statement: "SpaceX is already profitable â€” before selling a single share. ğŸš€",
            answer: true, heat: 1,
            verdict: { right:"âœ… Correct â€” rare for a hyped IPO.", wrong:"ğŸ˜® Actually yes â€” $8B profit on $15B revenue." },
            explain:`$15B <span data-voc="Revenue" class="ht-voc">revenue</span>. $8B profit. Already <span data-voc="Profitable" class="ht-voc">profitable</span> before the hype even starts â€” that's the real story.`
        },
        {
            statement: "A company's valuation = how much cash it has in the bank. ğŸ¦",
            answer: false, heat: 1,
            verdict: { right:"ğŸ’¡ Exactly â€” it's belief, not a bank balance.", wrong:"âŒ Nope â€” valuation is what investors believe it's worth." },
            explain:`<span data-voc="Valuation" class="ht-voc">Valuation</span> = investor belief in future growth. A company with $1 in the bank can be valued at $1 billion. It's opinion, not cash.`
        }
    ],

    briefing: [
        {
            heat:1, label:"ğŸ¢  The Deal",
            rows:[
                { key:"Companies",    val:`SpaceX + X (Twitter) + xAI`,                                     style:"" },
                { key:"Structure",    val:`One <span data-voc="Tripartite" class="b-voc">tripartite</span> merger`,   style:"" },
                { key:"IPO date",     val:"July 2026",                                                       style:"cool" },
                { key:"Status",       val:"Going public for the first time",                                 style:"" }
            ]
        },
        {
            heat:2, label:"ğŸ’°  The Numbers",
            rows:[
                { key:"Valuation",    val:"$1.5 trillion",  style:"warm" },
                { key:"Revenue",      val:"$15 billion",    style:"" },
                { key:"SpaceX profit",val:"$8 billion",     style:"" },
                { key:"xAI losses",   val:"âˆ’$5B / year",    style:"hot" }
            ]
        },
        {
            heat:3, label:"ğŸŒ¶ï¸  The Controversy",
            rows:[
                { key:"Price ratio",  val:"500Ã— earnings",             style:"hot" },
                { key:"Normal range", val:"30â€“60Ã— for tech companies", style:"" },
                { key:"Verdict",      val:`<span data-voc="Far-fetched" class="b-voc">Far-fetched</span> â€” until they see the <span data-voc="Prospectus" class="b-voc">prospectus</span>`, style:"" }
            ],
            alert:`Buying <strong>shares</strong> means buying all three companies. There is no Ã  la carte option.`
        }
    ],

    exercises: [
        {
            type:"trueFalse",   col:"green",
            icon:"âœ…",          title:"True or False?",
            sub:"Tap True or False for each statement",
            questions:[
                { q:"SpaceX was valued at $1.5 trillion in late 2025.",       a:true  },
                { q:"xAI was losing around $5 billion per year in 2025.",      a:true  },
                { q:"SpaceX is currently a profitable company.",               a:true  },
                { q:"Investors can buy SpaceX shares without buying xAI.",     a:false },
                { q:"The SpaceX IPO is planned for July 2026.",                a:true  }
            ]
        },
        {
            type:"multipleChoice", col:"blue",
            icon:"ğŸ¯",             title:"Comprehension Check",
            sub:"Choose the best answer for each question",
            questions:[
                { q:"What does 'going public' mean for SpaceX?",
                  opts:["SpaceX will publish all its secret rocket designs","SpaceX will sell shares to ordinary investors for the first time","SpaceX will become a government-owned company"],
                  correct:1 },
                { q:"Why might investors be cautious about the $1.5 trillion valuation?",
                  opts:["SpaceX has never successfully launched a rocket","The share price implies 500Ã— earnings â€” extreme even for tech","Elon Musk plans to retire before the IPO"],
                  correct:1 },
                { q:"What is the correct order of the mergers?",
                  opts:["SpaceX merged with X, then xAI joined","xAI merged with SpaceX, then X joined","X and xAI merged first, then the result merged with SpaceX"],
                  correct:2 }
            ]
        },
        {
            type:"gapFill", col:"purple",
            icon:"ğŸ§©",      title:"Fill the Gaps",
            sub:"Select a word from the bank, then tap a blank to fill it",
            wordBank:["merger","prospectus","valuation","profitable","shares","run rate"],
            sentences:[
                { t:"The SpaceX ___ is set at $1.5 trillion.",                           a:"valuation"  },
                { t:"Investors who buy ___ own part of all three companies.",             a:"shares"     },
                { t:"The ___ of X and xAI happened before SpaceX was involved.",         a:"merger"     },
                { t:"Unlike xAI, SpaceX is ___ â€” it makes more than it spends.",         a:"profitable" },
                { t:"The analyst said he'd wait for the official ___ before investing.",  a:"prospectus" },
                { t:"xAI's annual ___ for losses is around $5 billion.",                 a:"run rate"   }
            ]
        },
        {
            type:"wordForms", col:"punch",
            icon:"ğŸ”¤",        title:"Word Forms",
            sub:"Complete each sentence with the correct word form",
            questions:[
                { p:`The two companies will ___. (merger â†’ verb)`,                                         a:"merge"        },
                { p:`xAI is not making money â€” it is currently ___. (profitable â†’ opposite adjective)`,    a:"unprofitable" },
                { p:`He made a ___ investment in the company. (value â†’ 'worth a lot' adjective)`,          a:"valuable"     },
                { p:`The SpaceX and xAI deal was a ___. (merge â†’ noun)`,                                   a:"merger"       }
            ]
        },
        {
            type:"grammar", col:"teal",
            icon:"ğŸ“–",      title:"Future Forms",
            sub:"Choose the correct future form for each sentence",
            explanation:{
                heading:"Future Forms",
                text:"English has three main future forms â€” each shows a different type of prediction or plan.",
                examples:[
                    { label:"will â€” general prediction:",           text:`Analysts think SpaceX <strong>will generate</strong> $23bn next year.` },
                    { label:"going to â€” firm/known plan:",          text:`Musk <strong>is going to</strong> launch the IPO in July.` },
                    { label:"present continuous â€” fixed arrangement:", text:`SpaceX <strong>is listing</strong> its shares this summer.` }
                ]
            },
            questions:[
                { s:"Analysts predict SpaceX ___ $23bn in revenue next year.",  hint:"General prediction â†’ will",          opts:["generates","will generate","is generating"], a:"will generate"    },
                { s:"Musk ___ all three companies under one IPO.",               hint:"Firm plan â†’ going to",                opts:["will merge","is going to merge","merges"],   a:"is going to merge"},
                { s:"The IPO ___ in July 2026 â€” the date is confirmed.",         hint:"Fixed arrangement â†’ present continuous", opts:["happens","will happen","is happening"],  a:"is happening"     },
                { s:"If the numbers look bad, many investors ___ participate.",   hint:"Negative prediction â†’ won't",        opts:["won't","aren't going to","don't"],           a:"won't"            }
            ]
        }
    ],

    badges:[
        { icon:"ğŸš€", text:"Launch Ready!"  },
        { icon:"ğŸ’°", text:"Market Genius!" },
        { icon:"ğŸ†", text:"Hot Take Pro!"  },
        { icon:"ğŸ¤–", text:"AI Expert!"     },
        { icon:"ğŸ“ˆ", text:"Bull Market!"   },
        { icon:"â­", text:"Star Investor!" },
        { icon:"ğŸ”¥", text:"On Fire!"       }
    ],

    grammar:[
        { question:"will generate",      answer:"will generate",     explanation:"Will for general predictions" },
        { question:"is going to merge",  answer:"is going to merge", explanation:"Going to for firm plans" },
        { question:"is happening",       answer:"is happening",      explanation:"Present continuous for fixed arrangements" },
        { question:"won't",              answer:"won't",             explanation:"Will not for negative predictions" }
    ]
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let curSec   = 0;
let doneSecs = 0;
let htVoted  = false;
let htIdx    = 0;
let selWord  = null;
// 0=hotTakes  1=briefing  2..n=exercises
const TOTAL  = 2 + L.exercises.length;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function build() {
    const wrap = document.getElementById('sections');
    let html = '';
    html += secCard(0, true,  'strip-yellow', buildHotTakes());
    html += secCard(1, false, 'strip-blue',   buildBriefing());

    // Section dividers â€” homepage pattern
    const divider = (txt) => `<div class="sec-label">${txt}</div>`;
    html += divider('ğŸ“ Practice Exercises');

    L.exercises.forEach((ex, i) => {
        const n    = i + 2;
        const body = buildExercise(ex, n);
        html += secCard(n, false, `strip-${ex.col}`,
            head(ex.icon, ex.title, ex.sub, n) +
            `<div class="sec-body">${body}</div>`);
    });
    // Vocab glossary â€” always last
    html += divider('ğŸ“– Vocabulary Glossary');
    html += buildGlossary();

    wrap.innerHTML = html;
    updateNav(); updateProg();
    setTimeout(wireAll, 60);
}

function secCard(n, visible, strip, inner) {
    return `<div class="sec-card${visible?' visible':''} ${strip}" data-sec="${n}">${inner}</div>`;
}

function head(icon, title, sub, n, extra='') {
    return `<div class="sec-head">
        <div class="sec-head-left">
            <div class="sec-head-icon">${icon}</div>
            <div><div class="sec-head-title">${title}</div><div class="sec-head-sub">${sub}</div></div>
        </div>${extra}
    </div>`;
}

/* â”€â”€ HOT TAKES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildHotTakes() {
    const dots = L.hotTakes.map((_,i) =>
        `<div class="ht-dot${i===0?' active':''}" id="htd-${i}"></div>`).join('');
    return head('ğŸ”¥','Hot Takes','Agree or Disagree â€” then get the real story', 0) +
        `<div class="sec-body">
            <div class="ht-dots">${dots}</div>
            <div id="ht-slot">${renderHT(0)}</div>
        </div>`;
}

function renderHT(idx) {
    const h = L.hotTakes[idx];
    const heatLabel = ['','ğŸŸ¢ Warm','ğŸŸ¡ Spicy','ğŸ”´ Nuclear'][h.heat];
    const isLast    = idx === L.hotTakes.length - 1;
    return `<div class="ht-card" id="ht-card">
        <div class="ht-num">Hot Take ${idx+1} of ${L.hotTakes.length}</div>
        <div class="ht-heat h${h.heat}">${heatLabel}</div>
        <div class="ht-statement">${h.statement}</div>
        <div class="ht-votes">
            <button class="ht-btn agree"    onclick="htVote(${idx},true)">ğŸ‘ Agree</button>
            <button class="ht-btn disagree" onclick="htVote(${idx},false)">ğŸ‘ Disagree</button>
        </div>
        <div class="ht-reveal" id="ht-rev-${idx}">
            <div class="ht-verdict h${h.heat}" id="ht-verd-${idx}"></div>
            <div class="ht-explanation">${h.explain}</div>
            <button class="ht-next-btn" onclick="${isLast?'htFinish()':'htNext('+idx+')'}">
                ${isLast ? 'ğŸ“‹ Get The Briefing' : 'Next Hot Take â†’'}
            </button>
        </div>
    </div>`;
}

function htVote(idx, agreed) {
    if (htVoted) return;
    htVoted = true;
    const h   = L.hotTakes[idx];
    const win = agreed === h.answer;

    const ag = document.querySelector('.ht-btn.agree');
    const di = document.querySelector('.ht-btn.disagree');
    // Green = you got it right, Red = you got it wrong â€” on the button you pressed
    if (ag) {
        ag.disabled = true;
        if (agreed) ag.classList.add(win ? 'sel-agree' : 'sel-disagree');
    }
    if (di) {
        di.disabled = true;
        if (!agreed) di.classList.add(win ? 'sel-agree' : 'sel-disagree');
    }

    const rev  = document.getElementById(`ht-rev-${idx}`);
    const verd = document.getElementById(`ht-verd-${idx}`);
    if (rev)  { rev.classList.add('show'); }
    if (verd) {
        verd.className = `ht-verdict h${h.heat} ${win?'right':'wrong'}`;
        verd.textContent = win ? h.verdict.right : h.verdict.wrong;
    }
    const dot = document.getElementById(`htd-${idx}`);
    if (dot) { dot.classList.remove('active'); dot.classList.add('done'); }
}

function htNext(idx) {
    htVoted = false;
    const next = idx + 1;
    const card = document.getElementById('ht-card');
    if (card) card.classList.add('exit');
    setTimeout(() => {
        htIdx = next;
        document.getElementById('ht-slot').innerHTML = renderHT(next);
        const dot = document.getElementById(`htd-${next}`);
        if (dot) dot.classList.add('active');
    }, 210);
}

function htFinish() {
    doneSecs = Math.max(doneSecs, 1);
    updateProg(); burst(); showBadge(rndBadge());
    document.getElementById('ht-slot').innerHTML = `
        <div class="ht-done">
            <span class="ht-done-icon">ğŸ¯</span>
            <div class="ht-done-title">Hot Takes â€” Done!</div>
            <div class="ht-done-sub">You've seen all the key facts. Read the mission briefing before the exercises.</div>
            <button class="ht-next-btn" onclick="goTo(1)">ğŸ“‹ Get The Briefing</button>
        </div>`;
}

/* â”€â”€ BRIEFING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildBriefing() {
    const skipBtn = `<button class="briefing-skip" onclick="goTo(2)">Skip â†’</button>`;
    const blocks  = L.briefing.map((b, bi) => {
        const rows  = b.rows.map(r =>
            `<div class="b-row">
                <span class="b-key">${r.key}</span>
                <span class="b-val${r.style?' '+r.style:''}">${r.val}</span>
            </div>`).join('');
        const alert = b.alert ? `<div class="b-alert">${b.alert}</div>` : '';
        return `<div class="b-block" data-heat="${b.heat}" style="animation-delay:${bi*.08}s">
            <div class="b-label">${b.label}</div>
            <div class="b-rows">${rows}</div>${alert}
        </div>`;
    }).join('');

    return head('ğŸ“‹','The Briefing','Key facts â€” read before the exercises', 1, skipBtn) +
        `<div class="sec-body">
            ${blocks}
            <button class="briefing-go" onclick="completeSec(1)">Got It â€” Let's Go âš¡</button>
        </div>`;
}

/* â”€â”€ EXERCISE DISPATCHER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildExercise(ex, n) {
    if (ex.type === 'trueFalse')      return buildTF(ex, n);
    if (ex.type === 'multipleChoice') return buildMC(ex, n);
    if (ex.type === 'gapFill')        return buildGF(ex, n);
    if (ex.type === 'wordForms')      return buildWF(ex, n);
    if (ex.type === 'grammar')        return buildGR(ex, n);
    return '';
}

/* â”€â”€ TRUE / FALSE â”€â”€ */
function buildTF(ex, n) {
    const qs = ex.questions.map((q, qi) => `
        <div class="q-box">
            <p class="q-text">${qi+1}. ${q.q}</p>
            <div class="opt-grp">
                <button class="opt-btn" data-correct="${q.a===true}">ğŸ‘ True</button>
                <button class="opt-btn" data-correct="${q.a===false}">ğŸ‘ False</button>
            </div>
        </div>`).join('');
    return qs + btnRow(n, false, false);
}

/* â”€â”€ MULTIPLE CHOICE â”€â”€ */
function buildMC(ex, n) {
    const qs = ex.questions.map((q, qi) => {
        const opts = q.opts.map((o, oi) =>
            `<button class="opt-btn" data-correct="${oi===q.correct}">${o}</button>`).join('');
        return `<div class="q-box"><p class="q-text">${qi+1}. ${q.q}</p><div class="opt-grp">${opts}</div></div>`;
    }).join('');
    return qs + btnRow(n, false, false);
}

/* â”€â”€ GAP FILL â”€â”€ */
function buildGF(ex, n) {
    const bank  = ex.wordBank.map(w =>
        `<button class="wb-word" data-word="${w}">${w}</button>`).join('');
    const sents = ex.sentences.map((s, si) => {
        const pts = s.t.split('___');
        return `<p style="margin-bottom:.3em">${si+1}. ${pts[0]}<span class="gap" data-answer="${s.a}"></span>${pts[1]||''}</p>`;
    }).join('');
    return `<p style="font-size:13px;font-weight:800;color:var(--ink-3);margin-bottom:12px;">Select a word from the bank, then tap a blank</p>
        <div class="word-bank"><div class="wb-label">Word Bank</div><div class="wb-words">${bank}</div></div>
        <div class="gap-sents">${sents}</div>` + btnRow(n, false, false);
}

/* â”€â”€ WORD FORMS â”€â”€ */
function buildWF(ex, n) {
    const items = ex.questions.map((q, qi) => {
        // Generate a hint: first letter + underscores
        const hint = q.a[0] + '_'.repeat(Math.max(0, q.a.length - 1));
        return `
        <div class="wf-item">
            <p class="wf-prompt">${qi+1}. ${q.p}</p>
            <input type="text" class="wf-input" data-answer="${q.a}" placeholder="Type your answerâ€¦">
            <button class="hint-btn" onclick="toggleHint(this)">ğŸ’¡ Hint</button>
            <div class="hint-text">${hint} &nbsp;(${q.a.length} letters)</div>
        </div>`;
    }).join('');
    return items + btnRow(n, true, false);
}

/* â”€â”€ GRAMMAR â”€â”€ */
function buildGR(ex, n) {
    const ex2   = ex.explanation;
    const egs   = (ex2.examples||[]).map(e =>
        `<div class="gram-ex"><strong>${e.label}</strong> ${e.text}</div>`).join('');
    const expl  = `<div class="gram-expl"><h4>${ex2.heading}</h4><p>${ex2.text}</p>${egs}</div>`;
    const cards = ex.questions.map((q, qi) => {
        const opts = q.opts.map(o => `<option value="${o}">${o}</option>`).join('');
        return `<div class="gram-card">
            <div class="gc-body">
                <p class="gc-sent">${qi+1}. ${q.s}</p>
                <p class="gc-hint">ğŸ’¡ ${q.hint}</p>
            </div>
            <select class="gram-sel" data-answer="${q.a}">
                <option value="">Chooseâ€¦</option>${opts}
            </select>
        </div>`;
    }).join('');
    return expl + cards + btnRow(n, false, false);
}

/* â”€â”€ VOCABULARY GLOSSARY â”€â”€ */
function buildGlossary() {
    const items = L.vocabulary.map(w => `
        <div class="voc-item" onclick="showVoc('${w.word.replace("'","\'")}')">
            <div class="voc-item-word">${w.word}</div>
            <div class="voc-item-type">${w.type}</div>
            <div class="voc-item-def">${w.def}</div>
        </div>`).join('');
    return `<div class="sec-card visible strip-teal">
        <div class="sec-head">
            <div class="sec-head-left">
                <div class="sec-head-icon">ğŸ“š</div>
                <div><div class="sec-head-title">All 10 Vocab Words</div><div class="sec-head-sub">Tap any word to hear it pronounced</div></div>
            </div>
        </div>
        <div class="sec-body"><div class="voc-grid">${items}</div></div>
    </div>`;
}

function btnRow(n, hasReveal, isLast) {
    return `<div class="btn-row">
        <button class="btn-check" onclick="checkSec(${n})">Check Answers</button>
        ${hasReveal ? `<button class="btn-reveal" onclick="revealWF(${n})">Reveal All</button>` : ''}
        <button class="btn-reset"  onclick="resetSec(${n})">Reset</button>
    </div>
    <div id="res-${n}" class="result"></div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goTo(n) {
    curSec = n;
    const el = document.querySelector(`.sec-card[data-sec="${n}"]`);
    if (el) { el.classList.add('visible'); el.scrollIntoView({behavior:'smooth',block:'start'}); }
    updateNav();
}
function nextSec() { if (curSec < TOTAL-1) { curSec++; goTo(curSec); } else finishLesson(); }
function prevSec() { if (curSec > 0) { curSec--; goTo(curSec); } }

function completeSec(n) {
    doneSecs = Math.max(doneSecs, n);
    updateProg();
    if (n >= TOTAL-1) { finishLesson(); return; }
    const next = document.querySelector(`.sec-card[data-sec="${n+1}"]`);
    if (next) { next.classList.add('visible'); next.scrollIntoView({behavior:'smooth',block:'start'}); }
    if (Math.random() < .3) showBadge(rndBadge());
    curSec = n+1; updateNav();
}

function updateNav() {
    document.getElementById('bn-prev').disabled = curSec === 0;
    document.getElementById('bn-next').textContent = curSec >= TOTAL-1 ? 'ğŸ Finish' : 'Next â†’';
    document.getElementById('bn-ind').textContent  = `${curSec+1}/${TOTAL}`;
}
function updateProg() {
    const pct = Math.round((doneSecs/TOTAL)*100);
    document.getElementById('prog-fill').style.width  = pct + '%';
    document.getElementById('prog-label').textContent = `${doneSecs} / ${TOTAL} sections`;
    document.getElementById('prog-pct').textContent   = pct + '%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHECKERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function checkSec(n) {
    const el = secEl(n);
    const type = L.exercises[n-2]?.type;
    if (type === 'trueFalse' || type === 'multipleChoice') checkOpts(n);
    else if (type === 'gapFill')   checkGF(n);
    else if (type === 'wordForms') checkWF(n);
    else if (type === 'grammar')   checkGR(n);
}

function checkOpts(n) {
    const groups = secEl(n).querySelectorAll('.opt-grp');
    let ok=0, blank=0;
    groups.forEach(g => {
        const sel = g.querySelector('.opt-btn.selected');
        if (!sel) { blank++; return; }
        g.querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('correct','incorrect'));
        sel.dataset.correct==='true' ? (sel.classList.add('correct'), ok++) : sel.classList.add('incorrect');
    });
    if (blank) { return showErr(n,'Please answer all questions first!'); }
    showRes(n, ok, groups.length, 'ğŸ‰ All correct!', 'wrong answers in red â€” try again!');
}

function checkGF(n) {
    const gaps = secEl(n).querySelectorAll('.gap'); let ok=0;
    gaps.forEach(g => {
        g.classList.remove('correct','incorrect');
        const v = (g.textContent||'').trim().toLowerCase();
        if (v === g.dataset.answer.toLowerCase()) { g.classList.add('correct'); ok++; }
        else if (v) g.classList.add('incorrect');
    });
    showRes(n, ok, gaps.length, 'âœ¨ All gaps correct!', 'red gaps are wrong â€” click to clear and retry');
}

function checkWF(n) {
    const inputs = secEl(n).querySelectorAll('.wf-input'); let ok=0;
    inputs.forEach(i => {
        i.classList.remove('ok','bad');
        if (!i.value.trim()) return;
        i.value.trim().toLowerCase()===i.dataset.answer.toLowerCase()
            ? (i.classList.add('ok'), ok++) : i.classList.add('bad');
    });
    showRes(n, ok, inputs.length, 'ğŸ¯ Word Forms Champion!', 'red boxes are wrong â€” check spelling!');
}

function checkGR(n) {
    const sels = secEl(n).querySelectorAll('.gram-sel'); let ok=0;
    sels.forEach(s => {
        s.classList.remove('correct','incorrect');
        if (!s.value) return;
        s.value===s.dataset.answer ? (s.classList.add('correct'), ok++) : s.classList.add('incorrect');
    });
    showRes(n, ok, sels.length, 'ğŸ“¡ Grammar Ace!', 'red dropdowns are wrong â€” try again!');
}

function revealWF(n) {
    secEl(n).querySelectorAll('.wf-input').forEach(i => { i.value=i.dataset.answer; i.classList.add('ok'); i.classList.remove('bad'); });
    hideRes(n);
}

function resetSec(n) {
    const ex = L.exercises[n-2];
    if (!ex) return;
    if (ex.type==='trueFalse' || ex.type==='multipleChoice')
        secEl(n).querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('selected','correct','incorrect'));
    if (ex.type==='gapFill') {
        secEl(n).querySelectorAll('.gap').forEach(g=>{g.textContent='';g.classList.remove('correct','incorrect');});
        secEl(n).querySelectorAll('.wb-word').forEach(w=>w.classList.remove('sel','used'));
        selWord=null;
    }
    if (ex.type==='wordForms') secEl(n).querySelectorAll('.wf-input').forEach(i=>{i.value='';i.classList.remove('ok','bad');});
    if (ex.type==='grammar')   secEl(n).querySelectorAll('.gram-sel').forEach(s=>{s.value='';s.classList.remove('correct','incorrect');});
    hideRes(n);
}

function showRes(n, ok, total, yep, nope) {
    const el = document.getElementById(`res-${n}`); if (!el) return;
    const perfect = ok===total;
    el.style.display='block';
    el.className = `result ${perfect?'ok':'bad'}`;
    el.textContent = perfect ? yep : `${ok}/${total} correct â€” ${nope}`;
    if (perfect) { burst(); if(Math.random()<.5)showBadge(rndBadge()); setTimeout(()=>completeSec(n), 1400); }
}
function showErr(n, msg) { const e=document.getElementById(`res-${n}`); if(e){e.style.display='block';e.className='result bad';e.textContent=msg;} }
function hideRes(n)       { const e=document.getElementById(`res-${n}`); if(e){e.style.display='none';} }
function secEl(n)         { return document.querySelector(`.sec-card[data-sec="${n}"]`); }

/* â”€â”€ GAP CLICK â”€â”€ */
function gapClick(gap) {
    if (gap.classList.contains('correct')) return;
    if (gap.textContent.trim()) {
        const w = Array.from(gap.closest('.sec-card').querySelectorAll('.wb-word'))
            .find(b => b.dataset.word===gap.textContent.trim());
        if (w) w.classList.remove('used');
        gap.textContent=''; gap.classList.remove('incorrect');
    } else if (selWord) {
        gap.textContent=selWord.dataset.word;
        selWord.classList.add('used'); selWord.classList.remove('sel');
        selWord=null;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIRE ALL INTERACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function wireAll() {
    /* option group single-select */
    document.querySelectorAll('.opt-grp').forEach(g => {
        g.addEventListener('click', e => {
            const btn = e.target.closest('.opt-btn');
            if (!btn || g.querySelector('.opt-btn.correct')) return;
            g.querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('selected','incorrect'));
            btn.classList.add('selected');
        });
    });

    /* word bank */
    document.querySelectorAll('.wb-word').forEach(w => {
        w.addEventListener('click', () => {
            if (w.classList.contains('used')) return;
            if (w.classList.contains('sel')) { w.classList.remove('sel'); selWord=null; }
            else { document.querySelectorAll('.wb-word').forEach(b=>b.classList.remove('sel')); w.classList.add('sel'); selWord=w; }
        });
    });

    /* gaps */
    document.querySelectorAll('.gap').forEach(g => g.addEventListener('click', ()=>gapClick(g)));

    /* vocab popup + glossary grid + outside close */
    document.addEventListener('click', e => {
        const voc = e.target.closest('[data-voc]');
        if (voc) { e.stopPropagation(); showVoc(voc.dataset.voc); return; }
        const gl = e.target.closest('[data-voc-gl]');
        if (gl)  { e.stopPropagation(); showVoc(gl.dataset.word); return; }
        if (!e.target.closest('#voc-popup')) closeVoc();
    });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VOCAB POPUP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showVoc(word) {
    const w = L.vocabulary.find(v => v.word.toLowerCase()===word.toLowerCase());
    if (!w) return;
    document.getElementById('vp-body').innerHTML = `
        <div class="voc-word">${w.word}</div>
        <div class="voc-type">${w.type}</div>
        <div class="voc-def">${w.definition}</div>
        <button class="voc-hear" onclick="speak('${w.word}')">ğŸ”Š Hear It (British English)</button>`;
    document.getElementById('voc-popup').style.display='block';
}
function closeVoc() { document.getElementById('voc-popup').style.display='none'; }
function speak(word) {
    const u = new SpeechSynthesisUtterance(word);
    u.lang='en-GB'; u.rate=.85;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CELEBRATIONS â€” homepage confetti colours
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const COLOURS = ['#FFC800','#58CC02','#1CB0F6','#FF4B4B','#CE82FF','#2BDECC'];

function burst() {
    for (let i=0; i<18; i++) {
        const d = document.createElement('div');
        d.className = 'confetti-dot';
        d.style.cssText = `
            left:${25+Math.random()*50}vw;
            top:${15+Math.random()*35}vh;
            background:${COLOURS[Math.floor(Math.random()*COLOURS.length)]};
            animation-delay:${Math.random()*.35}s;
            animation-duration:${.65+Math.random()*.6}s;
            transform:rotate(${Math.random()*360}deg);
        `;
        document.body.appendChild(d);
        setTimeout(()=>d.remove(), 1300);
    }
}

function showBadge(b) {
    const el = document.createElement('div');
    el.className = 'badge';
    el.innerHTML = `<span class="badge-icon">${b.icon}</span><span class="badge-text">${b.text}</span>`;
    document.getElementById('badge-wrap').appendChild(el);
    setTimeout(()=>el.classList.add('show'), 80);
    setTimeout(()=>{ el.classList.remove('show'); setTimeout(()=>el.remove(), 400); }, 2800);
}

function rndBadge() { return L.badges[Math.floor(Math.random()*L.badges.length)]; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FINISH LESSON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function finishLesson() {
    doneSecs=TOTAL; updateProg();
    if (!window.EFCD_Auth?.getCurrentUser()) {
        localStorage.setItem('efcd_last_lesson_done', 'true'); // mark done for homepage
        if (confirm('ğŸš€ Lesson complete!\n\nSign up free to save your XP, streaks and badges.\n\nOK = Sign up | Cancel = Keep browsing'))
            window.location.href='/signup/';
        else if (typeof showWordMatchGame==='function')
            showWordMatchGame(L.vocabulary, ()=>window.location.href=L.levelPage);
        else window.location.href=L.levelPage;
        return;
    }
    localStorage.setItem('efcd_last_lesson_done', 'true'); // mark done â€” homepage shows "Find Next"
    const result = await window.EFCD_Auth.completeLesson({
        lessonId:L.lessonId, lessonTitle:L.title, lessonLevel:L.level,
        lessonLink:L.lessonLink, vocabulary:L.vocabulary, grammar:L.grammar,
        perfectScore:true,
        completionTime:Math.floor((Date.now()-performance.timing.navigationStart)/1000)
    });
    if (typeof showWordMatchGame==='function')
        showWordMatchGame(L.vocabulary, gr=>showEndScreen(result, gr));
    else showEndScreen(result, null);
}

function showEndScreen(res, game) {
    const xp = (res?.xpEarned||0)+((game?.bonusXP)||0);
    const ov = document.createElement('div');
    ov.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;animation:up .3s ease both;';
    ov.innerHTML=`
        <div style="background:var(--white);border:2px solid var(--border-heavy);border-bottom:8px solid var(--border-heavy);border-radius:var(--r);max-width:420px;width:100%;overflow:hidden;animation:popin .4s cubic-bezier(.175,.885,.32,1.275) both;">
            <div style="background:var(--blue);padding:28px 20px 24px;text-align:center;position:relative;">
                <button onclick="this.closest('div').parentElement.parentElement.remove()" style="position:absolute;top:10px;right:10px;background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.3);border-radius:var(--rxs);color:var(--white);font-size:20px;font-weight:900;width:34px;height:34px;cursor:pointer;font-family:inherit;line-height:1;display:flex;align-items:center;justify-content:center;">Ã—</button>
                <div style="font-size:68px;margin-bottom:8px;">ğŸš€</div>
                <div style="font-size:13px;font-weight:900;color:rgba(255,255,255,.8);text-transform:uppercase;letter-spacing:2px;margin-bottom:4px;">Mission Complete</div>
                <div style="font-size:30px;font-weight:900;color:var(--white);letter-spacing:-1px;text-shadow:0 3px 0 var(--blue-shadow);">You crushed it!</div>
            </div>
            <div style="padding:20px;display:flex;flex-direction:column;gap:14px;">
                <div style="background:var(--bg);border:2px solid var(--border-heavy);border-bottom:4px solid var(--border-heavy);border-radius:var(--rsm);padding:18px;text-align:center;">
                    <div style="font-size:48px;font-weight:900;color:var(--blue);">+${xp} XP</div>
                    ${res?.leveledUp?`<div style="color:var(--green-shadow);font-weight:900;font-size:16px;margin-top:6px;">ğŸŠ LEVEL UP â†’ Level ${res.newLevel}!</div>`:''}
                    ${res?.newStreak>0?`<div style="color:var(--ink-3);font-weight:800;font-size:14px;margin-top:4px;">ğŸ”¥ ${res.newStreak}-day streak!</div>`:''}
                </div>
                <a href="${L.levelPage}" style="display:flex;align-items:center;justify-content:center;gap:8px;padding:15px;background:var(--green);color:var(--white);font-size:16px;font-weight:900;border-radius:var(--rsm);border:2px solid var(--green-shadow);border-bottom:5px solid var(--green-shadow);">Next Lesson â†’</a>
                <a href="/dashboard-gamified/" style="display:flex;align-items:center;justify-content:center;padding:13px;background:var(--bg);color:var(--ink-3);font-size:14px;font-weight:800;border-radius:var(--rsm);border:2px solid var(--border-heavy);border-bottom:3px solid var(--border-heavy);">View Dashboard</a>
            </div>
        </div>`;
    document.body.appendChild(ov);
    burst(); setTimeout(burst, 300);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS â€” efcdReady-safe
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initStats() {
    // Mark IN-PROGRESS as soon as user lands on this page.
    // homepage will show "Continue: Elon Musk's Big Bet" with a real link.
    // finishLesson() overwrites done='true' so homepage switches to "Find Next Lesson".
    localStorage.setItem('efcd_last_lesson_url',  window.location.pathname);
    localStorage.setItem('efcd_last_lesson_name', "Elon Musk's Big Bet");
    localStorage.setItem('efcd_last_lesson_done', 'false');

    function tryInit() {
        if (typeof window.efcdReady==='undefined') { setTimeout(tryInit, 50); return; }
        window.efcdReady.then(async () => {
            if (!window.EFCD_Auth) return;
            await window.EFCD_Auth.initAuth();
            const user = window.EFCD_Auth.getCurrentUser();
            if (user) {
                const s = window.EFCD_Auth.getUserStats();
                document.getElementById('hdr-streak').textContent = s?.streak||0;
                document.getElementById('hdr-xp').textContent     = (s?.xp||0).toLocaleString();
            }
        }).catch(()=>{});
    }
    tryInit();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleHint(btn) {
    const hint = btn.nextElementSibling;
    if (!hint) return;
    hint.classList.toggle('show');
    btn.textContent = hint.classList.contains('show') ? 'ğŸ™ˆ Hide hint' : 'ğŸ’¡ Hint';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
build();
initStats();
</script>
</body>
</html>
