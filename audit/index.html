<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Audit Essentials - English for Cool Dudes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* --- COOL DUDES BRANDING & MOBILE-FIRST STYLES --- */
        :root {
            --color-primary: #047857; /* Dark Green - Professional */
            --color-secondary: #FBBF24; /* Amber - Accent/Money */
            --color-accent: #34D399; /* Light Green - Correct */
            --color-background: #F0FDF4; /* Lightest Green/White */
            --color-text: #1F2937;
            --color-correct: #10B981;
            --color-incorrect: #EF4444;
            --color-new-feature: #4F46E5; /* Indigo */
        }
        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* === REUSABLE HEADER STYLES === */
        .header {
            background: #FFFFFF;
            border-bottom: 1px solid #D1D5DB;
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--color-primary) 0%, #064E3B 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .site-title {
            font-size: 20px;
            font-weight: 800;
            color: #1A202C;
            letter-spacing: -0.02em;
            text-decoration: none;
        }

        .header-buttons {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-button {
            text-decoration: none;
            padding: 7px 14px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.2s;
            white-space: nowrap;
            cursor: pointer;
            border: 1px solid #E5E9F2;
            background: transparent;
        }

        .header-button.login {
            background: #F8F9FB;
            color: #4A5568;
        }

        .header-button.login:hover {
            background: #FFFFFF;
            color: #2C3E50;
            border-color: #718096;
        }

        .header-button.signup {
            background: var(--color-primary);
            color: white;
            border: 1px solid transparent;
        }

        .header-button.signup:hover {
            background: #065F46;
            box-shadow: 0 2px 5px rgba(4, 120, 87, 0.4);
        }

        .header-button.dashboard {
            background: #FFFBEA;
            color: #92400E;
            border-color: #FCD34D;
        }

        .header-button.dashboard:hover {
            background: #FCD34D;
            border-color: #F59E0B;
        }

        .header-button.logout {
            background: #F8F9FB;
            color: #E53E3E;
        }

        .header-button.logout:hover {
            background: #FEEBEB;
            color: #C53030;
            border-color: #FBD3DA;
        }

        .user-greeting {
            font-size: 14px;
            color: #4A5568;
            font-weight: 700;
            margin-right: 5px;
            white-space: nowrap;
        }
        
        /* Lesson Layout */
        .lesson-container {
            max-width: 800px;
            margin: 20px auto 40px;
            padding: 0 15px;
        }
        
        /* Content Blocks */
        .content-card {
            background-color: #FFFFFF;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 3px solid transparent; 
        }
        
        /* Collapsible Header Style */
        .collapsible-header {
            color: var(--color-primary);
            font-size: 1.8em;
            font-weight: 800;
            margin-bottom: 15px;
            border-bottom: 3px solid var(--color-secondary);
            padding-bottom: 3px;
            cursor: pointer; 
            user-select: none;
            transition: color 0.2s;
        }
        .collapsible-header:hover {
            color: #064E3B;
        }

        /* Reading Text Style */
        .reading-text {
            background: #ECFDF5; 
            border: 1px solid #A7F3D0;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.05em;
            white-space: pre-wrap;
        }
        
        /* Dictionary Word Style */
        .dictionary-word {
            text-decoration: underline dashed var(--color-primary) 2px;
            cursor: help;
            font-weight: 700; 
            color: var(--color-primary);
        }

        /* Quiz Options */
        .quiz-option {
            background: #FFFFFF;
            border: 2px solid #E5E9F2;
            padding: 15px; 
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            display: block;
            user-select: none;
            line-height: 1.4;
        }
        .quiz-option:hover {
            background: #F3FFF6;
            border-color: var(--color-primary);
        }
        .quiz-option.selected {
            background: var(--color-accent);
            color: var(--color-text);
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-primary);
            transform: scale(1.01);
        }
        .quiz-option.correct { 
            background: var(--color-correct) !important;
            color: white;
            border-color: var(--color-correct) !important;
        }
        .quiz-option.incorrect { 
            background: var(--color-incorrect) !important;
            color: white;
            border-color: var(--color-incorrect) !important;
        }
        
        /* Gap Fill Styles */
        .word-bank {
            background: #FEEBC9;
            border: 2px solid var(--color-secondary);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .word-option {
            background-color: var(--color-primary); 
            color: white;
            padding: 10px 14px; 
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, opacity 0.3s;
            font-weight: 600;
            transform: scale(1);
            transition: transform 0.1s;
        }
        .word-option:active {
            transform: scale(0.95);
        }
        .word-option.used {
            opacity: 0.5;
            pointer-events: none;
            background-color: #AAB8C2;
            transform: none;
        }
        .word-option.selected {
            box-shadow: 0 0 0 4px #F59E0B; 
            background-color: #D97706; 
        }
        .gap-input {
            display: inline-block;
            text-align: center;
            padding: 6px 10px;
            min-width: 110px; 
            height: 40px; 
            background-color: #E5E9F2;
            border: 1px dashed var(--color-primary);
            border-radius: 4px;
            color: var(--color-text);
            font-style: italic;
            cursor: pointer;
            line-height: 28px; 
            vertical-align: middle;
            font-weight: 600;
            margin: 0 4px;
            transition: all 0.2s ease;
        }
        .gap-input:hover {
            border-color: var(--color-secondary);
        }
        .gap-input.correct {
             background-color: var(--color-correct) !important;
             color: white;
        }
        .gap-input.incorrect {
             background-color: var(--color-incorrect) !important;
             color: white;
        }

        /* Check/Next Button */
        .check-btn {
            background-color: var(--color-primary);
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 15px;
            display: block;
            width: 100%;
            border: none;
            box-shadow: 0 4px #065F46; 
            text-transform: uppercase;
        }
        .check-btn:hover {
            background-color: #065F46;
        }
        .check-btn:active {
            box-shadow: 0 1px #065F46;
            transform: translateY(3px);
        }
        
        /* Save to Dashboard Button */
        #save-words-section {
            background: #EFF6FF;
            border: 2px solid #93C5FD;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        #save-words-btn {
            background-color: var(--color-new-feature);
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            display: block;
            width: 100%;
            border: none;
            box-shadow: 0 4px #3730A3;
            text-transform: uppercase;
            font-size: 1.1em;
            text-align: center;
        }
        #save-words-btn:hover:not(:disabled) {
            background-color: #3730A3;
        }
        #save-words-btn:active:not(:disabled) {
            box-shadow: 0 1px #3730A3;
            transform: translateY(3px);
        }
        #save-words-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        #login-prompt {
            background: #FEF3C7;
            border: 2px solid #FCD34D;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        #login-prompt p {
            color: #D97706;
            font-weight: 600;
            margin-bottom: 15px;
        }

        #login-prompt a {
            color: #4F46E5;
            text-decoration: none;
            font-weight: 700;
        }

        /* Feedback Pop-up */
        #feedback-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 30px;
            background: var(--color-secondary);
            color: var(--color-text);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            font-size: 1.2em;
            font-weight: 700;
            text-align: center;
        }
        /* Dictionary Pop-up */
        #dictionary-popup {
            position: fixed; 
            max-width: 250px;
            padding: 15px;
            background: var(--color-primary); 
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            z-index: 1001;
            display: none;
            font-size: 0.95em;
            line-height: 1.4;
            border: 3px solid var(--color-secondary);
            text-align: left;
        }
        .next-btn {
            background-color: var(--color-secondary);
            color: var(--color-text);
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            float: right;
            margin-top: 10px;
        }
        
        /* Final Summary List Format */
        #learned-words-list {
            list-style: none;
            padding-left: 0;
            margin-left: 0;
        }
        #learned-words-list li {
            margin-bottom: 5px; 
            font-size: 1.05em;
            line-height: 1.2;
        }

        @media (max-width: 768px) {
            .user-greeting {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <span class="logo">üòé</span>
                <a href="/tax/" class="site-title">English For Cool Dudes</a>
            </div>
            
            <div id="logged-out-buttons" class="header-buttons" style="display: none;">
                <a href="/login/" class="header-button login">Login</a>
                <a href="/signup/" class="header-button signup">Sign Up</a>
            </div>

            <div id="logged-in-buttons" class="header-buttons" style="display: none;">
                <span class="user-greeting" id="user-greeting">Hey Cool Dude! üëã</span>
                <a href="/dashboard/" class="header-button dashboard">My Dashboard</a>
                <button id="logout-btn" class="header-button logout">Sign Out</button>
            </div>
        </div>
    </header>

    <main class="lesson-container">
        <h1 class="text-3xl font-black text-gray-800 mb-5">üîé Tax Audit Essentials: Preparation and Process</h1>
        <p class="text-gray-600 mb-8">Level: Intermediate | Topic: Accounting/Taxation</p>
        
        <div class="flex justify-between items-center text-sm font-semibold mb-2 text-gray-600">
            <span>Progress: Stage <span id="current-stage">1</span> of 5</span>
        </div>
        
        <div class="content-card" data-section-id="0" data-completed="false">
            <h2 class="collapsible-header" onclick="toggleCollapse('reading-content')">üìú Reading Text (Click to Read/Hide the Text. Click <span class="dictionary-word" data-definition="Strong, thick, heavy type with a line underneath.">bold-underlined words</span> for definitions!)</h2>
            <div class="reading-text text-justify" id="reading-content" style="display: none;">
                <h4 class="text-xl font-extrabold text-gray-800 mb-3 mt-3">Navigating the Tax Audit</h4>

                A tax <span class="dictionary-word" data-definition="An official examination of a company's financial records to verify accuracy.">audit</span> is an official examination of an individual's or organization's <span class="dictionary-word" data-definition="Formal records of a company's financial activities and position.">financial statements</span> and tax returns to verify the accuracy of the reported income and deductions. The <span class="dictionary-word" data-definition="A comprehensive summary of a company's financial performance over the year.">annual report</span>, which summarizes a company's financial performance, often forms the initial basis for <span class="dictionary-word" data-definition="Critical observation or examination.">scrutiny</span>. The ultimate goal is to ensure compliance with tax legislation and confirm that tax liabilities have been correctly <span class="dictionary-word" data-definition="Paid or resolved.">settled</span>.

                Preparation is <span class="dictionary-word" data-definition="More important than anything else; supreme.">paramount</span>. Before the audit begins, companies typically perform an internal <span class="dictionary-word" data-definition="A formal assessment of something with the intention of instituting change if necessary.">review</span> to spot and correct any <span class="dictionary-word" data-definition="A lack of compatibility or similarity between facts or claims.">discrepancies</span> in the books. A critical area of focus is the proper valuation and management of <span class="dictionary-word" data-definition="A complete list of items, especially stock or raw materials.">inventories</span>. Auditors need to confirm that the reported stock levels match the physical count and that valuation methods (like First In First Out (FIFO) or Last In First Out (LIFO)) are being consistently applied.

                In the modern era, <span class="dictionary-word" data-definition="Audits conducted using digital records and platforms without a physical visit.">remote audits</span> have become increasingly <span class="dictionary-word" data-definition="Widespread in a particular area or at a particular time.">prevalent</span>. Instead of a physical visit, auditors use secure digital platforms to access records, including digital <span class="dictionary-word" data-definition="A book or computer file in which a company's financial data is stored.">ledgers</span> and expense reports. While this offers efficiency, it also places a higher <span class="dictionary-word" data-definition="The responsibility or burden of proof.">onus</span> on the taxpayer to ensure all digital documentation is readily <span class="dictionary-word" data-definition="Easily obtained or understood.">accessible</span> and properly indexed.

                The result of an audit is typically an <span class="dictionary-word" data-definition="An auditor's formal conclusion on the financial statements.">opinion</span>: either the financial statements are presented fairly (<span class="dictionary-word" data-definition="An auditor's conclusion that financial statements are presented fairly, without material misstatements.">unqualified opinion</span>), or they contain material misstatements (<span class="dictionary-word" data-definition="An auditor's conclusion that financial statements contain material misstatements.">qualified opinion</span>), which may lead to fines or adjustments to the tax due. Understanding the <span class="dictionary-word" data-definition="The consequences or results of an action.">implications</span> of each stage is vital for financial health and maintaining the integrity of the firm's reporting.
            </div>
        </div>

        
        <div id="stage-1" class="content-card" data-section-id="1" data-total-items="1">
            <h2 class="mb-0 collapsible-header" onclick="this.removeAttribute('onclick'); this.textContent = '1 / 5: Main Purpose';">1 / 5: Main Purpose</h2>
            <p class="text-gray-600 mb-4 font-semibold">What is the primary purpose of a tax audit, according to the text? (Choose the best answer)</p>

            <div class="question-box" data-correct-value="To ensure that a company's reported income and deductions comply with tax laws.">
                <div class="quiz-options space-y-2">
                    <div class="quiz-option" data-value="To establish new valuation methods for inventories.">To establish new valuation methods for inventories.</div>
                    <div class="quiz-option" data-value="To ensure that a company's reported income and deductions comply with tax laws.">To ensure that a company's reported income and deductions comply with tax laws.</div>
                    <div class="quiz-option" data-value="To replace physical audits with remote audits entirely.">To replace physical audits with remote audits entirely.</div>
                </div>
            </div>
            <button class="check-btn" onclick="checkRadioQuestion(document.querySelector('#stage-1 .question-box'))" id="check-btn-1">Check Answer</button>
            <button class="next-btn" onclick="nextStage(2)" style="display:none;">Continue to Stage 2 / 5 &rarr;</button>
        </div>


        <div id="stage-2" class="content-card" data-section-id="2" data-total-items="6" style="display:none;">
            <h2 class="mb-0 collapsible-header" onclick="this.removeAttribute('onclick'); this.textContent = '2 / 5: Detail Check';">2 / 5: Detail Check</h2>
            <p class="text-gray-600 mb-4 font-semibold">What aspects are mentioned as relevant to the audit process? (Choose all correct answers in each set)</p>

            <p class="font-bold mt-4 mb-2">Set A: The audit process often starts by looking at...</p>
            <div class="question-box" data-correct-values="A,C" data-type="checkbox">
                <div class="quiz-options space-y-2">
                    <div class="quiz-option" data-value="A">the company's annual report.</div>
                    <div class="quiz-option" data-value="B">the personal spending habits of the CEO.</div>
                    <div class="quiz-option" data-value="C">the official financial statements.</div>
                </div>
            </div>

            <p class="font-bold mt-4 mb-2">Set B: The shift to remote audits demands that taxpayers ensure...</p>
            <div class="question-box" data-correct-values="E,F" data-type="checkbox">
                <div class="quiz-options space-y-2">
                    <div class="quiz-option" data-value="D">all employees are physically present during the audit.</div>
                    <div class="quiz-option" data-value="E">all digital documentation is easily accessible.</div>
                    <div class="quiz-option" data-value="F">digital platforms are used to access records like ledgers.</div>
                </div>
            </div>
            <button class="check-btn" onclick="checkCheckboxQuestion(document.querySelectorAll('#stage-2 .question-box'))" id="check-btn-2">Check Answers</button>
            <button class="next-btn" onclick="nextStage(3)" style="display:none;">Continue to Stage 3 / 5 &rarr;</button>
        </div>


        <div id="stage-3" class="content-card" data-section-id="3" data-total-items="6" style="display:none;">
            <h2 class="mb-0 collapsible-header" onclick="this.removeAttribute('onclick'); this.textContent = '3 / 5: Noun Builder';">3 / 5: Noun Builder</h2>
            
            <h4 class="text-xl font-bold mt-4">üìù Practice the Nouns!</h4>
            <div class="word-bank mb-4">
                <p class="font-bold mb-3 text-sm text-gray-700">Word Bank:</p>
                <div class="word-options flex flex-wrap gap-2" id="noun-bank-gapfill">
                    <div class="word-option" data-word="ledgers">ledgers</div>
                    <div class="word-option" data-word="inventories">inventories</div>
                    <div class="word-option" data-word="discrepancies">discrepancies</div>
                    <div class="word-option" data-word="implications">implications</div>
                    <div class="word-option" data-word="opinion">opinion</div>
                    <div class="word-option" data-word="onus">onus</div>
                    <div class="word-option" data-word="review">review</div>
                </div>
            </div>
            <div class="gap-fill-text text-lg leading-loose space-y-3" id="gap-fill-nouns">
                <p>1. The auditor gave an unqualified <span class="gap-input" data-answer="opinion" data-original-text="____" data-filled-word="">____</span>.</p>
                <p>2. Auditors must verify that <span class="gap-input" data-answer="inventories" data-original-text="____" data-filled-word="">____</span> are valued correctly.</p>
                <p>3. The pre-audit <span class="gap-input" data-answer="review" data-original-text="____" data-filled-word="">____</span> found several minor <span class="gap-input" data-answer="discrepancies" data-original-text="____" data-filled-word="">____</span> in the records.</p>
                <p>4. The main <span class="gap-input" data-answer="onus" data-original-text="____" data-filled-word="">____</span> is on the company to provide access to its digital <span class="gap-input" data-answer="ledgers" data-original-text="____" data-filled-word="">____</span>.</p>
                <p>5. Understanding the financial <span class="gap-input" data-answer="implications" data-original-text="____" data-filled-word="">____</span> of a qualified opinion is vital.</p>
            </div>

            <button type="button" class="check-btn" onclick="checkGapFillStage(3)">Check Noun Gaps</button>
            <button class="next-btn" onclick="nextStage(4)" style="display:none;">Continue to Stage 4 / 5 &rarr;</button>
        </div>


        <div id="stage-4" class="content-card" data-section-id="4" data-total-items="6" style="display:none;">
            <h2 class="mb-0 collapsible-header" onclick="this.removeAttribute('onclick'); this.textContent = '4 / 5: Verb/Adjective Builder';">4 / 5: Verb/Adjective Builder</h2>
            
            <h4 class="text-xl font-bold mt-4">‚è≥ Practice the Verbs/Adjectives!</h4>
            <div class="word-bank mb-4">
                <p class="font-bold mb-3 text-sm text-gray-700">Word Bank:</p>
                <div class="word-options flex flex-wrap gap-2" id="prep-bank-gapfill">
                    <div class="word-option" data-word="paramount">paramount</div>
                    <div class="word-option" data-word="accessible">accessible</div>
                    <div class="word-option" data-word="prevalent">prevalent</div>
                    <div class="word-option" data-word="verify">verify</div>
                    <div class="word-option" data-word="settled">settled</div>
                    <div class="word-option" data-word="review">review</div>
                </div>
            </div>
            <div class="gap-fill-text text-lg leading-loose space-y-3" id="gap-fill-preps">
                <p>1. The primary task of an audit is to <span class="gap-input" data-answer="verify" data-original-text="____" data-filled-word="">____</span> the accuracy of the statements.</p>
                <p>2. Preparation for the audit is <span class="gap-input" data-answer="paramount" data-original-text="____" data-filled-word="">____</span> for a smooth process.</p>
                <p>3. Tax liabilities must have been correctly <span class="gap-input" data-answer="settled" data-original-text="____" data-filled-word="">____</span>.</p>
                <p>4. Remote audits are increasingly <span class="gap-input" data-answer="prevalent" data-original-text="____" data-filled-word="">____</span> in the digital age.</p>
                <p>5. The taxpayer needs to <span class="gap-input" data-answer="review" data-original-text="____" data-filled-word="">____</span> all documentation to ensure it is <span class="gap-input" data-answer="accessible" data-original-text="____" data-filled-word="">____</span>.</p>
            </div>

            <button type="button" class="check-btn" onclick="checkGapFillStage(4)">Check Verb/Adjective Gaps</button>
            <button class="next-btn" onclick="nextStage(5)" style="display:none;">Continue to Stage 5 / 5 &rarr;</button>
        </div>


        <div id="stage-5" class="content-card" data-section-id="5" data-total-items="1" style="display:none;">
            <h2 class="mb-0 collapsible-header" onclick="this.removeAttribute('onclick'); this.textContent = '5 / 5: Final Review';">5 / 5: Final Review</h2>
            <p class="text-gray-600 mb-4 font-semibold">What is a *qualified opinion*? (Choose the correct definition based on the text)</p>

            <div class="question-box" data-correct-value="An auditor's opinion that the financial statements contain material misstatements.">
                <div class="quiz-options space-y-2">
                    <div class="quiz-option" data-value="An auditor's opinion that the tax liability is higher than reported.">An auditor's opinion that the tax liability is higher than reported.</div>
		<div class="quiz-option" data-value="An auditor's opinion that the financial statements are presented fairly.">An auditor's opinion that the financial statements are presented fairly.</div>
		<div class="quiz-option" data-value="An auditor's opinion that the financial statements contain material misstatements.">An auditor's opinion that the financial statements contain material misstatements.</div>
                </div>
            </div>
            <button class="check-btn" onclick="checkRadioQuestion(document.querySelector('#stage-5 .question-box'))" id="check-btn-5">Check Answer</button>
            <button class="next-btn" onclick="showFinalSummary()" style="display:none;">View Final Summary &rarr;</button>
        </div>
        
        <div id="final-summary-card" class="content-card bg-white p-6 mt-8 border-l-8 border-yellow-500" style="display:none;">
            <h2 class="text-3xl font-black text-yellow-600 border-none">üí∞ üéâ Lesson Result: Completed!</h2>
            <p class="text-lg mb-4 text-gray-700">You have completed all 5 stages of *Tax Audit Essentials: Preparation and Process*.</p>
            
            <h4 class="text-xl font-bold mt-4 mb-2 text-gray-700 border-b pb-1">Key Vocabulary Review: Click to see definitions</h4>
            <ul id="learned-words-list" class="list-disc list-inside text-gray-800 ml-4 grid grid-cols-2 sm:grid-cols-3 gap-y-1">
            </ul>
            
            <div id="save-words-section">
                <div id="logged-in-save" style="display: none;">
                    <button id="save-words-btn" onclick="finishLessonAndSaveData()">
                        üíæ Save My New Tax Words to My Dashboard
                    </button>
                </div>

                <div id="login-prompt" style="display: none;">
                    <p>üîí You must be logged in to save words to your dashboard!</p>
                    <a href="/signup/">Sign Up</a> or <a href="/login/">Log In</a> to start saving vocabulary.
                </div>
            </div>

            <p class="text-gray-600 font-semibold mt-4">Keep learning English, cool dude! üìà üíº</p>
        </div>
    </main>
    
    <div id="feedback-popup"></div>
    <div id="dictionary-popup"></div>

   <script>
        // === SUPABASE INITIALIZATION - FIXED ===
        const SUPABASE_URL = 'https://knwgmrgwbpchqyqxbxea.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtud2dtcmd3YnBjaHF5cXhieGVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MDkyODgsImV4cCI6MjA3ODA4NTI4OH0.qnp2ScwSE77_idmPhpLE98sr46WvLpKtg6refFfC7s8';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // === GLOBAL STATE ===
        const TOTAL_STAGES = 5; 
        const FLASH_DURATION = 1500;
        let currentStage = 1;
        let selectedWordOption = null;
        let currentUser = null;
        
        // === LESSON DATA FOR INDEX PAGE COMPATIBILITY ===
        const lessonTitle = "Tax Audit Essentials: Preparation and Process";
        const lessonLink = "/audit/";
        const lessonLevel = "TAX";
        // Array to track all incorrect words/concepts during this session
        const incorrectAnswers = []; 

        // Helper function to log a mistake (only once per word in this session)
        function logMistake(word) {
            // Check if word is not null/empty and not already in the list
            if (word && word.trim() !== '' && !incorrectAnswers.includes(word.trim())) {
                incorrectAnswers.push(word.trim());
                console.log(`Logged mistake for further practice: ${word.trim()}`);
            }
        }
        
        // === LESSON VOCABULARY DATA ===
        const learnedWords = [
            { word: "audit", definition: "An official examination of a company's financial records to verify accuracy.", type: "NOUN" },
            { word: "financial statements", definition: "Formal records of a company's financial activities and position.", type: "NOUN" },
            { word: "annual report", definition: "A comprehensive summary of a company's financial performance over the year.", type: "NOUN" },
			{ word: "scrutiny", definition: "Critical observation or examination.", type: "NOUN" },
            { word: "settled", definition: "Paid or resolved.", type: "VERB" },
            { word: "paramount", definition: "More important than anything else; supreme.", type: "ADJECTIVE" },
            { word: "review", definition: "A formal assessment of something with the intention of instituting change if necessary.", type: "NOUN" },
            { word: "discrepancies", definition: "A lack of compatibility or similarity between facts or claims.", type: "NOUN" },
            { word: "inventories", definition: "A complete list of items, especially stock or raw materials.", type: "NOUN" },
            { word: "remote audits", definition: "Audits conducted using digital records and platforms without a physical visit.", type: "NOUN" },
            { word: "prevalent", definition: "Widespread in a particular area or at a particular time.", type: "ADJECTIVE" },
            { word: "ledgers", definition: "A book or computer file in which a company's financial data is stored.", type: "NOUN" },
            { word: "onus", definition: "The responsibility or burden of proof.", type: "NOUN" },
            { word: "accessible", definition: "Easily obtained or understood.", type: "ADJECTIVE" },
            { word: "opinion", definition: "An auditor's formal conclusion on the financial statements.", type: "NOUN" },
            { word: "unqualified opinion", definition: "An auditor's conclusion that financial statements are presented fairly, without material misstatements.", type: "NOUN" },
            { word: "qualified opinion", definition: "An auditor's conclusion that financial statements contain material misstatements.", type: "NOUN" },
            { word: "implications", definition: "The consequences or results of an action.", type: "NOUN" }
        ];

        // Function that saves only the lesson completion status (original logic)
        async function saveLessonCompletion() {
            const { data, error } = await supabase
                .from('lessons')
                .upsert([
                    { 
                        user_id: currentUser.id, 
                        lesson_title: lessonTitle,
                        lesson_link: lessonLink,
                        lesson_level: lessonLevel,
                        vocabulary: learnedWords,
                        completed_at: new Date().toISOString()
                    }
                ], { 
                    onConflict: 'user_id,lesson_title,word_list_type'
                })
                .select();

            if (error) {
                throw error; // Throw error to be caught by the calling function
            }
            
            return data;
        }

        // NEW function that handles both saving completion AND mistakes
        async function finishLessonAndSaveData() {
            const saveButton = document.getElementById('save-words-btn');
            saveButton.disabled = true;
            saveButton.textContent = "Saving...";

            if (!currentUser) {
                alert("üö® You must be logged in to save your vocabulary!");
                saveButton.disabled = false;
                saveButton.textContent = "üíæ Save My New Tax Words to My Dashboard";
                return;
            }
            
            try {
                // 1. Save Lesson Completion
                await saveLessonCompletion();

                // 2. Save only the incorrect answers for the index practice pop-up
                if (incorrectAnswers.length > 0) {
                    
                    // Map mistakes to vocabulary objects if possible, otherwise use N/A
                    const payload = incorrectAnswers.map(word => {
                        const wordObj = learnedWords.find(w => w.word === word); 
                        return {
                            user_id: currentUser.id,
                            lesson_title: lessonTitle,
                            lesson_link: lessonLink,
                            word: word,
                            // Use definition from learnedWords or a generic message for quiz options
                            definition: wordObj ? wordObj.definition : 'Quiz or Gap-Fill Practice Item from this lesson.',
                            // Use type from learnedWords or a generic type
                            type: wordObj ? wordObj.type : 'QUESTION_MISTAKE',
                            // Crucial field for the index page pop-up
                            word_list_type: 'incorrect_answers' 
                        };
                    });

                    // Insert/Update to the user_mistakes table
                    const { error: mistakesError } = await supabase
                        .from('user_mistakes')
                        .upsert(payload, { 
                            onConflict: 'user_id,lesson_title,word'
                        })
                        .select();
                    
                    if (mistakesError) throw mistakesError;
                    console.log(`‚úÖ Saved ${incorrectAnswers.length} unique mistakes.`);
                }

                // Final UI update and redirect
                showPopup('Words & Mistakes Saved! Redirecting to Dashboard... üéâ', 'correct');
                saveButton.disabled = true;
                saveButton.textContent = "‚úÖ Words Saved!";
                saveButton.style.backgroundColor = 'var(--color-correct)';
                
                setTimeout(() => {
                    window.location.href = '/dashboard/';
                }, 1500);

            } catch (err) {
                console.error('‚ùå Error saving data:', err);
                showPopup('Save Failed: ' + err.message, 'incorrect');
                
                saveButton.disabled = false;
                saveButton.textContent = "üíæ Try Saving Again (Error)";
                saveButton.style.backgroundColor = 'var(--color-incorrect)';
            }
        }

        // === AUTH HEADER INITIALIZATION ===
        async function initializeAuthHeader() {
            const loggedOutButtons = document.getElementById('logged-out-buttons');
            const loggedInButtons = document.getElementById('logged-in-buttons');
            const userGreeting = document.getElementById('user-greeting');
            const logoutBtn = document.getElementById('logout-btn');
            const loggedInSave = document.getElementById('logged-in-save');
            const loginPrompt = document.getElementById('login-prompt');

            try {
                const { data: { user }, error } = await supabase.auth.getUser();

                if (user) {
                    currentUser = user;
                    console.log('User logged in:', user.email);
                    
                    let userName = 'Cool Dude';
                    if (user.user_metadata && user.user_metadata.full_name) {
                        userName = user.user_metadata.full_name.split(' ')[0];
                    } else if (user.email) {
                        userName = user.email.split('@')[0];
                    }
                    
                    if (userGreeting) userGreeting.textContent = `Hey ${userName}! üëã`;
                    if (loggedInButtons) loggedInButtons.style.display = 'flex';
                    if (loggedOutButtons) loggedOutButtons.style.display = 'none';
                    if (loggedInSave) loggedInSave.style.display = 'block';
                    if (loginPrompt) loginPrompt.style.display = 'none';
                } else {
                    currentUser = null;
                    console.log('User not logged in');
                    
                    if (loggedOutButtons) loggedOutButtons.style.display = 'flex';
                    if (loggedInButtons) loggedInButtons.style.display = 'none';
                    if (loggedInSave) loggedInSave.style.display = 'none';
                    if (loginPrompt) loginPrompt.style.display = 'block';
                }
            } catch (err) {
                console.error('Error checking auth:', err);
                if (loggedOutButtons) loggedOutButtons.style.display = 'flex';
                if (loggedInButtons) loggedInButtons.style.display = 'none';
                if (loggedInSave) loggedInSave.style.display = 'none';
                if (loginPrompt) loginPrompt.style.display = 'block';
            }

            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    try {
                        const { error } = await supabase.auth.signOut();
                        if (error) {
                            console.error('Logout error:', error);
                            alert('Logout failed. Please try again.');
                        } else {
                            window.location.href = '/';
                        }
                    } catch (err) {
                        console.error('Unexpected logout error:', err);
                    }
                });
            }
        }
        
        // === CORE LESSON LOGIC ===

        let currentSelectedRadio = null; 
        const allDictionaryWords = {};


        // --- UI UTILITIES ---

        function showPopup(message, type = 'correct') {
            const popup = document.getElementById('feedback-popup');
            let finalMessage = message;

            if (type === 'correct') {
                finalMessage = `Passed the check! ‚úÖ ${message}`;
                popup.style.backgroundColor = 'var(--color-correct)';
                popup.style.color = 'white';
            } else if (type === 'incorrect') {
                finalMessage = `Rethink that entry! ‚ùå ${message}`;
                popup.style.backgroundColor = 'var(--color-incorrect)';
                popup.style.color = 'white';
            } else {
                 finalMessage = `Heads up! ‚ö†Ô∏è ${message}`;
                 popup.style.backgroundColor = 'var(--color-secondary)';
                 popup.style.color = 'var(--color-text)';
            }
            
            popup.textContent = finalMessage;
            popup.style.display = 'block';

            setTimeout(() => {
                popup.style.display = 'none';
            }, 1500);
        }

        function updateProgress() {
            const completedStages = document.querySelectorAll('.content-card[data-completed="true"]').length;
            document.getElementById('current-stage').textContent = completedStages;
        }

        // --- STAGE PROGRESSION ---

        function nextStage(nextStageNumber) {
            document.getElementById(`stage-${currentStage}`).style.display = 'none';
            document.getElementById(`stage-${nextStageNumber}`).style.display = 'block';
            currentStage = nextStageNumber;
            updateProgress();
        }

        function showFinalSummary() {
            document.getElementById('stage-5').style.display = 'none';
            document.getElementById('final-summary-card').style.display = 'block';
            
            const wordList = document.getElementById('learned-words-list');
            wordList.innerHTML = '';
            
            learnedWords.forEach(item => {
                const listItem = document.createElement('li'); 
                const wordElement = document.createElement('span'); 
                wordElement.className = 'dictionary-word'; 
                wordElement.textContent = item.word;
                wordElement.setAttribute('data-definition', item.definition);
                
                listItem.appendChild(wordElement);
                wordList.appendChild(listItem);
            });
            
            setupDictionaryListeners();
        }

        function toggleCollapse(elementId) {
            const content = document.getElementById(elementId);
            if (content.style.display === "none") {
                content.style.display = "block";
            } else {
                content.style.display = "none";
            }
        }

        // --- DICTIONARY (CLICK/TAP) ---

        function setupDictionaryListeners() {
            const popup = document.getElementById('dictionary-popup');
            let currentOpenWord = null;
            
            document.querySelectorAll('.dictionary-word').forEach(wordEl => {
                wordEl.onclick = null;
            });

            document.querySelectorAll('.dictionary-word').forEach(wordEl => {
                const definition = wordEl.getAttribute('data-definition');
                const word = wordEl.textContent.trim();
                allDictionaryWords[word] = definition;
                
                wordEl.onclick = (e) => { 
                    e.stopPropagation();
                    
                    if (currentOpenWord === wordEl) {
                        popup.style.display = 'none';
                        currentOpenWord = null;
                        return;
                    }

                    popup.innerHTML = `<strong>${word}</strong>: ${definition}`;
                    
                    const rect = e.target.getBoundingClientRect();
                    let top = rect.bottom + 5;
                    let left = rect.left;

                    popup.style.display = 'block';
                    const popupWidth = 250; 
                    const popupHeight = popup.offsetHeight; 

                    if (left + popupWidth > window.innerWidth - 20) { 
                        left = window.innerWidth - popupWidth - 20;
                    }
                    if (left < 10) {
                        left = 10;
                    }
                    if (rect.bottom + popupHeight > window.innerHeight - 20) {
                        top = rect.top - popupHeight - 5;
                        if (top < 10) { 
                            top = rect.bottom + 5;
                        }
                    }

                    popup.style.top = `${top}px`;
                    popup.style.left = `${left}px`;
                    
                    currentOpenWord = wordEl;
                };
            });
            
            document.addEventListener('click', (e) => {
                if (currentOpenWord && !e.target.closest('.dictionary-word')) {
                    document.getElementById('dictionary-popup').style.display = 'none';
                    currentOpenWord = null;
                }
            });
        }


        // --- QUIZ LOGIC (Radio & Checkboxes) ---
        
        function setupQuizListeners() {
            document.querySelectorAll('.question-box:not([data-type="checkbox"]) .quiz-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    const parentBox = this.closest('.question-box');
                    if (parentBox.getAttribute('data-locked') === 'true') return;

                    parentBox.querySelectorAll('.quiz-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    this.classList.add('selected');
                });
            });

            document.querySelectorAll('.question-box[data-type="checkbox"] .quiz-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    const parentBox = this.closest('.question-box');
                    if (parentBox.getAttribute('data-locked') === 'true') return;

                    this.classList.toggle('selected');
                });
            });
        }

        function checkRadioQuestion(questionBox) {
            const selectedOption = questionBox.querySelector('.quiz-option.selected');
            const correctValue = questionBox.getAttribute('data-correct-value');
            const cardElement = questionBox.closest('.content-card');
            const checkButton = document.getElementById(`check-btn-${cardElement.getAttribute('data-section-id')}`);
            const nextButton = cardElement.querySelector('.next-btn');
            const sectionId = cardElement.getAttribute('data-section-id');

            if (!selectedOption) {
                showPopup('Pre-check incomplete. Please select an answer first.', 'incorrect');
                return;
            }

            if (selectedOption.getAttribute('data-value') === correctValue) {
                selectedOption.classList.add('correct');
                showPopup('Compliance Verified!', 'correct');
                questionBox.setAttribute('data-locked', 'true');
                checkButton.style.display = 'none';
                cardElement.setAttribute('data-completed', 'true');
                nextButton.style.display = 'block';
            } else {
                selectedOption.classList.add('incorrect');
                
                // LOG MISTAKE: Log the text of the incorrect option selected
                logMistake(selectedOption.getAttribute('data-value'));

                if (sectionId === '1' || sectionId === '5') {
                    showPopup('Incorrect. Double-check the text and try again.', 'incorrect');
                    
                    setTimeout(() => {
                        selectedOption.classList.remove('selected', 'incorrect');
                    }, 500); 

                } else { 
                    showPopup('Answer found! Proceeding to next stage.', 'incorrect');
                    
                    questionBox.querySelectorAll('.quiz-option').forEach(option => {
                        if (option.getAttribute('data-value') === correctValue) {
                            option.classList.add('correct');
                        }
                        option.style.pointerEvents = 'none';
                    });
                    nextButton.style.display = 'block'; 
                    checkButton.style.display = 'none';
                    cardElement.setAttribute('data-completed', 'true');
                }
            }
            updateProgress();
        }

        function checkCheckboxQuestion(questionBoxes) {
            let allCorrect = true;
            let hasIncorrectSelection = false;
            
            questionBoxes.forEach(questionBox => {
                const correctValues = questionBox.getAttribute('data-correct-values').split(',');

                questionBox.querySelectorAll('.quiz-option').forEach(option => {
                    option.classList.remove('correct', 'incorrect');

                    const isSelected = option.classList.contains('selected');
                    const isCorrect = correctValues.includes(option.getAttribute('data-value'));

                    if (isSelected) {
                        if (isCorrect) {
                            option.classList.add('correct'); 
                        } else {
                            hasIncorrectSelection = true;
                            allCorrect = false;
                            option.classList.add('incorrect'); 
                            // LOG MISTAKE: Log the text of the incorrect option selected
                            logMistake(option.getAttribute('data-value'));
                        }
                    } else if (isCorrect) {
                        allCorrect = false;
                    }
                });

                const correctCount = correctValues.length;
                const selectedCorrectCount = Array.from(questionBox.querySelectorAll('.quiz-option.selected')).filter(opt => correctValues.includes(opt.getAttribute('data-value'))).length;
                
                if (correctCount !== selectedCorrectCount) {
                    allCorrect = false;
                }
            });

            const cardElement = questionBoxes[0].closest('.content-card');
            const checkButton = cardElement.querySelector('.check-btn');
            const nextButton = cardElement.querySelector('.next-btn');

            if (!document.querySelectorAll('#stage-2 .quiz-option.selected').length) {
                 showPopup('Pre-check incomplete. Please select at least one answer.', 'incorrect');
                 return;
            }

            if (allCorrect) {
                showPopup('Audit Complete! All systems verified.', 'correct');
                
                questionBoxes.forEach(questionBox => {
                    const correctValues = questionBox.getAttribute('data-correct-values').split(','); 
                    
                    questionBox.querySelectorAll('.quiz-option').forEach(option => {
                        option.classList.remove('selected');
                        
                        if (correctValues.includes(option.getAttribute('data-value'))) {
                             option.classList.add('correct'); 
                        }
                        
                        option.style.pointerEvents = 'none';
                    });
                });

                cardElement.setAttribute('data-completed', 'true');
                checkButton.style.display = 'none';
                nextButton.style.display = 'block';

            } else {
                
                if (hasIncorrectSelection) {
                    showPopup('‚ùå Misstatements found. Try again!', 'incorrect');
                } else {
                    showPopup('‚ö†Ô∏è Incomplete records. Nearly all correct!', 'secondary'); 
                }
                
                setTimeout(() => {
                    questionBoxes.forEach(questionBox => {
                        questionBox.querySelectorAll('.quiz-option').forEach(option => {
                            if (option.classList.contains('incorrect')) {
                                option.classList.remove('selected');
                            }
                            option.classList.remove('correct', 'incorrect');
                        });
                    });
                }, 800);
            }
            updateProgress();
        }

        // --- GAP FILL LOGIC ---

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function handleWordSelectGap(event) {
            const wordOption = event.currentTarget;
            
            if (selectedWordOption) {
                selectedWordOption.classList.remove('selected');
            }

            if (selectedWordOption === wordOption) {
                selectedWordOption = null;
            } else {
                wordOption.classList.add('selected');
                selectedWordOption = wordOption;
            }
        }

        function handleGapFill(event) {
            const gapInput = event.currentTarget;
            
            if (gapInput.hasAttribute('data-locked')) {
                return;
            }
            
            const stageCard = gapInput.closest('.content-card');
            const stageId = stageCard ? stageCard.id : null;
            const wordBankId = stageId === 'stage-3' ? 'noun-bank-gapfill' : 
                               stageId === 'stage-4' ? 'prep-bank-gapfill' : null;
            const wordBank = wordBankId ? document.getElementById(wordBankId) : null;

            const wasIncorrect = gapInput.classList.contains('incorrect');
            const usedWord = gapInput.getAttribute('data-filled-word');

            if (wasIncorrect) {
                // Allows incorrect answers to be deselected for another try
                gapInput.textContent = gapInput.getAttribute('data-original-text');
                gapInput.removeAttribute('data-filled-word');
                gapInput.classList.remove('incorrect');
                
                if (wordBank) {
                    const wordOption = wordBank.querySelector(`.word-option[data-word="${usedWord}"]`);
                    if (wordOption) {
                        wordOption.classList.remove('used');
                        wordOption.style.display = 'block';
                    }
                }
                
                return;
            }


            if (selectedWordOption) {
                const wordToFill = selectedWordOption.getAttribute('data-word');
                
                const existingWord = gapInput.getAttribute('data-filled-word');
                if (existingWord) {
                    if (wordBank) {
                        const existingWordOption = wordBank.querySelector(`.word-option[data-word="${existingWord}"]`);
                        if (existingWordOption) {
                            existingWordOption.classList.remove('used');
                            existingWordOption.style.display = 'block';
                        }
                    }
                }

                gapInput.textContent = wordToFill;
                gapInput.setAttribute('data-filled-word', wordToFill);
                
                selectedWordOption.classList.remove('selected');
                selectedWordOption.classList.add('used');
                selectedWordOption.style.display = 'none';
                selectedWordOption = null;
                
            } else {
                const usedWord = gapInput.getAttribute('data-filled-word');
                if (usedWord) {
                    gapInput.textContent = gapInput.getAttribute('data-original-text');
                    gapInput.removeAttribute('data-filled-word');
                    
                    if (wordBank) {
                        const wordOption = wordBank.querySelector(`.word-option[data-word="${usedWord}"]`);
                        if (wordOption) {
                            wordOption.classList.remove('used');
                            wordOption.style.display = 'block';
                        }
                    }
                }
            }
        }

        function bindGapFillListeners() {
            document.querySelectorAll('.word-option').forEach(word => {
                word.addEventListener('click', handleWordSelectGap);
            });

            document.querySelectorAll('.gap-input').forEach(gap => {
                gap.addEventListener('click', handleGapFill);
            });
        }

        function checkGapFillStage(stageNumber) {
            const cardElement = document.getElementById(`stage-${stageNumber}`);
            const gaps = cardElement.querySelectorAll('.gap-input');
            const checkButton = cardElement.querySelector('.check-btn');
            const nextButton = cardElement.querySelector('.next-btn');
            
            let allGapsFilled = true;
            let allCorrect = true;
            let firstUnfilled = null;

            gaps.forEach(gap => {
                // Clear previous check classes
                gap.classList.remove('correct', 'incorrect');
                
                if (!gap.getAttribute('data-filled-word')) {
                    allGapsFilled = false;
                    if (!firstUnfilled) firstUnfilled = gap;
                    return;
                }

                const filledWord = gap.getAttribute('data-filled-word');
                const correctAnswer = gap.getAttribute('data-answer');

                if (filledWord === correctAnswer) {
                    gap.classList.add('correct');
                    gap.setAttribute('data-locked', 'true');
                } else {
                    gap.classList.add('incorrect');
                    allCorrect = false;
                    // LOG MISTAKE: Log the word that was incorrectly placed
                    logMistake(filledWord);
                }
            });

            if (!allGapsFilled) {
                showPopup('Pre-check incomplete. Please fill all the gaps first.', 'incorrect');
                if (firstUnfilled) firstUnfilled.focus();
                return;
            }

            if (allCorrect) {
                showPopup('Excellent! Records balanced!', 'correct');
                cardElement.setAttribute('data-completed', 'true');
                checkButton.style.display = 'none';
                nextButton.style.display = 'block';
                gaps.forEach(gap => {
                     gap.setAttribute('data-locked', 'true');
                });
                
            } else {
                // No automatic word reset, allowing the user to click incorrect gaps to retrieve words
                showPopup('Check the books again! Click the incorrect answers to put the words back in the bank and try swapping them.', 'incorrect');
            }

            updateProgress();
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeAuthHeader(); 
            setupQuizListeners(); 
            bindGapFillListeners(); 
            setupDictionaryListeners(); 

            // Shuffle the Stage 4 word bank on load
            const prepBank = document.getElementById('prep-bank-gapfill');
            if (prepBank) {
                const words = Array.from(prepBank.children);
                const shuffledWords = shuffleArray(words);
                
                prepBank.innerHTML = '';
                shuffledWords.forEach(word => prepBank.appendChild(word));
            }
            
            document.getElementById('reading-content').style.display = 'none'; 
            document.getElementById('stage-1').style.display = 'block';
            document.getElementById('stage-2').style.display = 'none';
            document.getElementById('stage-3').style.display = 'none';
            document.getElementById('stage-4').style.display = 'none';
            document.getElementById('stage-5').style.display = 'none';
            updateProgress(); 
        });
    </script>
</body>
</html>
