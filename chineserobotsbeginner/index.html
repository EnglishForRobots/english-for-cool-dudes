<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <title>ğŸ¤– Robots on Chinese TV! â€” English For Cool Dudes</title>

    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/init-auth.js"></script>

    <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EFCD DESIGN TOKENS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
        --blue:          #1CB0F6;
        --blue-shadow:   #1899D6;
        --yellow:        #FFC800;
        --yellow-shadow: #E5B400;
        --green:         #58CC02;
        --green-shadow:  #58A700;
        --punch:         #FF4B4B;
        --punch-shadow:  #EA2B2B;
        --purple:        #CE82FF;
        --purple-shadow: #A559D9;
        --teal:          #2BDECC;
        --teal-shadow:   #1FBFAF;
        --bg:            #F7F9FA;
        --white:         #FFFFFF;
        --ink:           #4B4B4B;
        --ink-bold:      #111827;
        --ink-3:         #AFAFAF;
        --border:        #E5E5E5;
        --border-heavy:  #CECECE;
        --r:             24px;
        --rsm:           16px;
        --rxs:           10px;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }
    body {
        background: var(--bg);
        color: var(--ink);
        font-family: 'Nunito', system-ui, sans-serif;
        line-height: 1.5;
        overflow-x: hidden;
        padding-bottom: 84px;
        -webkit-font-smoothing: antialiased;
        -webkit-tap-highlight-color: transparent;
    }
    @media(min-width:768px){ body { padding-bottom: 0; } }
    a { color: inherit; text-decoration: none; }
    button { font-family: inherit; cursor: pointer; border: none; background: none; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ANIMATIONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @keyframes up      { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
    @keyframes popin   { 0%{opacity:0;transform:scale(.82)} 70%{transform:scale(1.04)} 100%{opacity:1;transform:scale(1)} }
    @keyframes nudge   { 0%,100%{transform:translateX(0)} 30%{transform:translateX(6px)} }
    @keyframes float   { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }
    @keyframes confetti{ 0%{opacity:1;transform:translateY(0) rotate(0)} 100%{opacity:0;transform:translateY(130px) rotate(400deg)} }
    @keyframes shake   { 0%,100%{transform:translateX(0)} 20%{transform:translateX(-8px)} 40%{transform:translateX(8px)} 60%{transform:translateX(-5px)} 80%{transform:translateX(5px)} }
    @keyframes slideLeft { from{opacity:1;transform:translateX(0)} to{opacity:0;transform:translateX(-32px)} }
    @keyframes slideUp { from{transform:translateY(100%);opacity:0} to{transform:translateY(0);opacity:1} }
    @keyframes xpPop   { 0%{opacity:1;transform:translateY(0) scale(1)} 100%{opacity:0;transform:translateY(-55px) scale(1.5)} }
    @keyframes heartbeat { 0%,100%{transform:scale(1)} 14%{transform:scale(1.15)} 28%{transform:scale(1)} 42%{transform:scale(1.1)} 56%{transform:scale(1)} }

    .u1{animation:up .44s ease both .05s}
    .u2{animation:up .44s ease both .15s}
    .u3{animation:up .44s ease both .25s}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .header {
        background: var(--white); border-bottom: 2px solid var(--border);
        position: sticky; top: 0; z-index: 200;
        padding: 0 16px; height: 58px; display: flex; align-items: center;
    }
    .hc  { max-width: 900px; width: 100%; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
    .hl  { display: flex; align-items: center; gap: 10px; }
    .logo {
        width: 38px; height: 38px; border-radius: 10px;
        background: var(--yellow); border: 2px solid var(--border-heavy);
        display: flex; align-items: center; justify-content: center;
        font-size: 20px; flex-shrink: 0; box-shadow: 0 3px 0 var(--border-heavy);
    }
    .site-title { font-size: 17px; font-weight: 900; color: var(--ink-bold); letter-spacing: -.3px; }
    @media(max-width:380px){ .site-title{display:none} }
    .hdr-stats { display: flex; align-items: center; gap: 8px; }
    .hdr-pill {
        display: flex; align-items: center; gap: 5px;
        background: var(--bg); border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy);
        padding: 5px 12px; border-radius: var(--rxs);
        font-size: 14px; font-weight: 900; color: var(--ink-bold);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE + SECTION CARDS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .page { max-width: 900px; margin: 0 auto; padding: 16px 12px 24px; display: flex; flex-direction: column; gap: 14px; }

    /* LESSON BANNER */
    .lesson-banner {
        background: var(--green);
        border: 2px solid var(--green-shadow);
        border-bottom: 6px solid var(--green-shadow);
        border-radius: var(--r); padding: 22px 18px 18px;
        position: relative; overflow: hidden;
    }
    .lesson-banner::after {
        content: 'ğŸ¤–'; position: absolute; bottom: -14px; right: 6px;
        font-size: 110px; opacity: .1; pointer-events: none; transform: rotate(-6deg);
    }
    .lesson-eyebrow {
        display: inline-block; background: var(--white); color: var(--ink-bold);
        font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 1.5px;
        padding: 4px 10px; border-radius: 8px; border: 2px solid var(--border-heavy);
        margin-bottom: 10px;
    }
    .lesson-title {
        font-size: clamp(22px, 6vw, 36px); font-weight: 900; color: var(--white);
        letter-spacing: -1px; line-height: 1.1; margin-bottom: 4px;
        position: relative; z-index: 1; text-shadow: 0 2px 0 var(--green-shadow);
    }
    .lesson-sub { font-size: 14px; font-weight: 700; color: rgba(255,255,255,.9); position: relative; z-index: 1; margin-bottom: 14px; }

    /* PROGRESS */
    .prog-wrap { background: rgba(0,0,0,.12); padding: 10px 12px; border-radius: var(--rsm); position: relative; z-index: 1; }
    .prog-row  { display: flex; justify-content: space-between; font-size: 13px; font-weight: 800; color: var(--white); margin-bottom: 7px; }
    .prog-track{ height: 14px; background: rgba(0,0,0,.14); border-radius: 99px; overflow: hidden; border: 2px solid rgba(0,0,0,.1); }
    .prog-fill { height: 100%; width: 0%; border-radius: 99px; background: var(--yellow); border-top: 3px solid rgba(255,255,255,.35); transition: width .7s cubic-bezier(.4,0,.2,1); }

    /* SECTION CARD */
    .sec-card {
        background: var(--white); border: 2px solid var(--border-heavy);
        border-bottom: 6px solid var(--border-heavy); border-radius: var(--r);
        overflow: hidden; opacity: 0; transform: translateY(18px);
        transition: opacity .4s ease, transform .4s ease; scroll-margin-top: 70px;
    }
    .sec-card.visible { opacity: 1; transform: translateY(0); }
    .sec-card::before { content: ''; display: block; height: 7px; }
    .strip-green::before  { background: linear-gradient(90deg, var(--green), #7EE000); }
    .strip-blue::before   { background: var(--blue); }
    .strip-yellow::before { background: var(--yellow); }
    .strip-purple::before { background: var(--purple); }
    .strip-punch::before  { background: var(--punch); }

    .sec-head {
        padding: 13px 18px 11px; border-bottom: 2px solid var(--border);
        display: flex; align-items: center; justify-content: space-between;
    }
    .sec-head-left { display: flex; align-items: center; gap: 10px; }
    .sec-head-icon {
        width: 40px; height: 40px; border-radius: 12px;
        display: flex; align-items: center; justify-content: center;
        font-size: 20px; flex-shrink: 0;
        background: var(--bg); border: 2px solid var(--border-heavy); border-bottom: 3px solid var(--border-heavy);
    }
    .sec-head-title { font-size: 15px; font-weight: 900; color: var(--ink-bold); letter-spacing: -.3px; }
    .sec-head-sub   { font-size: 12px; font-weight: 700; color: var(--ink-3); margin-top: 1px; }
    .sec-body { padding: 18px; }
    @media(min-width:640px){ .sec-body { padding: 22px; } }

    .sec-label { font-size: 12px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 1.5px; display: none; align-items: center; gap: 12px; padding: 0 4px; }
    .sec-label.show { display: flex; }
    .sec-label::before, .sec-label::after { content: ''; flex: 1; height: 2px; background: var(--border); border-radius: 2px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIDEO
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .video-wrap {
        position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;
        border-radius: var(--rsm); background: #000;
        border: 2px solid var(--border-heavy); box-shadow: 0 4px 0 var(--border-heavy);
        margin-bottom: 14px;
    }
    .video-wrap iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

    /* fast fact chips under video */
    .fact-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 14px; }
    .fact-chip {
        background: rgba(88,204,2,.08); border: 2px solid rgba(88,204,2,.2);
        border-bottom: 3px solid rgba(88,204,2,.2); border-radius: 99px;
        padding: 6px 14px; font-size: 12px; font-weight: 900; color: var(--green-shadow);
        animation: up .4s ease both;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VOCAB FLASHCARDS
       One card at a time â€” tap to flip, then next
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .vc-progress { display: flex; gap: 5px; margin-bottom: 14px; }
    .vc-pip { flex: 1; height: 6px; border-radius: 99px; background: var(--border-heavy); transition: background .3s; }
    .vc-pip.done { background: var(--yellow); }
    .vc-pip.active { background: var(--green); }

    .vc-card {
        background: var(--bg); border: 2px solid var(--border-heavy);
        border-bottom: 5px solid var(--border-heavy);
        border-radius: var(--rsm); overflow: hidden;
        animation: up .28s ease both;
    }
    .vc-card.exit { animation: slideLeft .22s ease both; }
    .vc-front, .vc-back { padding: 20px 18px; }
    .vc-front { cursor: pointer; user-select: none; }
    .vc-type  { font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 1.5px; color: var(--ink-3); margin-bottom: 6px; }
    .vc-word  { font-size: clamp(28px, 8vw, 42px); font-weight: 900; color: var(--ink-bold); letter-spacing: -1.5px; margin-bottom: 10px; line-height: 1; }
    .vc-tap-hint { font-size: 12px; font-weight: 800; color: var(--ink-3); display: flex; align-items: center; gap: 5px; animation: nudge 2s ease-in-out infinite; }

    .vc-back { display: none; background: rgba(88,204,2,.06); border-top: 2px solid rgba(88,204,2,.15); }
    .vc-back.show { display: block; animation: up .2s ease both; }
    .vc-def { font-size: 15px; font-weight: 700; color: var(--ink-bold); line-height: 1.65; margin-bottom: 14px; }
    .vc-example { font-size: 13px; font-weight: 700; color: var(--ink); background: rgba(88,204,2,.08); border-left: 3px solid var(--green); padding: 8px 12px; border-radius: 0 8px 8px 0; margin-bottom: 14px; font-style: italic; }
    .vc-example strong { color: var(--green-shadow); font-style: normal; }

    .vc-actions { display: flex; gap: 10px; }
    .vc-hear {
        flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px;
        padding: 12px; background: var(--white); color: var(--ink-bold);
        border: 2px solid var(--border-heavy); border-bottom: 4px solid var(--border-heavy);
        border-radius: var(--rsm); font-size: 14px; font-weight: 900;
        cursor: pointer; touch-action: manipulation; transition: transform .1s, border-bottom-width .1s;
    }
    .vc-hear:active { border-bottom-width: 2px; transform: translateY(2px); }
    .vc-next {
        flex: 2; display: flex; align-items: center; justify-content: center; gap: 6px;
        padding: 12px; background: var(--green); color: var(--white);
        border: 2px solid var(--green-shadow); border-bottom: 4px solid var(--green-shadow);
        border-radius: var(--rsm); font-size: 14px; font-weight: 900;
        cursor: pointer; touch-action: manipulation; transition: transform .1s, border-bottom-width .1s;
    }
    .vc-next:active { border-bottom-width: 2px; transform: translateY(2px); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HOT TAKES
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .ht-dots { display: flex; justify-content: center; gap: 7px; margin-bottom: 16px; }
    .ht-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--border-heavy); border: 2px solid var(--border-heavy); transition: all .3s; }
    .ht-dot.active { width: 28px; border-radius: 6px; background: var(--green); border-color: var(--green-shadow); }
    .ht-dot.done   { background: var(--yellow); border-color: var(--yellow-shadow); }

    .ht-card { background: var(--bg); border: 2px solid var(--border); border-radius: var(--rsm); padding: 20px; animation: up .3s ease both; }
    .ht-card.exit { animation: slideLeft .2s ease both; }
    .ht-num  { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px; }
    .ht-heat { display: inline-flex; align-items: center; gap: 5px; font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; padding: 4px 12px; border-radius: 8px; margin-bottom: 14px; border: 2px solid; }
    .h1 { background: rgba(88,204,2,.1); border-color: var(--green-shadow); color: var(--green-shadow); }
    .h2 { background: rgba(255,200,0,.15); border-color: var(--yellow-shadow); color: #7A5800; }
    .h3 { background: rgba(255,75,75,.1); border-color: var(--punch-shadow); color: var(--punch-shadow); }
    .ht-statement { font-size: clamp(17px, 4.5vw, 22px); font-weight: 900; color: var(--ink-bold); line-height: 1.3; letter-spacing: -.3px; margin-bottom: 18px; }
    .ht-votes { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .ht-btn {
        display: flex; align-items: center; justify-content: center; gap: 7px;
        padding: 15px 10px; min-height: 58px; font-size: 15px; font-weight: 900;
        font-family: inherit; border-radius: var(--rsm); border: 2px solid; border-bottom-width: 5px;
        cursor: pointer; transition: transform .1s, border-bottom-width .1s; touch-action: manipulation;
    }
    .ht-btn:active { border-bottom-width: 2px; transform: translateY(3px); }
    .ht-btn.agree    { background: rgba(88,204,2,.08);  border-color: var(--green-shadow); color: var(--green-shadow); }
    .ht-btn.disagree { background: rgba(255,75,75,.08); border-color: var(--punch-shadow); color: var(--punch-shadow); }
    .ht-btn.sel-right { background: var(--green) !important; color: var(--white) !important; border-color: var(--green-shadow) !important; animation: heartbeat .6s ease; }
    .ht-btn.sel-wrong { background: var(--punch)  !important; color: var(--white) !important; border-color: var(--punch-shadow) !important; animation: shake .4s; }
    .ht-btn:disabled  { cursor: default; opacity: .85; }

    .ht-reveal { margin-top: 14px; border: 2px solid var(--border-heavy); border-radius: var(--rsm); display: none; overflow: hidden; }
    .ht-reveal.show { display: block; animation: up .22s ease both; }
    .ht-verdict { padding: 12px 16px; font-size: 16px; font-weight: 900; }
    .ht-verdict.right { background: var(--green);  color: var(--white); }
    .ht-verdict.wrong { background: var(--punch);  color: var(--white); }
    .ht-explanation { padding: 14px 16px; font-size: 14px; font-weight: 700; line-height: 1.65; color: var(--ink-bold); background: var(--white); border-top: 2px solid var(--border); }
    .ht-voc { color: var(--green-shadow); font-weight: 900; border-bottom: 2.5px solid rgba(88,204,2,.4); cursor: pointer; }

    .ht-next-btn {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; margin-top: 14px; padding: 14px;
        background: var(--green); color: var(--white);
        font-size: 16px; font-weight: 900; font-family: inherit;
        border: 2px solid var(--green-shadow); border-bottom: 5px solid var(--green-shadow);
        border-radius: var(--rsm); cursor: pointer; touch-action: manipulation;
        transition: transform .1s, border-bottom-width .1s;
    }
    .ht-next-btn:active { border-bottom-width: 2px; transform: translateY(3px); }
    .ht-done { text-align: center; padding: 28px 18px; animation: popin .4s cubic-bezier(.175,.885,.32,1.275) both; }
    .ht-done-icon  { font-size: 54px; display: block; margin-bottom: 10px; animation: float 2.5s ease-in-out infinite; }
    .ht-done-title { font-size: 22px; font-weight: 900; color: var(--ink-bold); margin-bottom: 6px; }
    .ht-done-sub   { font-size: 14px; font-weight: 700; color: var(--ink-3); margin-bottom: 18px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAP THE ANSWER (vocab in context)
       One question at a time, 4 chunky answer buttons
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .tap-progress { display: flex; gap: 5px; margin-bottom: 14px; }
    .tp-pip { flex: 1; height: 6px; border-radius: 99px; background: var(--border-heavy); transition: background .3s; }
    .tp-pip.done   { background: var(--yellow); }
    .tp-pip.active { background: var(--green); }

    .tap-q {
        background: var(--bg); border: 2px solid var(--border);
        border-radius: var(--rsm); padding: 20px 18px;
        margin-bottom: 12px; animation: up .28s ease both;
    }
    .tap-q.exit { animation: slideLeft .2s ease both; }
    .tap-q-num  { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px; }
    .tap-q-text {
        font-size: clamp(16px, 4vw, 20px); font-weight: 900; color: var(--ink-bold);
        line-height: 1.35; margin-bottom: 16px; letter-spacing: -.3px;
    }
    .tap-q-text .blank {
        display: inline-block; min-width: 90px; height: 28px;
        background: rgba(28,176,246,.1); border-bottom: 3px solid var(--blue);
        border-radius: 4px; vertical-align: bottom; margin: 0 3px;
    }

    .tap-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .tap-opt {
        padding: 14px 10px; font-size: 14px; font-weight: 900; font-family: inherit;
        background: var(--white); color: var(--ink-bold); text-align: center;
        border: 2px solid var(--border-heavy); border-bottom: 5px solid var(--border-heavy);
        border-radius: var(--rsm); cursor: pointer; touch-action: manipulation;
        transition: transform .1s, border-bottom-width .1s, background .15s;
        min-height: 54px; display: flex; align-items: center; justify-content: center;
    }
    .tap-opt:active:not(:disabled) { border-bottom-width: 2px; transform: translateY(3px); }
    .tap-opt.right { background: var(--green) !important; color: var(--white) !important; border-color: var(--green-shadow) !important; animation: heartbeat .55s ease; }
    .tap-opt.wrong { background: var(--punch)  !important; color: var(--white) !important; border-color: var(--punch-shadow) !important; animation: shake .4s; }
    .tap-opt:disabled { cursor: default; }

    .tap-feedback { margin-top: 12px; padding: 12px 14px; border-radius: var(--rsm); font-size: 14px; font-weight: 800; border: 2px solid; display: none; }
    .tap-feedback.show  { display: block; animation: up .2s ease both; }
    .tap-feedback.right { background: rgba(88,204,2,.1); color: var(--green-shadow); border-color: rgba(88,204,2,.3); }
    .tap-feedback.wrong { background: rgba(255,75,75,.1); color: var(--punch-shadow); border-color: rgba(255,75,75,.3); }
    .tap-next {
        display: flex; align-items: center; justify-content: center; gap: 7px;
        width: 100%; margin-top: 12px; padding: 14px;
        background: var(--blue); color: var(--white); font-size: 15px; font-weight: 900; font-family: inherit;
        border: 2px solid var(--blue-shadow); border-bottom: 5px solid var(--blue-shadow);
        border-radius: var(--rsm); cursor: pointer; touch-action: manipulation;
        transition: transform .1s, border-bottom-width .1s;
    }
    .tap-next:active { border-bottom-width: 2px; transform: translateY(3px); }
    .tap-done { text-align: center; padding: 26px 18px; animation: popin .4s cubic-bezier(.175,.885,.32,1.275) both; }
    .tap-done-icon  { font-size: 52px; display: block; margin-bottom: 10px; animation: float 2.5s ease-in-out infinite; }
    .tap-done-title { font-size: 22px; font-weight: 900; color: var(--ink-bold); margin-bottom: 6px; }
    .tap-done-sub   { font-size: 14px; font-weight: 700; color: var(--ink-3); margin-bottom: 18px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GRAMMAR BUILDER
       3 big chunky choice buttons per question
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .gram-tip {
        background: var(--bg); border: 2px solid var(--border);
        border-left: 5px solid var(--green); border-radius: 0 var(--rsm) var(--rsm) 0;
        padding: 14px 16px; margin-bottom: 16px;
    }
    .gram-tip h4 { font-size: 11px; font-weight: 900; color: var(--green-shadow); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 8px; }
    .gram-tip p  { font-size: 14px; font-weight: 700; color: var(--ink); line-height: 1.5; margin-bottom: 8px; }
    .gram-ex { padding: 7px 12px; margin: 4px 0; background: rgba(88,204,2,.08); border-left: 3px solid var(--green); border-radius: 0 8px 8px 0; font-size: 13px; font-weight: 700; }
    .gram-ex strong { color: var(--green-shadow); font-weight: 900; }

    .gq-progress { display: flex; gap: 5px; margin-bottom: 16px; }
    .gp-pip { flex: 1; height: 6px; border-radius: 99px; background: var(--border-heavy); transition: background .3s; }
    .gp-pip.done   { background: var(--yellow); }
    .gp-pip.active { background: var(--purple); }

    .gq-card {
        background: var(--bg); border: 2px solid var(--border);
        border-radius: var(--rsm); padding: 20px; margin-bottom: 12px;
        animation: up .28s ease both;
    }
    .gq-card.exit { animation: slideLeft .2s ease both; }
    .gq-num  { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px; }
    .gq-sent { font-size: clamp(16px, 4vw, 20px); font-weight: 900; color: var(--ink-bold); line-height: 1.35; margin-bottom: 6px; letter-spacing: -.3px; }
    .gq-hint { font-size: 12px; font-weight: 700; color: var(--ink-3); font-style: italic; margin-bottom: 16px; }
    .gq-options { display: flex; flex-direction: column; gap: 8px; }
    .gq-opt {
        padding: 14px 18px; font-size: 15px; font-weight: 900; font-family: inherit;
        background: var(--white); color: var(--ink-bold); text-align: center;
        border: 2px solid var(--border-heavy); border-bottom: 5px solid var(--border-heavy);
        border-radius: var(--rsm); cursor: pointer; touch-action: manipulation;
        transition: transform .1s, border-bottom-width .1s;
        min-height: 52px;
    }
    .gq-opt:active:not(:disabled) { border-bottom-width: 2px; transform: translateY(3px); }
    .gq-opt.right { background: var(--green) !important; color: var(--white) !important; border-color: var(--green-shadow) !important; animation: heartbeat .55s ease; }
    .gq-opt.wrong { background: var(--punch)  !important; color: var(--white) !important; border-color: var(--punch-shadow) !important; animation: shake .35s; }
    .gq-opt:disabled { cursor: default; }

    .gq-feedback { margin-top: 12px; padding: 12px 14px; border-radius: var(--rsm); font-size: 14px; font-weight: 800; border: 2px solid; display: none; }
    .gq-feedback.show  { display: block; animation: up .2s ease both; }
    .gq-feedback.right { background: rgba(88,204,2,.1); color: var(--green-shadow); border-color: rgba(88,204,2,.3); }
    .gq-feedback.wrong { background: rgba(255,75,75,.1); color: var(--punch-shadow); border-color: rgba(255,75,75,.3); }
    .gq-next {
        display: flex; align-items: center; justify-content: center; gap: 7px;
        width: 100%; margin-top: 12px; padding: 14px;
        background: var(--purple); color: var(--white); font-size: 15px; font-weight: 900; font-family: inherit;
        border: 2px solid var(--purple-shadow); border-bottom: 5px solid var(--purple-shadow);
        border-radius: var(--rsm); cursor: pointer; touch-action: manipulation;
        transition: transform .1s, border-bottom-width .1s;
    }
    .gq-next:active { border-bottom-width: 2px; transform: translateY(3px); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONTINUE + CHECK BUTTONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn-continue {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; padding: 15px; margin-top: 14px;
        background: var(--green); color: var(--white);
        font-size: 16px; font-weight: 900; font-family: inherit;
        border: 2px solid var(--green-shadow); border-bottom: 5px solid var(--green-shadow);
        border-radius: var(--rsm); cursor: pointer; touch-action: manipulation;
        transition: transform .1s, border-bottom-width .1s;
    }
    .btn-continue:active { border-bottom-width: 2px; transform: translateY(3px); }
    .btn-arrow { font-size: 20px; animation: nudge 2.2s ease-in-out infinite; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOTTOM NAV
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .bot-nav {
        position: fixed; bottom: 0; left: 0; right: 0;
        background: var(--white); border-top: 2px solid var(--border);
        padding: 10px 12px; padding-bottom: calc(10px + env(safe-area-inset-bottom));
        display: flex; align-items: center; gap: 10px; z-index: 200;
    }
    @media(min-width:768px){ .bot-nav { display: none; } }
    .bn-btn {
        flex: 1; background: var(--bg); color: var(--ink-bold);
        border: 2px solid var(--border-heavy); border-bottom: 4px solid var(--border-heavy);
        padding: 12px; border-radius: var(--rsm); font-weight: 900; font-size: 15px;
        min-height: 50px; font-family: inherit; transition: transform .1s, border-bottom-width .1s;
    }
    .bn-btn:active { border-bottom-width: 2px; transform: translateY(2px); }
    .bn-btn.primary { flex: 2; background: var(--green); color: var(--white); border-color: var(--green-shadow); }
    .bn-btn:disabled { opacity: .3; cursor: not-allowed; }
    .bn-ind { font-size: 12px; font-weight: 900; color: var(--ink-3); white-space: nowrap; text-align: center; min-width: 40px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VOCAB POPUP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #voc-popup {
        position: fixed; bottom: 76px; left: 12px; right: 12px;
        background: var(--white); border: 2px solid var(--border-heavy);
        border-bottom: 6px solid var(--border-heavy); border-top: 4px solid var(--green);
        padding: 18px 18px 20px; border-radius: var(--r) var(--r) var(--rsm) var(--rsm);
        z-index: 500; display: none; box-shadow: 0 -6px 28px rgba(0,0,0,.1);
        animation: slideUp .25s cubic-bezier(.175,.885,.32,1.275) both;
        max-height: 44vh; overflow-y: auto;
    }
    @media(min-width:768px){ #voc-popup { position: fixed; bottom: 24px; right: 24px; left: auto; max-width: 300px; border-radius: var(--r); } }
    .vp-close {
        position: absolute; top: 10px; right: 10px;
        width: 32px; height: 32px; border-radius: var(--rxs);
        background: var(--bg); border: 2px solid var(--border-heavy);
        font-size: 18px; font-weight: 900; color: var(--ink-3);
        display: flex; align-items: center; justify-content: center; cursor: pointer;
    }
    .voc-word { font-size: 22px; font-weight: 900; color: var(--green-shadow); letter-spacing: -.4px; margin-bottom: 2px; }
    .voc-type { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
    .voc-def  { font-size: 14px; font-weight: 700; color: var(--ink); line-height: 1.65; margin-bottom: 14px; }
    .voc-hear {
        width: 100%; padding: 12px;
        background: var(--green); color: var(--white);
        border: 2px solid var(--green-shadow); border-bottom: 5px solid var(--green-shadow);
        border-radius: var(--rsm); font-size: 15px; font-weight: 900; font-family: inherit;
        cursor: pointer; transition: transform .1s, border-bottom-width .1s;
    }
    .voc-hear:active { border-bottom-width: 2px; transform: translateY(3px); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BADGES + CONFETTI + XP FLOAT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .badge-wrap { position: fixed; top: 68px; right: 12px; display: flex; flex-direction: column; gap: 8px; z-index: 999; pointer-events: none; }
    .badge {
        background: var(--white); border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy); border-left: 4px solid var(--green);
        padding: 10px 14px; border-radius: var(--rsm);
        display: flex; align-items: center; gap: 8px;
        transform: translateX(240px); opacity: 0; transition: transform .4s, opacity .4s;
        box-shadow: 0 4px 14px rgba(0,0,0,.08);
    }
    .badge.show { transform: translateX(0); opacity: 1; }
    .badge-icon { font-size: 22px; }
    .badge-text { font-size: 13px; font-weight: 900; color: var(--ink-bold); }

    .confetti-dot { position: fixed; width: 10px; height: 10px; border-radius: 3px; pointer-events: none; z-index: 9999; animation: confetti .9s ease-out both; }

    .xp-float { position: fixed; font-size: 20px; font-weight: 900; color: var(--yellow-shadow); text-shadow: 0 2px 0 rgba(0,0,0,.12); pointer-events: none; z-index: 9998; animation: xpPop .85s ease-out forwards; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DAILY CHALLENGE BUTTON
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #daily-challenge-widget { }

    /* score bar in tap/grammar */
    .score-bar {
        display: flex; justify-content: flex-end; margin-bottom: 12px;
        gap: 6px;
    }
    .score-pip { width: 22px; height: 22px; border-radius: 50%; background: var(--border-heavy); border: 2px solid var(--border-heavy); transition: all .3s; font-size: 12px; display: flex; align-items: center; justify-content: center; }
    .score-pip.right { background: var(--green); border-color: var(--green-shadow); color: var(--white); }
    .score-pip.wrong { background: var(--punch);  border-color: var(--punch-shadow);  color: var(--white); }
    </style>
</head>
<body>

<header class="header">
    <div class="hc">
        <div class="hl">
            <a href="/beginner/" class="logo">ğŸ˜</a>
            <a href="/beginner/" class="site-title">English For Cool Dudes</a>
        </div>
        <div class="hdr-stats">
            <div class="hdr-pill">ğŸ”¥ <span id="hdr-streak">0</span></div>
            <div class="hdr-pill">âš¡ <span id="hdr-xp">0</span> XP</div>
        </div>
    </div>
</header>

<div class="badge-wrap" id="badge-wrap"></div>
<div id="voc-popup">
    <button class="vp-close" onclick="closeVoc()">Ã—</button>
    <div id="vp-body"></div>
</div>

<div class="page">

    <!-- Daily Challenge -->
    <!-- Lesson Banner -->
    <div class="lesson-banner u1">
        <div class="lesson-eyebrow">ğŸŒ± Beginner (A2) Â· Technology & Culture</div>
        <div class="lesson-title">Robots on Chinese TV!</div>
        <div class="lesson-sub">10 new words Â· 3 Hot Takes Â· quiz Â· grammar Â· <strong style="color:var(--yellow)">4 activities</strong></div>
        <div class="prog-wrap">
            <div class="prog-row">
                <span id="prog-label">0 / 5 sections</span>
                <span id="prog-pct">0%</span>
            </div>
            <div class="prog-track"><div class="prog-fill" id="prog-fill"></div></div>
        </div>
    </div>

    <div id="daily-challenge-widget"></div>

    <div id="sections"></div>
</div>

<nav class="bot-nav">
    <button class="bn-btn" id="bn-prev" onclick="prevSec()" disabled>â† Back</button>
    <span class="bn-ind" id="bn-ind">1/5</span>
    <button class="bn-btn primary" id="bn-next" onclick="nextSec()">Next â†’</button>
</nav>

<script src="/supabase-auth-gamified.js"></script>
<script src="/daily-challenges-system.js"></script>
<script src="/word-match-game.js"></script>

<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LESSON DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const L = {
    title:      "Robots on Chinese TV!",
    lessonId:   "chineserobotsbeginner",
    lessonLink: "/chineserobotsbeginner/",
    levelPage:  "/beginner/",
    level:      "Beginner",

    vocabulary: [
        { word:"amazing",       type:"adjective", def:"Very surprising and impressive.",                         ex:"The robot <strong>performance</strong> was <strong>amazing</strong>!" },
        { word:"performance",   type:"noun",       def:"A show â€” like dancing, singing, or doing kung fu on TV.",ex:"The robots gave an <strong>amazing performance</strong> on TV." },
        { word:"technology",    type:"noun",       def:"Modern machines, tools, and scientific knowledge.",      ex:"China's robot <strong>technology</strong> is growing very fast." },
        { word:"viewers",       type:"noun",       def:"People who watch TV or videos. The audience.",           ex:"Millions of <strong>viewers</strong> watched the kung fu show." },
        { word:"government",    type:"noun",       def:"The people who control a country and make its laws.",    ex:"The <strong>government</strong> supports robot companies with money." },
        { word:"investment",    type:"noun",       def:"Money you give to help a company grow.",                 ex:"The TV show brought more <strong>investment</strong> to robot companies." },
        { word:"factories",     type:"noun",       def:"Buildings where products are made by machines.",         ex:"Robots will work in <strong>factories</strong> and do difficult jobs." },
        { word:"ageing",        type:"adjective",  def:"Getting older. An 'ageing population' = more old people than young.", ex:"China has an <strong>ageing</strong> population, so robots can help." },
        { word:"underestimate", type:"verb",        def:"To think something is less powerful than it really is.", ex:"Elon Musk said: 'People <strong>underestimate</strong> China.'" },
        { word:"competitors",   type:"noun",       def:"Companies or people trying to be better than each other.", ex:"Chinese companies are Musk's biggest <strong>competitors</strong>." }
    ],

    hotTakes: [
        {
            statement: "The kung fu robot show was just for fun â€” it had nothing to do with business. ğŸ­",
            answer: false, heat: 2,
            verdict: { right: "ğŸ¯ Exactly â€” it was a massive business move!", wrong: "ğŸ¤” Actually, it was huge for business!" },
            explain: `Four robot companies showed their <span data-voc="technology" class="ht-voc">technology</span> to millions of <span data-voc="viewers" class="ht-voc">viewers</span>. The TV <span data-voc="performance" class="ht-voc">performance</span> was basically a very <span data-voc="amazing" class="ht-voc">amazing</span> advertisement. Companies that appear on this show get more <span data-voc="investment" class="ht-voc">investment</span> money.`
        },
        {
            statement: "China makes about 90% of the world's humanoid robots. ğŸ¤–",
            answer: true, heat: 1,
            verdict: { right: "âœ… Correct â€” China dominates robot production!", wrong: "ğŸ˜® Actually TRUE â€” China makes around 90% of all humanoid robots." },
            explain: `The Chinese <span data-voc="government" class="ht-voc">government</span> gives huge support to robot companies. China has an <span data-voc="ageing" class="ht-voc">ageing</span> population, so robots will work in <span data-voc="factories" class="ht-voc">factories</span> and fill the jobs gap.`
        },
        {
            statement: "Elon Musk thinks he has nothing to worry about from Chinese companies. ğŸ˜",
            answer: false, heat: 3,
            verdict: { right: "ğŸ”¥ Right â€” Musk is VERY worried!", wrong: "ğŸŒ¶ï¸ Actually the opposite â€” he called China his biggest threat!" },
            explain: `Even Musk said: "People <span data-voc="underestimate" class="ht-voc">underestimate</span> China." Chinese <span data-voc="competitors" class="ht-voc">competitors</span> are building very fast. The robot race is real â€” and serious.`
        }
    ],

    tapQuestions: [
        { s:"The robots gave an ___ kung fu performance on TV.", a:"amazing",       opts:["amazing","boring","quiet","old"]              },
        { s:"Four companies showed their robot ___ to the world.", a:"technology",  opts:["money","technology","weather","music"]         },
        { s:"Millions of TV ___ watched the kung fu show.",       a:"viewers",      opts:["robots","clouds","viewers","teachers"]          },
        { s:"The ___ supports Chinese robot companies.",           a:"government",   opts:["government","hospital","library","airport"]     },
        { s:"Robots will work in ___ doing jobs for people.",      a:"factories",    opts:["factories","cafes","gardens","schools"]         },
        { s:"Chinese companies are Elon Musk's biggest ___.",      a:"competitors",  opts:["friends","competitors","students","visitors"]   }
    ],

    grammar: [
        { s:"The robots ___ in China.", hint:"Made by companies (plural) â†’ are made", opts:["make","is made","are made"], a:"are made" },
        { s:"The show ___ by millions of people.", hint:"Watched (singular show) â†’ is watched", opts:["watch","is watched","are watched"], a:"is watched" },
        { s:"Robot companies ___ by the government.", hint:"Supported (plural companies) â†’ are supported", opts:["support","is supported","are supported"], a:"are supported" },
        { s:"Kung fu ___ by the robots.", hint:"Performed (singular kung fu) â†’ is performed", opts:["perform","are performed","is performed"], a:"is performed" }
    ],

    grammarData: [
        { question:"are made",      answer:"are made",      explanation:"Passive: are + made"      },
        { question:"is watched",    answer:"is watched",    explanation:"Passive: is + watched"    },
        { question:"are supported", answer:"are supported", explanation:"Passive: are + supported" },
        { question:"is performed",  answer:"is performed",  explanation:"Passive: is + performed"  }
    ],

    badges:[
        { icon:'ğŸ¤–', text:'Robot Fan!'    },
        { icon:'ğŸ¥·', text:'Kung Fu!'      },
        { icon:'ğŸ¯', text:'Sharp!'        },
        { icon:'â­', text:'Star Learner!' },
        { icon:'ğŸ”¥', text:'On Fire!'      },
        { icon:'âš¡', text:'Power Up!'     }
    ]
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let curSec   = 0;
let doneSecs = 0;
const TOTAL  = 5;

// Vocab card state
let vcIdx    = 0;
let vcFlipped = false;

// Hot takes state
let htIdx    = 0;
let htVoted  = false;

// Tap question state
let tapIdx   = 0;
let tapAnswered = false;
let tapScore = [];

// Grammar state
let gqIdx    = 0;
let gqAnswered = false;
let gqScore  = [];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function build() {
    document.getElementById('sections').innerHTML =
        secCard(0, true,  'strip-green',  buildVideo())     +
        secCard(1, false, 'strip-blue',   buildVocabCards())+
        secCard(2, false, 'strip-yellow', buildHotTakes())  +
        `<div class="sec-label" id="lbl-exercises">âœï¸ Practice</div>` +
        secCard(3, false, 'strip-purple', buildTapQ())      +
        secCard(4, false, 'strip-punch',  buildGrammar());
    updateNav(); updateProg();
    document.addEventListener('click', e => {
        const voc = e.target.closest('[data-voc]');
        if (voc) { e.stopPropagation(); showVoc(voc.dataset.voc); return; }
        if (!e.target.closest('#voc-popup')) closeVoc();
    });
}

function secCard(n, vis, strip, inner) {
    return `<div class="sec-card${vis?' visible':''} ${strip}" data-sec="${n}">${inner}</div>`;
}
function head(icon, title, sub) {
    return `<div class="sec-head"><div class="sec-head-left">
        <div class="sec-head-icon">${icon}</div>
        <div><div class="sec-head-title">${title}</div><div class="sec-head-sub">${sub}</div></div>
    </div></div>`;
}

/* â”€â”€â”€ SECTION 0: VIDEO â”€â”€â”€ */
function buildVideo() {
    return head('ğŸ“º', 'Watch First!', 'Kung fu robots on Chinese TV') +
    `<div class="sec-body">
        <div class="video-wrap">
            <iframe src="https://www.youtube-nocookie.com/embed/mUmlv814aJo?si=EM5lNqyT6qXGzefr"
                title="Robots on Chinese TV" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen></iframe>
        </div>
        <div class="fact-chips">
            <div class="fact-chip u1">ğŸ¤– China = 90% of world's robots</div>
            <div class="fact-chip u2">ğŸ“º China's biggest TV show</div>
            <div class="fact-chip u3">âš”ï¸ Real swords and nunchucks!</div>
            <div class="fact-chip" style="animation-delay:.35s">ğŸ’° 4 companies competed</div>
        </div>
        <button class="btn-continue" onclick="completeSec(0)">
            Learn 10 new words! <span class="btn-arrow">â†’</span>
        </button>
    </div>`;
}

/* â”€â”€â”€ SECTION 1: VOCAB FLASHCARDS â”€â”€â”€ */
function buildVocabCards() {
    const pips = L.vocabulary.map((_,i) =>
        `<div class="vc-pip${i===0?' active':''}" id="vcp-${i}"></div>`).join('');
    return head('ğŸ´', 'Vocab Cards', 'Tap the card to see the meaning!') +
        `<div class="sec-body">
            <div class="vc-progress">${pips}</div>
            <div id="vc-slot">${renderVC(0)}</div>
        </div>`;
}

function renderVC(idx) {
    const v = L.vocabulary[idx];
    const isLast = idx === L.vocabulary.length - 1;
    return `<div class="vc-card" id="vc-card">
        <div class="vc-front" onclick="flipVC()">
            <div class="vc-type">${v.type}</div>
            <div class="vc-word">${v.word}</div>
            <div class="vc-tap-hint">ğŸ‘† Tap to see meaning</div>
        </div>
        <div class="vc-back" id="vc-back">
            <div class="vc-def">${v.def}</div>
            <div class="vc-example">${v.ex}</div>
            <div class="vc-actions">
                <button class="vc-hear" onclick="speak('${v.word}')">ğŸ”Š Hear it</button>
                <button class="vc-next" onclick="${isLast?'vcFinish()':'vcNext('+idx+')'}">
                    ${isLast ? 'âœ… All done! â†’' : 'Next word â†’'}
                </button>
            </div>
        </div>
    </div>`;
}

function flipVC() {
    if (vcFlipped) return;
    vcFlipped = true;
    document.getElementById('vc-back').classList.add('show');
    floatXP('+5 XP', 'center');
}

function vcNext(idx) {
    vcFlipped = false;
    const card = document.getElementById('vc-card');
    if (card) card.classList.add('exit');
    setTimeout(() => {
        vcIdx = idx + 1;
        document.getElementById('vc-slot').innerHTML = renderVC(vcIdx);
        const prevPip = document.getElementById(`vcp-${idx}`);
        if (prevPip) { prevPip.classList.remove('active'); prevPip.classList.add('done'); }
        const pip = document.getElementById(`vcp-${vcIdx}`);
        if (pip) pip.classList.add('active');
    }, 200);
}

function vcFinish() {
    doneSecs = Math.max(doneSecs, 2); updateProg(); burst(); showBadge(rndBadge());
    floatXP('+20 XP', 'center');
    document.getElementById('vc-slot').innerHTML = `
        <div class="ht-done">
            <span class="ht-done-icon">ğŸ´</span>
            <div class="ht-done-title">10 words learned!</div>
            <div class="ht-done-sub">Now let's test what you knowâ€¦</div>
            <button class="ht-next-btn" onclick="completeSec(1)">Hot Takes ğŸ”¥ â†’</button>
        </div>`;
}

/* â”€â”€â”€ SECTION 2: HOT TAKES â”€â”€â”€ */
function buildHotTakes() {
    const dots = L.hotTakes.map((_,i) =>
        `<div class="ht-dot${i===0?' active':''}" id="htd-${i}"></div>`).join('');
    return head('ğŸ”¥', 'Hot Takes', 'Agree or Disagree â€” then see the answer') +
        `<div class="sec-body">
            <div class="ht-dots">${dots}</div>
            <div id="ht-slot">${renderHT(0)}</div>
        </div>`;
}

function renderHT(idx) {
    const h = L.hotTakes[idx];
    const heat = ['','ğŸŸ¢ Easy','ğŸŸ¡ Spicy','ğŸ”´ Nuclear'][h.heat];
    const isLast = idx === L.hotTakes.length - 1;
    return `<div class="ht-card" id="ht-card">
        <div class="ht-num">Statement ${idx+1} / ${L.hotTakes.length}</div>
        <div class="ht-heat h${h.heat}">${heat}</div>
        <div class="ht-statement">${h.statement}</div>
        <div class="ht-votes">
            <button class="ht-btn agree"    onclick="htVote(${idx},true)" >ğŸ‘ Agree</button>
            <button class="ht-btn disagree" onclick="htVote(${idx},false)">ğŸ‘ Disagree</button>
        </div>
        <div class="ht-reveal" id="ht-rev-${idx}">
            <div class="ht-verdict" id="ht-verd-${idx}"></div>
            <div class="ht-explanation">${h.explain}</div>
            <button class="ht-next-btn" onclick="${isLast?'htFinish()':'htNext('+idx+')'}">
                ${isLast ? 'âœï¸ Start Practice â†’' : 'Next â†’'}
            </button>
        </div>
    </div>`;
}

function htVote(idx, agreed) {
    if (htVoted) return;
    htVoted = true;
    const h = L.hotTakes[idx];
    const win = agreed === h.answer;
    document.querySelectorAll('.ht-btn').forEach(b => b.disabled = true);
    const clickedBtn = agreed ? document.querySelector('.ht-btn.agree') : document.querySelector('.ht-btn.disagree');
    if (clickedBtn) clickedBtn.classList.add(win ? 'sel-right' : 'sel-wrong');
    const rev = document.getElementById(`ht-rev-${idx}`);
    const verd = document.getElementById(`ht-verd-${idx}`);
    if (rev)  rev.classList.add('show');
    if (verd) { verd.className=`ht-verdict ${win?'right':'wrong'}`; verd.textContent = win ? h.verdict.right : h.verdict.wrong; }
    const dot = document.getElementById(`htd-${idx}`);
    if (dot) { dot.classList.remove('active'); dot.classList.add('done'); }
    if (win) floatXP('+15 XP', 'center');
}

function htNext(idx) {
    htVoted = false;
    const card = document.getElementById('ht-card');
    if (card) card.classList.add('exit');
    setTimeout(() => {
        htIdx = idx + 1;
        document.getElementById('ht-slot').innerHTML = renderHT(htIdx);
        const pip = document.getElementById(`htd-${htIdx}`);
        if (pip) pip.classList.add('active');
    }, 200);
}

function htFinish() {
    doneSecs = Math.max(doneSecs, 3); updateProg(); burst(); showBadge(rndBadge());
    floatXP('+30 XP', 'center');
    document.getElementById('ht-slot').innerHTML = `
        <div class="ht-done">
            <span class="ht-done-icon">ğŸ¯</span>
            <div class="ht-done-title">Hot Takes â€” Done!</div>
            <div class="ht-done-sub">You know the key facts. Now let's practise!</div>
            <button class="ht-next-btn" onclick="goTo(3)">âœï¸ Start Practice â†’</button>
        </div>`;
}

/* â”€â”€â”€ SECTION 3: TAP THE ANSWER â”€â”€â”€ */
function buildTapQ() {
    const pips = L.tapQuestions.map((_,i) =>
        `<div class="tp-pip${i===0?' active':''}" id="tpp-${i}"></div>`).join('');
    return head('ğŸ§©', 'Tap the Answer', 'Choose the right word to complete each sentence') +
        `<div class="sec-body">
            <div class="tap-progress">${pips}</div>
            <div class="score-bar" id="tap-score-bar"></div>
            <div id="tap-slot">${renderTapQ(0)}</div>
        </div>`;
}

function renderTapQ(idx) {
    const q = L.tapQuestions[idx];
    const parts = q.s.split('___');
    const shuffled = [...q.opts].sort(() => Math.random() - .5);
    const opts = shuffled.map(o =>
        `<button class="tap-opt" onclick="tapAnswer(${idx},'${o}')">${o}</button>`).join('');
    return `<div class="tap-q" id="tap-q">
        <div class="tap-q-num">Question ${idx+1} of ${L.tapQuestions.length}</div>
        <div class="tap-q-text">${parts[0]}<span class="blank"></span>${parts[1]||''}</div>
        <div class="tap-options">${opts}</div>
        <div class="tap-feedback" id="tap-fb"></div>
    </div>`;
}

function tapAnswer(idx, choice) {
    if (tapAnswered) return;
    tapAnswered = true;
    const q = L.tapQuestions[idx];
    const win = choice === q.a;
    const opts = document.querySelectorAll('.tap-opt');
    opts.forEach(o => {
        o.disabled = true;
        if (o.textContent === choice) o.classList.add(win ? 'right' : 'wrong');
        if (!win && o.textContent === q.a) o.classList.add('right');
    });
    const fb = document.getElementById('tap-fb');
    if (fb) {
        fb.className = `tap-feedback show ${win?'right':'wrong'}`;
        fb.innerHTML = win
            ? `âœ… Correct! <em>${q.a}</em> is right.`
            : `âŒ The answer is <em><strong>${q.a}</strong></em>`;
    }
    tapScore.push(win);
    updateTapScoreBar();
    if (win) floatXP('+10 XP', 'center');

    const isLast = idx === L.tapQuestions.length - 1;
    const nextBtn = document.createElement('button');
    nextBtn.className = 'tap-next';
    nextBtn.innerHTML = isLast ? 'ğŸ See results â†’' : 'Next â†’';
    nextBtn.onclick = isLast ? tapFinish : () => tapNext(idx);
    document.getElementById('tap-q').appendChild(nextBtn);
}

function tapNext(idx) {
    tapAnswered = false;
    const el = document.getElementById('tap-q');
    if (el) el.classList.add('exit');
    setTimeout(() => {
        tapIdx = idx + 1;
        const pip = document.getElementById(`tpp-${idx}`);
        if (pip) { pip.classList.remove('active'); pip.classList.add('done'); }
        const nextPip = document.getElementById(`tpp-${tapIdx}`);
        if (nextPip) nextPip.classList.add('active');
        document.getElementById('tap-slot').innerHTML = renderTapQ(tapIdx);
    }, 200);
}

function tapFinish() {
    const correct = tapScore.filter(Boolean).length;
    const total   = tapScore.length;
    const perfect = correct === total;
    if (perfect) { burst(); showBadge(rndBadge()); floatXP('+50 XP', 'center'); }
    document.getElementById('tap-slot').innerHTML = `
        <div class="tap-done">
            <span class="tap-done-icon">${perfect ? 'ğŸ†' : 'ğŸ‘'}</span>
            <div class="tap-done-title">${correct}/${total} correct!</div>
            <div class="tap-done-sub">${perfect ? 'Perfect score!' : 'Good effort â€” keep going!'}</div>
            <button class="ht-next-btn" onclick="completeSec(3)">Grammar â†’</button>
        </div>`;
    doneSecs = Math.max(doneSecs, 4); updateProg();
}

function updateTapScoreBar() {
    const bar = document.getElementById('tap-score-bar');
    if (!bar) return;
    bar.innerHTML = tapScore.map((r,i) =>
        `<div class="score-pip ${r?'right':'wrong'}">${r?'âœ“':'âœ—'}</div>`).join('') +
        Array(L.tapQuestions.length - tapScore.length).fill('<div class="score-pip"></div>').join('');
}

/* â”€â”€â”€ SECTION 4: GRAMMAR BUILDER â”€â”€â”€ */
function buildGrammar() {
    const pips = L.grammar.map((_,i) =>
        `<div class="gp-pip${i===0?' active':''}" id="gpp-${i}"></div>`).join('');
    return head('ğŸ“–', 'Grammar: Passive Voice', 'Choose the correct form') +
        `<div class="sec-body">
            <div class="gram-tip">
                <h4>ğŸ›¸ Passive Voice</h4>
                <p>Use passive when the action is more important than who does it.</p>
                <div class="gram-ex"><strong>Active:</strong> Companies <strong>make</strong> robots.</div>
                <div class="gram-ex"><strong>Passive:</strong> Robots <strong>are made</strong> by companies.</div>
                <p style="margin-top:8px;font-size:12px;color:var(--ink-3);font-weight:800">Formula: is / are + past participle</p>
            </div>
            <div class="gq-progress">${pips}</div>
            <div class="score-bar" id="gq-score-bar"></div>
            <div id="gq-slot">${renderGQ(0)}</div>
        </div>`;
}

function renderGQ(idx) {
    const q = L.grammar[idx];
    const opts = q.opts.map(o =>
        `<button class="gq-opt" onclick="gqAnswer(${idx},'${o}')">${o}</button>`).join('');
    return `<div class="gq-card" id="gq-card">
        <div class="gq-num">Question ${idx+1} of ${L.grammar.length}</div>
        <div class="gq-sent">${q.s}</div>
        <div class="gq-hint">ğŸ’¡ ${q.hint}</div>
        <div class="gq-options">${opts}</div>
        <div class="gq-feedback" id="gq-fb"></div>
    </div>`;
}

function gqAnswer(idx, choice) {
    if (gqAnswered) return;
    gqAnswered = true;
    const q = L.grammar[idx];
    const win = choice === q.a;
    document.querySelectorAll('.gq-opt').forEach(o => {
        o.disabled = true;
        if (o.textContent === choice) o.classList.add(win ? 'right' : 'wrong');
        if (!win && o.textContent === q.a) o.classList.add('right');
    });
    const fb = document.getElementById('gq-fb');
    if (fb) {
        fb.className = `gq-feedback show ${win?'right':'wrong'}`;
        fb.innerHTML = win ? `âœ… "${q.a}" â€” passive form. ` : `âŒ The answer is "<strong>${q.a}</strong>"`;
    }
    gqScore.push(win);
    updateGQScoreBar();
    if (win) floatXP('+10 XP', 'center');

    const isLast = idx === L.grammar.length - 1;
    const btn = document.createElement('button');
    btn.className = 'gq-next';
    btn.innerHTML = isLast ? 'ğŸ Finish Lesson â†’' : 'Next â†’';
    btn.onclick = isLast ? gqFinish : () => gqNext(idx);
    document.getElementById('gq-card').appendChild(btn);
}

function gqNext(idx) {
    gqAnswered = false;
    const el = document.getElementById('gq-card');
    if (el) el.classList.add('exit');
    setTimeout(() => {
        gqIdx = idx + 1;
        const pip = document.getElementById(`gpp-${idx}`);
        if (pip) { pip.classList.remove('active'); pip.classList.add('done'); }
        const nextPip = document.getElementById(`gpp-${gqIdx}`);
        if (nextPip) nextPip.classList.add('active');
        document.getElementById('gq-slot').innerHTML = renderGQ(gqIdx);
    }, 200);
}

function gqFinish() {
    const correct = gqScore.filter(Boolean).length;
    const total   = gqScore.length;
    const perfect = correct === total;
    if (perfect) { burst(); burst(); showBadge(rndBadge()); floatXP('+80 XP', 'center'); }
    doneSecs = Math.max(doneSecs, 5); updateProg();
    setTimeout(finishLesson, 600);
}

function updateGQScoreBar() {
    const bar = document.getElementById('gq-score-bar');
    if (!bar) return;
    bar.innerHTML = gqScore.map((r,i) =>
        `<div class="score-pip ${r?'right':'wrong'}">${r?'âœ“':'âœ—'}</div>`).join('') +
        Array(L.grammar.length - gqScore.length).fill('<div class="score-pip"></div>').join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goTo(n) {
    curSec = n;
    if (n >= 3) document.getElementById('lbl-exercises')?.classList.add('show');
    const el = document.querySelector(`.sec-card[data-sec="${n}"]`);
    if (el) { el.classList.add('visible'); el.scrollIntoView({ behavior:'smooth', block:'start' }); }
    updateNav();
}
function nextSec() { if (curSec < TOTAL-1) { curSec++; goTo(curSec); } else finishLesson(); }
function prevSec() { if (curSec > 0) { curSec--; goTo(curSec); } }

function completeSec(n) {
    doneSecs = Math.max(doneSecs, n+1); updateProg();
    if (n >= TOTAL-1) { finishLesson(); return; }
    const next = document.querySelector(`.sec-card[data-sec="${n+1}"]`);
    if (next) { next.classList.add('visible'); next.scrollIntoView({ behavior:'smooth', block:'start' }); }
    if (Math.random() < .3) showBadge(rndBadge());
    curSec = n+1; updateNav();
    if (n >= 2) document.getElementById('lbl-exercises')?.classList.add('show');
}

function updateNav() {
    document.getElementById('bn-prev').disabled = curSec === 0;
    document.getElementById('bn-next').textContent = curSec >= TOTAL-1 ? 'ğŸ Finish' : 'Next â†’';
    document.getElementById('bn-ind').textContent  = `${curSec+1}/${TOTAL}`;
}
function updateProg() {
    const pct = Math.round((doneSecs / TOTAL) * 100);
    document.getElementById('prog-fill').style.width = pct + '%';
    document.getElementById('prog-label').textContent = `${doneSecs} / ${TOTAL} sections`;
    document.getElementById('prog-pct').textContent   = pct + '%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VOCAB POPUP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showVoc(word) {
    const w = L.vocabulary.find(v => v.word.toLowerCase() === word.toLowerCase());
    if (!w) return;
    document.getElementById('vp-body').innerHTML = `
        <div class="voc-word">${w.word}</div>
        <div class="voc-type">${w.type}</div>
        <div class="voc-def">${w.def}</div>
        <button class="voc-hear" onclick="speak('${w.word}')">ğŸ”Š Hear it (British English)</button>`;
    document.getElementById('voc-popup').style.display = 'block';
}
function closeVoc() { document.getElementById('voc-popup').style.display = 'none'; }
function speak(word) {
    const u = new SpeechSynthesisUtterance(word);
    u.lang='en-GB'; u.rate=.85;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CELEBRATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const COLS = ['#58CC02','#FFC800','#1CB0F6','#FF4B4B','#CE82FF','#2BDECC'];
function burst() {
    for (let i=0; i<18; i++) {
        const d = document.createElement('div');
        d.className = 'confetti-dot';
        d.style.cssText = `left:${22+Math.random()*56}vw;top:${12+Math.random()*38}vh;background:${COLS[Math.floor(Math.random()*COLS.length)]};animation-delay:${Math.random()*.35}s;animation-duration:${.65+Math.random()*.6}s;transform:rotate(${Math.random()*360}deg)`;
        document.body.appendChild(d);
        setTimeout(()=>d.remove(), 1300);
    }
}
function showBadge(b) {
    const el = document.createElement('div');
    el.className = 'badge';
    el.innerHTML = `<span class="badge-icon">${b.icon}</span><span class="badge-text">${b.text}</span>`;
    document.getElementById('badge-wrap').appendChild(el);
    setTimeout(()=>el.classList.add('show'), 60);
    setTimeout(()=>{ el.classList.remove('show'); setTimeout(()=>el.remove(), 400); }, 2800);
}
function rndBadge() { return L.badges[Math.floor(Math.random()*L.badges.length)]; }
function floatXP(msg, pos) {
    const el = document.createElement('div');
    el.className = 'xp-float'; el.textContent = msg;
    if (pos==='center') { el.style.left='50%'; el.style.top='42%'; el.style.transform='translateX(-50%)'; }
    else { el.style.right='14px'; el.style.top='64px'; }
    document.body.appendChild(el);
    setTimeout(()=>el.remove(), 900);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FINISH LESSON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function finishLesson() {
    doneSecs = TOTAL; updateProg(); burst(); setTimeout(burst, 350);
    if (!window.EFCD_Auth?.getCurrentUser()) {
        localStorage.setItem('efcd_last_lesson_done','true');
        setTimeout(() => {
            if (confirm('ğŸ¤– Lesson complete!\n\nSign up free to save your XP, streaks and badges.\n\nOK = Sign up | Cancel = Keep browsing'))
                window.location.href = '/signup/';
            else if (typeof showWordMatchGame==='function')
                showWordMatchGame(L.vocabulary, ()=>window.location.href=L.levelPage);
            else window.location.href = L.levelPage;
        }, 500);
        return;
    }
    localStorage.setItem('efcd_last_lesson_done','true');
    const completionTime = Math.floor((Date.now()-performance.timing.navigationStart)/1000);
    const result = await window.EFCD_Auth.completeLesson({
        lessonId:L.lessonId, lessonTitle:L.title, lessonLevel:L.level,
        lessonLink:L.lessonLink, vocabulary:L.vocabulary, grammar:L.grammarData,
        perfectScore:true, completionTime
    });
    if (window.DailyChallenges && result?.success) {
        const cr = await window.DailyChallenges.updateChallengeProgress({
            perfectScore:true, vocabCount:L.vocabulary.length, completionTime, grammarPerfect:true
        });
        if (cr?.justCompleted) setTimeout(()=>window.DailyChallenges.showChallengeCompletionCelebration?.(cr.challenge), 900);
    }
    if (typeof showWordMatchGame==='function')
        showWordMatchGame(L.vocabulary, gr=>showEndScreen(result,gr));
    else showEndScreen(result,null);
}

function showEndScreen(res, game) {
    const xp = (res?.xpEarned||0) + (game?.bonusXP||0);
    const ov = document.createElement('div');
    ov.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:9999;display:flex;align-items:center;justify-content:center;padding:16px;';
    ov.innerHTML=`
        <div style="background:var(--white);border:2px solid var(--border-heavy);border-bottom:8px solid var(--green-shadow);border-radius:var(--r);max-width:420px;width:100%;overflow:hidden;animation:popin .45s cubic-bezier(.175,.885,.32,1.275) both;">
            <div style="background:linear-gradient(135deg,var(--green) 0%,#7EE000 100%);padding:26px 18px 22px;text-align:center;position:relative;">
                <button onclick="this.closest('div').parentElement.parentElement.remove()" style="position:absolute;top:10px;right:10px;background:rgba(0,0,0,.1);border:2px solid rgba(0,0,0,.12);border-radius:var(--rxs);color:var(--white);font-size:20px;font-weight:900;width:34px;height:34px;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;line-height:1;">Ã—</button>
                <div style="font-size:66px;margin-bottom:8px">ğŸ¤–</div>
                <div style="font-size:12px;font-weight:900;color:rgba(255,255,255,.8);text-transform:uppercase;letter-spacing:2px;margin-bottom:3px">Lesson Complete!</div>
                <div style="font-size:26px;font-weight:900;color:var(--white);letter-spacing:-1px;text-shadow:0 2px 0 var(--green-shadow)">Robots mastered! ğŸ¥·</div>
            </div>
            <div style="padding:18px;display:flex;flex-direction:column;gap:12px;">
                <div style="background:var(--bg);border:2px solid var(--border-heavy);border-bottom:4px solid var(--border-heavy);border-radius:var(--rsm);padding:16px;text-align:center;">
                    <div style="font-size:44px;font-weight:900;color:var(--green)">+${xp} XP</div>
                    ${res?.leveledUp?`<div style="color:var(--green-shadow);font-weight:900;font-size:15px;margin-top:4px">ğŸŠ LEVEL UP â†’ Level ${res.newLevel}!</div>`:''}
                    ${res?.newStreak>0?`<div style="color:var(--ink-3);font-weight:800;font-size:13px;margin-top:3px">ğŸ”¥ ${res.newStreak}-day streak!</div>`:''}
                </div>
                <a href="${L.levelPage}" style="display:flex;align-items:center;justify-content:center;gap:8px;padding:14px;background:var(--green);color:var(--white);font-size:16px;font-weight:900;border-radius:var(--rsm);border:2px solid var(--green-shadow);border-bottom:5px solid var(--green-shadow);">Next Lesson â†’</a>
                <a href="/dashboard-gamified/" style="display:flex;align-items:center;justify-content:center;padding:12px;background:var(--bg);color:var(--ink-3);font-size:14px;font-weight:800;border-radius:var(--rsm);border:2px solid var(--border-heavy);border-bottom:3px solid var(--border-heavy);">View Dashboard</a>
            </div>
        </div>`;
    document.body.appendChild(ov);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initStats() {
    localStorage.setItem('efcd_last_lesson_url',  window.location.pathname);
    localStorage.setItem('efcd_last_lesson_name', 'Robots on Chinese TV!');
    localStorage.setItem('efcd_last_lesson_done', 'false');
    function tryInit() {
        if (typeof window.efcdReady==='undefined') { setTimeout(tryInit,50); return; }
        window.efcdReady.then(async()=>{
            if (!window.EFCD_Auth) return;
            await window.EFCD_Auth.initAuth();
            const user = window.EFCD_Auth.getCurrentUser();
            if (user) {
                const s = window.EFCD_Auth.getUserStats();
                document.getElementById('hdr-streak').textContent = s?.streak||0;
                document.getElementById('hdr-xp').textContent     = (s?.xp||0).toLocaleString();
            }
        }).catch(()=>{});
    }
    tryInit();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
build();
initStats();
if (window.DailyChallenges) {
    const w = document.getElementById('daily-challenge-widget');
    if (w) w.innerHTML = window.DailyChallenges.renderDailyChallengeWidget?.() || '';
}
</script>
</body>
</html>
