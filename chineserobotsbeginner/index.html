<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <title>ğŸ¤– Robots on Chinese TV! â€” English For Cool Dudes</title>

    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/init-auth.js"></script>

    <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOKENS â€” exact EFCD design system
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
        --blue:          #1CB0F6;
        --blue-shadow:   #1899D6;
        --yellow:        #FFC800;
        --yellow-shadow: #E5B400;
        --green:         #58CC02;
        --green-shadow:  #58A700;
        --punch:         #FF4B4B;
        --punch-shadow:  #EA2B2B;
        --purple:        #CE82FF;
        --purple-shadow: #A559D9;
        --teal:          #2BDECC;
        --teal-shadow:   #1FBFAF;
        --bg:            #F7F9FA;
        --white:         #FFFFFF;
        --ink:           #4B4B4B;
        --ink-bold:      #111827;
        --ink-3:         #AFAFAF;
        --border:        #E5E5E5;
        --border-heavy:  #CECECE;
        --r:             24px;
        --rsm:           16px;
        --rxs:           10px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }
    body {
        background: var(--bg);
        color: var(--ink);
        font-family: 'Nunito', -apple-system, system-ui, sans-serif;
        line-height: 1.5;
        overflow-x: hidden;
        padding-bottom: 84px;
        -webkit-font-smoothing: antialiased;
    }
    @media(min-width:768px){ body { padding-bottom: 0; } }
    a { color: inherit; text-decoration: none; }
    button { font-family: inherit; cursor: pointer; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ANIMATIONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @keyframes up      { from{opacity:0;transform:translateY(22px)} to{opacity:1;transform:translateY(0)} }
    @keyframes popin   { 0%{opacity:0;transform:scale(.88)} 70%{transform:scale(1.03)} 100%{opacity:1;transform:scale(1)} }
    @keyframes shim    { 0%{background-position:-400px 0} 100%{background-position:400px 0} }
    @keyframes nudge   { 0%,100%{transform:translateX(0)} 30%{transform:translateX(5px)} }
    @keyframes float   { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
    @keyframes confetti{ 0%{opacity:1;transform:translateY(0) rotate(0deg)} 100%{opacity:0;transform:translateY(130px) rotate(400deg)} }
    @keyframes flick   { 0%,100%{transform:rotate(-4deg) scale(1)} 50%{transform:rotate(4deg) scale(1.12)} }
    @keyframes slideOut{ from{opacity:1;transform:translateX(0)} to{opacity:0;transform:translateX(-28px)} }

    .u1{animation:up .44s ease both .04s}
    .u2{animation:up .44s ease both .14s}
    .u3{animation:up .44s ease both .24s}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .header {
        background: var(--white); border-bottom: 2px solid var(--border);
        position: sticky; top: 0; z-index: 200;
        padding: 0 20px; height: 60px; display: flex; align-items: center;
    }
    .hc { max-width: 900px; width: 100%; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
    .hl { display: flex; align-items: center; gap: 10px; }
    .logo {
        width: 40px; height: 40px; border-radius: 12px;
        background: var(--yellow); border: 2px solid var(--border-heavy);
        display: flex; align-items: center; justify-content: center;
        font-size: 22px; flex-shrink: 0; box-shadow: 0 3px 0 var(--border-heavy);
    }
    .site-title { font-size: 18px; font-weight: 900; color: var(--ink-bold); letter-spacing: -.4px; }
    @media(max-width:380px){ .site-title{display:none} }
    .hdr-stats { display: flex; align-items: center; gap: 8px; }
    .hdr-pill {
        display: flex; align-items: center; gap: 5px;
        background: var(--bg); border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy);
        padding: 5px 12px; border-radius: var(--rxs);
        font-size: 14px; font-weight: 900; color: var(--ink-bold);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .page { max-width: 900px; margin: 0 auto; padding: 24px 16px; display: flex; flex-direction: column; gap: 16px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LESSON BANNER â€” green (beginner colour)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .lesson-banner {
        background: var(--green);
        border: 2px solid var(--green-shadow);
        border-bottom: 6px solid var(--green-shadow);
        border-radius: var(--r); padding: 24px 20px 20px;
        position: relative; overflow: hidden;
    }
    .lesson-banner::after {
        content: 'ğŸ¤–';
        position: absolute; bottom: -16px; right: 8px;
        font-size: 120px; opacity: .12; pointer-events: none;
        transform: rotate(-8deg);
    }
    .lesson-eyebrow {
        display: inline-block; background: var(--white); color: var(--ink-bold);
        font-size: 12px; font-weight: 900; text-transform: uppercase; letter-spacing: 1.5px;
        padding: 4px 12px; border-radius: 8px; border: 2px solid var(--border-heavy);
        margin-bottom: 12px;
    }
    .lesson-title {
        font-size: clamp(24px, 6vw, 38px); font-weight: 900; color: var(--white);
        letter-spacing: -1px; line-height: 1.1; margin-bottom: 6px;
        position: relative; z-index: 1; text-shadow: 0 2px 0 var(--green-shadow);
    }
    .lesson-sub { font-size: 15px; font-weight: 700; color: rgba(255,255,255,.9); position: relative; z-index: 1; }
    .prog-wrap  { margin-top: 18px; position: relative; z-index: 1; background: rgba(0,0,0,.12); padding: 12px; border-radius: var(--rsm); }
    .prog-row   { display: flex; justify-content: space-between; font-size: 13px; font-weight: 800; color: var(--white); margin-bottom: 8px; }
    .prog-track { height: 16px; background: rgba(0,0,0,.15); border-radius: 99px; overflow: hidden; border: 2px solid rgba(0,0,0,.1); }
    .prog-fill  { height: 100%; width: 0%; border-radius: 99px; background: var(--yellow); border-top: 4px solid rgba(255,255,255,.4); transition: width .7s cubic-bezier(.4,0,.2,1); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION CARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .sec-card {
        background: var(--white); border: 2px solid var(--border-heavy);
        border-bottom: 6px solid var(--border-heavy); border-radius: var(--r);
        overflow: hidden; opacity: 0; transform: translateY(16px);
        transition: opacity .4s ease, transform .4s ease; scroll-margin-top: 72px;
    }
    .sec-card.visible { opacity: 1; transform: translateY(0); }
    .sec-card::before { content: ''; display: block; height: 7px; }
    .strip-green::before  { background: linear-gradient(90deg, var(--green) 0%, #7EE000 100%); }
    .strip-blue::before   { background: var(--blue); }
    .strip-yellow::before { background: var(--yellow); }
    .strip-purple::before { background: var(--purple); }
    .strip-punch::before  { background: var(--punch); }

    .sec-head {
        padding: 14px 20px 12px; border-bottom: 2px solid var(--border);
        display: flex; align-items: center; justify-content: space-between; gap: 10px;
    }
    .sec-head-left { display: flex; align-items: center; gap: 10px; }
    .sec-head-icon {
        width: 40px; height: 40px; border-radius: 12px;
        display: flex; align-items: center; justify-content: center;
        font-size: 20px; flex-shrink: 0;
        background: var(--bg); border: 2px solid var(--border-heavy); border-bottom: 3px solid var(--border-heavy);
    }
    .sec-head-title { font-size: 16px; font-weight: 900; color: var(--ink-bold); letter-spacing: -.3px; }
    .sec-head-sub   { font-size: 12px; font-weight: 700; color: var(--ink-3); margin-top: 1px; }
    .sec-body { padding: 20px; }
    @media(min-width:768px){ .sec-body { padding: 24px; } }

    .sec-label {
        font-size: 13px; font-weight: 900; color: var(--ink-3);
        text-transform: uppercase; letter-spacing: 1.5px;
        display: none; align-items: center; gap: 12px;
    }
    .sec-label.show { display: flex; }
    .sec-label::after { content: ''; flex: 1; height: 2px; background: var(--border); border-radius: 2px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIDEO
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .video-wrap {
        position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;
        border-radius: var(--rsm); background: #000;
        border: 2px solid var(--border-heavy);
        box-shadow: 0 4px 0 var(--border-heavy);
        margin-bottom: 16px;
    }
    .video-wrap iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

    /* Discussion questions */
    .disc-box {
        background: rgba(88,204,2,.07); border: 2px solid rgba(88,204,2,.25);
        border-left: 5px solid var(--green); border-radius: 0 var(--rsm) var(--rsm) 0;
        padding: 14px 16px; margin-bottom: 16px;
    }
    .disc-box h3 { font-size: 14px; font-weight: 900; color: var(--green-shadow); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
    .disc-q { display: flex; align-items: baseline; gap: 8px; padding: 6px 0; border-bottom: 1.5px dashed rgba(88,204,2,.2); font-size: 14px; font-weight: 700; color: var(--ink); }
    .disc-q:last-child { border-bottom: none; }
    .disc-q::before { content: 'ğŸ¤”'; flex-shrink: 0; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       READING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .fact-strip {
        background: linear-gradient(135deg, var(--ink-bold) 0%, #1e293b 100%);
        border: 2px solid #374151; border-radius: var(--rsm);
        padding: 16px 18px; margin-bottom: 16px;
    }
    .fact-strip h4 { font-size: 11px; font-weight: 900; color: var(--yellow); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px; }
    .fact-item { display: flex; align-items: baseline; gap: 8px; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,.08); font-size: 13px; font-weight: 700; color: rgba(255,255,255,.85); }
    .fact-item:last-child { border-bottom: none; }
    .fact-item::before { content: 'âš¡'; flex-shrink: 0; font-size: 12px; }

    .reading-card {
        background: #FEFEFE; border: 2px solid var(--border-heavy);
        border-left: 5px solid var(--green);
        border-radius: 0 var(--rsm) var(--rsm) 0;
        padding: 18px 16px;
        font-size: 15px; font-weight: 700; line-height: 1.85; color: var(--ink);
        margin-bottom: 16px;
    }
    @media(min-width:640px){ .reading-card { padding: 22px 20px; } }
    .reading-card p { margin-bottom: 14px; }
    .reading-card p:last-child { margin-bottom: 0; }

    .vocab-word {
        color: var(--green-shadow); font-weight: 900;
        border-bottom: 2.5px solid rgba(88,204,2,.4);
        cursor: pointer; white-space: nowrap;
        transition: color .15s;
    }
    .vocab-word:active, .vocab-word:hover { color: var(--green); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HOT TAKES (Agree / Disagree)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .ht-dots { display: flex; justify-content: center; gap: 6px; margin-bottom: 18px; }
    .ht-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--border-heavy); border: 2px solid var(--border-heavy); transition: all .3s; }
    .ht-dot.active { width: 26px; border-radius: 6px; background: var(--green); border-color: var(--green-shadow); }
    .ht-dot.done   { background: var(--yellow); border-color: var(--yellow-shadow); }

    .ht-card {
        background: var(--bg); border: 2px solid var(--border);
        border-radius: var(--rsm); padding: 20px; animation: up .32s ease both;
    }
    .ht-card.exit { animation: slideOut .22s ease both; }
    .ht-num  { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px; }
    .ht-heat { display: inline-flex; align-items: center; gap: 5px; font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; padding: 4px 12px; border-radius: 8px; margin-bottom: 14px; border: 2px solid; }
    .h1 { background: rgba(88,204,2,.1); border-color: var(--green-shadow); color: var(--green-shadow); }
    .h2 { background: rgba(255,200,0,.18); border-color: var(--yellow-shadow); color: #8A6400; }
    .h3 { background: rgba(255,75,75,.1); border-color: var(--punch-shadow); color: var(--punch-shadow); }
    .ht-statement {
        font-size: clamp(17px, 4.5vw, 22px); font-weight: 900; color: var(--ink-bold);
        line-height: 1.3; letter-spacing: -.3px; margin-bottom: 18px;
    }
    .ht-votes { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .ht-btn {
        display: flex; align-items: center; justify-content: center; gap: 6px;
        padding: 14px 12px; min-height: 54px; font-size: 15px; font-weight: 900;
        font-family: inherit; border-radius: var(--rsm); border: 2px solid; border-bottom-width: 5px;
        cursor: pointer; transition: transform .1s, border-bottom-width .1s; touch-action: manipulation;
    }
    .ht-btn:active { border-bottom-width: 2px; transform: translateY(3px); }
    .ht-btn.agree    { background: rgba(88,204,2,.08); border-color: var(--green-shadow); color: var(--green-shadow); }
    .ht-btn.disagree { background: rgba(255,75,75,.08); border-color: var(--punch-shadow); color: var(--punch-shadow); }
    .ht-btn.sel-agree    { background: var(--green) !important; color: var(--white) !important; border-color: var(--green-shadow) !important; }
    .ht-btn.sel-disagree { background: var(--punch) !important; color: var(--white) !important; border-color: var(--punch-shadow) !important; }
    .ht-btn:disabled { opacity: .8; cursor: default; }

    .ht-reveal { margin-top: 14px; border: 2px solid var(--border-heavy); border-radius: var(--rsm); display: none; }
    .ht-reveal.show { display: block; animation: up .2s ease both; }
    .ht-verdict { padding: 13px 16px; font-size: 16px; font-weight: 900; }
    .ht-verdict.right { background: var(--green); color: var(--white); }
    .ht-verdict.wrong { background: var(--punch); color: var(--white); }
    .ht-explanation { padding: 14px 16px; font-size: 14px; font-weight: 700; line-height: 1.65; color: var(--ink-bold); background: var(--white); border-top: 2px solid var(--border); }
    .ht-voc { color: var(--green-shadow); font-weight: 900; border-bottom: 2.5px solid rgba(88,204,2,.4); cursor: pointer; }
    .ht-next-btn {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; margin-top: 14px; padding: 15px;
        background: var(--green); color: var(--white);
        font-size: 16px; font-weight: 900; font-family: inherit;
        border: 2px solid var(--green-shadow); border-bottom: 5px solid var(--green-shadow);
        border-radius: var(--rsm); cursor: pointer; touch-action: manipulation;
        transition: transform .1s, border-bottom-width .1s;
    }
    .ht-next-btn:active { border-bottom-width: 2px; transform: translateY(3px); }
    .ht-done { text-align: center; padding: 28px 20px; animation: popin .4s cubic-bezier(.175,.885,.32,1.275) both; }
    .ht-done-icon  { font-size: 56px; display: block; margin-bottom: 10px; }
    .ht-done-title { font-size: 22px; font-weight: 900; color: var(--ink-bold); margin-bottom: 6px; }
    .ht-done-sub   { font-size: 14px; font-weight: 700; color: var(--ink-3); margin-bottom: 18px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GAP FILL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .word-bank { background: var(--bg); border: 2px solid var(--border); border-radius: var(--rsm); padding: 14px; margin-bottom: 14px; }
    .wb-label  { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px; }
    .wb-words  { display: flex; flex-wrap: wrap; gap: 8px; }
    .wb-word {
        background: var(--white); color: var(--green-shadow);
        padding: 8px 14px; border-radius: var(--rsm);
        border: 2px solid var(--green-shadow); border-bottom: 4px solid var(--green-shadow);
        font-weight: 900; font-size: 13px; font-family: inherit;
        transition: transform .1s, border-bottom-width .1s; touch-action: manipulation;
        cursor: pointer;
    }
    .wb-word:active { border-bottom-width: 2px; transform: translateY(2px); }
    .wb-word.sel  { background: var(--green); color: var(--white); border-color: var(--green-shadow); }
    .wb-word.used { opacity: .22; pointer-events: none; }

    .gap-sents { font-size: 15px; font-weight: 700; line-height: 3.6; color: var(--ink); }
    .gap {
        display: inline-block; text-align: center; min-width: 112px;
        background: var(--white); border: 2px dashed var(--green-shadow);
        border-radius: var(--rsm); padding: 4px 10px; margin: 0 3px;
        font-weight: 900; color: var(--green-shadow); font-size: 13px;
        cursor: pointer; min-height: 34px; transition: background .15s;
    }
    .gap.correct   { background: var(--green) !important; border-color: var(--green-shadow) !important; border-style: solid; color: var(--white); pointer-events: none; }
    .gap.incorrect { background: var(--punch) !important; border-color: var(--punch-shadow) !important; border-style: solid; color: var(--white); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GRAMMAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .gram-expl {
        background: var(--bg); border: 2px solid var(--border);
        border-left: 5px solid var(--green);
        border-radius: 0 var(--rsm) var(--rsm) 0; padding: 16px; margin-bottom: 16px;
    }
    .gram-expl h4 { font-size: 11px; font-weight: 900; color: var(--green-shadow); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 8px; }
    .gram-expl p  { font-size: 14px; font-weight: 700; color: var(--ink); margin-bottom: 8px; line-height: 1.5; }
    .gram-ex { padding: 8px 12px; margin: 5px 0; background: rgba(88,204,2,.08); border-left: 3px solid var(--green); border-radius: 0 8px 8px 0; font-size: 13px; font-weight: 700; line-height: 1.5; }
    .gram-ex strong { color: var(--green-shadow); font-weight: 900; }
    .gram-card { background: var(--bg); border: 2px solid var(--border); border-radius: var(--rsm); padding: 15px; margin-bottom: 10px; }
    @media(min-width:640px){ .gram-card { display: flex; align-items: center; gap: 16px; } }
    .gc-body { margin-bottom: 10px; flex: 1; }
    @media(min-width:640px){ .gc-body { margin-bottom: 0; } }
    .gc-sent { font-weight: 800; color: var(--ink-bold); font-size: 15px; margin-bottom: 4px; line-height: 1.4; }
    .gc-hint { font-size: 12px; font-weight: 700; color: var(--ink-3); font-style: italic; }
    .gram-sel {
        width: 100%; padding: 12px 14px; min-height: 48px;
        background: var(--white); border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy);
        border-radius: var(--rsm); font-size: 14px; font-weight: 800;
        color: var(--ink); font-family: inherit; transition: border-color .15s;
        -webkit-appearance: none;
    }
    @media(min-width:640px){ .gram-sel { width: auto; min-width: 200px; } }
    .gram-sel.correct  { background: var(--green); color: var(--white); border-color: var(--green-shadow); }
    .gram-sel.incorrect{ background: var(--punch); color: var(--white); border-color: var(--punch-shadow); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BUTTONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn-row { margin-top: 18px; display: flex; flex-direction: column; gap: 10px; }
    @media(min-width:640px){ .btn-row { flex-direction: row; justify-content: center; } }
    .btn-check, .btn-reset {
        padding: 13px 24px; min-height: 50px; font-size: 15px; font-weight: 900;
        font-family: inherit; border-radius: var(--rsm); border: 2px solid; border-bottom-width: 5px;
        transition: transform .1s, border-bottom-width .1s; touch-action: manipulation; cursor: pointer;
    }
    .btn-check:active, .btn-reset:active { border-bottom-width: 2px; transform: translateY(3px); }
    .btn-check { background: var(--green); color: var(--white); border-color: var(--green-shadow); }
    .btn-reset { background: var(--bg); color: var(--ink-3); border-color: var(--border-heavy); }

    .btn-continue {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; padding: 15px; margin-top: 16px;
        background: var(--green); color: var(--white);
        font-size: 16px; font-weight: 900; font-family: inherit;
        border: 2px solid var(--green-shadow); border-bottom: 5px solid var(--green-shadow);
        border-radius: var(--rsm); cursor: pointer; touch-action: manipulation;
        transition: transform .1s, border-bottom-width .1s;
    }
    .btn-continue:active { border-bottom-width: 2px; transform: translateY(3px); }
    .btn-continue-arrow { font-size: 20px; animation: nudge 2s ease-in-out infinite; }

    .result { margin-top: 12px; padding: 13px 16px; border-radius: var(--rsm); font-weight: 800; font-size: 15px; border: 2px solid; display: none; }
    .result.ok  { background: rgba(88,204,2,.09);  color: var(--green-shadow); border-color: var(--green-shadow); }
    .result.bad { background: rgba(255,75,75,.09); color: var(--punch-shadow); border-color: var(--punch-shadow); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOTTOM NAV
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .bot-nav {
        position: fixed; bottom: 0; left: 0; right: 0;
        background: var(--white); border-top: 2px solid var(--border);
        padding: 10px 16px; padding-bottom: calc(10px + env(safe-area-inset-bottom));
        display: flex; align-items: center; gap: 10px; z-index: 200;
    }
    @media(min-width:768px){ .bot-nav { display: none; } }
    .bn-btn {
        flex: 1; background: var(--bg); color: var(--ink-bold);
        border: 2px solid var(--border-heavy); border-bottom: 4px solid var(--border-heavy);
        padding: 12px; border-radius: var(--rsm); font-weight: 900; font-size: 15px;
        min-height: 50px; font-family: inherit; transition: transform .1s, border-bottom-width .1s;
    }
    .bn-btn:active { border-bottom-width: 2px; transform: translateY(2px); }
    .bn-btn.primary { flex: 2; background: var(--green); color: var(--white); border-color: var(--green-shadow); }
    .bn-btn:disabled { opacity: .35; cursor: not-allowed; }
    .bn-ind { font-size: 12px; font-weight: 900; color: var(--ink-3); white-space: nowrap; text-align: center; min-width: 40px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VOCAB POPUP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #voc-popup {
        position: fixed; bottom: 76px; left: 12px; right: 12px;
        background: var(--white); border: 2px solid var(--border-heavy);
        border-bottom: 6px solid var(--border-heavy); border-top: 4px solid var(--green);
        padding: 18px 18px 20px; border-radius: var(--r) var(--r) var(--rsm) var(--rsm);
        z-index: 500; display: none;
        box-shadow: 0 -8px 32px rgba(0,0,0,.12);
        animation: up .22s ease both; max-height: 46vh; overflow-y: auto;
    }
    @media(min-width:768px){ #voc-popup { position: fixed; bottom: 24px; right: 24px; left: auto; max-width: 310px; border-radius: var(--r); } }
    .vp-close {
        position: absolute; top: 10px; right: 10px;
        width: 32px; height: 32px; border-radius: var(--rxs);
        background: var(--bg); border: 2px solid var(--border-heavy);
        font-size: 18px; font-weight: 900; color: var(--ink-3);
        display: flex; align-items: center; justify-content: center; cursor: pointer;
    }
    .voc-word { font-size: 22px; font-weight: 900; color: var(--green-shadow); letter-spacing: -.4px; margin-bottom: 2px; }
    .voc-type { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
    .voc-def  { font-size: 14px; font-weight: 700; color: var(--ink); line-height: 1.65; margin-bottom: 14px; }
    .voc-hear {
        width: 100%; padding: 13px;
        background: var(--green); color: var(--white);
        border: 2px solid var(--green-shadow); border-bottom: 5px solid var(--green-shadow);
        border-radius: var(--rsm); font-size: 15px; font-weight: 900; font-family: inherit;
        cursor: pointer; transition: transform .1s, border-bottom-width .1s;
    }
    .voc-hear:active { border-bottom-width: 2px; transform: translateY(3px); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BADGES + CONFETTI
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .badge-wrap { position: fixed; top: 70px; right: 12px; display: flex; flex-direction: column; gap: 8px; z-index: 999; }
    .badge {
        background: var(--white); border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy); border-left: 4px solid var(--green);
        padding: 10px 14px; border-radius: var(--rsm);
        display: flex; align-items: center; gap: 8px;
        transform: translateX(240px); opacity: 0;
        transition: transform .4s, opacity .4s;
        box-shadow: 0 4px 14px rgba(0,0,0,.1);
    }
    .badge.show { transform: translateX(0); opacity: 1; }
    .badge-icon { font-size: 22px; }
    .badge-text { font-size: 13px; font-weight: 900; color: var(--ink-bold); }
    .confetti-dot {
        position: fixed; width: 10px; height: 10px; border-radius: 3px;
        pointer-events: none; z-index: 9999;
        animation: confetti .9s ease-out both;
    }
    </style>
</head>
<body>

<header class="header">
    <div class="hc">
        <div class="hl">
            <a href="/beginner/" class="logo">ğŸ˜</a>
            <a href="/beginner/" class="site-title">English For Cool Dudes</a>
        </div>
        <div class="hdr-stats">
            <div class="hdr-pill">ğŸ”¥ <span id="hdr-streak">0</span></div>
            <div class="hdr-pill">âš¡ <span id="hdr-xp">0</span> XP</div>
        </div>
    </div>
</header>

<div class="badge-wrap" id="badge-wrap"></div>
<div id="voc-popup">
    <button class="vp-close" onclick="closeVoc()">Ã—</button>
    <div id="vp-body"></div>
</div>

<div class="page">

    <!-- BANNER -->
    <div class="lesson-banner u1">
        <div class="lesson-eyebrow">ğŸŒ± Beginner (A2) Â· Technology & Culture</div>
        <div class="lesson-title">Robots on Chinese TV!</div>
        <div class="lesson-sub">Kung fu robots, Chinese New Year, and a surprising fact about the future of work.</div>
        <div class="prog-wrap">
            <div class="prog-row">
                <span id="prog-label">0 / 5 sections</span>
                <span id="prog-pct">0%</span>
            </div>
            <div class="prog-track"><div class="prog-fill" id="prog-fill"></div></div>
        </div>
    </div>

    <!-- Sections injected by JS -->
    <div id="sections"></div>

</div>

<nav class="bot-nav">
    <button class="bn-btn" id="bn-prev" onclick="prevSec()" disabled>â† Back</button>
    <span class="bn-ind" id="bn-ind">1/5</span>
    <button class="bn-btn primary" id="bn-next" onclick="nextSec()">Next â†’</button>
</nav>

<script src="/supabase-auth-gamified.js"></script>
<script src="/daily-challenges-system.js"></script>
<script src="/word-match-game.js"></script>

<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LESSON DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const L = {
    title:      "Robots on Chinese TV!",
    lessonId:   "chineserobotsbeginner",
    lessonLink: "/chineserobotsbeginner/",
    levelPage:  "/beginner/",
    level:      "Beginner",

    vocabulary: [
        { word: "amazing",       type: "adjective", definition: "Very surprising and impressive. Example: The robot performance was amazing!" },
        { word: "performance",   type: "noun",      definition: "A show or display â€” like dancing, singing, or doing kung fu on TV." },
        { word: "technology",    type: "noun",      definition: "Scientific knowledge and modern machines and tools." },
        { word: "viewers",       type: "noun",      definition: "People who watch TV or videos. (= the audience)" },
        { word: "government",    type: "noun",      definition: "The people who control a country and make its laws." },
        { word: "investment",    type: "noun",      definition: "Money that you give to a company to help it grow." },
        { word: "factories",     type: "noun",      definition: "Buildings where products are made by machines and workers." },
        { word: "ageing",        type: "adjective", definition: "Getting older. An 'ageing population' means more old people than young people." },
        { word: "underestimate", type: "verb",      definition: "To think something is less powerful or important than it really is." },
        { word: "competitors",   type: "noun",      definition: "People or companies trying to be better than each other in the same market." }
    ],

    /* 3 opinion takes â€” agree / disagree */
    hotTakes: [
        {
            statement: "Robots doing kung fu on TV is just entertainment â€” it's not important. ğŸ¤·",
            answer: false, heat: 2,
            verdict: { right: "ğŸ¯ Exactly! It's more than just a show.", wrong: "ğŸ¤” Actually, it's much more important than it looks!" },
            explain: `The robot <span data-voc="performance" class="ht-voc">performance</span> was also a way to show China's robot <span data-voc="technology" class="ht-voc">technology</span> to millions of TV <span data-voc="viewers" class="ht-voc">viewers</span>. Four Chinese robot companies showed their products at the same time. That's business!`
        },
        {
            statement: "China makes most of the world's humanoid robots. ğŸ¤–",
            answer: true, heat: 1,
            verdict: { right: "âœ… Correct â€” China makes 90% of them!", wrong: "ğŸ˜® Actually true â€” China makes around 90% of all humanoid robots." },
            explain: `This is <span data-voc="amazing" class="ht-voc">amazing</span> but true. Chinese robot <span data-voc="technology" class="ht-voc">technology</span> is growing very fast. The <span data-voc="government" class="ht-voc">government</span> supports robot companies with money and attention from top politicians.`
        },
        {
            statement: "Elon Musk thinks Chinese robot companies are no competition for him. ğŸ˜",
            answer: false, heat: 3,
            verdict: { right: "ğŸ”¥ Right! Even Musk respects Chinese competition.", wrong: "ğŸŒ¶ï¸ Actually the opposite â€” he called them his biggest competitors!" },
            explain: `Even Elon Musk said: "People <span data-voc="underestimate" class="ht-voc">underestimate</span> China." His <span data-voc="competitors" class="ht-voc">competitors</span> from China are building fast. The race for robot technology is real â€” and very serious.`
        }
    ],

    gapWords: ['performance', 'technology', 'viewers', 'government', 'factories', 'competitors'],
    gapSentences: [
        { t: "The robot ___ was on TV for Chinese New Year.", a: "performance" },
        { t: "China's robot ___ is growing very quickly.", a: "technology" },
        { t: "Millions of ___ watched the show.", a: "viewers" },
        { t: "The ___ supports robot companies with money.", a: "government" },
        { t: "Robots will work in ___ and do difficult jobs.", a: "factories" },
        { t: "Chinese companies are Elon Musk's biggest ___.", a: "competitors" }
    ],

    grammar: [
        { s: "The robots ___ in China.",                      hint: "Made by companies (plural) â†’ are made",     opts: ["make","is made","are made"],   a: "are made"    },
        { s: "The show ___ by millions of people.",           hint: "Watched (singular show) â†’ is watched",       opts: ["watch","is watched","are watched"], a: "is watched" },
        { s: "Robot companies ___ by the government.",        hint: "Supported (plural companies) â†’ are supported", opts: ["are supported","support","is supported"], a: "are supported" },
        { s: "Kung fu ___ by the robots.",                    hint: "Performed (singular kung fu) â†’ is performed",  opts: ["perform","is performed","are performed"], a: "is performed" }
    ],

    badges: [
        { icon: 'ğŸ¤–', text: 'Robot Fan!'    },
        { icon: 'ğŸ¥·', text: 'Kung Fu!'      },
        { icon: 'ğŸ¯', text: 'Great Work!'   },
        { icon: 'â­', text: 'Star Learner!' },
        { icon: 'ğŸ”¥', text: 'On Fire!'      }
    ],

    grammarData: [
        { question: "are made",     answer: "are made",     explanation: "Passive: are + made" },
        { question: "is watched",   answer: "is watched",   explanation: "Passive: is + watched" },
        { question: "are supported",answer: "are supported",explanation: "Passive: are + supported" },
        { question: "is performed", answer: "is performed", explanation: "Passive: is + performed" }
    ]
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let curSec   = 0;
let doneSecs = 0;
let htIdx    = 0;
let htVoted  = false;
let selWord  = null;
const TOTAL  = 5;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function build() {
    const wrap = document.getElementById('sections');
    wrap.innerHTML =
        secCard(0, true,  'strip-green',  buildVideo()) +
        secCard(1, false, 'strip-blue',   buildReading()) +
        secCard(2, false, 'strip-yellow', buildHotTakes()) +
        `<div class="sec-label" id="lbl-exercises">ğŸ“ Practice Exercises</div>` +
        secCard(3, false, 'strip-purple', buildGapFill()) +
        secCard(4, false, 'strip-punch',  buildGrammar());
    updateNav(); updateProg();
    setTimeout(wireAll, 60);
}

function secCard(n, visible, strip, inner) {
    return `<div class="sec-card${visible ? ' visible' : ''} ${strip}" data-sec="${n}">${inner}</div>`;
}
function head(icon, title, sub) {
    return `<div class="sec-head"><div class="sec-head-left">
        <div class="sec-head-icon">${icon}</div>
        <div><div class="sec-head-title">${title}</div><div class="sec-head-sub">${sub}</div></div>
    </div></div>`;
}

/* â”€â”€ SECTION 0: VIDEO â”€â”€ */
function buildVideo() {
    return head('ğŸ“º', 'Watch the Video', 'See robots do kung fu on Chinese TV!') +
    `<div class="sec-body">
        <div class="video-wrap">
            <iframe src="https://www.youtube-nocookie.com/embed/mUmlv814aJo?si=EM5lNqyT6qXGzefr"
                title="Robots on Chinese TV" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen></iframe>
        </div>
        <div class="disc-box">
            <h3>ğŸ’¬ What do you think?</h3>
            <div class="disc-q">Did you like the robot performance?</div>
            <div class="disc-q">Was it surprising?</div>
            <div class="disc-q">Can robots do kung fu in your country?</div>
            <div class="disc-q">Is this good or bad?</div>
        </div>
        <button class="btn-continue" onclick="completeSec(0)">Continue <span class="btn-continue-arrow">â†’</span></button>
    </div>`;
}

/* â”€â”€ SECTION 1: READING â”€â”€ */
function buildReading() {
    return head('ğŸ“–', 'Reading', 'Read the text. Tap the green words to learn them!') +
    `<div class="sec-body">
        <div class="fact-strip">
            <h4>âš¡ Quick Facts</h4>
            <div class="fact-item">The TV show is China's biggest TV event of the year</div>
            <div class="fact-item">Many millions of people watched it</div>
            <div class="fact-item">China makes 90% of the world's humanoid robots</div>
            <div class="fact-item">The robots did kung fu with swords and sticks</div>
        </div>
        <div class="reading-card">
            <p>On Chinese New Year 2026, something <span class="vocab-word" data-voc="amazing">amazing</span> happened on TV. More than a dozen robots performed kung fu on China's biggest TV show. They moved swords, sticks, and nunchucks. They performed with children.</p>
            <p>This <span class="vocab-word" data-voc="performance">performance</span> was not just entertainment. It was also a way to show China's robot <span class="vocab-word" data-voc="technology">technology</span>. Four Chinese robot companies showed their products to millions of TV <span class="vocab-word" data-voc="viewers">viewers</span>.</p>
            <p>The robots did "drunken boxing" â€” a difficult martial arts style. The robots had to move together without falling. This is very hard for robots to do!</p>
            <p>Appearing on this TV show is very important for companies. They get <span class="vocab-word" data-voc="government">government</span> support and more <span class="vocab-word" data-voc="investment">investment</span> money.</p>
            <p>China wants to use robots in <span class="vocab-word" data-voc="factories">factories</span>. China has an <span class="vocab-word" data-voc="ageing">ageing</span> population, so robots can help with work. Even Elon Musk said: "People <span class="vocab-word" data-voc="underestimate">underestimate</span> China." Chinese companies are now his biggest <span class="vocab-word" data-voc="competitors">competitors</span>.</p>
        </div>
        <button class="btn-continue" onclick="completeSec(1)">Continue <span class="btn-continue-arrow">â†’</span></button>
    </div>`;
}

/* â”€â”€ SECTION 2: HOT TAKES â”€â”€ */
function buildHotTakes() {
    const dots = L.hotTakes.map((_, i) =>
        `<div class="ht-dot${i === 0 ? ' active' : ''}" id="htd-${i}"></div>`).join('');
    return head('ğŸ”¥', 'Hot Takes', 'Agree or Disagree â€” then see the real answer') +
        `<div class="sec-body">
            <div class="ht-dots">${dots}</div>
            <div id="ht-slot">${renderHT(0)}</div>
        </div>`;
}

function renderHT(idx) {
    const h = L.hotTakes[idx];
    const heatLabel = ['', 'ğŸŸ¢ Easy', 'ğŸŸ¡ Medium', 'ğŸ”´ Hard'][h.heat];
    const isLast    = idx === L.hotTakes.length - 1;
    return `<div class="ht-card" id="ht-card">
        <div class="ht-num">Statement ${idx + 1} of ${L.hotTakes.length}</div>
        <div class="ht-heat h${h.heat}">${heatLabel}</div>
        <div class="ht-statement">${h.statement}</div>
        <div class="ht-votes">
            <button class="ht-btn agree"    onclick="htVote(${idx},true)">ğŸ‘ Agree</button>
            <button class="ht-btn disagree" onclick="htVote(${idx},false)">ğŸ‘ Disagree</button>
        </div>
        <div class="ht-reveal" id="ht-rev-${idx}">
            <div class="ht-verdict" id="ht-verd-${idx}"></div>
            <div class="ht-explanation">${h.explain}</div>
            <button class="ht-next-btn" onclick="${isLast ? 'htFinish()' : 'htNext(' + idx + ')'}">
                ${isLast ? 'ğŸ§© Start Exercises â†’' : 'Next Statement â†’'}
            </button>
        </div>
    </div>`;
}

function htVote(idx, agreed) {
    if (htVoted) return;
    htVoted = true;
    const h   = L.hotTakes[idx];
    const win = agreed === h.answer;
    const ag  = document.querySelector('.ht-btn.agree');
    const di  = document.querySelector('.ht-btn.disagree');
    if (ag) { ag.disabled = true; if (agreed) ag.classList.add(win ? 'sel-agree' : 'sel-disagree'); }
    if (di) { di.disabled = true; if (!agreed) di.classList.add(win ? 'sel-agree' : 'sel-disagree'); }
    const rev  = document.getElementById(`ht-rev-${idx}`);
    const verd = document.getElementById(`ht-verd-${idx}`);
    if (rev)  rev.classList.add('show');
    if (verd) { verd.className = `ht-verdict ${win ? 'right' : 'wrong'}`; verd.textContent = win ? h.verdict.right : h.verdict.wrong; }
    const dot = document.getElementById(`htd-${idx}`);
    if (dot) { dot.classList.remove('active'); dot.classList.add('done'); }
}

function htNext(idx) {
    htVoted = false;
    const card = document.getElementById('ht-card');
    if (card) card.classList.add('exit');
    setTimeout(() => {
        htIdx = idx + 1;
        document.getElementById('ht-slot').innerHTML = renderHT(htIdx);
        const dot = document.getElementById(`htd-${htIdx}`);
        if (dot) dot.classList.add('active');
    }, 210);
}

function htFinish() {
    doneSecs = Math.max(doneSecs, 3); updateProg(); burst(); showBadge(rndBadge());
    document.getElementById('ht-slot').innerHTML = `
        <div class="ht-done">
            <span class="ht-done-icon">ğŸ¯</span>
            <div class="ht-done-title">Hot Takes â€” Done!</div>
            <div class="ht-done-sub">You know the key facts. Now let's practise!</div>
            <button class="ht-next-btn" onclick="goTo(3)">ğŸ§© Start Exercises â†’</button>
        </div>`;
}

/* â”€â”€ SECTION 3: GAP FILL â”€â”€ */
function buildGapFill() {
    const bank = L.gapWords.map(w =>
        `<button class="wb-word" data-word="${w}">${w}</button>`).join('');
    const sents = L.gapSentences.map((s, i) => {
        const pts = s.t.split('___');
        return `<p style="margin-bottom:.3em">${i + 1}. ${pts[0]}<span class="gap" data-answer="${s.a}"></span>${pts[1] || ''}</p>`;
    }).join('');
    return head('ğŸ§©', 'Fill the Gaps', 'Tap a word from the bank, then tap a blank') +
        `<div class="sec-body">
            <p style="font-size:13px;font-weight:800;color:var(--ink-3);margin-bottom:12px;">Tap a word, then tap a blank space to fill it</p>
            <div class="word-bank"><div class="wb-label">Word Bank</div><div class="wb-words">${bank}</div></div>
            <div class="gap-sents">${sents}</div>
            <div class="btn-row">
                <button class="btn-check" onclick="checkGF()">Check Answers</button>
                <button class="btn-reset" onclick="resetGF()">Reset</button>
            </div>
            <div id="res-gf" class="result"></div>
        </div>`;
}

/* â”€â”€ SECTION 4: GRAMMAR â”€â”€ */
function buildGrammar() {
    const cards = L.grammar.map((q, i) => {
        const opts = q.opts.map(o => `<option value="${o}">${o}</option>`).join('');
        return `<div class="gram-card">
            <div class="gc-body">
                <p class="gc-sent">${i + 1}. ${q.s}</p>
                <p class="gc-hint">ğŸ’¡ ${q.hint}</p>
            </div>
            <select class="gram-sel" data-answer="${q.a}">
                <option value="">Chooseâ€¦</option>${opts}
            </select>
        </div>`;
    }).join('');
    return head('ğŸ“–', 'Grammar: Passive Voice', 'Choose the correct passive form') +
        `<div class="sec-body">
            <div class="gram-expl">
                <h4>ğŸ›°ï¸ What is the Passive?</h4>
                <p>We use passive when <strong>the action is more important than who does it</strong>.</p>
                <div class="gram-ex"><strong>Active:</strong> Companies <strong>make</strong> robots.</div>
                <div class="gram-ex"><strong>Passive:</strong> Robots <strong>are made</strong> by companies.</div>
                <p style="margin-top:8px;font-size:12px;color:var(--ink-3);font-weight:800;">Form: is/are + past participle</p>
            </div>
            ${cards}
            <div class="btn-row">
                <button class="btn-check" onclick="checkGR()">Check Grammar</button>
            </div>
            <div id="res-gr" class="result"></div>
        </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goTo(n) {
    curSec = n;
    if (n >= 3) document.getElementById('lbl-exercises')?.classList.add('show');
    const el = document.querySelector(`.sec-card[data-sec="${n}"]`);
    if (el) { el.classList.add('visible'); el.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
    updateNav();
}
function nextSec() { if (curSec < TOTAL - 1) { curSec++; goTo(curSec); } else finishLesson(); }
function prevSec() { if (curSec > 0) { curSec--; goTo(curSec); } }

function completeSec(n) {
    doneSecs = Math.max(doneSecs, n + 1); updateProg();
    if (n >= TOTAL - 1) { finishLesson(); return; }
    const next = document.querySelector(`.sec-card[data-sec="${n + 1}"]`);
    if (next) { next.classList.add('visible'); next.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
    if (Math.random() < .3) showBadge(rndBadge());
    curSec = n + 1; updateNav();
}

function updateNav() {
    document.getElementById('bn-prev').disabled = curSec === 0;
    document.getElementById('bn-next').textContent = curSec >= TOTAL - 1 ? 'ğŸ Finish' : 'Next â†’';
    document.getElementById('bn-ind').textContent  = `${curSec + 1}/${TOTAL}`;
}
function updateProg() {
    const pct = Math.round((doneSecs / TOTAL) * 100);
    document.getElementById('prog-fill').style.width  = pct + '%';
    document.getElementById('prog-label').textContent = `${doneSecs} / ${TOTAL} sections`;
    document.getElementById('prog-pct').textContent   = pct + '%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAP FILL LOGIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function gapClick(gap) {
    if (gap.classList.contains('correct')) return;
    if (gap.textContent.trim()) {
        const w = Array.from(document.querySelectorAll('.wb-word'))
            .find(b => b.dataset.word === gap.textContent.trim());
        if (w) w.classList.remove('used');
        gap.textContent = ''; gap.classList.remove('incorrect');
    } else if (selWord) {
        gap.textContent = selWord.dataset.word;
        selWord.classList.add('used'); selWord.classList.remove('sel');
        selWord = null;
    }
}

function checkGF() {
    const gaps = document.querySelectorAll('.gap'); let ok = 0;
    gaps.forEach(g => {
        g.classList.remove('correct', 'incorrect');
        const v = (g.textContent || '').trim().toLowerCase();
        if (v === g.dataset.answer.toLowerCase()) { g.classList.add('correct'); ok++; }
        else if (v) g.classList.add('incorrect');
    });
    showRes('gf', ok, gaps.length, 'âœ¨ All gaps correct!', 'red gaps are wrong â€” click to clear and retry');
}

function resetGF() {
    document.querySelectorAll('.gap').forEach(g => { g.textContent = ''; g.classList.remove('correct', 'incorrect'); });
    document.querySelectorAll('.wb-word').forEach(w => w.classList.remove('sel', 'used'));
    selWord = null;
    hideRes('gf');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GRAMMAR LOGIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function checkGR() {
    const sels = document.querySelectorAll('.gram-sel'); let ok = 0;
    sels.forEach(s => {
        s.classList.remove('correct', 'incorrect');
        if (!s.value) return;
        s.value === s.dataset.answer ? (s.classList.add('correct'), ok++) : s.classList.add('incorrect');
    });
    showRes('gr', ok, sels.length, 'ğŸ¯ Grammar Star!', 'red dropdowns are wrong â€” try again!');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULT HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showRes(id, ok, total, yep, nope) {
    const el = document.getElementById(`res-${id}`); if (!el) return;
    const perfect = ok === total;
    el.style.display = 'block'; el.className = `result ${perfect ? 'ok' : 'bad'}`;
    el.textContent = perfect ? yep : `${ok}/${total} correct â€” ${nope}`;
    if (perfect) {
        burst();
        if (Math.random() < .5) showBadge(rndBadge());
        const secNum = id === 'gf' ? 3 : 4;
        setTimeout(() => completeSec(secNum), 1400);
    }
}
function hideRes(id) { const e = document.getElementById(`res-${id}`); if (e) e.style.display = 'none'; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIRE INTERACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function wireAll() {
    document.querySelectorAll('.wb-word').forEach(w => {
        w.addEventListener('click', () => {
            if (w.classList.contains('used')) return;
            if (w.classList.contains('sel')) { w.classList.remove('sel'); selWord = null; }
            else { document.querySelectorAll('.wb-word').forEach(b => b.classList.remove('sel')); w.classList.add('sel'); selWord = w; }
        });
    });
    document.querySelectorAll('.gap').forEach(g => g.addEventListener('click', () => gapClick(g)));
    document.addEventListener('click', e => {
        const voc = e.target.closest('[data-voc]');
        if (voc) { e.stopPropagation(); showVoc(voc.dataset.voc); return; }
        if (!e.target.closest('#voc-popup')) closeVoc();
    });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VOCAB POPUP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showVoc(word) {
    const w = L.vocabulary.find(v => v.word.toLowerCase() === word.toLowerCase());
    if (!w) return;
    document.getElementById('vp-body').innerHTML = `
        <div class="voc-word">${w.word}</div>
        <div class="voc-type">${w.type}</div>
        <div class="voc-def">${w.definition}</div>
        <button class="voc-hear" onclick="speak('${w.word}')">ğŸ”Š Hear It (British English)</button>`;
    document.getElementById('voc-popup').style.display = 'block';
}
function closeVoc() { document.getElementById('voc-popup').style.display = 'none'; }
function speak(word) {
    const u = new SpeechSynthesisUtterance(word);
    u.lang = 'en-GB'; u.rate = .85;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CELEBRATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const COLOURS = ['#58CC02','#FFC800','#1CB0F6','#FF4B4B','#CE82FF','#2BDECC'];
function burst() {
    for (let i = 0; i < 18; i++) {
        const d = document.createElement('div');
        d.className = 'confetti-dot';
        d.style.cssText = `left:${25+Math.random()*50}vw;top:${15+Math.random()*35}vh;background:${COLOURS[Math.floor(Math.random()*COLOURS.length)]};animation-delay:${Math.random()*.35}s;animation-duration:${.65+Math.random()*.6}s;transform:rotate(${Math.random()*360}deg)`;
        document.body.appendChild(d);
        setTimeout(() => d.remove(), 1300);
    }
}
function showBadge(b) {
    const el = document.createElement('div');
    el.className = 'badge';
    el.innerHTML = `<span class="badge-icon">${b.icon}</span><span class="badge-text">${b.text}</span>`;
    document.getElementById('badge-wrap').appendChild(el);
    setTimeout(() => el.classList.add('show'), 80);
    setTimeout(() => { el.classList.remove('show'); setTimeout(() => el.remove(), 400); }, 2800);
}
function rndBadge() { return L.badges[Math.floor(Math.random() * L.badges.length)]; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FINISH LESSON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function finishLesson() {
    doneSecs = TOTAL; updateProg();
    if (!window.EFCD_Auth?.getCurrentUser()) {
        localStorage.setItem('efcd_last_lesson_done', 'true');
        if (confirm('ğŸ¤– Lesson complete!\n\nSign up free to save your XP, streaks and badges.\n\nOK = Sign up | Cancel = Keep browsing'))
            window.location.href = '/signup/';
        else if (typeof showWordMatchGame === 'function')
            showWordMatchGame(L.vocabulary, () => window.location.href = L.levelPage);
        else window.location.href = L.levelPage;
        return;
    }
    localStorage.setItem('efcd_last_lesson_done', 'true');
    const completionTime = Math.floor((Date.now() - performance.timing.navigationStart) / 1000);
    const result = await window.EFCD_Auth.completeLesson({
        lessonId:       L.lessonId,
        lessonTitle:    L.title,
        lessonLevel:    L.level,
        lessonLink:     L.lessonLink,
        vocabulary:     L.vocabulary,
        grammar:        L.grammarData,
        perfectScore:   true,
        completionTime: completionTime
    });

    if (window.DailyChallenges && result?.success) {
        const cr = await window.DailyChallenges.updateChallengeProgress({
            perfectScore: true, vocabCount: L.vocabulary.length,
            completionTime: completionTime, grammarPerfect: true
        });
        if (cr?.justCompleted) {
            setTimeout(() => window.DailyChallenges.showChallengeCompletionCelebration?.(cr.challenge), 900);
        }
    }

    if (typeof showWordMatchGame === 'function')
        showWordMatchGame(L.vocabulary, gr => showEndScreen(result, gr));
    else showEndScreen(result, null);
}

function showEndScreen(res, game) {
    const xp = (res?.xpEarned || 0) + (game?.bonusXP || 0);
    const ov = document.createElement('div');
    ov.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;animation:up .3s ease both;';
    ov.innerHTML = `
        <div style="background:var(--white);border:2px solid var(--border-heavy);border-bottom:8px solid var(--border-heavy);border-radius:var(--r);max-width:420px;width:100%;overflow:hidden;animation:popin .4s cubic-bezier(.175,.885,.32,1.275) both;">
            <div style="background:linear-gradient(135deg,var(--green) 0%,#7EE000 100%);padding:28px 20px 24px;text-align:center;position:relative;">
                <button onclick="this.closest('div').parentElement.parentElement.remove()" style="position:absolute;top:10px;right:10px;background:rgba(0,0,0,.1);border:2px solid rgba(0,0,0,.15);border-radius:var(--rxs);color:var(--white);font-size:20px;font-weight:900;width:34px;height:34px;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;">Ã—</button>
                <div style="font-size:68px;margin-bottom:8px;">ğŸ¤–</div>
                <div style="font-size:13px;font-weight:900;color:rgba(255,255,255,.8);text-transform:uppercase;letter-spacing:2px;margin-bottom:4px;">Lesson Complete!</div>
                <div style="font-size:28px;font-weight:900;color:var(--white);letter-spacing:-1px;text-shadow:0 2px 0 var(--green-shadow);">Robots mastered! ğŸ¥·</div>
            </div>
            <div style="padding:20px;display:flex;flex-direction:column;gap:14px;">
                <div style="background:var(--bg);border:2px solid var(--border-heavy);border-bottom:4px solid var(--border-heavy);border-radius:var(--rsm);padding:18px;text-align:center;">
                    <div style="font-size:48px;font-weight:900;color:var(--green);">+${xp} XP</div>
                    ${res?.leveledUp ? `<div style="color:var(--green-shadow);font-weight:900;font-size:16px;margin-top:6px;">ğŸŠ LEVEL UP â†’ Level ${res.newLevel}!</div>` : ''}
                    ${res?.newStreak > 0 ? `<div style="color:var(--ink-3);font-weight:800;font-size:14px;margin-top:4px;">ğŸ”¥ ${res.newStreak}-day streak!</div>` : ''}
                </div>
                <a href="${L.levelPage}" style="display:flex;align-items:center;justify-content:center;gap:8px;padding:15px;background:var(--green);color:var(--white);font-size:16px;font-weight:900;border-radius:var(--rsm);border:2px solid var(--green-shadow);border-bottom:5px solid var(--green-shadow);">Next Lesson â†’</a>
                <a href="/dashboard-gamified/" style="display:flex;align-items:center;justify-content:center;padding:13px;background:var(--bg);color:var(--ink-3);font-size:14px;font-weight:800;border-radius:var(--rsm);border:2px solid var(--border-heavy);border-bottom:3px solid var(--border-heavy);">View Dashboard</a>
            </div>
        </div>`;
    document.body.appendChild(ov);
    burst(); setTimeout(burst, 300);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initStats() {
    localStorage.setItem('efcd_last_lesson_url',  window.location.pathname);
    localStorage.setItem('efcd_last_lesson_name', 'Robots on Chinese TV!');
    localStorage.setItem('efcd_last_lesson_done', 'false');

    function tryInit() {
        if (typeof window.efcdReady === 'undefined') { setTimeout(tryInit, 50); return; }
        window.efcdReady.then(async () => {
            if (!window.EFCD_Auth) return;
            await window.EFCD_Auth.initAuth();
            const user = window.EFCD_Auth.getCurrentUser();
            if (user) {
                const s = window.EFCD_Auth.getUserStats();
                document.getElementById('hdr-streak').textContent = s?.streak || 0;
                document.getElementById('hdr-xp').textContent     = (s?.xp || 0).toLocaleString();
            }
        }).catch(() => {});
    }
    tryInit();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
build();
initStats();
if (window.DailyChallenges) {
    const w = document.getElementById('daily-challenge-widget');
    if (w) w.innerHTML = window.DailyChallenges.renderDailyChallengeWidget?.() || '';
}
</script>
</body>
</html>
