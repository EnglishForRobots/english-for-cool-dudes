
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="apple-touch-icon" href="/images/icon-180.png" sizes="180x180">
    <link rel="icon" type="image/png" href="/images/icon-192.png" sizes="192x192">
    <link rel="manifest" href="/manifest.json">
    <title>The Agile Workplace - English For Cool Dudes</title>
    <script src="https://cdn.tailwindcss.com"></script>
  
    <style>
        /* --- BASE & LAYOUT STYLES (Matching New Site) --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: #F8F9FB; /* Light background */
            color: #2C3E50;
            line-height: 1.6;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
        }

        /* Header (Global Nav Bar) */
        .header {
            background: #FFFFFF;
            border-bottom: 1px solid #E5E9F2;
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }

       .header-wrapper {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.header-link {
    display: flex;
    align-items: center;
    gap: 15px;
    text-decoration: none;
    color: #2C3E50;
}

.header-link:hover {
    opacity: 0.9;
}

.header-content:hover {
     opacity: 0.9; /* Subtle visual feedback on hover */
}

        .logo {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .site-title {
            font-size: 20px;
            font-weight: 600;
            color: #1A202C;
            letter-spacing: -0.02em;
        }

        /* Main Container for Lesson */
        .container-main {
            max-width: 900px;
            margin: 30px auto;
            padding: 30px 20px;
            background-color: #FFFFFF; /* White card background */
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #E5E9F2;
        }

        /* Lesson Specific Styles */
        .lesson-main-title {
            font-size: 2.5em;
            font-weight: 600;
            color: #27AE60; /* Agile Theme Color: Emerald Green */
            margin-bottom: 10px;
            letter-spacing: -0.02em;
        }

        .lesson-section {
            background-color: #F8F9FB; /* Very light background for content */
            padding: 30px;
            border-radius: 10px;
            border: 1px solid #E5E9F2;
        }

        .section-title {
            color: #27AE60; /* Primary Green for Agile headers */
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 5px;
            border-bottom: 2px dashed #E5E9F2;
        }
        
        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            background: #E5E9F2;
            border-radius: 9999px; /* Full rounded */
            height: 10px;
            margin-top: 10px;
        }

        .progress-bar-fill {
            background: linear-gradient(90deg, #27AE60 0%, #38a169 100%); /* Green Gradient */
            height: 10px;
            border-radius: 9999px;
            transition: width 0.5s ease;
        }

        /* --- INTERACTIVE ELEMENT STYLES --- */
        .interactive-element {
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #E5E9F2;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }

        .interactive-element:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            border-color: #667EEA;
        }

        /* Quiz/Matching Options */
        .quiz-option, .term-btn, .meaning-btn {
            background-color: #FFFFFF;
            color: #2C3E50;
            font-weight: 600;
        }
        
        /* True/False Buttons */
        .tf-btn {
            background: #FFFFFF !important; /* Override inline style */
            color: #2C3E50 !important;
            border: 2px solid #E5E9F2;
            font-weight: 600;
        }
        .tf-btn:hover {
            border-color: #667EEA;
        }

        /* Conversation Word Bank Items (fill-in-box) */
        .fill-in-box {
            background-color: #F0F3F7;
            border: 2px solid #E5E9F2;
            color: #2C3E50;
            font-weight: 600;
            padding: 10px 15px; /* Bigger word bank items */
        }
        
        /* New: Custom Classes for Cycling Colors (Light Theme Palette) */
        .match-color-1 { background-color: #27AE60 !important; border-color: #27AE60 !important; color: white !important; } /* Emerald */
        .match-color-2 { background-color: #8E44AD !important; border-color: #8E44AD !important; color: white !important; } /* Wisteria */
        .match-color-3 { background-color: #F39C12 !important; border-color: #F39C12 !important; color: white !important; } /* Orange */
        .match-color-4 { background-color: #3498DB !important; border-color: #3498DB !important; color: white !important; } /* Peter River */
        
        /* Match/Term Selection */
        .bg-yellow-600 { /* For temporarily selected terms/meanings */
            background-color: #F39C12 !important; 
            color: white !important;
            border-color: #F39C12 !important;
        }
        
        /* Conversation Blanks (conversation-fill-box) */
        .conversation-fill-box {
            /* BIGGER GAPS */
            display: inline-block;
            min-width: 160px; /* Increased minimum width */
            padding: 8px 10px; /* Increased padding */
            border-bottom: 2px dashed #2980B9; /* Primary Blue Dash */
            color: #2980B9;
            font-weight: 600;
            background-color: #F0F3F7;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
        }

        /* Conversation Blank Selection */
        .conversation-fill-box.selected-blank {
            background-color: #2980B9;
            color: white;
            border-bottom: 2px solid #2980B9;
        }

        /* Conversation Word Bank Selection */
        .fill-in-box.selected-word {
            background-color: #667EEA; /* Primary Purple/Blue */
            color: white;
            border-color: #667EEA;
        }

        /* Correct/Incorrect Answers */
        .correct-answer {
            background-color: #27AE60 !important; /* Green */
            color: white !important;
            border-color: #27AE60 !important;
            pointer-events: none;
            cursor: default;
        }
        .incorrect-answer {
            background-color: #E74C3C !important; /* Red */
            color: white !important;
            border-color: #E74C3C !important;
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        
        /* Check Answer Button (Conversation) */
        .check-button {
            background: linear-gradient(45deg, #667EEA 0%, #764BA2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
        }
        .check-button:hover {
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.5);
            transform: translateY(-1px);
        }

        /* Footer */
        .footer {
            background: #FFFFFF;
            border-top: 1px solid #E5E9F2;
            padding: 32px 20px;
            margin-top: 40px;
            text-align: center;
        }

        .footer-text {
            font-size: 14px;
            color: #718096;
        }
    </style>
</head>
<body>
    <header class="header">
    <div class="header-wrapper">
        <a href="/business/" class="header-link">
            <div class="logo">üòé</div> 
            <span class="site-title">English For Cool Dudes</span> 
        </a>
    </div>
</header>

    <div class="container-main mx-auto max-w-6xl overflow-hidden my-10">

        <header class="text-center pb-8 mb-8 border-b border-gray-200">
            <p class="text-lg font-medium text-gray-500 mb-1">Essential Business English for Modern Teams</p>
            <h1 class="lesson-main-title">üöÄ The Agile Workplace</h1>
            <p class="text-xl text-gray-500">Essential Business English for Modern Teams</p>

            <div class="mt-6 flex justify-between text-sm font-semibold text-gray-600">
                <span id="progress-text">Progress: 0/4 activities complete</span>
                <span id="score">Score: 0</span>
            </div>
            <div class="progress-bar-container">
                <div id="progress-fill" class="progress-bar-fill" style="width: 0%"></div>
            </div>
             <span id="feedback-message" class="text-lg font-medium text-green-400 hidden"></span>
        </header>

        <main class="p-4 sm:p-6 md:p-10">
            
            <section id="reading-section" class="lesson-section shadow-lg mb-8">
                <h2 class="section-title">üìñ Reading: The Rise of Agile Work</h2>
                <div class="text-gray-600 space-y-4 text-sm md:text-base">
                    <p>In today's fast-paced world, many companies are moving away from traditional, rigid work structures and embracing an **agile** approach. This means prioritizing **flexibility**, **collaboration**, and **adaptability**. Instead of long-term, fixed plans, agile teams work in short cycles called **sprints**, typically lasting two to four weeks. At the end of each sprint, the team delivers a finished piece of work, gets feedback, and adjusts their plan for the next cycle.</p>
                    <p>A key aspect of agile is constant communication. Teams hold daily **stand-up meetings** (or **scrums**) to quickly share what they've done, what they'll do next, and any obstacles they're facing. This transparency helps everyone stay on track and allows for problems to be solved quickly. The focus is on **continuous improvement** and responding to change, rather than following a strict, pre-determined path. This is particularly important for remote or hybrid teams that need to stay connected.</p>
                </div>
                <div class="mt-6">
                    <h3 class="text-xl font-bold text-gray-700 mb-4">Quiz: Reading Check</h3>
                    <p class="text-gray-600 mb-4">What is the main purpose of a daily stand-up meeting?</p>
                    <div id="reading-quiz" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="checkReadingQuiz('A')" class="quiz-option interactive-element rounded-lg p-4 font-semibold text-left">A) To give a full presentation on a new project.</button>
                        <button onclick="checkReadingQuiz('B')" class="quiz-option interactive-element rounded-lg p-4 font-semibold text-left">B) To quickly share progress and identify challenges.</button>
                    </div>
                    <p id="reading-feedback" class="mt-4 text-sm font-medium"></p>
                </div>
            </section>
            
            <section id="true-false-section" class="lesson-section shadow-lg mb-8">
                <h2 class="section-title">‚öñÔ∏è True or False?</h2>
                <div class="space-y-4">
                    <p class="text-lg font-medium text-gray-700" id="tf-question">1. An agile team works on a project for months before delivering any results.</p>
                    <div class="flex gap-4">
                        <button onclick="checkTrueFalse(true)" class="tf-btn interactive-element py-3 px-6 rounded-full shadow-md">True</button>
                        <button onclick="checkTrueFalse(false)" class="tf-btn interactive-element py-3 px-6 rounded-full shadow-md">False</button>
                    </div>
                    <p id="tf-feedback" class="text-sm italic text-gray-600"></p>
                </div>
            </section>
            
            <section id="terms-section" class="lesson-section shadow-lg mb-8">
                <h2 class="section-title">üîó Agile Terms & Concepts</h2>
                <p class="text-gray-600 text-center mb-6">Click a term, then click its meaning to make a match! Correct matches will turn the same color.</p>
                <div class="flex flex-col md:flex-row justify-center items-center gap-6">
                    <div id="terms-container" class="grid grid-cols-1 md:grid-cols-1 gap-4 w-full md:w-1/2">
                        </div>
                    <div id="meanings-container" class="grid grid-cols-1 md:grid-cols-1 gap-4 w-full md:w-1/2">
                        </div>
                </div>
                <div class="text-center mt-6">
                    <span id="terms-progress" class="text-lg font-medium text-gray-600">0/5 matched</span>
                </div>
            </section>

            <section id="conversation-section" class="lesson-section shadow-lg mb-8">
                <h2 class="section-title">üó£Ô∏è Team Talk</h2>
                <p class="text-gray-600 mb-4">Click a word from the bank, then click the blank to fill it.</p>
                <div id="conversation-word-bank" class="flex flex-wrap gap-2 justify-center bg-gray-100 p-4 rounded-lg mb-6">
                    </div>
                <div id="conversation-text" class="text-lg text-gray-700 leading-relaxed space-y-4">
                    <p><span class="font-bold text-blue-500">Liam:</span> Hey team, let's have a quick <span class="conversation-fill-box interactive-element" data-word-index="0"></span> to sync up on our progress.</p>
                    <p><span class="font-bold text-blue-500">Maria:</span> Sounds good. We're on track to complete all our tasks by the end of this <span class="conversation-fill-box interactive-element" data-word-index="1"></span>. The new feature is almost ready for testing.</p>
                    <p><span class="font-bold text-blue-500">Liam:</span> Great. I'll get back to you with some feedback. We need to be **flexible** and make changes as needed. What's the biggest <span class="conversation-fill-box interactive-element" data-word-index="2"></span> you're facing?</p>
                    <p><span class="font-bold text-blue-500">Maria:</span> We're having some trouble with the API. It's a bit of a <span class="conversation-fill-box interactive-element" data-word-index="3"></span>, but we should have it solved soon. I'll keep you updated.</p>
                </div>
                <button onclick="checkConversationBlanks()" class="check-button">Check Answers</button>
                <div id="conversation-feedback" class="mt-4 text-sm font-medium"></div>
            </section>
        </main>
        
        <footer class="footer">
    <p class="footer-text">¬© 2025 English For Cool Dudes - üòé</p>
    <div style="margin-top: 10px;">
        <a href="/impressum/" style="color: #667EEA; margin-right: 15px; text-decoration: none;">Impressum</a>
        <a href="/datenschutz/" style="color: #667EEA; text-decoration: none;">Datenschutzerkl√§rung</a>
    </div>
</footer>
    </div>

    <script>
        // Global state variables for all activities
        let score = 0;
        let matchedTerms = 0;
        let selectedTerm = null;
        let selectedMeaning = null;
        let activitiesCompleted = 0;
        let readingQuizDone = false;
        let tfQuizDone = false;
        let termsDone = false;
        let conversationDone = false;

        // Custom Classes for Cycling Colors (Matching Game)
        let matchColorIndex = 0;
        const MATCH_COLORS = ['match-color-1', 'match-color-2', 'match-color-3', 'match-color-4', 'match-color-1'];

        const terms = [
            { id: 1, term: 'Sprint', meaning: 'A short, time-boxed period to complete a specific set of tasks.' },
            { id: 2, term: 'Stand-up', meaning: 'A brief daily meeting to share progress and challenges.' },
            { id: 3, term: 'Agile', meaning: 'A project approach that prioritizes flexibility and collaboration.' },
            { id: 4, term: 'Roadblock', meaning: 'An obstacle or problem that prevents progress.' },
            { id: 5, term: 'Backlog', meaning: 'A list of tasks, features, or issues to be completed.' }
        ];

        const conversationBlanksData = ['stand-up', 'sprint', 'roadblock', 'headache'];
        let userConversationWords = new Array(conversationBlanksData.length).fill(null);
        let selectedBlankIndex = null;
        let selectedWordBankWord = null; // New global state for selected word
        
        const totalActivities = 4; 

        /**
         * Utility function to update the score, progress bar, and provide feedback.
         */
        function updateScore(points, message, type) {
            score += points;
            document.getElementById('score').textContent = `Score: ${score}`;

            const feedbackEl = document.getElementById('feedback-message');
            feedbackEl.textContent = message;
            feedbackEl.classList.remove('text-green-600', 'text-red-600', 'hidden');
            if (type === 'correct') {
                feedbackEl.classList.add('text-green-600', 'font-bold');
                feedbackEl.classList.remove('text-red-600');
            } else {
                feedbackEl.classList.add('text-red-600', 'font-bold');
                feedbackEl.classList.remove('text-green-600');
            }
            setTimeout(() => {
                feedbackEl.classList.add('hidden');
            }, 3000);
        }

        /**
         * Updates the overall progress bar.
         */
        function updateProgress() {
            activitiesCompleted = [readingQuizDone, tfQuizDone, termsDone, conversationDone].filter(Boolean).length;
            const percentage = (activitiesCompleted / totalActivities) * 100;
            document.getElementById('progress-fill').style.width = `${percentage}%`;
            document.getElementById('progress-text').textContent = `${activitiesCompleted}/${totalActivities} activities complete`;

            if (activitiesCompleted === totalActivities) {
                updateScore(100, 'All activities completed! You are an Agile Pro! üèÜ', 'correct');
            }
        }
        
        /**
         * Checks the reading comprehension multiple-choice quiz answer.
         */
        function checkReadingQuiz(selectedOption) {
            if (readingQuizDone) return;
            const feedbackEl = document.getElementById('reading-feedback');
            const quizOptions = document.querySelectorAll('#reading-quiz button');
            
            quizOptions.forEach(btn => btn.classList.remove('correct-answer', 'incorrect-answer'));

            if (selectedOption === 'B') {
                feedbackEl.textContent = 'Correct! The goal is a quick sync, not a full presentation.';
                feedbackEl.className = 'mt-4 text-sm font-medium text-green-600';
                document.querySelector(`[onclick="checkReadingQuiz('${selectedOption}')"]`).classList.add('correct-answer');
                updateScore(20, 'Reading quiz correct!', 'correct');
                readingQuizDone = true;
                updateProgress();
            } else {
                feedbackEl.textContent = 'Incorrect. Stand-ups are for quick updates, not long presentations.';
                feedbackEl.className = 'mt-4 text-sm font-medium text-red-600';
                document.querySelector(`[onclick="checkReadingQuiz('${selectedOption}')"]`).classList.add('incorrect-answer');
                updateScore(-5, 'Reading quiz incorrect.', 'incorrect');
            }
        }

        /**
         * Checks the answer for the True/False question.
         */
        function checkTrueFalse(answer) {
            if (tfQuizDone) return;
            const feedbackEl = document.getElementById('tf-feedback');
            
            document.querySelectorAll('.tf-btn').forEach(btn => btn.classList.remove('correct-answer', 'incorrect-answer'));

            if (!answer) { // The statement is False
                feedbackEl.textContent = 'Correct! Agile teams work in short sprints, not long, fixed periods.';
                feedbackEl.className = 'text-sm italic text-green-600';
                document.querySelectorAll('.tf-btn')[1].classList.add('correct-answer'); // False button is the second one
                updateScore(15, 'True/False question correct!', 'correct');
                tfQuizDone = true;
                updateProgress();
            } else {
                feedbackEl.textContent = 'Incorrect. That statement is false.';
                feedbackEl.className = 'text-sm italic text-red-600';
                document.querySelectorAll('.tf-btn')[0].classList.add('incorrect-answer'); // True button is the first one
                updateScore(-5, 'True/False question incorrect.', 'incorrect');
            }
        }

        /**
         * Initializes the terms matching game by shuffling and displaying pairs.
         */
        function setupTerms() {
            const termsShuffled = [...terms].sort(() => Math.random() - 0.5);
            const meaningsShuffled = [...terms].sort(() => Math.random() - 0.5);

            const termsContainer = document.getElementById('terms-container');
            const meaningsContainer = document.getElementById('meanings-container');
            
            termsContainer.innerHTML = '';
            meaningsContainer.innerHTML = '';

            termsShuffled.forEach(item => {
                const button = document.createElement('button');
                button.textContent = item.term;
                button.className = 'term-btn interactive-element rounded-lg p-4 font-semibold shadow-md';
                button.dataset.id = item.id;
                button.onclick = () => selectTerm(button);
                termsContainer.appendChild(button);
            });

            meaningsShuffled.forEach(item => {
                const button = document.createElement('button');
                button.textContent = item.meaning;
                button.className = 'meaning-btn interactive-element rounded-lg p-4 font-semibold shadow-md';
                button.dataset.id = item.id;
                button.onclick = () => selectMeaning(button);
                meaningsContainer.appendChild(button);
            });
        }

        /**
         * Handles the selection of an idiom button.
         */
        function selectTerm(button) {
            if (button.disabled || termsDone) return;
            document.querySelectorAll('.term-btn').forEach(btn => btn.classList.remove('bg-yellow-600'));
            button.classList.add('bg-yellow-600');
            selectedTerm = button;
            checkMatch();
        }

        /**
         * Handles the selection of a meaning button.
         */
        function selectMeaning(button) {
            if (button.disabled || termsDone) return;
            document.querySelectorAll('.meaning-btn').forEach(btn => btn.classList.remove('bg-yellow-600'));
            button.classList.add('bg-yellow-600');
            selectedMeaning = button;
            checkMatch();
        }

        /**
         * Checks if the selected idiom and meaning match.
         */
        function checkMatch() {
            if (selectedTerm && selectedMeaning) {
                if (selectedTerm.dataset.id === selectedMeaning.dataset.id) {
                    
                    // Correct Match - Apply new color
                    const colorClass = MATCH_COLORS[matchColorIndex];
                    matchColorIndex = (matchColorIndex + 1) % MATCH_COLORS.length; // Cycle the index
                    
                    selectedTerm.classList.remove('bg-yellow-600', 'interactive-element');
                    selectedMeaning.classList.remove('bg-yellow-600', 'interactive-element');
                    
                    selectedTerm.classList.add(colorClass);
                    selectedMeaning.classList.add(colorClass);

                    selectedTerm.disabled = true;
                    selectedMeaning.disabled = true;
                    selectedTerm = null;
                    selectedMeaning = null;
                    matchedTerms++;
                    document.getElementById('terms-progress').textContent = `${matchedTerms}/${terms.length} matched`;
                    updateScore(15, 'Correct! Great match.', 'correct');
                    if (matchedTerms === terms.length) {
                        updateScore(50, 'Section complete! All terms matched! üèÜ', 'correct');
                        termsDone = true;
                        updateProgress();
                    }
                } else {
                    updateScore(-5, 'Incorrect match. Try again.', 'incorrect');
                    selectedTerm.classList.add('incorrect-answer');
                    selectedMeaning.classList.add('incorrect-answer');
                    
                    const termToClear = selectedTerm;
                    const meaningToClear = selectedMeaning;
                    selectedTerm = null;
                    selectedMeaning = null;

                    setTimeout(() => {
                        termToClear.classList.remove('bg-yellow-600', 'incorrect-answer');
                        meaningToClear.classList.remove('bg-yellow-600', 'incorrect-answer');
                    }, 500);
                }
            }
        }
        
        /**
         * Sets up the conversation fill-in-the-blanks section.
         */
        function setupConversationBlanks() {
            const wordBankEl = document.getElementById('conversation-word-bank');
            // Shuffle the word bank for variety
            const words = [...conversationBlanksData].sort(() => Math.random() - 0.5);
            
            wordBankEl.innerHTML = '';
            words.forEach(word => {
                const button = document.createElement('button');
                button.textContent = word;
                button.className = 'fill-in-box interactive-element rounded-lg p-2 font-semibold shadow-md';
                button.dataset.word = word; // Store the word in data-word
                button.onclick = () => handleWordBankClick(button);
                wordBankEl.appendChild(button);
            });
            
            userConversationWords = new Array(conversationBlanksData.length).fill(null);

            // Add click handlers for the blank boxes
            document.querySelectorAll('.conversation-fill-box').forEach(blank => {
                blank.onclick = () => handleBlankClick(blank);
            });
        }
        
        /**
         * Handles clicks on the word bank buttons.
         */
        function handleWordBankClick(button) {
            if (conversationDone) return;
            
            // Deselect previous word
            document.querySelectorAll('.fill-in-box').forEach(btn => btn.classList.remove('selected-word'));
            
            // Select new word
            button.classList.add('selected-word');
            selectedWordBankWord = button.dataset.word;
        }

        /**
         * Handles clicks on the blank boxes.
         */
        function handleBlankClick(blank) {
            if (conversationDone) return;
            
            const blankIndex = parseInt(blank.dataset.wordIndex);
            
            // Scenario 1: Blank already has a word and is clicked to clear it
            if (blank.textContent) {
                const oldWord = blank.textContent;
                
                // Remove word from blank
                blank.textContent = '';
                userConversationWords[blankIndex] = null;
                
                // Re-enable word bank button
                const oldButton = document.querySelector(`.fill-in-box[data-word="${oldWord}"]`);
                if (oldButton) {
                    oldButton.disabled = false;
                    oldButton.style.opacity = '1.0';
                }
                
                // Reset styling
                blank.classList.remove('selected-blank', 'correct-answer', 'incorrect-answer');

            }

            // Scenario 2: A word is selected in the word bank and the blank is clicked to fill it
            if (selectedWordBankWord) {
                
                // 1. Fill the blank
                blank.textContent = selectedWordBankWord;
                userConversationWords[blankIndex] = selectedWordBankWord;
                
                // 2. Disable the word bank button and deselect the word
                const selectedWordButton = document.querySelector(`.fill-in-box[data-word="${selectedWordBankWord}"]`);
                if (selectedWordButton) {
                    selectedWordButton.disabled = true;
                    selectedWordButton.style.opacity = '0.5';
                    selectedWordButton.classList.remove('selected-word');
                }
                
                // 3. Clear selected word state
                selectedWordBankWord = null;
                
                // 4. Update blank state visually
                blank.classList.remove('selected-blank', 'incorrect-answer'); // remove selected and incorrect if present
            }
            
            // Scenario 3: Neither a word nor a blank is selected (or word is deselected)
            else {
                 // Deselect all blanks
                document.querySelectorAll('.conversation-fill-box').forEach(b => b.classList.remove('selected-blank'));
            }
        }

        /**
         * Checks the user's answers for the conversation activity.
         */
        function checkConversationBlanks() {
            if (conversationDone) return;
            const feedbackEl = document.getElementById('conversation-feedback');
            const blanks = document.querySelectorAll('#conversation-text span.conversation-fill-box');
            let allCorrect = true;
            
            // The correct order for the blanks based on the conversation context
            const correctOrder = ['stand-up', 'sprint', 'roadblock', 'headache'];

            blanks.forEach((blank, index) => {
                blank.classList.remove('correct-answer', 'incorrect-answer', 'selected-blank');
                
                const isCorrect = userConversationWords[index] === correctOrder[index];
                if (isCorrect) {
                    blank.classList.add('correct-answer');
                } else {
                    blank.classList.add('incorrect-answer');
                    allCorrect = false;
                }
            });

            if (allCorrect) {
                feedbackEl.textContent = "Excellent! You've used all the agile phrases correctly.";
                feedbackEl.className = 'mt-4 text-sm font-medium text-green-600';
                updateScore(30, 'Conversation correct!', 'correct');
                conversationDone = true;
                updateProgress();
            } else {
                feedbackEl.textContent = "Some answers are incorrect. Please try again!";
                feedbackEl.className = 'mt-4 text-sm font-medium text-red-600';
                updateScore(-15, 'Conversation incorrect.', 'incorrect');
                
                // Clear incorrect answers after a delay and re-enable their buttons
                setTimeout(() => {
                    blanks.forEach((blank, index) => {
                        if (userConversationWords[index] !== correctOrder[index]) {
                            const word = blank.textContent;
                            
                            // Re-enable word bank button
                            const correspondingButton = document.querySelector(`.fill-in-box[data-word="${word}"]`);
                            if (correspondingButton) {
                                correspondingButton.disabled = false;
                                correspondingButton.style.opacity = '1.0';
                            }
                            
                            // Clear blank
                            blank.textContent = '';
                            blank.classList.remove('incorrect-answer');
                            userConversationWords[index] = null;
                        }
                    });
                }, 1500);
            }
        }
        
        // Initialize all activities on window load
        window.onload = function() {
            setupTerms();
            setupConversationBlanks();
        };

    </script>
</body>
</html>
