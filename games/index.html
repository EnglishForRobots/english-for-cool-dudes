<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <link rel="manifest" href="/manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Break Room - English For Cool Dudes</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', Arial, sans-serif; background: #F8F9FB; color: #2C3E50; line-height: 1.6; }
        .header { background: #FFFFFF; border-bottom: 1px solid #E5E9F2; padding: 20px 0; margin-bottom: 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.04); }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; gap: 15px; }
        .logo { width: 36px; height: 36px; background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .site-title { font-size: 20px; font-weight: 600; color: #1A202C; text-decoration: none; }
        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; min-height: 80vh; }
        .section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #E5E9F2; }
        .section-title { font-size: 22px; font-weight: 600; color: #1A202C; }
        .course-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .course-card { background: #FFFFFF; border: 1px solid #E5E9F2; border-radius: 12px; text-decoration: none; color: inherit; display: block; transition: all 0.2s; overflow: hidden; }
        .course-card:hover { border-color: #667EEA; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.12); }
        .course-header { padding: 28px; background: linear-gradient(135deg, #F8F9FB 0%, #FFFFFF 100%); border-bottom: 1px solid #E5E9F2; }
        .course-icon { font-size: 48px; margin-bottom: 12px; display: block; }
        .course-title { font-size: 20px; font-weight: 600; margin-bottom: 8px; }
        .course-level { display: inline-block; background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); color: white; padding: 5px 14px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .course-body { padding: 28px; }
        .course-description { font-size: 15px; color: #4A5568; margin-bottom: 18px; }
        .footer { background: #FFFFFF; border-top: 1px solid #E5E9F2; padding: 32px 20px; margin-top: 60px; text-align: center; }
        .footer-text { font-size: 14px; color: #718096; }
        
        /* Auth & Header Layout */
        .header-left { display: flex; align-items: center; gap: 15px; }
        .header-buttons { display: flex; align-items: center; gap: 8px; }
        .header-button { padding: 7px 14px; border-radius: 6px; font-size: 14px; font-weight: 600; border: 1px solid #E5E9F2; text-decoration: none; white-space: nowrap; cursor: pointer; }
        .header-button.login { background: #F8F9FB; color: #4A5568; }
        .header-button.login:hover { background: #FFFFFF; color: #2C3E50; border-color: #718096; }
        .header-button.signup { background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); color: white; border: 1px solid transparent; }
        .header-button.signup:hover { background: linear-gradient(135deg, #5A6AD0 0%, #6D4396 100%); box-shadow: 0 2px 5px rgba(102, 126, 234, 0.4); }
        .header-button.dashboard { background: #FFFBEA; color: #92400E; border-color: #FCD34D; }
        .header-button.dashboard:hover { background: #FCD34D; border-color: #F59E0B; }
        .header-button.logout { background: #F8F9FB; color: #E53E3E; }
        .header-button.logout:hover { background: #FEEBEB; color: #C53030; border-color: #FBD3DA; }
        .user-greeting { font-size: 14px; color: #4A5568; font-weight: 600; margin-right: 5px; white-space: nowrap; }

        /* Ticker Styles */
        #latest-updates-ticker { position: fixed; top: 20px; right: 50%; margin-right: -580px; z-index: 1000; cursor: pointer; background: #FFC107; color: #92400E; padding: 8px 15px; border-radius: 20px; font-size: 14px; font-weight: 600; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); transition: transform 0.2s, background-color 0.2s, opacity 0.2s; border: 2px solid #F59E0B; animation: pulse 2s infinite ease-in-out; text-decoration: none; white-space: nowrap; max-width: 450px; text-overflow: ellipsis; overflow: hidden; display: inline-block; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); } 50% { transform: scale(1.03); box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.6); } 100% { transform: scale(1); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); } }
        #latest-updates-ticker:hover { background: #FFD54F; transform: scale(1.05); animation: none; }

        /* Responsive */
        @media (max-width: 1240px) { #latest-updates-ticker { right: 20px; margin-right: 0; } }
        @media (max-width: 768px) { .user-greeting { display: none; } .course-grid { grid-template-columns: 1fr; } }
        @media (max-width: 480px) { 
            .header-content { gap: 10px; } .logo { font-size: 28px; } .site-title { font-size: 18px; } 
            .container { padding: 20px 15px 80px 15px; } 
            #latest-updates-ticker { top: auto; bottom: 0; right: 0; left: 0; margin-right: 0; border-radius: 0; font-size: 13px; padding: 12px 15px; max-width: 100%; text-align: center; border: none; border-top: 2px solid #F59E0B; box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1); } 
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <span class="logo">üéÆ</span>
                <a href="/" class="site-title">English For Cool Dudes</a>
                
                <div id="logged-out-buttons" class="header-buttons" style="display: none;">
                    <a href="/login/" class="header-button login">Login</a>
                    <a href="/signup/" class="header-button signup">Sign Up</a>
                </div>

                <div id="logged-in-buttons" class="header-buttons" style="display: none;">
                    <span class="user-greeting" id="user-greeting">Hey Cool Dude! üëã</span>
                    <a href="/dashboard/" class="header-button dashboard">My Dashboard</a>
                    <button id="logout-btn" class="header-button logout">Sign Out</button>
                </div>
            </div>
        </div>
    </header>

    <a href="/crocs/" id="latest-updates-ticker">
        üòé NEW! ADVANCED: Crocs' China Strategy üêä
    </a>

    <main class="container">
        <section class="section">
            <div class="section-header">
                <span class="section-icon">‚òï</span>
                <h2 class="section-title">The Break Room</h2>
            </div>
            
            <div class="course-grid">
                <!-- Memory Game -->
                <a href="/matching/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üß†</span>
                        <h3 class="course-title">Vocabulary Matching</h3>
                        <span class="course-level">All Levels (A1-C2)</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">
                            Match the similar words. Choose from topics like Business, Legal, Tax, Travel, and Train With Words From Your Dashboard! 
                        </p>
                    </div>
                </a>

                <!-- Intermediate Game -->
                <a href="/phrasescramble/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üß©</span>
                        <h3 class="course-title">Phrase Scramble</h3>
                        <span class="course-level">All Levels (A1-C2)</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">
                            Put the jumbled words in the correct order to form professional business sentences, and Train With Words From Your Dashboard!
                        </p>
                    </div>
                </a>

                <!-- Advanced Game -->
                <a href="/taboo/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üö´</span>
                        <h3 class="course-title">Don't Say It!</h3>
                        <span class="course-level">All Levels (A1-C2)</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">
                            A "Taboo"-style game for colleagues. Describe the word without using the forbidden words, and Train With Words From Your Dashboard!
                        </p>
                    </div>
                </a>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p class="footer-text">¬© 2025 English For Cool Dudes - üòé</p>
        <div style="margin-top: 10px;">
            <a href="/impressum/" style="color: #667EEA; margin-right: 15px; text-decoration: none;">Impressum</a>
            <a href="/datenschutz/" style="color: #667EEA; text-decoration: none;">Datenschutzerkl√§rung</a>
        </div>
    </footer>
    
    <script>
        const SUPABASE_URL = 'https://knwgmrgwbpchqyqxbxea.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtud2dtcmd3YnBjaHF5cXhieGVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MDkyODgsImV4cCI6MjA3ODA4NTI4OH0.qnp2ScwSE77_idmPhpLE98sr46WvLpKtg6refFfC7s8';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- AUTH HEADER LOGIC ---
        async function initializeAuthHeader() {
            const loggedOutButtons = document.getElementById('logged-out-buttons');
            const loggedInButtons = document.getElementById('logged-in-buttons');
            const logoutBtn = document.getElementById('logout-btn');
            const userGreeting = document.getElementById('user-greeting');

            try {
                const { data: { user } } = await supabase.auth.getUser();

                if (user) {
                    let userName = 'Cool Dude';
                    if (user.user_metadata && user.user_metadata.full_name) {
                        userName = user.user_metadata.full_name.split(' ')[0];
                    } else if (user.email) {
                        userName = user.email.split('@')[0];
                    }
                    
                    if (userGreeting) userGreeting.textContent = `Hey ${userName}! üëã`;
                    if (loggedInButtons) loggedInButtons.style.display = 'flex';
                    if (loggedOutButtons) loggedOutButtons.style.display = 'none';
                } else {
                    if (loggedOutButtons) loggedOutButtons.style.display = 'flex';
                    if (loggedInButtons) loggedInButtons.style.display = 'none';
                }
            } catch (err) {
                console.error('Error checking auth:', err);
                if (loggedOutButtons) loggedOutButtons.style.display = 'flex';
                if (loggedInButtons) loggedInButtons.style.display = 'none';
            }

            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    try {
                        const { error } = await supabase.auth.signOut();
                        if (error) {
                            console.error('Logout error:', error);
                            alert('Logout failed. Please try again.');
                        } else {
                            window.location.reload();
                        }
                    } catch (err) {
                        console.error('Unexpected logout error:', err);
                    }
                });
            }
        }

        // --- TICKER ANIMATION ---
        function startTickerAnimation() {
            const ticker = document.getElementById('latest-updates-ticker');
            if (!ticker) return;

            const LESSON_STATES = [
                { text: 'üåê NEW! TAX: The Netflix Tax üé¨üçø', href: '/VATdigital/' },
                { text: "üö© NEW! LEGAL: Due Diligence in M&A üíº", href: "/duediligence/" },
                { text: "üî• NEW! BEGINNER: Bonfire Night and Guy Fawkes üéÜ", href: "/bonfire/" },
                { text: "üèß NEW! INTERMEDIATE: The Bank of England üí∞", href: "/boe/" },
                { text: "üèß NEW! TAX: Tax Audit Essentials üîç", href: "/audit/" },
                { text: "üöÄ NEW! BUSINESS: Career Progression üéØ", href: "/feedback/" },
                { text: "üëª NEW! BEGINNER: Trick or Treat! üéÉ", href: "/trickortreat/" },
                { text: "üéÉ NEW! INTERMEDIATE: Beware The Black Cat! üëª", href: "/halloween/" },
                { text: "üßü‚Äç‚ôÇÔ∏è NEW! ADVANCED: The Creation's Ruin - Frankenstein ‚ö∞Ô∏è", href: "/frank/" },
                { text: "üòé NEW! ADVANCED: Unusual European Foods üç¥", href: "/weirdeurofoods/" },
                { text: "üòé NEW! BUSINESS: Change Management üß≠", href: "/changemanagement/" },
                { text: "üòé NEW! TAX: International Tax Essentials üåé", href: "/internationaltaxation/" },
                { text: "üòé NEW! BEGINNER: What's The Weather Like? ‚òî", href: "/weather/" },
                { text: "üòé NEW! INTERMEDIATE: Fortune Cookie English ü•†", href: "/fortunecookies/" },
                { text: "üòé NEW! LEGAL: Intellectual Property Law üèõÔ∏è", href: "/iplaw/" },
            ];

            let currentStateIndex = 0;

            function updateTicker() {
                currentStateIndex = (currentStateIndex + 1) % LESSON_STATES.length;
                const newState = LESSON_STATES[currentStateIndex];
                ticker.style.opacity = 0;

                setTimeout(() => {
                    ticker.textContent = newState.text;
                    ticker.href = newState.href;
                    ticker.style.opacity = 1;
                }, 200);
            }

            ticker.textContent = LESSON_STATES[0].text;
            ticker.href = LESSON_STATES[0].href;
            setInterval(updateTicker, 4000);
            
            ticker.addEventListener('mouseenter', () => { ticker.style.animation = 'none'; });
            ticker.addEventListener('mouseleave', () => { ticker.style.animation = 'pulse 2s infinite ease-in-out'; });
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await initializeAuthHeader();
            startTickerAnimation();
        });
    </script>
</body>
</html>
