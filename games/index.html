<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="manifest" href="/manifest.json">
    <title>The Break Room - English For Cool Dudes</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', Arial, sans-serif; background: #F8F9FB; color: #2C3E50; line-height: 1.6; }
        .header { background: #FFFFFF; border-bottom: 1px solid #E5E9F2; padding: 20px 0; margin-bottom: 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.04); }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; gap: 15px; }
        .logo { width: 36px; height: 36px; background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .site-title { font-size: 20px; font-weight: 600; color: #1A202C; text-decoration: none; }
        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; min-height: 80vh; }
        .section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #E5E9F2; }
        .section-title { font-size: 22px; font-weight: 600; color: #1A202C; }
        .course-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .course-card { background: #FFFFFF; border: 1px solid #E5E9F2; border-radius: 12px; text-decoration: none; color: inherit; display: block; transition: all 0.2s; overflow: hidden; }
        .course-card:hover { border-color: #667EEA; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.12); }
        .course-header { padding: 28px; background: linear-gradient(135deg, #F8F9FB 0%, #FFFFFF 100%); border-bottom: 1px solid #E5E9F2; }
        .course-icon { font-size: 48px; margin-bottom: 12px; display: block; }
        .course-title { font-size: 20px; font-weight: 600; margin-bottom: 8px; }
        .course-level { display: inline-block; background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); color: white; padding: 5px 14px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .course-body { padding: 28px; }
        .course-description { font-size: 15px; color: #4A5568; margin-bottom: 18px; }
        .footer { background: #FFFFFF; border-top: 1px solid #E5E9F2; padding: 32px 20px; margin-top: 60px; text-align: center; }
        .footer-text { font-size: 14px; color: #718096; }
        
        /* Auth & Header Layout */
        .header-left { display: flex; align-items: center; gap: 15px; }
        .header-buttons { display: flex; align-items: center; gap: 8px; }
        .header-button { padding: 7px 14px; border-radius: 6px; font-size: 14px; font-weight: 600; border: 1px solid #E5E9F2; text-decoration: none; white-space: nowrap; cursor: pointer; }
        .header-button.login { background: #F8F9FB; color: #4A5568; }
        .header-button.login:hover { background: #FFFFFF; color: #2C3E50; border-color: #718096; }
        .header-button.signup { background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); color: white; border: 1px solid transparent; }
        .header-button.signup:hover { background: linear-gradient(135deg, #5A6AD0 0%, #6D4396 100%); box-shadow: 0 2px 5px rgba(102, 126, 234, 0.4); }
        .header-button.dashboard { background: #FFFBEA; color: #92400E; border-color: #FCD34D; }
        .header-button.dashboard:hover { background: #FCD34D; border-color: #F59E0B; }
        .header-button.logout { background: #F8F9FB; color: #E53E3E; }
        .header-button.logout:hover { background: #FEEBEB; color: #C53030; border-color: #FBD3DA; }
        .user-greeting { font-size: 14px; color: #4A5568; font-weight: 600; margin-right: 5px; white-space: nowrap; }

        /* Ticker Styles */
        #latest-updates-ticker { position: fixed; top: 20px; right: 50%; margin-right: -580px; z-index: 1000; cursor: pointer; background: #FFC107; color: #92400E; padding: 8px 15px; border-radius: 20px; font-size: 14px; font-weight: 600; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); transition: transform 0.2s, background-color 0.2s, opacity 0.2s; border: 2px solid #F59E0B; animation: pulse 2s infinite ease-in-out; text-decoration: none; white-space: nowrap; max-width: 450px; text-overflow: ellipsis; overflow: hidden; display: inline-block; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); } 50% { transform: scale(1.03); box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.6); } 100% { transform: scale(1); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); } }
        #latest-updates-ticker:hover { background: #FFD54F; transform: scale(1.05); animation: none; }

        /* Responsive */
        @media (max-width: 1240px) { #latest-updates-ticker { right: 20px; margin-right: 0; } }
        @media (max-width: 768px) { .user-greeting { display: none; } .course-grid { grid-template-columns: 1fr; } }
        @media (max-width: 480px) { 
            .header-content { gap: 10px; } .logo { font-size: 28px; } .site-title { font-size: 18px; } 
            .container { padding: 20px 15px 80px 15px; } 
            #latest-updates-ticker { top: auto; bottom: 0; right: 0; left: 0; margin-right: 0; border-radius: 0; font-size: 13px; padding: 12px 15px; max-width: 100%; text-align: center; border: none; border-top: 2px solid #F59E0B; box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1); } 
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <span class="logo">üéÆ</span>
                <a href="/" class="site-title">English For Cool Dudes</a>
                
                <div id="logged-out-buttons" class="header-buttons" style="display: none;">
                    <a href="/login/" class="header-button login">Login</a>
                    <a href="/signup/" class="header-button signup">Sign Up</a>
                </div>

                <div id="logged-in-buttons" class="header-buttons" style="display: none;">
                    <span class="user-greeting" id="user-greeting">Hey Cool Dude! üëã</span>
                    <a href="/dashboard/" class="header-button dashboard">My Dashboard</a>
                    <button id="logout-btn" class="header-button logout">Sign Out</button>
                </div>
            </div>
        </div>
    </header>

    <a href="#" id="latest-updates-ticker" style="opacity: 0;"></a>

    <main class="container">
        
        <section class="section">
            <div class="section-header">
                <span class="section-icon">‚òï</span>
                <h2 class="section-title">The Break Room</h2>
            </div>

            <div class="course-grid">

                <a href="/chatattack/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üí¨</span>
                        <h3 class="course-title">Chat... chat... chat... chat...</h3>
                        <span class="course-level">All Levels (A1-C2)</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">
                            Choose a topic, choose a time, and let's chat! 
                        </p>
                    </div>
                </a>
              
                <a href="/vibecheck/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üì±</span>
                        <h3 class="course-title">Keep the conversation flowing</h3>
                        <span class="course-level">All Levels (Chill - Pro)</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">
                            Different levels, different scenarios, different vibes, dude! 
                        </p>
                    </div>
                </a>
            
                <a href="/matching/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üß†</span>
                        <h3 class="course-title">Vocabulary Matching</h3>
                        <span class="course-level">All Levels (A1-C2)</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">
                            Match the similar words, and Train With Words From Your Dashboard! 
                        </p>
                    </div>
                </a>

                <!-- Intermediate Game -->
                <a href="/phrasescramble/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üß©</span>
                        <h3 class="course-title">Phrase Scramble</h3>
                        <span class="course-level">All Levels (A1-C2)</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">
                            Put the jumbled words in the correct order, and Train With Words From Your Dashboard!
                        </p>
                    </div>
                </a>

                <a href="/reversetaboo/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">ü§´</span>
                        <h3 class="course-title">Guess The Word</h3>
                        <span class="course-level">All Levels (A1-C2)</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">
                            Read the definition, guess the word...
                        </p>
                    </div>
                </a>
                
                <a href="/fixit/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üïµÔ∏è‚Äç‚ôÇÔ∏è</span>
                        <h3 class="course-title">Fixit - The Glitch Hunt!</h3>
                        <span class="course-level">All Levels (A1-C2)</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">
                            The sentence is broken, Fixit!
                        </p>
                    </div>
                </a>
                
                <!-- Advanced Game -->
                <a href="/wordtrap/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üö´</span>
                        <h3 class="course-title">Word Trap!</h3>
                        <span class="course-level">All Levels (A1-C2)</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">
                            Describe the word without using the forbidden words, and Train With Words From Your Dashboard!
                        </p>
                    </div>
                </a>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p class="footer-text">¬© 2026 English For Cool Dudes - üòé</p>
        <div style="margin-top: 10px;">
            <a href="/impressum/" style="color: #667EEA; margin-right: 15px; text-decoration: none;">Impressum</a>
            <a href="/datenschutz/" style="color: #667EEA; text-decoration: none;">Datenschutzerkl√§rung</a>
        </div>
    </footer>

    <script src="/tickerData.js"></script>

<script>
// ============================================
// UNIVERSAL AUTH & INITIALIZATION SCRIPT
// Place at the bottom of EVERY page
// ============================================

(function() {
    'use strict';
    
    // --- SAFE SUPABASE INITIALIZATION ---
    // This prevents the "already declared" error
    if (typeof window.efcdSupabaseClient === 'undefined') {
        try {
            const SUPABASE_URL = 'https://knwgmrgwbpchqyqxbxea.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtud2dtcmd3YnBjaHF5cXhieGVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MDkyODgsImV4cCI6MjA3ODA4NTI4OH0.qnp2ScwSE77_idmPhpLE98sr46WvLpKtg6refFfC7s8';
            
            if (typeof window.supabase !== 'undefined' && window.supabase.createClient) {
                window.efcdSupabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('‚úÖ Supabase client initialized');
            } else {
                console.error('‚ùå Supabase library not loaded');
            }
        } catch (err) {
            console.error('‚ùå Supabase initialization error:', err);
        }
    } else {
        console.log('‚ÑπÔ∏è Supabase client already exists');
    }
    
    // --- AUTH HEADER LOGIC ---
    async function initializeAuthHeader() {
        const loggedOutButtons = document.getElementById('logged-out-buttons');
        const loggedInButtons = document.getElementById('logged-in-buttons');
        const userGreeting = document.getElementById('user-greeting');
        const logoutBtn = document.getElementById('logout-btn');

        try {
            if (!window.efcdSupabaseClient) {
                console.warn('‚ö†Ô∏è Supabase client not available');
                if (loggedOutButtons) loggedOutButtons.style.display = 'flex';
                return;
            }
            
            const { data: { user }, error } = await window.efcdSupabaseClient.auth.getUser();

            if (error) {
                console.error('Auth error:', error);
                if (loggedOutButtons) loggedOutButtons.style.display = 'flex';
                return;
            }

            if (user) {
                let userName = 'Cool Dude';
                if (user.user_metadata && user.user_metadata.full_name) {
                    userName = user.user_metadata.full_name.split(' ')[0];
                } else if (user.email) {
                    userName = user.email.split('@')[0];
                }
                
                if (userGreeting) userGreeting.textContent = `Hey ${userName}! üëã`;
                if (loggedInButtons) loggedInButtons.style.display = 'flex';
                if (loggedOutButtons) loggedOutButtons.style.display = 'none';
            } else {
                if (loggedOutButtons) loggedOutButtons.style.display = 'flex';
                if (loggedInButtons) loggedInButtons.style.display = 'none';
            }
        } catch (err) {
            console.error('‚ùå Auth check error:', err);
            if (loggedOutButtons) loggedOutButtons.style.display = 'flex';
        }

        // Logout handler
        if (logoutBtn) {
            logoutBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                try {
                    const { error } = await window.efcdSupabaseClient.auth.signOut();
                    if (error) {
                        console.error('Logout error:', error);
                    } else {
                        console.log('‚úÖ Logged out successfully');
                        window.location.reload();
                    }
                } catch (err) {
                    console.error('‚ùå Logout error:', err);
                }
            });
        }
    }
    
    // --- SERVICE WORKER REGISTRATION ---
    async function registerServiceWorker() {
        if (!('serviceWorker' in navigator)) {
            console.log('‚ÑπÔ∏è Service Worker not supported');
            return;
        }

        try {
            // Force check for new service worker
            const swUrl = '/sw.js?v=' + Date.now();
            const registration = await navigator.serviceWorker.register(swUrl);
            
            console.log('‚úÖ Service Worker registered');
            
            // Check for updates every 30 seconds
            setInterval(() => {
                registration.update();
            }, 30000);
            
            // Check when page becomes visible
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    registration.update();
                }
            });
            
            // Handle updates
            registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                console.log('üÜï New Service Worker found');
                
                newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        console.log('‚ö° New version available, activating...');
                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                    }
                });
            });
        } catch (error) {
            console.error('‚ùå Service Worker registration failed:', error);
        }
        
        // Auto-reload on controller change
        let refreshing = false;
        navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (refreshing) return;
            refreshing = true;
            console.log('üîÑ New Service Worker activated, reloading...');
            window.location.reload();
        });
    }
    
    // --- TICKER INITIALIZATION ---
    function initializeTicker() {
        if (typeof startTickerAnimation === 'function') {
            console.log('‚úÖ Starting ticker animation');
            startTickerAnimation();
        } else {
            console.warn('‚ö†Ô∏è Ticker function not found');
        }
    }
    
    // --- RUN ON PAGE LOAD ---
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeAuthHeader();
            await registerServiceWorker();
            initializeTicker();
        });
    } else {
        // DOM already loaded
        (async () => {
            await initializeAuthHeader();
            await registerServiceWorker();
            initializeTicker();
        })();
    }
})();
</script>

</body>
</html>
