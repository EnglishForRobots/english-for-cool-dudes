
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Istanbul's Grand Bazaar - English For Cool Dudes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* --- BRANDING & LAYOUT STYLES (From Nordic Tax Lesson) --- */
        :root {
            /* Professional Blue/Green palette for Economics/Tax */
            --color-primary: #1A5E7F; /* Deep Blue */
            --color-secondary: #28A745; /* Success Green/Teal */
            --color-accent: #FFC107; /* Amber/Highlight (for selection) */
            --color-background: #F8F9FB; /* Light Gray-Blue */
            --color-text: #2C3E50; /* Dark Blue-Gray */
        }
        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
        }
        .header {
            background: #FFFFFF;
            border-bottom: 1px solid #E5E9F2;
            padding: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            color: #2C3E50;
        }
        .logo {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); 
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .site-title {
            font-size: 20px;
            font-weight: 800;
            color: #1A202C;
            letter-spacing: -0.02em;
        }
        .container-main {
            max-width: 900px;
            margin: 30px auto;
            padding: 30px 20px;
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #E5E9F2;
        }
        .lesson-section {
            background-color: #F8F9FB;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid #E5E9F2;
            margin-bottom: 2rem;
        }
        .section-title {
            color: var(--color-primary);
            font-size: 1.8em;
            font-weight: 800;
            margin-bottom: 20px;
            padding-bottom: 5px;
            border-bottom: 2px dashed #E5E9F2;
        }
        .exercise-number {
            background: var(--color-accent);
            color: var(--color-text);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        .exercise h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
        }
        /* --- MATCHING STYLES (FIXED: Same Color for Pair, Red Flash on Incorrect) --- */
        .matching-item, .matching-target {
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            cursor: pointer;
            border-radius: 0.375rem;
            transition: all 0.2s;
            border: 2px solid #E0E0E0;
            font-weight: 600;
        }
        .matching-item { background-color: #f0f8ff; border-left: 5px solid var(--color-primary); }
        .matching-target { background-color: #f7fff5; border-right: 5px solid var(--color-secondary); text-align: left; }
        
        /* State for selected items (Amber) */
        .selected-item, .selected-target { 
            box-shadow: 0 0 0 3px var(--color-accent); 
            transform: translateY(-2px); 
            border-color: var(--color-accent) !important; 
        }

        /* GUARANTEED RED FLASH FOR INCORRECT GUESSES */
        .incorrect-flash {
            background-color: #ffe6e6 !important; 
            border: 2px solid #E74C3C !important; 
            box-shadow: 0 0 0 3px #E74C3C !important; 
            color: #c0392b !important; 
        }
        
        /* --- 10 UNIQUE COLOR SETS FOR PAIRS --- */
        /* Color Set 0: Purple/Lavender */
        .matched-color-0.matching-item, .matched-color-0.matching-target { 
            background-color: #e9d5ff !important; color: #5B21B6 !important; border-color: #a855f7 !important;
        }
        .matched-color-0.matching-item { border-left: 5px solid #a855f7 !important; border-right: 2px solid #a855f7 !important; }
        .matched-color-0.matching-target { border-right: 5px solid #a855f7 !important; border-left: 2px solid #a855f7 !important; }

        /* Color Set 1: Teal/Mint */
        .matched-color-1.matching-item, .matched-color-1.matching-target { 
            background-color: #ccfbf1 !important; color: #0f766e !important; border-color: #14b8a6 !important;
        }
        .matched-color-1.matching-item { border-left: 5px solid #14b8a6 !important; border-right: 2px solid #14b8a6 !important; }
        .matched-color-1.matching-target { border-right: 5px solid #14b8a6 !important; border-left: 2px solid #14b8a6 !important; }

        /* Color Set 2: Blue/Indigo */
        .matched-color-2.matching-item, .matched-color-2.matching-target { 
            background-color: #e0e7ff !important; color: #3730a3 !important; border-color: #4f46e5 !important;
        }
        .matched-color-2.matching-item { border-left: 5px solid #4f46e5 !important; border-right: 2px solid #4f46e5 !important; }
        .matched-color-2.matching-target { border-right: 5px solid #4f46e5 !important; border-left: 2px solid #4f46e5 !important; }

        /* Color Set 3: Rose/Pink */
        .matched-color-3.matching-item, .matched-color-3.matching-target { 
            background-color: #fce7f3 !important; color: #9d174d !important; border-color: #ec4899 !important;
        }
        .matched-color-3.matching-item { border-left: 5px solid #ec4899 !important; border-right: 2px solid #ec4899 !important; }
        .matched-color-3.matching-target { border-right: 5px solid #ec4899 !important; border-left: 2px solid #ec4899 !important; }

        /* Color Set 4: Green/Lime */
        .matched-color-4.matching-item, .matched-color-4.matching-target { 
            background-color: #ecfdf5 !important; color: #065f46 !important; border-color: #10b981 !important;
        }
        .matched-color-4.matching-item { border-left: 5px solid #10b981 !important; border-right: 2px solid #10b981 !important; }
        .matched-color-4.matching-target { border-right: 5px solid #10b981 !important; border-left: 2px solid #10b981 !important; }

        /* Color Set 5: Yellow/Sun */
        .matched-color-5.matching-item, .matched-color-5.matching-target { 
            background-color: #fffbeb !important; color: #92400e !important; border-color: #f59e0b !important;
        }
        .matched-color-5.matching-item { border-left: 5px solid #f59e0b !important; border-right: 2px solid #f59e0b !important; }
        .matched-color-5.matching-target { border-right: 5px solid #f59e0b !important; border-left: 2px solid #f59e0b !important; }

        /* Color Set 6: Cyan/Light Blue */
        .matched-color-6.matching-item, .matched-color-6.matching-target { 
            background-color: #e0f2fe !important; color: #075985 !important; border-color: #38bdf8 !important;
        }
        .matched-color-6.matching-item { border-left: 5px solid #38bdf8 !important; border-right: 2px solid #38bdf8 !important; }
        .matched-color-6.matching-target { border-right: 5px solid #38bdf8 !important; border-left: 2px solid #38bdf8 !important; }

        /* Color Set 7: Red/Brick */
        .matched-color-7.matching-item, .matched-color-7.matching-target { 
            background-color: #fee2e2 !important; color: #991b1b !important; border-color: #f87171 !important;
        }
        .matched-color-7.matching-item { border-left: 5px solid #f87171 !important; border-right: 2px solid #f87171 !important; }
        .matched-color-7.matching-target { border-right: 5px solid #f87171 !important; border-left: 2px solid #f87171 !important; }

        /* Color Set 8: Gray/Slate */
        .matched-color-8.matching-item, .matched-color-8.matching-target { 
            background-color: #f3f4f6 !important; color: #374151 !important; border-color: #6b7280 !important;
        }
        .matched-color-8.matching-item { border-left: 5px solid #6b7280 !important; border-right: 2px solid #6b7280 !important; }
        .matched-color-8.matching-target { border-right: 5px solid #6b7280 !important; border-left: 2px solid #6b7280 !important; }

        /* Color Set 9: Orange/Coral */
        .matched-color-9.matching-item, .matched-color-9.matching-target { 
            background-color: #fff7ed !important; color: #9a3412 !important; border-color: #f97316 !important;
        }
        .matched-color-9.matching-item { border-left: 5px solid #f97316 !important; border-right: 2px solid #f97316 !important; }
        .matched-color-9.matching-target { border-right: 5px solid #f97316 !important; border-left: 2px solid #f97316 !important; }

        .matched { pointer-events: none; opacity: 0.9; }

        /* --- MULTIPLE CHOICE / TRUE FALSE STYLES --- */
        .mc-option {
            padding: 12px;
            margin: 10px 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .mc-option:hover:not(.correct):not(.incorrect) {
            border-color: var(--color-accent);
        }
        .mc-option.selected {
            background: #FFEDD5; /* Light Amber */
            border-color: var(--color-accent);
        }
        .mc-option.correct {
            background: #D1FAE5; /* Light Green */
            color: #065F46;
            border-color: var(--color-secondary);
            font-weight: 700;
        }
        .mc-option.incorrect {
            background: #FEE2E2; /* Light Red */
            color: #991B1B;
            border-color: #F87171;
            font-weight: 700;
        }

        .tf-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin: 10px 0;
            justify-content: space-between;
            border: 1px solid #E5E9F2;
        }
        
        .tf-buttons {
            display: flex;
            gap: 10px;
        }
        
        .tf-button {
            padding: 8px 16px;
            border: 2px solid #ccc;
            background: #f0f0f0;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .tf-button.selected-true {
            background: var(--color-secondary);
            color: white;
            border-color: var(--color-secondary);
        }

        .tf-button.selected-false {
            background: #E74C3C;
            color: white;
            border-color: #E74C3C;
        }

        /* --- GAP FILL STYLES (Click-to-Fill) --- */
        .gap-fill-word {
            background: var(--color-primary);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            display: inline-block;
            margin: 5px;
            font-weight: bold;
            border: 2px solid transparent;
            min-width: 80px;
            text-align: center;
        }

        .gap-fill-word.selected {
            background: var(--color-accent) !important;
            color: var(--color-text) !important;
            border-color: var(--color-primary) !important;
            box-shadow: 0 0 0 3px var(--color-primary);
        }
        .gap-fill-word.used {
            opacity: 0.5;
            pointer-events: none;
            text-decoration: none;
        }
        .gap-fill-area input {
            border: none;
            border-bottom: 2px solid var(--color-accent);
            padding: 8px;
            margin: 0 5px;
            width: 160px;
            text-align: center;
            font-size: 16px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        .gap-fill-area p {
            margin-bottom: 15px;
        }

        .check-button {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 20px 10px 10px 0;
            transition: all 0.3s ease;
        }
        .reset-button {
            background: #6c757d;
        }
        .show-answers-button {
            background: #17a2b8;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            display: none;
        }
        
        .correct {
            background: #d4edda;
            color: #155724;
        }
        
        .incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        /* --- OTHER SECTIONS --- */
        .reading-text {
            background: white;
            padding: 20px;
            border-left: 5px solid var(--color-secondary);
            border-radius: 8px;
        }
        .reading-text p {
            margin-bottom: 1em;
            text-align: justify;
        }
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 8px;
        }
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .video-link {
            display: inline-block;
            background: var(--color-primary);
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px 0;
        }
        .notes-area {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #E5E9F2;
        }
        .notes-area textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            resize: vertical;
        }
        .discussion-box {
            background: #fffbeb;
            color: var(--color-text);
            border: 1px solid #FDE68A;
        }
        .discussion-box h3 {
            color: #92400E;
        }
        .discussion-questions {
            list-style: none;
            padding: 0;
        }
        .discussion-questions li {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
        }
        .discussion-questions li::before {
            content: "💭";
            position: absolute;
            left: 0;
        }
        .grammar-explanation {
            background: #e6f7ff;
            padding: 15px;
            border-left: 5px solid var(--color-primary);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .grammar-explanation em {
            font-style: italic;
            color: #1A5276;
        }
    </style>
</head>
<body>

<header class="header"> 
    <a href="/advanced/" class="header-content"> 
        <div class="logo">😎</div> 
        <span class="site-title">English For Cool Dudes</span> 
    </a> 
</header>

<div class="container-main">
    
    <header class="text-center mb-10">
        <h1 class="text-4xl font-extrabold text-gray-800">🕌 Istanbul's Grand Bazaar</h1>
        <p class="text-xl text-gray-600 mt-2">Upper-Intermediate/Advanced Level</p>
    </header>

    <div class="exercise lesson-section">
        <h3><span class="exercise-number">1</span>Vocabulary Match 🎯</h3>
        <p class="mb-4 text-gray-600">Match the words with their definitions. Click on a word, then click on its matching definition. Correct pairs will share the same color.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div id="vocab-words-container" class="flex flex-col">
                <h4 class="font-bold mb-2">📝 Words</h4>
                </div>
            <div id="vocab-definitions-container" class="flex flex-col">
                <h4 class="font-bold mb-2">📖 Definitions</h4>
                </div>
        </div>
        <button class="check-button reset-button" onclick="resetVocab()">Reset</button>
        <button class="check-button show-answers-button" onclick="showVocabAnswers()">Show Answers</button>
        <div id="vocab-match-feedback" class="result"></div>
    </div>

    <div class="reading-section lesson-section">
        <h3><span class="exercise-number">2</span>Reading Text 📖</h3>
        <div class="reading-text">
            <h4 class="text-xl font-bold mb-3 text-gray-800">The Heart of Istanbul: A Journey Through Time</h4>
            <p>Istanbul's Grand Bazaar, known locally as Kapalı Çarşısı, stands as one of the world's most remarkable commercial centers. This architectural marvel spans over 30,000 square meters and houses approximately 3,600 shops across 60 lanes, making it not just a market, but truly a city within a city.</p>
            <p>The bazaar's roots trace back to the 15th century when Sultan Mehmet II established it following his conquest of Constantinople in 1453. Originally designed for trading textiles and precious jewelry, the market gradually evolved into a global commercial hub that connected European and Asian trade routes. The Ottoman influence is still palpable today, creating a unique atmosphere where East meets West.</p>
            <p>What makes the Grand Bazaar particularly special is its human element. Approximately 25,000 people work within its walls, many of whom have inherited their trades from previous generations. Family businesses passed down through decades create an authentic shopping experience that cannot be replicated in modern malls. The art of carpet weaving, for instance, carries deep cultural significance, with each pattern and color combination telling stories of different Turkish regions.</p>
            <p>The sensory experience is overwhelming yet captivating. The constant buzz of conversation in multiple languages, the aroma of spices and Turkish tea, and the glittering displays of gold, silver, and precious stones create an atmosphere that engages all five senses. With an estimated 400,000 daily visitors, the bazaar remains one of Istanbul's most visited attractions, testament to its enduring appeal in our digital age.</p>
        </div>
    </div>
    
    <div class="exercise lesson-section">
        <h3><span class="exercise-number">3</span>Reading Comprehension 📝</h3>
        <p>Choose the best answer (A, B, C, or D):</p>
        <div class="mc-question p-4 bg-white rounded-lg shadow-sm mb-4">
            <p class="font-bold mb-2">1. The Grand Bazaar is described as "a city within a city" because:</p>
            <div class="mc-option" data-question="1" data-correct="false">A) It has its own government</div>
            <div class="mc-option" data-question="1" data-correct="true">B) It covers a large area with many shops and workers</div>
            <div class="mc-option" data-question="1" data-correct="false">C) It's completely separated from Istanbul</div>
            <div class="mc-option" data-question="1" data-correct="false">D) It has residential areas inside</div>
        </div>
        <div class="mc-question p-4 bg-white rounded-lg shadow-sm mb-4">
            <p class="font-bold mb-2">2. The bazaar was originally established:</p>
            <div class="mc-option" data-question="2" data-correct="false">A) In the 14th century for spice trading</div>
            <div class="mc-option" data-question="2" data-correct="false">B) After World War I for tourism</div>
            <div class="mc-option" data-question="2" data-correct="true">C) In the 15th century for textiles and jewelry</div>
            <div class="mc-option" data-question="2" data-correct="false">D) During the Roman Empire</div>
        </div>
        <div class="mc-question p-4 bg-white rounded-lg shadow-sm mb-4">
            <p class="font-bold mb-2">3. The human element that makes the bazaar special refers to:</p>
            <div class="mc-option" data-question="3" data-correct="false">A) The large number of tourists</div>
            <div class="mc-option" data-question="3" data-correct="false">B) The modern shopping facilities</div>
            <div class="mc-option" data-question="3" data-correct="true">C) The family businesses passed down through generations</div>
            <div class="mc-option" data-question="3" data-correct="false">D) The international atmosphere</div>
        </div>
        <div class="mc-question p-4 bg-white rounded-lg shadow-sm mb-4">
            <p class="font-bold mb-2">4. According to the text, what makes the shopping experience "authentic"?</p>
            <div class="mc-option" data-question="4" data-correct="false">A) The modern payment systems</div>
            <div class="mc-option" data-question="4" data-correct="false">B) The air conditioning</div>
            <div class="mc-option" data-question="4" data-correct="true">C) The inherited family trades and traditions</div>
            <div class="mc-option" data-question="4" data-correct="false">D) The tourist information centers</div>
        </div>
        <div class="mc-question p-4 bg-white rounded-lg shadow-sm mb-4">
            <p class="font-bold mb-2">5. The bazaar's daily visitor estimate suggests:</p>
            <div class="mc-option" data-question="5" data-correct="false">A) It's losing popularity</div>
            <div class="mc-option" data-question="5" data-correct="true">B) It remains highly attractive to people</div>
            <div class="mc-option" data-question="5" data-correct="false">C) Only locals shop there</div>
            <div class="mc-option" data-question="5" data-correct="false">D) It's too crowded to enjoy</div>
        </div>
        <button class="check-button" onclick="checkMultipleChoice()">Check Answers</button>
        <div id="mc-result" class="result"></div>
    </div>

    <div class="video-section lesson-section">
        <h3><span class="exercise-number">4</span>Video Viewing 🎬</h3>
        <h2 class="text-xl font-bold mb-4 text-center text-gray-800">Istanbul's Grand Bazaar - What You Need to Know</h2>
        <div class="video-wrapper">
            <iframe src="https://www.youtube.com/embed/QcMdaKKWGwA" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <p>Watch the video and take notes on the points below.</p>
        <a href="https://www.youtube.com/watch?v=QcMdaKKWGwA" class="video-link" target="_blank">🎬 Open on YouTube (if embed doesn't work)</a>
        <div class="notes-area">
            <h4 class="font-bold mb-2">Take notes while watching about:</h4>
            <ul class="list-disc list-inside space-y-1 text-gray-700">
                <li>What people buy at the bazaar</li>
                <li>The haggling/bargaining process</li>
                <li>Interesting facts about the market</li>
                <li>The tea culture connection</li>
            </ul>
            <textarea placeholder="Write your notes here..."></textarea>
        </div>
    </div>

    <div class="exercise lesson-section">
        <h3><span class="exercise-number">5</span>True/False Statements ✅❌</h3>
        <p>Based on the video, mark these statements as True (T) or False (F):</p>
        <div class="tf-item" data-answer="true">
            <span>The Grand Bazaar has exactly 21 gates leading into it.</span>
            <div class="tf-buttons">
                <button class="tf-button tf-true">True</button>
                <button class="tf-button tf-false">False</button>
            </div>
        </div>
        <div class="tf-item" data-answer="true">
            <span>Each carpet pattern has its own meaning and significance.</span>
            <div class="tf-buttons">
                <button class="tf-button tf-true">True</button>
                <button class="tf-button tf-false">False</button>
            </div>
        </div>
        <div class="tf-item" data-answer="false">
            <span>The bazaar was founded by Sultan Mehmet II in the 16th century.</span>
            <div class="tf-buttons">
                <button class="tf-button tf-true">True</button>
                <button class="tf-button tf-false">False</button>
            </div>
        </div>
        <div class="tf-item" data-answer="false">
            <span>The cameraman bought more items than the reporter in the challenge.</span>
            <div class="tf-buttons">
                <button class="tf-button tf-true">True</button>
                <button class="tf-button tf-false">False</button>
            </div>
        </div>
        <div class="tf-item" data-answer="false">
            <span>On Turkish carpets, running water symbolises life and an eye means wisdom.</span>
            <div class="tf-buttons">
                <button class="tf-button tf-true">True</button>
                <button class="tf-button tf-false">False</button>
            </div>
        </div>
        <button class="check-button" onclick="checkTrueFalse()">Check Answers</button>
        <div id="tf-result" class="result"></div>
    </div>

    <div class="exercise lesson-section">
        <h3><span class="exercise-number">6</span>Gap Fill Exercise 📝</h3>
        <p>Select a word from the bank, then click a gap to fill it. Click a filled gap to put the word back.</p>
        <div id="word-bank" class="word-box-options p-4 bg-gray-100 rounded flex flex-wrap justify-center mb-6">
        </div>
        <div class="gap-fill-area">
            <p>1. The sensory experience of the bazaar can be quite <input type="text" data-word="overwhelming" readonly> for first-time visitors.</p>
            <p>2. It's important to <input type="text" data-word="haggle" readonly> prices in Turkish markets - it's expected!</p>
            <p>3. Many families have been running their businesses for several <input type="text" data-word="decades" readonly>.</p>
            <p>4. The bazaar was established after the <input type="text" data-word="conquest" readonly> of Constantinople.</p>
            <p>5. Roving <input type="text" data-word="merchants" readonly> sell tea throughout the market using a phone system.</p>
            <p>6. Some designer brands sold there are <input type="text" data-word="genuine" readonly>, while others are fake.</p>
            <p>7. Bargaining is a cultural <input type="text" data-word="tradition" readonly> that tourists should embrace.</p>
            <p>8. Always do a price <input type="text" data-word="comparison" readonly> before making your final purchase.</p>
            <p>9. The carpet seller learned to <input type="text" data-word="negotiate" readonly> with customers from his father.</p>
            <p>10. The bazaar represents Turkey's rich cultural <input type="text" data-word="heritage" readonly>.</p>
        </div>
        <button class="check-button" onclick="checkGapFill()">Check Answers</button>
        <button class="check-button reset-button" onclick="resetGapFill()">Reset</button>
        <div id="gap-result" class="result"></div>
    </div>

    <div class="idioms-section lesson-section">
        <h3><span class="exercise-number">7</span>Useful Idioms & Expressions 💬</h3>
        
        <h4 class="text-lg font-bold mb-3 text-gray-700">Match the Idiom to the Definition:</h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <ul id="idiom-list-container" class="flex flex-col">
            </ul>
            <ul id="idiom-definitions-container" class="flex flex-col">
            </ul>
        </div>
        <button class="check-button reset-button" onclick="resetIdiomMatch()">Reset</button>
        <button class="check-button show-answers-button" onclick="showIdiomAnswers()">Show Answers</button>
        <div id="idiom-match-feedback" class="result"></div>
        
        <h4 class="text-lg font-bold mt-8 mb-3 text-gray-700">Fill in the Gaps with the Correct Idiom:</h4>
        <div class="idiom-gap-fill p-4 bg-white rounded-lg shadow-sm">
            <p>1. I found this antique vase at a flea market. It was a real <input type="text" id="idiom-gap-1" class="border-b-2 border-amber-500 p-1 w-40">!</p>
            <p>2. My dad said we can't buy the new car until we <input type="text" id="idiom-gap-2" class="border-b-2 border-amber-500 p-1 w-48"> with the salesman.</p>
            <p>3. This coffee is €10! That's <input type="text" id="idiom-gap-3" class="border-b-2 border-amber-500 p-1 w-40">.</p>
            <p>4. I always <input type="text" id="idiom-gap-4" class="border-b-2 border-amber-500 p-1 w-40"> before buying a new phone to make sure I get the best deal.</p>
            <p>5. The company's huge advertising budget shows that <input type="text" id="idiom-gap-5" class="border-b-2 border-amber-500 p-1 w-40"> when it comes to attracting customers.</p>
        </div>
        <button class="check-button" onclick="checkIdiomGapFill()">Check Answers</button>
        <div id="idiom-gap-result" class="result"></div>
    </div>
    
    <div class="grammar-section lesson-section">
        <h3><span class="exercise-number">8</span>Grammar Focus: Present Perfect Continuous 📚</h3>
        <div class="grammar-explanation">
            <p class="mb-3">We use the <strong>Present Perfect Continuous</strong> to talk about an action that started in the past and is still continuing now, or has just finished and has a visible result. We often use it with <em>'for'</em> and <em>'since'</em> or to explain a current situation.</p>
            <p class="mb-3"><em>Example: "The tourists have been waiting in line for hours."</em></p>
            <p>The form is: <strong>have/has + been + verb-ing</strong></p>
        </div>
        <p class="mb-4">Complete the sentences using the Present Perfect Continuous form of the verbs in brackets:</p>
        <div class="grammar-question space-y-3">
            <p>1. The Grand Bazaar <input type="text" id="g1" class="border-b-2 border-amber-500 p-1"> (attract) visitors for centuries.</p>
            <p>2. The merchants <input type="text" id="g2" class="border-b-2 border-amber-500 p-1"> (sell) their goods all morning.</p>
            <p>3. How long <input type="text" id="g3" class="border-b-2 border-amber-500 p-1 w-20"> you <input type="text" id="g4" class="border-b-2 border-amber-500 p-1 w-40"> (learn) English?</p>
            <p>4. He <input type="text" id="g5" class="border-b-2 border-amber-500 p-1"> (haggle) for twenty minutes, but still hasn't got a good price.</p>
            <p>5. The tourists are tired because they <input type="text" id="g6" class="border-b-2 border-amber-500 p-1"> (walk) around the market all day.</p>
        </div>
        <button class="check-button" onclick="checkGrammar()">Check Answers</button>
        <div id="grammar-result" class="result"></div>
    </div>

    <div class="discussion-box lesson-section">
        <h3><span class="exercise-number">9</span>Discussion Questions 🗣️</h3>
        <ul class="discussion-questions">
            <li>What's the most interesting market or bazaar you've ever visited? Describe the experience.</li>
            <li>Do you enjoy bargaining/haggling? Why or why not?</li>
            <li>How can traditional markets like the Grand Bazaar balance preserving their cultural heritage with meeting modern consumer expectations?</li>
            <li>What might be the positive and negative effects of such heavy tourism on local culture and business?</li>
            <li>Why do you think people are drawn to traditional markets when they could shop more conveniently online or in modern malls?</li>
            <li>What are the advantages and disadvantages of family businesses compared to modern corporations?</li>
            <li>How can tourists distinguish between genuine and fake products? Is it always important to buy authentic items?</li>
        </ul>
    </div>
    
</div>

<script>
    // --- DATA ---
    let vocabData = [
        { word: "haggle", def: "To negotiate the price of something" },
        { word: "bazaar", def: "A large marketplace, especially in Middle Eastern countries" },
        { word: "overwhelming", def: "Very intense or powerful; difficult to deal with" },
        { word: "tourist", def: "A person who travels for pleasure" },
        { word: "souvenirs", def: "Items kept as reminders of a place" },
        { word: "merchant", def: "A person who buys and sells goods" },
        { word: "hub", def: "The center of activity or interest" },
        { word: "genuine", def: "Real, not fake or copied" },
        { word: "conquest", def: "The act of taking control of a place by force" },
        { word: "landmark", def: "A recognizable feature of a landscape or city" }
    ];

    let idiomData = [
        { idiom: "Shop around", def: "Compare prices at different stores" },
        { idiom: "A steal", def: "A very good bargain" },
        { idiom: "Highway robbery", def: "Extremely expensive" },
        { idiom: "To strike a deal", def: "To reach an agreement" },
        { idiom: "Money talks", def: "Money gives you power/influence" }
    ];

    const gapFillWords = ['overwhelming', 'haggle', 'decades', 'conquest', 'merchants', 'genuine', 'tradition', 'comparison', 'negotiate', 'heritage'];
    
    // --- GLOBAL MATCHING STATE ---
    const colorClasses = [
        'matched-color-0', 'matched-color-1', 'matched-color-2', 'matched-color-3', 'matched-color-4', 
        'matched-color-5', 'matched-color-6', 'matched-color-7', 'matched-color-8', 'matched-color-9'
    ];
    
    let selectedVocabWord = null;
    let selectedVocabDefinition = null;
    let vocabMatches = 0;
    const totalVocabPairs = 10;

    let selectedIdiom = null;
    let selectedIdiomDef = null;
    let idiomMatches = 0;
    const totalIdiomPairs = 5;

    let selectedGapWord = null;

    // --- UTILITY FUNCTIONS ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
    function showResult(elementId, isCorrect, message) {
        const resultElement = document.getElementById(elementId);
        resultElement.textContent = message;
        resultElement.classList.remove('correct', 'incorrect');
        resultElement.classList.add(isCorrect ? 'correct' : 'incorrect');
        resultElement.style.display = 'block';
    }
    function hideResult(elementId) {
        const resultElement = document.getElementById(elementId);
        if (resultElement) {
            resultElement.style.display = 'none';
        }
    }

    // =================================================================
    // --- ACTIVITY 1: VOCABULARY MATCHING LOGIC (Fixed) ---
    // =================================================================
    function initVocabulary() {
        const wordsContainer = document.getElementById('vocab-words-container');
        const defsContainer = document.getElementById('vocab-definitions-container');
        wordsContainer.innerHTML = '<h4 class="font-bold mb-2">📝 Words</h4>';
        defsContainer.innerHTML = '<h4 class="font-bold mb-2">📖 Definitions</h4>';

        // Shuffle definitions separately to randomize placement
        const defsArray = [...vocabData];
        shuffleArray(defsArray);

        vocabData.forEach(item => {
            const wordDiv = document.createElement('div');
            wordDiv.className = 'matching-item'; // Use generic matching class
            wordDiv.dataset.term = item.word;
            wordDiv.textContent = item.word;
            wordDiv.addEventListener('click', () => handleVocabSelection(wordDiv, 'word'));
            wordsContainer.appendChild(wordDiv);
        });

        defsArray.forEach(item => {
            const defDiv = document.createElement('div');
            defDiv.className = 'matching-target'; // Use generic matching class
            defDiv.dataset.definition = item.word;
            defDiv.textContent = item.def;
            defDiv.addEventListener('click', () => handleVocabSelection(defDiv, 'def'));
            defsContainer.appendChild(defDiv);
        });
        
        vocabMatches = 0;
        selectedVocabWord = null;
        selectedVocabDefinition = null;
        hideResult('vocab-match-feedback');
    }
    
    function clearVocabSelection(skipWord, skipDef) {
        if (selectedVocabWord && !skipWord) {
            selectedVocabWord.classList.remove('selected-item', 'incorrect-flash');
            selectedVocabWord = null;
        }
        if (selectedVocabDefinition && !skipDef) {
            selectedVocabDefinition.classList.remove('selected-target', 'incorrect-flash');
            selectedVocabDefinition = null;
        }
    }

    function handleVocabSelection(element, type) {
        if (element.classList.contains('matched')) return;

        element.classList.remove('incorrect-flash');

        if (type === 'word') {
            clearVocabSelection(false, true); // Clear previous word, keep definition
            selectedVocabWord = (selectedVocabWord === element) ? null : element;
            if (selectedVocabWord) selectedVocabWord.classList.add('selected-item');
        } else {
            clearVocabSelection(true, false); // Clear previous definition, keep word
            selectedVocabDefinition = (selectedVocabDefinition === element) ? null : element;
            if (selectedVocabDefinition) selectedVocabDefinition.classList.add('selected-target');
        }

        if (selectedVocabWord && selectedVocabDefinition) {
            checkVocabMatch(selectedVocabWord, selectedVocabDefinition);
        }
    }
    
    function checkVocabMatch(word, definition) {
        const termId = word.dataset.term;
        const defId = definition.dataset.definition;
        const feedbackDiv = document.getElementById('vocab-match-feedback');

        if (termId === defId) {
            // SUCCESS: Apply unique color using the cycling logic
            const colorClass = colorClasses[vocabMatches % colorClasses.length];
            
            word.classList.add('matched', colorClass);
            definition.classList.add('matched', colorClass);
            
            word.classList.remove('selected-item');
            definition.classList.remove('selected-target');
            selectedVocabWord = null;
            selectedVocabDefinition = null;
            
            vocabMatches++;
            
            if (vocabMatches === totalVocabPairs) {
                showResult('vocab-match-feedback', true, 'Activity Complete! You matched all the vocabulary! 🏆');
            } else {
                hideResult('vocab-match-feedback');
            }
        } else {
            // INCORRECT: Flash red and deselect both
            word.classList.add('incorrect-flash');
            definition.classList.add('incorrect-flash');
            showResult('vocab-match-feedback', false, 'Oops, try again. Deselected both cards.');
            
            setTimeout(() => {
                word.classList.remove('selected-item', 'incorrect-flash');
                definition.classList.remove('selected-target', 'incorrect-flash');
                
                selectedVocabWord = null;
                selectedVocabDefinition = null;
                hideResult('vocab-match-feedback');
            }, 500); 
        }
    }
    
    function showVocabAnswers() {
        // Clear existing state
        document.querySelectorAll('#vocab-words-container > .matching-item, #vocab-definitions-container > .matching-target').forEach(item => {
            item.classList.remove('selected-item', 'selected-target', 'matched', 'incorrect-flash');
            colorClasses.forEach(c => item.classList.remove(c));
        });
        
        // Apply correct state
        vocabData.forEach((item, index) => {
            const wordElement = document.querySelector(`#vocab-words-container [data-term="${item.word}"]`);
            const defElement = document.querySelector(`#vocab-definitions-container [data-definition="${item.word}"]`);
            
            if (wordElement && defElement) {
                const pairClass = colorClasses[index % colorClasses.length];
                wordElement.classList.add('matched', pairClass);
                defElement.classList.add('matched', pairClass);
            }
        });
        vocabMatches = totalVocabPairs;
        showResult('vocab-match-feedback', true, 'All correct matches are now displayed with matching colors!');
    }
    
    function resetVocab() {
        initVocabulary();
    }


    // =================================================================
    // --- ACTIVITY 7: IDIOM MATCHING LOGIC (Fixed) ---
    // =================================================================

    function initIdiomMatch() {
        const idiomList = document.getElementById('idiom-list-container');
        const idiomDefs = document.getElementById('idiom-definitions-container');

        idiomList.innerHTML = '';
        idiomDefs.innerHTML = '';

        const defsArray = [...idiomData];
        shuffleArray(defsArray);

        idiomData.forEach(item => {
            const li = document.createElement('li');
            li.className = 'matching-item'; // Use generic matching class
            li.textContent = `"${item.idiom}"`;
            li.dataset.term = item.idiom;
            li.addEventListener('click', () => handleIdiomSelection(li, 'idiom'));
            idiomList.appendChild(li);
        });

        defsArray.forEach(item => {
            const li = document.createElement('li');
            li.className = 'matching-target'; // Use generic matching class
            li.textContent = item.def;
            li.dataset.definition = item.idiom;
            li.addEventListener('click', () => handleIdiomSelection(li, 'def'));
            idiomDefs.appendChild(li);
        });
        
        idiomMatches = 0;
        selectedIdiom = null;
        selectedIdiomDef = null;
        hideResult('idiom-match-feedback');
    }

    function clearIdiomSelection(skipIdiom, skipDef) {
        if (selectedIdiom && !skipIdiom) {
            selectedIdiom.classList.remove('selected-item', 'incorrect-flash');
            selectedIdiom = null;
        }
        if (selectedIdiomDef && !skipDef) {
            selectedIdiomDef.classList.remove('selected-target', 'incorrect-flash');
            selectedIdiomDef = null;
        }
    }

    function handleIdiomSelection(element, type) {
        if (element.classList.contains('matched')) return;

        element.classList.remove('incorrect-flash');

        if (type === 'idiom') {
            clearIdiomSelection(false, true); 
            selectedIdiom = (selectedIdiom === element) ? null : element;
            if (selectedIdiom) selectedIdiom.classList.add('selected-item');
        } else {
            clearIdiomSelection(true, false); 
            selectedIdiomDef = (selectedIdiomDef === element) ? null : element;
            if (selectedIdiomDef) selectedIdiomDef.classList.add('selected-target');
        }

        if (selectedIdiom && selectedIdiomDef) {
            checkIdiomMatch(selectedIdiom, selectedIdiomDef);
        }
    }
    
    function checkIdiomMatch(idiom, definition) {
        const termId = idiom.dataset.term;
        const defId = definition.dataset.definition;
        const feedbackDiv = document.getElementById('idiom-match-feedback');

        if (termId === defId) {
            // SUCCESS: Use the first 5 color sets
            const colorClass = colorClasses[idiomMatches % 5];
            
            idiom.classList.add('matched', colorClass);
            definition.classList.add('matched', colorClass);
            
            idiom.classList.remove('selected-item');
            definition.classList.remove('selected-target');
            selectedIdiom = null;
            selectedIdiomDef = null;
            
            idiomMatches++;
            
            if (idiomMatches === totalIdiomPairs) {
                showResult('idiom-match-feedback', true, 'Great job! You matched all the idioms! 🏆');
            } else {
                hideResult('idiom-match-feedback');
            }
        } else {
            // INCORRECT: Flash red and deselect both
            idiom.classList.add('incorrect-flash');
            definition.classList.add('incorrect-flash');
            showResult('idiom-match-feedback', false, 'Oops, try again. Deselected both cards.');

            setTimeout(() => {
                idiom.classList.remove('selected-item', 'incorrect-flash');
                definition.classList.remove('selected-target', 'incorrect-flash');
                
                selectedIdiom = null;
                selectedIdiomDef = null;
                hideResult('idiom-match-feedback');
            }, 500); 
        }
    }
    
    function showIdiomAnswers() {
        document.querySelectorAll('#idiom-list-container > .matching-item, #idiom-definitions-container > .matching-target').forEach(item => {
            item.classList.remove('selected-item', 'selected-target', 'matched', 'incorrect-flash');
            colorClasses.forEach(c => item.classList.remove(c));
        });

        idiomData.forEach((item, index) => {
            const idiomElement = document.querySelector(`#idiom-list-container [data-term="${item.idiom}"]`);
            const defElement = document.querySelector(`#idiom-definitions-container [data-definition="${item.idiom}"]`);
            
            if (idiomElement && defElement) {
                const pairClass = colorClasses[index % 5];
                idiomElement.classList.add('matched', pairClass);
                defElement.classList.add('matched', pairClass);
            }
        });
        idiomMatches = totalIdiomPairs;
        showResult('idiom-match-feedback', true, 'All correct matches are now displayed with matching colors!');
    }
    
    function resetIdiomMatch() {
        initIdiomMatch();
    }


    // =================================================================
    // --- ACTIVITY 3: MULTIPLE CHOICE ---
    // =================================================================
    function initMultipleChoice() {
        document.querySelectorAll('.mc-option').forEach(option => {
            option.addEventListener('click', () => selectMCOption(option));
        });
    }
    
    function selectMCOption(element) {
        const question = element.dataset.question;
        const questionOptions = document.querySelectorAll(`[data-question="${question}"]`);
        
        questionOptions.forEach(option => {
            option.classList.remove('selected');
        });
        element.classList.add('selected');
    }
    
    function checkMultipleChoice() {
        const totalQuestions = 5;
        let correct = 0;
        
        for (let i = 1; i <= totalQuestions; i++) {
            const selected = document.querySelector(`[data-question="${i}"].selected`);
            const allOptions = document.querySelectorAll(`[data-question="${i}"]`);
            
            allOptions.forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
                if (option.dataset.correct === 'true') {
                    option.classList.add('correct');
                }
            });
            
            if (selected) {
                selected.classList.add(selected.dataset.correct === 'true' ? 'correct' : 'incorrect');
                if (selected.dataset.correct === 'true') {
                    correct++;
                }
            }
        }
        
        const percentage = Math.round((correct / totalQuestions) * 100);
        const message = correct === totalQuestions ? 
            'Excellent! All answers are correct!' : 
            `You got ${correct}/${totalQuestions} correct (${percentage}%)`;
        
        showResult('mc-result', correct === totalQuestions, message);
    }

    // =================================================================
    // --- ACTIVITY 5: TRUE/FALSE ---
    // =================================================================
    function initTrueFalse() {
        document.querySelectorAll('.tf-button').forEach(button => {
            button.addEventListener('click', () => selectTFOption(button));
        });
    }
    
    function selectTFOption(button) {
        const item = button.closest('.tf-item');
        const buttons = item.querySelectorAll('.tf-button');
        
        buttons.forEach(btn => btn.classList.remove('selected-true', 'selected-false'));
        
        if (button.classList.contains('tf-true')) {
            button.classList.add('selected-true');
            item.dataset.selected = 'true';
        } else {
            button.classList.add('selected-false');
            item.dataset.selected = 'false';
        }
    }
    
    function checkTrueFalse() {
        const items = document.querySelectorAll('.tf-item');
        let correct = 0;
        
        items.forEach(item => {
            const selected = item.dataset.selected;
            const correctAnswer = item.dataset.answer;
            
            item.querySelectorAll('.tf-button').forEach(btn => {
                btn.classList.remove('selected-true', 'selected-false');
            });
            
            if (selected === correctAnswer) {
                correct++;
                item.querySelector(selected === 'true' ? '.tf-true' : '.tf-false').classList.add('selected-true');
            } else if (selected !== undefined) {
                item.querySelector(selected === 'true' ? '.tf-true' : '.tf-false').classList.add('selected-false');
            }
        });
        
        const percentage = Math.round((correct / items.length) * 100);
        const message = correct === items.length ? 
            'Perfect! All answers are correct!' : 
            `You got ${correct}/${items.length} correct (${percentage}%)`;
        
        showResult('tf-result', correct === items.length, message);
    }

    // =================================================================
    // --- ACTIVITY 6: GAP FILL "Click-to-fill" Logic ---
    // =================================================================

    function initGapFill() {
        const wordBank = document.getElementById('word-bank');
        wordBank.innerHTML = '';
        const shuffledWords = [...gapFillWords];
        shuffleArray(shuffledWords);

        shuffledWords.forEach(word => {
            const wordSpan = document.createElement('span');
            wordSpan.className = 'gap-fill-word';
            wordSpan.textContent = word;
            wordSpan.dataset.word = word;
            wordSpan.addEventListener('click', selectGapWord);
            wordBank.appendChild(wordSpan);
        });

        document.querySelectorAll('.gap-fill-area input').forEach(input => {
            input.value = "";
            input.classList.remove('correct', 'incorrect');
            input.style.borderBottomColor = 'var(--color-accent)';
            input.style.background = '#f8f9fa';
            input.addEventListener('click', fillGap);
        });
        selectedGapWord = null;
        hideResult('gap-result');
    }

    function selectGapWord(e) {
        if (selectedGapWord) {
            selectedGapWord.classList.remove('selected');
        }
        selectedGapWord = e.target;
        selectedGapWord.classList.add('selected');
    }

    function fillGap(e) {
        const input = e.target;
        if (input.value === "" && selectedGapWord) {
            input.value = selectedGapWord.textContent;
            selectedGapWord.classList.add('used');
            selectedGapWord.classList.remove('selected');
            selectedGapWord = null;
        } else if (input.value !== "") {
            const wordToReturn = input.value;
            input.value = "";
            const wordSpan = document.querySelector(`.gap-fill-word[data-word="${wordToReturn}"]`);
            if (wordSpan) {
                wordSpan.classList.remove('used');
            }
            input.style.borderBottomColor = 'var(--color-accent)';
            input.style.background = '#f8f9fa';
        }
    }

    function checkGapFill() {
        const inputs = document.querySelectorAll('.gap-fill-area input');
        let correct = 0;
        inputs.forEach(input => {
            const userAnswer = input.value.toLowerCase().trim();
            const correctAnswer = input.dataset.word.toLowerCase();
            input.classList.remove('correct', 'incorrect');
            if (userAnswer === correctAnswer) {
                input.style.borderBottomColor = 'var(--color-secondary)';
                input.style.background = '#e8f5e8';
                correct++;
            } else {
                input.style.borderBottomColor = '#F44336';
                input.style.background = '#ffebee';
            }
        });

        const percentage = Math.round((correct / inputs.length) * 100);
        const message = correct === inputs.length ? 
            'Perfect! All answers are correct!' : 
            `You got ${correct}/${inputs.length} correct (${percentage}%)`;
        
        showResult('gap-result', correct === inputs.length, message);
    }

    function resetGapFill() {
        initGapFill();
    }


    // =================================================================
    // --- ACTIVITY 7: IDIOM GAP FILL ---
    // =================================================================
    function checkIdiomGapFill() {
        const answers = {
            'idiom-gap-1': 'steal',
            'idiom-gap-2': 'strike a deal',
            'idiom-gap-3': 'highway robbery',
            'idiom-gap-4': 'shop around',
            'idiom-gap-5': 'money talks'
        };
        const inputs = document.querySelectorAll('.idiom-gap-fill input');
        let correct = 0;
        inputs.forEach(input => {
            // Clean the user's answer (remove punctuation and spaces, and convert to lowercase)
            const userAnswer = input.value.toLowerCase().trim().replace(/[.,!]/g, ''); 
            const correctAnswer = answers[input.id].toLowerCase();
            
            if (userAnswer === correctAnswer) {
                input.style.borderBottomColor = 'var(--color-secondary)';
                input.style.background = '#e8f5e8';
                correct++;
            } else {
                input.style.borderBottomColor = '#F44336';
                input.style.background = '#ffebee';
            }
        });
        const percentage = Math.round((correct / inputs.length) * 100);
        const message = correct === inputs.length ? 'Perfect! All answers are correct!' : `You got ${correct}/${inputs.length} correct (${percentage}%)`;
        showResult('idiom-gap-result', correct === inputs.length, message);
    }


    // =================================================================
    // --- ACTIVITY 8: GRAMMAR CHECK ---
    // =================================================================
    function checkGrammar() {
        // Consolidated answers for all inputs
        const answers = [
            {id: 'g1', correct: 'has been attracting'}, 
            {id: 'g2', correct: 'have been selling'}, 
            {id: 'g3', correct: 'have'}, 
            {id: 'g4', correct: 'been learning'}, 
            {id: 'g5', correct: 'has been haggling'}, 
            {id: 'g6', correct: 'have been walking'}
        ];
        let correct = 0;
        
        answers.forEach(item => {
            const input = document.getElementById(item.id);
            if (input) {
                const userAnswer = input.value.toLowerCase().trim();
                const correctAnswer = item.correct.toLowerCase();
                if (userAnswer === correctAnswer) {
                    input.style.borderBottomColor = 'var(--color-secondary)';
                    input.style.background = '#e8f5e8';
                    correct++;
                } else {
                    input.style.borderBottomColor = '#F44336';
                    input.style.background = '#ffebee';
                }
            }
        });

        const totalQuestions = answers.length;
        const percentage = Math.round((correct / totalQuestions) * 100);
        const message = correct === totalQuestions ? 
            'Perfect! All answers are correct!' : 
            `You got ${correct}/${totalQuestions} correct (${percentage}%)`;
        
        showResult('grammar-result', correct === totalQuestions, message);
    }


    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        initVocabulary();
        initMultipleChoice();
        initTrueFalse();
        initGapFill();
        initIdiomMatch();
    });
</script>
</body>
</html>
