<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Taste of Britain: An Advanced English Lesson</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0a0e27;
            --secondary: #16213e;
            --accent: #1e3a8a;
            --bright: #ff006e;
            --success: #00f5ff;
            --warning: #ffbe0b;
            --error: #fb5607;
            --purple: #8338ec;
            --green: #06ffa5;
            --orange: #ff9500;
            --text-primary: #ffffff;
            --text-secondary: #a8b2d1;
            --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --shadow-light: 0 8px 32px rgba(255, 0, 110, 0.2);
            --shadow-dark: 0 8px 32px rgba(0, 0, 0, 0.4);
            --transition: all 0.3s ease;
            --gradient-1: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
            --gradient-2: linear-gradient(135deg, var(--bright) 0%, var(--orange) 100%);

            /* New colors for correct matching pairs */
            --match-color-1: #6a0572;
            --match-color-2: #2a9d8f;
            --match-color-3: #e9c46a;
            --match-color-4: #f4a261;
            --match-color-5: #e76f51;
            --match-color-6: #588b5e;
            --match-color-7: #c9ada7;
            --match-color-8: #90be6d;
        }

        /* Basic Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            overflow-x: hidden;
            background: #101533;
        }

        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background-color: var(--secondary);
        }

        h1, h2, h3 {
            color: var(--text-primary);
            font-weight: 700;
            margin-bottom: 10px;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 20px;
            background-image: linear-gradient(90deg, #ff9500, #ff006e);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        h2 {
            font-size: 1.8em;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 5px;
            margin-top: 30px;
        }

        p {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 10px;
            margin: 20px 0;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        .exercise {
            background-color: var(--primary);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid var(--accent);
        }

        .exercise p, .exercise h3 {
            margin-bottom: 15px;
        }

        /* Interactive Elements */
        .button {
            background-image: var(--gradient-1);
            color: var(--text-primary);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-block;
            text-align: center;
            text-decoration: none;
            margin-top: 10px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .button:active {
            transform: translateY(0);
        }

        .button.secondary {
            background-image: var(--gradient-2);
        }
        
        /* Matching Exercises */
        .matching-section {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }

        .matching-list {
            flex: 1;
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .matching-item {
            background-color: var(--secondary);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--accent);
        }

        .matching-item:hover {
            background-color: var(--accent);
        }

        .matching-item.selected {
            background-color: var(--purple);
            border: 1px solid var(--purple);
        }
        
        .matching-item.correct {
            cursor: default;
        }

        .matching-item.incorrect {
            background-color: var(--error);
            color: var(--primary);
            cursor: default;
        }

        /* New styles for correctly matched pairs */
        .match-color-1 { background-color: var(--match-color-1); border: 1px solid var(--match-color-1); color: var(--primary); }
        .match-color-2 { background-color: var(--match-color-2); border: 1px solid var(--match-color-2); color: var(--primary); }
        .match-color-3 { background-color: var(--match-color-3); border: 1px solid var(--match-color-3); color: var(--primary); }
        .match-color-4 { background-color: var(--match-color-4); border: 1px solid var(--match-color-4); color: var(--primary); }
        .match-color-5 { background-color: var(--match-color-5); border: 1px solid var(--match-color-5); color: var(--primary); }
        .match-color-6 { background-color: var(--match-color-6); border: 1px solid var(--match-color-6); color: var(--primary); }
        .match-color-7 { background-color: var(--match-color-7); border: 1px solid var(--match-color-7); color: var(--primary); }
        .match-color-8 { background-color: var(--match-color-8); border: 1px solid var(--match-color-8); color: var(--primary); }

        /* Multiple Choice & True/False */
        .options-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-item {
            background-color: var(--secondary);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--accent);
        }

        .option-item:hover:not(.correct):not(.incorrect) {
            background-color: var(--accent);
        }

        .option-item.selected {
            background-color: var(--purple);
            border: 1px solid var(--purple);
        }

        .option-item.correct {
            background-color: var(--green);
            color: var(--primary);
            border: 1px solid var(--green);
            cursor: default;
        }

        .option-item.incorrect {
            background-color: var(--error);
            color: var(--primary);
            border: 1px solid var(--error);
            cursor: default;
        }

        .question {
            margin-bottom: 20px;
        }
        
        /* Reading Comprehension */
        .reading-passage {
            background-color: var(--primary);
            border-left: 4px solid var(--purple);
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        /* Gap Fill */
        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .word-option {
            background-color: var(--secondary);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--accent);
        }

        .word-option:hover:not(.used) {
            background-color: var(--accent);
        }

        .word-option.active, .word-option.selected {
            background-color: var(--purple);
            border: 1px solid var(--purple);
        }

        .word-option.used {
            background-color: #2e3b5e;
            color: #7d8ea1;
            cursor: default;
            text-decoration: line-through;
        }

        .gap-fill-text {
            line-height: 2.5;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
        }

        .gap-fill-text input {
            background-color: transparent;
            border: none;
            border-bottom: 2px solid var(--accent);
            color: var(--text-primary);
            padding: 2px 5px;
            font-size: 1em;
            text-align: center;
            width: 150px;
            transition: border-color 0.3s;
        }

        .gap-fill-text input.correct {
            border-color: var(--green);
        }

        .gap-fill-text input.incorrect {
            border-color: var(--error);
        }

        /* Grammar */
        .grammar-question {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .grammar-gap {
            font-weight: 700;
            color: var(--text-primary);
            min-width: 100px;
            text-align: center;
            transition: color 0.3s;
        }

        .grammar-gap.correct {
            color: var(--green);
        }

        .grammar-gap.incorrect {
            color: var(--error);
        }
        
        /* Result Display */
        .result-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .result-message.correct {
            background-color: rgba(6, 255, 165, 0.1);
            border: 1px solid var(--green);
            color: var(--green);
        }

        .result-message.incorrect {
            background-color: rgba(251, 86, 7, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>A Taste of Britain: An Advanced English Lesson</h1>

        <div class="exercise" id="vocab-exercise">
            <h2>Exercise 1: Vocabulary Matching</h2>
            <p>Match the word or phrase to its correct definition.</p>
            <div class="matching-section">
                <ul class="matching-list vocab-terms">
                    <li class="matching-item" data-term="culinary_heritage">Culinary Heritage</li>
                    <li class="matching-item" data-term="fry_up">Fry-up</li>
                    <li class="matching-item" data-term="caramelised">Caramelised</li>
                    <li class="matching-item" data-term="shortcrust_pastry">Shortcrust Pastry</li>
                </ul>
                <ul class="matching-list vocab-definitions">
                    <li class="matching-item">A type of dough made from flour, butter, and eggs.</li>
                    <li class="matching-item">The cooking traditions of a country handed down over time.</li>
                    <li class="matching-item">A casual, slang term for a Full English Breakfast.</li>
                    <li class="matching-item">A cooking process that makes vegetables or sugars brown and sweet.</li>
                </ul>
            </div>
            <div id="vocab-result" class="result-message"></div>
        </div>

        <div class="exercise" id="reading-exercise">
            <h2>Exercise 2: Reading Comprehension</h2>
            <div class="reading-passage">
                <h3>Before you watch the video, read this summary of what you're about to learn.</h3>
                <p>British cuisine has a rich and varied culinary heritage that goes far beyond just fish and chips. A traditional Full English Breakfast, often called a "fry-up," is a hearty dish that includes sausages, bacon, eggs, and more. It's often celebrated for the quality of its ingredients. The sandwich, a British invention, is famous around the world and was supposedly created by a man who wanted to eat without leaving the gambling table. Another classic is the Sunday Roast, which features meat, roasted vegetables, and a delicious side dish known as Yorkshire pudding. British food also includes unique dishes like "bubble and squeak," made from leftover vegetables.</p>
            </div>
            <div class="question">
                <p>1. What is another name for a Full English Breakfast?</p>
                <ul class="options-list">
                    <li class="option-item" data-correct="false">A Sunday Roast.</li>
                    <li class="option-item" data-correct="true">A fry-up.</li>
                    <li class="option-item" data-correct="false">Bubble and squeak.</li>
                </ul>
            </div>
            <div class="question">
                <p>2. What is the sandwich named after?</p>
                <ul class="options-list">
                    <li class="option-item" data-correct="true">A man who wanted to eat while gambling.</li>
                    <li class="option-item" data-correct="false">A popular type of bread.</li>
                    <li class="option-item" data-correct="false">A small village in Britain.</li>
                </ul>
            </div>
            <div class="question">
                <p>3. What is considered a classic side dish for a Sunday Roast?</p>
                <ul class="options-list">
                    <li class="option-item" data-correct="false">Chips not crisps.</li>
                    <li class="option-item" data-correct="true">Yorkshire pudding.</li>
                    <li class="option-item" data-correct="false">Custard.</li>
                </ul>
            </div>
            <div id="reading-result" class="result-message"></div>
            <button class="button" onclick="checkMultipleChoice('reading')">Check Answers</button>
            <button class="button secondary" onclick="resetMultipleChoice('reading')">Reset</button>
        </div>

        <div class="video-container">
            <iframe src="https://www.youtube.com/embed/zaEvM3BPfFU?si=GzU8kR8J5p0qYhPz" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div>
        <p>This lesson is designed to improve your vocabulary, listening skills, and understanding of British culture. Watch the video above about the British love for tea, and then complete the exercises below.</p>
        
        <div class="exercise" id="true-false-exercise">
            <h2>Exercise 4: True or False</h2>
            <p>Based on the video, decide if the following statements are true or false.</p>
            <div class="question">
                <p>1. Black pudding is a dish enjoyed for centuries, made from pig's blood.</p>
                <ul class="options-list">
                    <li class="option-item" data-correct="true">True</li>
                    <li class="option-item" data-correct="false">False</li>
                </ul>
            </div>
            <div class="question">
                <p>2. The Sunday Roast tradition started with the king providing his guards with beef.</p>
                <ul class="options-list">
                    <li class="option-item" data-correct="true">True</li>
                    <li class="option-item" data-correct="false">False</li>
                </ul>
            </div>
            <div class="question">
                <p>3. Max Halley's rule for a delicious sandwich is to eat it with cutlery.</p>
                <ul class="options-list">
                    <li class="option-item" data-correct="false">True</li>
                    <li class="option-item" data-correct="true">False</li>
                </ul>
            </div>
            <div id="true-false-result" class="result-message"></div>
            <button class="button" onclick="checkMultipleChoice('true-false')">Check Answers</button>
            <button class="button secondary" onclick="resetMultipleChoice('true-false')">Reset</button>
        </div>
        
       <div class="exercise" id="gap-fill-exercise">
    <h2>Exercise 5: Gap-Fill</h2>
    <p>Use the words in the box to fill the gaps in the sentences.</p>
    <div class="word-bank">
        <div class="word-option" data-word="caramelised">caramelised</div>
        <div class="word-option" data-word="Beefeaters">Beefeaters</div>
        <div class="word-option" data-word="squeaks">squeaks</div>
        <div class="word-option" data-word="ingredients">ingredients</div>
        <div class="word-option" data-word="fry-up">fry-up</div>
    </div>
    <div class="gap-fill-text">
        <p>1. The name "bubble and squeak" comes from the sounds it makes while frying, as it bubbles and <input type="text" data-correct="squeaks" readonly>.</p>
        <p>2. The Full English Breakfast is also known as a <input type="text" data-correct="fry-up" readonly>.</p>
        <p>3. One of the main <input type="text" data-correct="ingredients" readonly> in the pie is <input type="text" data-correct="caramelised" readonly> onions.</p>
        <p>4. The British royal guards were nicknamed "<input type="text" data-correct="Beefeaters" readonly>" because they were supplied with weekly rations of beef.</p>
    </div>
    <div id="gap-result" class="result-message"></div>
    <button class="button" onclick="checkGaps()">Check Answers</button>
    <button class="button secondary" onclick="resetGaps()">Reset</button>
</div>

        <div class="exercise" id="grammar-exercise">
            <h2>Exercise 6: Passive Voice</h2>
            <p>Complete the sentences with the correct passive voice verb. Click the correct option.</p>
            <div class="question">
                <p class="grammar-question">
                    It is believed that the king's guards <span id="grammar-gap-1" class="grammar-gap"></span> "Beefeaters".
                </p>
                <ul class="options-list grammar" data-gap="grammar-gap-1">
                    <li class="option-item" data-value="were nicknamed">were nicknamed</li>
                    <li class="option-item" data-value="were nicknaming">were nicknaming</li>
                </ul>
            </div>
            <div class="question">
                <p class="grammar-question">
                    The meat for the Sunday Roast<span id="grammar-gap-2" class="grammar-gap"></span> with rosemary, thyme, and garlic.
                </p>
                <ul class="options-list grammar" data-gap="grammar-gap-2">
                    <li class="option-item" data-value="is preparing">is preparing</li>
                    <li class="option-item" data-value="is prepared">is prepared</li>
                </ul>
            </div>
            <div class="question">
                <p class="grammar-question">
                    Black pudding <span id="grammar-gap-3" class="grammar-gap"></span> by hand into natural casings.
                </p>
                <ul class="options-list grammar" data-gap="grammar-gap-3">
                    <li class="option-item" data-value="is stuffed">is stuffed</li>
                    <li class="option-item" data-value="has stuffed">has stuffed</li>
                </ul>
            </div>
            <div id="grammar-result" class="result-message"></div>
            <button class="button" onclick="checkGrammar()">Check Answers</button>
            <button class="button secondary" onclick="resetGrammar()">Reset</button>
        </div>
        
        <div class="exercise" id="idiom-exercise">
            <h2>Exercise 7: Food Idioms</h2>
            <p>Match the idiom with its correct meaning.</p>
            <div class="matching-section">
                <ul class="matching-list idiom-terms">
                    <li class="matching-item" data-term="spill_the_beans">Spill the beans</li>
                    <li class="matching-item" data-term="have_egg_on_your_face">Have egg on your face</li>
                    <li class="matching-item" data-term="as_easy_as_pie">As easy as pie</li>
                    <li class="matching-item" data-term="bring_home_the_bacon">Bring home the bacon</li>
                </ul>
                <ul class="matching-list idiom-definitions">
                    <li class="matching-item">To be embarrassed by something you've said or done.</li>
                    <li class="matching-item">Very easy to do.</li>
                    <li class="matching-item">To earn money for your family.</li>
                    <li class="matching-item">To reveal a secret.</li>
                </ul>
            </div>
            <div id="idiom-result" class="result-message"></div>
        </div>

        <div class="exercise" id="discussion-section">
            <h2>Exercise 8: Discussion</h2>
            <p>Ready to put your knowledge to the test? Use these questions to start a discussion with a partner or classmate.</p>
            <ul>
                <li>What is your favourite type of British food, and why?</li>
                <li>How do food traditions in your country compare to those in the UK?</li>
                <li>What are some food idioms in your language, and what do they mean?</li>
            </ul>
        </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', () => {

        const displayResultMessage = (resultId, message, isCorrect) => {
            const resultDiv = document.getElementById(resultId);
            resultDiv.textContent = message;
            resultDiv.style.display = 'block';
            resultDiv.classList.remove('correct', 'incorrect');
            resultDiv.classList.add(isCorrect ? 'correct' : 'incorrect');
        };

        // --- Matching Logic ---
        const vocabPairs = {
            'culinary_heritage': 'The cooking traditions of a country handed down over time.',
            'fry_up': 'A casual, slang term for a Full English Breakfast.',
            'caramelised': 'A cooking process that makes vegetables or sugars brown and sweet.',
            'shortcrust_pastry': 'A type of dough made from flour, butter, and eggs.'
        };
        const idiomPairs = {
            'spill_the_beans': 'To reveal a secret.',
            'have_egg_on_your_face': 'To be embarrassed by something you\'ve said or done.',
            'as_easy_as_pie': 'Very easy to do.',
            'bring_home_the_bacon': 'To earn money for your family.'
        };
        const matchColors = ['match-color-1', 'match-color-2', 'match-color-3', 'match-color-4'];
        let vocabMatchCount = 0;
        let idiomMatchCount = 0;

        const matchingSelections = {
            'vocab': { term: null, def: null },
            'idiom': { term: null, def: null }
        };

        const addMatchingListeners = (type, pairs) => {
            const terms = document.querySelector(`.${type}-terms`);
            const definitions = document.querySelector(`.${type}-definitions`);

            [...terms.children, ...definitions.children].forEach(item => {
                item.addEventListener('click', () => {
                    if (item.classList.contains('correct')) {
                        return; // Correctly matched items can't be reselected
                    }

                    const isTerm = item.parentElement === terms;
                    const currentType = isTerm ? 'term' : 'def';
                    
                    if (matchingSelections[type][currentType] === item) {
                        item.classList.remove('selected');
                        matchingSelections[type][currentType] = null;
                        return;
                    }

                    if (matchingSelections[type][currentType]) {
                        matchingSelections[type][currentType].classList.remove('selected');
                    }
                    matchingSelections[type][currentType] = item;
                    item.classList.add('selected');

                    if (matchingSelections[type].term && matchingSelections[type].def) {
                        checkAndLockPair(type);
                    }
                });
            });
        };
        
        const checkAndLockPair = (type) => {
            const termItem = matchingSelections[type].term;
            const defItem = matchingSelections[type].def;
            const pairs = type === 'vocab' ? vocabPairs : idiomPairs;

            if (!termItem || !defItem) return;

            const termKey = termItem.dataset.term;
            const defText = defItem.textContent.trim();
            const isCorrect = pairs[termKey] === defText;
            
            if (isCorrect) {
                const matchCount = type === 'vocab' ? vocabMatchCount++ : idiomMatchCount++;
                const colorClass = matchColors[matchCount % matchColors.length];

                termItem.classList.add('correct', colorClass);
                defItem.classList.add('correct', colorClass);
                termItem.classList.remove('selected');
                defItem.classList.remove('selected');
                displayResultMessage(`${type}-result`, 'Correct match! ðŸ‘', true);
            } else {
                termItem.classList.add('incorrect');
                defItem.classList.add('incorrect');
                displayResultMessage(`${type}-result`, 'Incorrect match. Try again! ðŸ§', false);

                setTimeout(() => {
                    termItem.classList.remove('selected', 'incorrect');
                    defItem.classList.remove('selected', 'incorrect');
                }, 1000);
            }

            matchingSelections[type].term = null;
            matchingSelections[type].def = null;
            
            if (document.querySelectorAll(`.${type}-terms .correct`).length === Object.keys(pairs).length) {
                displayResultMessage(`${type}-result`, 'All pairs are correct! ðŸŽ‰', true);
            }
        };

        window.checkMatchingAnswers = () => {};
        window.resetMatching = () => {};


        // --- Multiple Choice/True or False Logic ---
        const addMultipleChoiceListeners = () => {
            document.querySelectorAll('.options-list').forEach(list => {
                list.addEventListener('click', (event) => {
                    const selected = event.target.closest('.option-item');
                    if (!selected || selected.closest('.question').classList.contains('answered')) {
                        return;
                    }

                    list.querySelectorAll('.option-item').forEach(item => item.classList.remove('selected'));
                    selected.classList.add('selected');
                });
            });
        };

        window.checkMultipleChoice = (type) => {
            const exerciseDiv = document.querySelector(`#${type}-result`).closest('.exercise');
            const questions = exerciseDiv.querySelectorAll('.question');
            let correctCount = 0;
            const totalQuestions = questions.length;

            questions.forEach(q => {
                const selected = q.querySelector('.option-item.selected');
                if (selected) {
                    const isCorrect = selected.dataset.correct === 'true';
                    selected.classList.add(isCorrect ? 'correct' : 'incorrect');
                    if (isCorrect) {
                        correctCount++;
                    }
                    q.classList.add('answered'); // Prevents re-checking this question
                }
            });

            const message = `You got ${correctCount} out of ${totalQuestions} correct!`;
            displayResultMessage(`${type}-result`, message, correctCount === totalQuestions);
        };

        window.resetMultipleChoice = (type) => {
            const exerciseDiv = document.querySelector(`#${type}-result`).closest('.exercise');
            exerciseDiv.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('selected', 'correct', 'incorrect');
            });
            exerciseDiv.querySelectorAll('.question').forEach(q => q.classList.remove('answered'));
            document.getElementById(`${type}-result`).style.display = 'none';
        };

        // --- Gap-Fill Logic (Click to select) ---
        let selectedWord = null;

        const addGapFillListeners = () => {
            document.querySelectorAll('.word-option').forEach(option => {
                option.addEventListener('click', () => {
                    if (option.classList.contains('used')) return;
                    if (selectedWord) {
                        selectedWord.classList.remove('active');
                    }
                    selectedWord = option;
                    option.classList.add('active');
                });
            });

            document.querySelectorAll('.gap-fill-text input').forEach(gap => {
                gap.addEventListener('click', () => {
                    if (gap.classList.contains('correct') || gap.classList.contains('incorrect')) {
                        return;
                    }
                    if (gap.value && gap.classList.contains('filled')) {
                        const originalWord = document.querySelector(`.word-option[data-word="${gap.value}"]`);
                        if (originalWord) {
                            originalWord.classList.remove('used');
                            gap.value = '';
                            gap.classList.remove('filled');
                            gap.classList.remove('active');
                        }
                    } else if (selectedWord) {
                        const currentWord = selectedWord.dataset.word;
                        gap.value = currentWord;
                        gap.classList.add('filled');
                        selectedWord.classList.add('used');
                        selectedWord.classList.remove('active');
                        selectedWord = null;
                    }
                });
            });
        };

        window.checkGaps = () => {
            const gaps = document.querySelectorAll('.gap-fill-text input');
            let correctCount = 0;
            const totalGaps = gaps.length;

            gaps.forEach(gap => {
                const isCorrect = gap.value.toLowerCase() === gap.dataset.correct.toLowerCase();
                gap.classList.add(isCorrect ? 'correct' : 'incorrect');
                if (isCorrect) {
                    correctCount++;
                }
            });

            const message = `You got ${correctCount} out of ${totalGaps} correct!`;
            displayResultMessage('gap-result', message, correctCount === totalGaps);
        };

        window.resetGaps = () => {
            document.querySelectorAll('.gap-fill-text input').forEach(gap => {
                gap.value = '';
                gap.classList.remove('correct', 'incorrect', 'filled', 'active');
            });
            document.querySelectorAll('.word-option').forEach(option => {
                option.classList.remove('used', 'active');
            });
            selectedWord = null;
            document.getElementById('gap-result').style.display = 'none';
        };

        // --- Grammar Logic (Passive Voice) ---
        const grammarAnswers = {
            'grammar-gap-1': 'were nicknamed',
            'grammar-gap-2': 'is prepared',
            'grammar-gap-3': 'is stuffed'
        };

        const addGrammarListeners = () => {
            document.querySelectorAll('.options-list.grammar').forEach(list => {
                list.addEventListener('click', (event) => {
                    const selectedOption = event.target.closest('.option-item');
                    const parentQuestion = list.closest('.question');
                    if (!selectedOption || parentQuestion.classList.contains('answered')) return;

                    const gapId = list.dataset.gap;
                    const gap = document.getElementById(gapId);
                    
                    list.querySelectorAll('.option-item').forEach(opt => opt.classList.remove('selected'));

                    selectedOption.classList.add('selected');
                    gap.textContent = selectedOption.dataset.value;
                });
            });
        };

        window.checkGrammar = () => {
            const questions = document.querySelectorAll('.options-list.grammar');
            let correctCount = 0;
            const totalQuestions = questions.length;

            questions.forEach(list => {
                const gapId = list.dataset.gap;
                const gapSpan = document.getElementById(gapId);
                const selectedOption = list.querySelector('.option-item.selected');
                const parentQuestion = list.closest('.question');

                if (selectedOption) {
                    const isCorrect = selectedOption.dataset.value === grammarAnswers[gapId];
                    selectedOption.classList.add(isCorrect ? 'correct' : 'incorrect');
                    gapSpan.classList.add(isCorrect ? 'correct' : 'incorrect');
                    if (isCorrect) {
                        correctCount++;
                    }
                    parentQuestion.classList.add('answered');
                }
            });
            
            const message = `You got ${correctCount} out of ${totalQuestions} correct!`;
            displayResultMessage('grammar-result', message, correctCount === totalQuestions);
        };

        window.resetGrammar = () => {
            document.querySelectorAll('.options-list.grammar').forEach(list => {
                list.querySelectorAll('.option-item').forEach(option => {
                    option.classList.remove('selected', 'correct', 'incorrect');
                });
                const gapSpan = document.getElementById(list.dataset.gap);
                gapSpan.textContent = '';
                gapSpan.classList.remove('correct', 'incorrect');
                list.closest('.question').classList.remove('answered');
            });
            document.getElementById('grammar-result').style.display = 'none';
        };

        addMatchingListeners('vocab', vocabPairs);
        addMatchingListeners('idiom', idiomPairs);
        addMultipleChoiceListeners();
        addGapFillListeners();
        addGrammarListeners();
    });
</script>
</body>
</html>
