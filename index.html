<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <title>English For Cool Dudes - Master English with Gamified Learning</title>

    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/init-auth.js"></script>

    <style>
        /* â”€â”€ MOONSHOT GAMIFIED PALETTE â”€â”€ */
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap');

        :root {
            /* Vibrant App Colors */
            --blue:         #1CB0F6;
            --blue-shadow:  #1899D6;
            --yellow:       #FFC800;
            --yellow-shadow:#E5B400;
            --green:        #58CC02;
            --green-shadow: #58A700;
            --punch:        #FF4B4B;
            --punch-shadow: #EA2B2B;
            --purple:       #CE82FF;
            --purple-shadow:#A559D9;
            --teal:         #2BDECC;
            
            /* Neutrals */
            --bg:           #F7F9FA;
            --ink:          #4B4B4B;
            --ink-bold:     #111827;
            --ink-3:        #AFAFAF;
            --white:        #FFFFFF;
            --border:       #E5E5E5;
            --border-heavy: #CECECE;

            /* Radii */
            --r:            24px;
            --rsm:          16px;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { -webkit-text-size-adjust: 100%; }

        body {
            background: var(--bg);
            color: var(--ink);
            /* Bubbly, friendly font commonly used in games */
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.5;
            overflow-x: hidden;
        }
        a { color: inherit; text-decoration: none; }

        /* â”€â”€ ANIMATIONS â”€â”€ */
        @keyframes up    { from{opacity:0;transform:translateY(22px)} to{opacity:1;transform:translateY(0)} }
        @keyframes popin { 0%{opacity:0;transform:scale(.8)} 70%{transform:scale(1.05)} 100%{opacity:1;transform:scale(1)} }
        @keyframes flick { 0%,100%{transform:rotate(-4deg)scale(1)} 50%{transform:rotate(4deg)scale(1.12)} }
        @keyframes shim  { 0%{background-position:-400px 0} 100%{background-position:400px 0} }
        @keyframes nudge { 0%,100%{transform:translateX(0)} 30%{transform:translateX(4px)} }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }

        .u1{animation:up .44s ease both .04s}
        .u2{animation:up .44s ease both .12s}
        .u3{animation:up .44s ease both .20s}
        .u4{animation:up .44s ease both .28s}
        .u5{animation:up .44s ease both .36s}
        .u6{animation:up .44s ease both .44s}

        /* â”€â”€ HEADER â”€â”€ */
        .header {
            background: var(--white);
            border-bottom: 2px solid var(--border);
            position: sticky; top: 0; z-index: 200;
            padding: 0 20px; height: 60px;
            display: flex; align-items: center;
        }
        .hc {
            max-width: 860px; width: 100%; margin: 0 auto;
            display: flex; align-items: center; justify-content: space-between;
        }
        .hl { display: flex; align-items: center; gap: 10px; }
        .logo {
            width: 40px; height: 40px; border-radius: 12px;
            background: var(--yellow); border: 2px solid var(--border-heavy);
            display: flex; align-items: center; justify-content: center;
            font-size: 22px; flex-shrink: 0;
            box-shadow: 0 3px 0 var(--border-heavy);
        }
        .site-title { font-size: 18px; font-weight: 900; color: var(--ink-bold); letter-spacing: -.4px; }
        @media(max-width:380px){.site-title{display:none}}
        #header-auth-container { display:flex; align-items:center; gap:8px; }

        /* â”€â”€ PAGE â”€â”€ */
        .page { max-width: 860px; margin: 0 auto; padding: 24px 16px 96px; display: flex; flex-direction: column; gap: 20px; }

        /* â”€â”€ SKELETON â”€â”€ */
        .sk {
            background: linear-gradient(90deg,#EBEBEB 25%,#F5F5F5 50%,#EBEBEB 75%);
            background-size: 400px 100%;
            animation: shim 1.4s infinite;
            border-radius: var(--rsm);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CHUNKY CARD BASE (Gamified feel)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .chunky-card {
            background: var(--white);
            border: 2px solid var(--border-heavy);
            border-bottom: 6px solid var(--border-heavy);
            border-radius: var(--r);
            padding: 20px;
            transition: transform 0.1s, border-bottom-width 0.1s, margin-top 0.1s;
        }
        .chunky-card:active {
            border-bottom-width: 2px;
            transform: translateY(4px);
            margin-bottom: 4px; /* prevents layout shift below it */
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HERO â€” Vibrant Blue / Yellow
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .hero {
            background: var(--blue);
            border: 2px solid var(--blue-shadow);
            border-bottom: 6px solid var(--blue-shadow);
            border-radius: var(--r);
            padding: 24px 20px;
            position: relative; overflow: hidden;
        }
        .hero::after {
            content:'ğŸ˜'; position:absolute; bottom:-10px; right:10px;
            font-size: 100px; opacity: 0.2; pointer-events:none;
            transform: rotate(-15deg);
        }

        /* guest */
        .eyebrow {
            display:inline-block; background:var(--yellow); color:var(--ink-bold);
            font-size:12px; font-weight:900; text-transform:uppercase; letter-spacing:1.5px;
            padding:4px 12px; border-radius:8px; margin-bottom:14px;
            border: 2px solid var(--yellow-shadow);
        }
        .big-title {
            font-size: clamp(32px,8vw,52px);
            font-weight:900; color:var(--white); line-height:1.1; letter-spacing:-1px;
            margin-bottom:10px; position:relative; z-index:1;
        }
        .big-title .yellow { color: var(--yellow); text-shadow: 0 3px 0 var(--yellow-shadow); }
        .hero-sub { font-size:16px; font-weight:700; color:rgba(255,255,255,.9); margin-bottom:24px; max-width:320px; position:relative; z-index:1;}
        .guest-btns { display:flex; gap:12px; flex-wrap:wrap; position:relative; z-index:1;}

        .btn-yellow {
            display:inline-flex; align-items:center; gap:6px;
            padding:14px 24px; background:var(--yellow); color:var(--ink-bold);
            font-size:16px; font-weight:900; border-radius:var(--rsm); 
            border:2px solid var(--yellow-shadow); border-bottom: 4px solid var(--yellow-shadow);
            cursor:pointer; letter-spacing:-.3px;
            transition: transform .1s, border-bottom-width .1s;
        }
        .btn-yellow:active { border-bottom-width: 2px; transform:translateY(2px); }

        .btn-white {
            display:inline-flex; align-items:center; gap:6px;
            padding:14px 20px; background:var(--white); color:var(--ink-bold);
            font-size:16px; font-weight:900; border-radius:var(--rsm);
            border:2px solid var(--border-heavy); border-bottom: 4px solid var(--border-heavy);
            cursor:pointer; letter-spacing:-.3px;
            transition: transform .1s, border-bottom-width .1s;
        }
        .btn-white:active { border-bottom-width: 2px; transform:translateY(2px); }

        /* logged-in top row */
        .hero-top {
            display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
            margin-bottom:18px; position:relative; z-index:1;
        }
        .greet { font-size:13px; font-weight:800; color:rgba(255,255,255,.8); text-transform:uppercase; letter-spacing:1px; margin-bottom:2px; }
        .uname { font-size:clamp(24px,6vw,36px); font-weight:900; color:var(--white); letter-spacing:-1px; line-height:1.1; text-shadow: 0 2px 0 var(--blue-shadow);}
        
        /* streak block */
        .streak-block {
            text-align:center; flex-shrink:0;
            background:var(--white); border:2px solid var(--border-heavy); border-bottom:4px solid var(--border-heavy);
            border-radius:var(--rsm); padding:10px 16px; min-width:80px;
        }
        .sfire { font-size:32px; display:block; line-height:1; animation:flick 1.8s ease-in-out infinite; }
        .snum  { font-size:24px; font-weight:900; color:var(--punch); display:block; line-height:1.1; margin-top:4px;}
        .sword { font-size:10px; font-weight:900; color:var(--ink-3); text-transform:uppercase; letter-spacing:1px; }

        /* xp bar */
        .xp-wrap { position:relative; z-index:1; margin-bottom:20px; background: rgba(255,255,255,0.2); padding: 12px; border-radius: var(--rsm);}
        .xp-row  { display:flex; justify-content:space-between; font-size:13px; font-weight:800; margin-bottom:8px; color: var(--white); text-shadow: 0 1px 0 rgba(0,0,0,0.1);}
        .xp-track{ height:16px; background:rgba(0,0,0,.15); border-radius:99px; overflow:hidden; border: 2px solid rgba(0,0,0,0.1); }
        .xp-fill {
            height:100%; width:0%; border-radius:99px;
            background:var(--yellow);
            border-top: 4px solid rgba(255,255,255,0.4); /* shiny effect */
            transition:width 1.3s cubic-bezier(.4,0,.2,1);
        }

        /* CTA button inside hero */
        .hero-cta {
            display:flex; align-items:center; justify-content:space-between;
            width:100%; padding:16px 20px;
            background:var(--green); color:var(--white);
            font-size:18px; font-weight:900; border-radius:var(--rsm); 
            border:2px solid var(--green-shadow); border-bottom:6px solid var(--green-shadow);
            cursor:pointer; letter-spacing:-.3px;
            transition:transform .1s, border-bottom-width .1s;
            position:relative; z-index:1;
        }
        .hero-cta:active{ border-bottom-width: 2px; transform:translateY(4px); margin-bottom: 4px;}
        .cta-arrow { font-size:24px; font-weight:900; flex-shrink:0; }

        /* stats row */
        .stat-row { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:16px; position:relative; z-index:1; }
        .stat-pill {
            background:rgba(255,255,255,.2); border:2px solid rgba(255,255,255,.3);
            border-radius:var(--rsm); padding:12px 8px; text-align:center;
        }
        .sn { display:block; font-size:22px; font-weight:900; color:var(--white); line-height:1; text-shadow: 0 2px 0 rgba(0,0,0,0.1);}
        .sl { font-size:10px; font-weight:900; color:rgba(255,255,255,.8); text-transform:uppercase; letter-spacing:1px; margin-top:4px; display:block; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STREAK PROTECTION BANNER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .streak-banner {
            display:flex; align-items:center; gap:14px;
            background:var(--yellow); 
            border:2px solid var(--yellow-shadow); border-bottom: 5px solid var(--yellow-shadow);
            border-radius:var(--r); padding:16px 20px; cursor:pointer;
            transition:transform .1s, border-bottom-width .1s;
        }
        .streak-banner:active{ border-bottom-width: 2px; transform:translateY(3px); }
        .sb-icon { font-size:32px; flex-shrink:0; animation:flick 1.8s ease-in-out infinite; }
        .sb-body { flex:1; }
        .sb-title { font-size:16px; font-weight:900; color:var(--ink-bold); letter-spacing:-.3px; }
        .sb-sub   { font-size:13px; font-weight:700; color:rgba(0,0,0,.6); margin-top:2px; }
        .sb-arrow { font-size:24px; font-weight:900; color:var(--ink-bold); opacity:.5; animation:nudge 2s ease-in-out infinite; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIXED WIDGET LAYOUT & COOL PICKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.widget-row { display: grid; grid-template-columns: 1fr; gap: 16px; align-items: stretch; }
@media(min-width: 600px) { .widget-row { grid-template-columns: 1fr 1fr; } }

/* Cool Picks Widget Specifics */
#cool-picks-widget {
    display: flex; flex-direction: column; justify-content: space-between; height: 100%; gap: 12px;
}
.picks-content-wrap { flex: 1; }

/* Injected Cool Picks CSS from the JS file */
.picks-full-preview, .picks-funfact, .picks-mystery { color: var(--ink-bold); display: flex; flex-direction: column; gap: 8px; }
.picks-header-row { font-weight: 900; font-size: 16px; display: flex; align-items: center; gap: 8px; color: var(--ink-bold); }
.picks-preview, .picks-tagline { font-size: 14px; font-weight: 700; color: var(--ink-3); }
.picks-learnings, .picks-fact { font-size: 13px; background: var(--bg); padding: 10px; border-radius: 12px; color: var(--ink-bold); border: 2px solid var(--border); }
.picks-direct-badge { display: inline-block; font-size: 11px; background: var(--yellow); padding: 4px 8px; border-radius: 6px; font-weight: 900; border: 2px solid var(--yellow-shadow); width: max-content;}

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DAILY CHALLENGE & PICKS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .widget-row { display: grid; grid-template-columns: 1fr; gap: 16px; }
        @media(min-width: 600px) { .widget-row { grid-template-columns: 1fr 1fr; } }

        .d-icon { font-size:36px; animation: float 3s ease-in-out infinite; }
        .d-title, #picks-title { font-size:16px; font-weight:900; color:var(--ink-bold); letter-spacing:-.2px; margin-bottom: 2px;}
        .d-sub, #picks-desc { font-size:13px; font-weight: 700; color:var(--ink-3); }
        
        .d-badge, .picks-btn {
            background:var(--white); color:var(--ink-bold);
            font-size:13px; font-weight:900; padding:10px 16px;
            border: 2px solid var(--border-heavy); border-bottom: 4px solid var(--border-heavy);
            border-radius:var(--rsm); text-transform:uppercase;
            letter-spacing:.8px; flex-shrink:0; cursor: pointer;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SECTION LABEL
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .sec-label {
            font-size:14px; font-weight:900; color:var(--ink-3);
            text-transform:uppercase; letter-spacing:1.5px;
            margin-bottom:12px; margin-top: 8px;
            display:flex; align-items:center; gap:12px;
        }
        .sec-label::after { content:''; flex:1; height:2px; background:var(--border); border-radius: 2px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           COURSE CARDS â€” swipeable
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .strip {
            display:flex; gap:16px;
            overflow-x:auto; scroll-snap-type:x mandatory;
            -webkit-overflow-scrolling:touch;
            padding-bottom:10px;
            scrollbar-width:none; -ms-overflow-style:none;
        }
        .strip::-webkit-scrollbar { display:none; }
        @media(min-width:600px){
            .strip { display:grid; grid-template-columns:repeat(3,1fr); overflow:visible; }
        }

        .cc {
            background:var(--white); 
            border:2px solid var(--border-heavy); border-bottom: 6px solid var(--border-heavy);
            border-radius:var(--r);
            padding:20px 18px; display:flex; flex-direction:column; gap:12px;
            min-width:240px; flex-shrink:0; scroll-snap-align:start;
            transition: border-bottom-width .1s, transform .1s;
            position:relative; cursor:pointer;
        }
        .cc:active{ border-bottom-width: 2px; transform:translateY(4px); }
        
        /* Colorful top borders for cards */
        .cc::before { content:''; position:absolute; top:-2px; left:-2px; right:-2px; height:8px; border-radius: 24px 24px 0 0; }
        .cc[data-c=red]::before    { background:var(--punch); }
        .cc[data-c=orange]::before { background:var(--yellow); }
        .cc[data-c=blue]::before   { background:var(--blue); }
        .cc[data-c=green]::before  { background:var(--green); }
        .cc[data-c=purple]::before { background:var(--purple); }
        .cc[data-c=teal]::before   { background:var(--teal); }

        .cc-top  { display:flex; align-items:center; justify-content:space-between; margin-top: 4px;}
        .cc-icon { font-size:32px; line-height:1; }
        .cc-badge{
            font-size:10px; font-weight:900; letter-spacing:1px; text-transform:uppercase;
            padding:4px 10px; border-radius:8px; background:var(--bg); color:var(--ink-3);
        }
        .cc-title { font-size:18px; font-weight:900; color:var(--ink-bold); letter-spacing:-.3px; }
        .cc-desc  { font-size:14px; font-weight:700; color:var(--ink-3); line-height:1.4; flex:1; }
        .cc-foot  { display:flex; align-items:center; justify-content:space-between; margin-top:8px; }
        .cc-meta  { font-size:12px; font-weight:800; color:var(--ink-3); }
        .cc-go    { width:32px; height:32px; border-radius:50%; background:var(--border); color:var(--ink-bold); display:flex; align-items:center; justify-content:center; font-size:16px; font-weight:900; }

        .swipe-hint { font-size:12px; font-weight:800; color:var(--ink-3); margin-bottom:8px; display:flex; align-items:center; gap:4px; }
        .swipe-hint span { animation:nudge 2s ease-in-out infinite; display:inline-block; }
        @media(min-width:600px){.swipe-hint{display:none;}}

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           GAME ZONE (Now vibrant!)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .game-card {
            background:var(--purple); 
            border:2px solid var(--purple-shadow); border-bottom: 6px solid var(--purple-shadow);
            border-radius:var(--r);
            padding:24px 20px; display:flex; align-items:center; gap:16px;
            cursor:pointer; position:relative; overflow:hidden;
            transition:transform .1s, border-bottom-width .1s;
        }
        .game-card::after {
            content:'ğŸ‘¾'; position:absolute; top:-10px; right:-10px;
            font-size:120px; opacity:.15; pointer-events:none; transform: rotate(15deg);
        }
        .game-card:active{ border-bottom-width: 2px; transform:translateY(4px); }
        .g-icon {
            width:64px; height:64px; flex-shrink:0;
            background:rgba(255,255,255,.2); border-radius:16px;
            display:flex; align-items:center; justify-content:center;
            font-size:36px; position:relative; z-index:1;
        }
        .g-body  { flex:1; position:relative; z-index:1; }
        .g-title { font-size:22px; font-weight:900; color:var(--white); letter-spacing:-.5px; margin-bottom:4px; text-shadow: 0 2px 0 var(--purple-shadow);}
        .g-sub   { font-size:14px; font-weight:700; color:rgba(255,255,255,.9); line-height:1.4; }
        .g-pill  {
            flex-shrink:0; position:relative; z-index:1;
            background:var(--white); color:var(--purple-shadow);
            font-size:14px; font-weight:900; padding:12px 20px;
            border-radius:var(--rsm); text-transform:uppercase; letter-spacing:1px;
            border: 2px solid var(--border-heavy); border-bottom: 4px solid var(--border-heavy);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LEADERBOARD
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .lb-head { padding:16px 20px; border-bottom:2px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
        .lb-head-t { font-size:16px; font-weight:900; color:var(--ink-bold); }
        .lb-head-a { font-size:13px; font-weight:900; color:var(--blue); text-transform:uppercase; letter-spacing:.5px; }
        .lb-row { display:flex; align-items:center; gap:14px; padding:14px 20px; border-bottom:2px solid var(--border); }
        .lb-row:last-child{border-bottom:none;}
        .lb-row.you{background:rgba(28, 176, 246, 0.08);}
        .lb-rank{ font-size:18px; font-weight: 900; width:30px; text-align:center; flex-shrink:0; color: var(--ink-3);}
        .lb-av  { width:40px; height:40px; border-radius:12px; background:var(--yellow); border: 2px solid var(--border-heavy); color:var(--ink-bold); display:flex; align-items:center; justify-content:center; font-size:18px; font-weight:900; flex-shrink:0; }
        .lb-name{ flex:1; font-size:15px; font-weight:800; color:var(--ink-bold); }
        .lb-xp  { font-size:15px; font-weight:900; color:var(--blue); }

        

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FOOTER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .footer { padding:32px 20px; text-align:center; }
        .footer-text { font-size:14px; font-weight:800; color:var(--ink-3); margin-bottom:12px; }
        .footer a { color:var(--ink-3); font-size:13px; font-weight:800; margin:0 12px; text-decoration: underline;}
    </style>
</head>
<body>

<header class="header">
    <div class="hc">
        <div class="hl">
            <div class="logo">ğŸ˜</div>
            <a href="/" class="site-title">English For Cool Dudes</a>
        </div>
        <div id="header-auth-container"></div>
    </div>
</header>

<div class="page">

    <div class="u1">
        <div class="hero" id="hero-card">
            <div class="sk" style="height:14px;width:38%;margin-bottom:10px;"></div>
            <div class="sk" style="height:48px;width:72%;margin-bottom:24px;"></div>
            <div class="sk" style="height:16px;margin-bottom:8px;border-radius:99px;"></div>
            <div class="sk" style="height:64px;border-radius:16px;margin-top:20px;"></div>
        </div>
    </div>

    <div class="u2" id="sb-wrap" style="display:none;">
        <a href="#" class="streak-banner" id="sb-link">
            <span class="sb-icon">ğŸ”¥</span>
            <div class="sb-body">
                <div class="sb-title" id="sb-title">Don't break your streak!</div>
                <div class="sb-sub">Complete one lesson today to keep it alive</div>
            </div>
            <span class="sb-arrow">â†’</span>
        </a>
    </div>

    <div class="u3 widget-row">
        <div id="daily-challenge-container">
            </div>

        <div class="chunky-card" id="cool-picks-widget">
            <div class="picks-content-wrap">
                <div class="d-icon" style="font-size: 32px; margin-bottom: 8px;">ğŸ¯</div>
                <div id="picks-desc">
                    <div id="picks-title">Cool Picks</div>
                    <div style="font-size:13px; font-weight:700; color:var(--ink-3);">Discover something new!</div>
                </div>
            </div>
            <button id="picks-btn" class="picks-btn" style="width: 100%;">ğŸ‘€ Look</button>
        </div>
    </div>

        <div class="chunky-card" style="display:flex; align-items:center; gap:16px; cursor:pointer;">
            <div class="d-icon">ğŸ¯</div>
            <div style="flex:1;">
                <div id="picks-title">Cool Picks</div>
                <div id="picks-desc">Discover something new!</div>
            </div>
            <button id="picks-btn" class="picks-btn">ğŸ‘€ Look</button>
        </div>
    </div>

    <div class="u4">
        <div class="sec-label">The Main Path</div>
        <p class="swipe-hint">Swipe <span>â†’</span></p>
        <div class="strip">
            <a href="beginner/" class="cc" data-c="green">
                <div class="cc-top"><span class="cc-icon">ğŸŒ±</span><span class="cc-badge">A1â€“A2</span></div>
                <div class="cc-title">Beginner</div>
                <div class="cc-desc">Start your English journey from scratch.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Foundation</span><span class="cc-go">â€º</span></div>
            </a>
            <a href="intermediate/" class="cc" data-c="blue">
                <div class="cc-top"><span class="cc-icon">ğŸš€</span><span class="cc-badge">B1â€“B2</span></div>
                <div class="cc-title">Intermediate</div>
                <div class="cc-desc">Complex grammar for real-world situations.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Expanding</span><span class="cc-go">â€º</span></div>
            </a>
            <a href="advanced/" class="cc" data-c="red">
                <div class="cc-top"><span class="cc-icon">ğŸ¯</span><span class="cc-badge">C1â€“C2</span></div>
                <div class="cc-title">Advanced</div>
                <div class="cc-desc">Idioms and native-like British fluency.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Mastery</span><span class="cc-go">â€º</span></div>
            </a>
        </div>
    </div>

    <div class="u5">
        <div class="sec-label">Specialized Tracks id="specialized-tracks"</div>
        <p class="swipe-hint">Swipe <span>â†’</span></p>
        <div class="strip">
            <a href="business/" class="cc" data-c="purple">
                <div class="cc-top"><span class="cc-icon">ğŸ’¼</span><span class="cc-badge">Pro</span></div>
                <div class="cc-title">Business English</div>
                <div class="cc-desc">Meetings, emails, presentations and negotiations.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Multiple lessons</span><span class="cc-go">â€º</span></div>
            </a>
            <a href="tax/" class="cc" data-c="orange">
                <div class="cc-top"><span class="cc-icon">ğŸ’°</span><span class="cc-badge">Specialist</span></div>
                <div class="cc-title">Tax English</div>
                <div class="cc-desc">Tax terminology for accounting professionals.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Multiple lessons</span><span class="cc-go">â€º</span></div>
            </a>
            <a href="legal/" class="cc" data-c="teal">
                <div class="cc-top"><span class="cc-icon">âš–ï¸</span><span class="cc-badge">Specialist</span></div>
                <div class="cc-title">Legal English</div>
                <div class="cc-desc">Legal terms and contracts with confidence.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Multiple lessons</span><span class="cc-go">â€º</span></div>
            </a>
        </div>
    </div>

    <div class="u6">
        <div class="sec-label">The Break Room</div>
        <a href="games/" class="game-card">
            <div class="g-icon">ğŸ®</div>
            <div class="g-body">
                <div class="g-title">Game Zone</div>
                <div class="g-sub">What Am I? Â· Chat Attack Â· Vibe Check</div>
            </div>
            <div class="g-pill">Play</div>
        </a>
    </div>

    <div class="u6" id="lb-section" style="display:none;">
        <div class="sec-label">ğŸ† Top League</div>
        <div class="chunky-card" style="padding:0; overflow:hidden;">
            <div class="lb-head">
                <span class="lb-head-t">This Week's Best</span>
                <a href="/leaderboard/" class="lb-head-a">Full Board â†’</a>
            </div>
            <div id="lb-rows"></div>
        </div>
    </div>

</div><footer class="footer">
    <p class="footer-text">Â© 2026 English For Cool Dudes ğŸ˜</p>
    <div>
        <a href="impressum/">Impressum</a>
        <a href="datenschutz/">Privacy</a>
    </div>
</footer>

<script src="/supabase-auth-gamified.js"></script>
<script src="/main-gamified.js"></script>
<script src="/coolPicks-enhanced.js"></script>

<script>
    function greet() {
        const h = new Date().getHours();
        return h < 12 ? 'Good morning' : h < 18 ? 'Good afternoon' : 'Good evening';
    }

   function renderUser(stats, user) {
    // 1. NAME FIX: Extract the first name, capitalize it, and add "Cool"
    const profile = window.EFCD_Auth.getCurrentUser();
    let rawName = profile?.name || user.user_metadata?.full_name || user.email?.split('@')[0] || 'Dude';
    let firstName = rawName.split(' ')[0]; // Grab just the first name
    firstName = firstName.charAt(0).toUpperCase() + firstName.slice(1); // Capitalize
    const finalName = `Cool ${firstName}`;

    const streak  = stats?.streak || 0;
    const xp      = stats?.xp || 0;
    const level   = stats?.level || 1;
    const lessons = stats?.lessonsCompleted || 0;
    
    // 3. BADGE FIX: Removed the "s" from achievementsCount
    const badges  = stats?.achievementCount || 0; 
    
    const xpIn    = xp % 500;
    const xpPct   = Math.min(100, Math.round((xpIn / 500) * 100));
    const xpLeft  = 500 - xpIn;
    
    // 2 & 4. URL FIX: Don't force them into the beginner course!
    let lastUrl = localStorage.getItem('efcd_last_lesson_url');
    let lastNm  = localStorage.getItem('efcd_last_lesson_name');
    let heroCtaText = "ğŸš€ Pick a Course!";
    let heroCtaLink = "#specialized-tracks"; // Anchor link down the page

    if (lastUrl && lastUrl !== 'beginner/' && lastUrl !== '/beginner/') {
        heroCtaText = `ğŸš€ Continue: ${lastNm}`;
        heroCtaLink = lastUrl;
    }

    document.getElementById('hero-card').innerHTML = `
        <div class="hero-top">
            <div>
                <div class="greet">${greet()}</div>
                <div class="uname">${finalName}</div>
            </div>
            <div class="streak-block">
                <span class="sfire">ğŸ”¥</span>
                <span class="snum">${streak}</span>
                <span class="sword">Day Streak</span>
            </div>
        </div>
        <div class="xp-wrap">
            <div class="xp-row">
                <span>Level ${level}</span>
                <span>${xpLeft} XP to Level ${level + 1}</span>
            </div>
            <div class="xp-track"><div class="xp-fill" id="xf"></div></div>
        </div>
        <a href="${heroCtaLink}" class="hero-cta">
            <span>${heroCtaText}</span>
            <span class="cta-arrow">â€º</span>
        </a>
        <div class="stat-row">
            <div class="stat-pill"><span class="sn">${lessons}</span><span class="sl">Lessons</span></div>
            <div class="stat-pill"><span class="sn">${xp.toLocaleString()}</span><span class="sl">Total XP</span></div>
            <div class="stat-pill"><span class="sn">${badges}</span><span class="sl">Badges</span></div>
        </div>`;

    requestAnimationFrame(() => setTimeout(() => {
        const f = document.getElementById('xf');
        if (f) f.style.width = xpPct + '%';
    }, 80));

    // STREAK URL FIX
    if (streak > 0) {
        const wrap = document.getElementById('sb-wrap');
        const title = document.getElementById('sb-title');
        const link  = document.getElementById('sb-link');
        if (wrap)  wrap.style.display  = 'block';
        if (title) title.textContent   = `ğŸ”¥ ${streak}-day streak â€” protect it!`;
        if (link)  link.href           = heroCtaLink; 
    }

    // 6. INJECT DAILY CHALLENGE WIDGET
    if (window.DailyChallenges) {
        const dcContainer = document.getElementById('daily-challenge-container');
        if (dcContainer) {
            dcContainer.innerHTML = window.DailyChallenges.renderDailyChallengeWidget();
        }
    }

    tryLeaderboard();
}
    function renderGuest() {
        document.getElementById('hero-card').innerHTML = `
            <div class="eyebrow">100% Free Setup</div>
            <div class="big-title">Learn English.<br><span class="yellow">Stay Cool.</span></div>
            <div class="hero-sub">Earn XP, build streaks, and unlock badges. Real lessons that are actually fun.</div>
            <div class="guest-btns">
                <a href="/signup/" class="btn-yellow">ğŸš€ Start Free</a>
                <a href="/login/"  class="btn-white">Log In</a>
            </div>`;
    }

    async function tryLeaderboard() {
        if (!window.EFCD_Auth?.getLeaderboard) return;
        try {
            const data = await window.EFCD_Auth.getLeaderboard(5);
            if (!data?.length) return;
            const me = window.EFCD_Auth.getCurrentUser();
            const em = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','4','5'];
            const rows = data.map((e, i) => {
                const you = me && e.user_id === me.id;
                // Fix missing display names on the leaderboard too
                const metaName = e.raw_user_meta_data?.full_name || e.raw_user_meta_data?.name || e.display_name || 'Cool Dude';
                return `<div class="lb-row${you?' you':''}">
                    <span class="lb-rank">${em[i]}</span>
                    <div class="lb-av">${metaName[0].toUpperCase()}</div>
                    <span class="lb-name">${metaName}${you?' <small style="color:var(--blue)">(you)</small>':''}</span>
                    <span class="lb-xp">${(e.xp||0).toLocaleString()} XP</span>
                </div>`;
            }).join('');
            document.getElementById('lb-rows').innerHTML = rows;
            document.getElementById('lb-section').style.display = 'block';
        } catch(_) {}
    }

    function init() {
        if (typeof window.efcdReady === 'undefined') {
            setTimeout(init, 50); return;
        }
        window.efcdReady.then(async () => {
            try {
                await window.EFCD_Auth.initAuth();
                const user = window.EFCD_Auth.getCurrentUser();
                if (user) {
                    renderUser(window.EFCD_Auth.getUserStats(), user);
                } else {
                    renderGuest();
                }
                if (window.EFCD_UI) {
                    window.EFCD_UI.updateHeaderUI();
                    window.EFCD_UI.showWelcomeMessage();
                }
            } catch(e) {
                console.error('Init error:', e);
                renderGuest();
            }
        }).catch(() => renderGuest());
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
</script>

</body>
</html>
