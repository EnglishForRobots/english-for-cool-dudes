<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="manifest" href="/manifest.json">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English For Cool Dudes</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; background: #F8F9FB; color: #2C3E50; line-height: 1.6; -webkit-font-smoothing: antialiased; }

        /* === 1. CLEAN MAIN HEADER === */
        .header { background: #FFFFFF; border-bottom: 1px solid #E5E9F2; padding: 20px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.04); margin-bottom: 20px; }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; }
        
        .header-left { display: flex; align-items: center; gap: 15px; }
        .logo { width: 36px; height: 36px; background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .site-title { font-size: 20px; font-weight: 600; color: #1A202C; letter-spacing: -0.02em; text-decoration: none; }

        .header-buttons { display: flex; align-items: center; gap: 8px; }
        .header-button { text-decoration: none; padding: 7px 14px; border-radius: 6px; font-size: 14px; font-weight: 600; transition: all 0.2s; white-space: nowrap; cursor: pointer; border: 1px solid #E5E9F2; background: transparent; }
        .header-button.login { background: #F8F9FB; color: #4A5568; }
        .header-button.login:hover { background: #FFFFFF; color: #2C3E50; border-color: #718096; }
        .header-button.signup { background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); color: white; border: 1px solid transparent; }
        .header-button.signup:hover { background: linear-gradient(135deg, #5A6AD0 0%, #6D4396 100%); box-shadow: 0 2px 5px rgba(102, 126, 234, 0.4); }
        .header-button.dashboard { background: #FFFBEA; color: #92400E; border-color: #FCD34D; }
        .header-button.dashboard:hover { background: #FCD34D; border-color: #F59E0B; }
        .header-button.logout { background: #F8F9FB; color: #E53E3E; }
        .header-button.logout:hover { background: #FEEBEB; color: #C53030; border-color: #FBD3DA; }
        .user-greeting { font-size: 14px; color: #4A5568; font-weight: 600; margin-right: 5px; white-space: nowrap; }

        /* === 2. INFO BOX (NOW THE PULSE TICKER) === */
        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
        
        .info-box { 
            background: linear-gradient(135deg, #FFF9E6 0%, #FFF3CD 100%); 
            border-left: 4px solid #F59E0B; 
            padding: 20px 24px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            display: flex;
            align-items: center;
            min-height: 60px; 
        }

        /* === 2.5 THE REPAIR SHOP WIDGET (NEW!) === */
        #repair-shop-widget {
            display: none; /* Hidden by default until we check for mistakes */
            background: #FFFFFF;
            border: 1px solid #E5E9F2;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 40px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        #repair-shop-widget.has-mistakes {
            background: #FEF2F2;
            border-color: #FECACA;
            border-left: 4px solid #EF4444;
        }
        
        #repair-shop-widget.all-clear {
            background: #F0FDF4;
            border-color: #BBF7D0;
            border-left: 4px solid #22C55E;
        }

        .repair-content { display: flex; align-items: center; justify-content: space-between; gap: 20px; flex-wrap: wrap; }
        .repair-text h3 { font-size: 18px; font-weight: 700; margin-bottom: 5px; }
        .repair-text p { font-size: 14px; color: #64748B; }
        
        .repair-btn {
            background: #EF4444; color: white; border: none; padding: 10px 20px;
            border-radius: 6px; font-weight: 600; cursor: pointer; text-decoration: none;
            display: inline-flex; align-items: center; gap: 8px; font-size: 14px;
            transition: transform 0.2s;
        }
        .repair-btn:hover { background: #DC2626; transform: translateY(-1px); }

        /* The animated text inside the box */
        #pulse-ticker-text { 
            font-size: 15px; 
            color: #92400E; 
            font-weight: 600; 
            margin: 0; 
            line-height: 1.6;
            transition: opacity 0.5s ease-in-out;
            width: 100%;
        }
        
        /* Link style inside the ticker */
        #pulse-ticker-text a {
            color: #78350F;
            text-decoration: underline;
            text-decoration-style: dotted;
            transition: all 0.2s;
        }
        #pulse-ticker-text a:hover {
            color: #B45309;
            background: rgba(255,255,255,0.5);
        }
        
        /* === 3. COURSE CARDS === */
        .section { margin-bottom: 50px; }
        .section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #E5E9F2; }
        .section-icon { font-size: 26px; }
        .section-title { font-size: 22px; font-weight: 600; color: #1A202C; letter-spacing: -0.02em; }
        .course-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .course-card { background: #FFFFFF; border: 1px solid #E5E9F2; border-radius: 12px; padding: 0; text-decoration: none; color: inherit; display: block; transition: all 0.2s; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
        .course-card:hover { border-color: #667EEA; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.12); transform: translateY(-2px); }
        .course-header { padding: 28px; background: linear-gradient(135deg, #F8F9FB 0%, #FFFFFF 100%); border-bottom: 1px solid #E5E9F2; }
        .course-icon { font-size: 48px; margin-bottom: 12px; display: block; }
        .course-title { font-size: 20px; font-weight: 600; color: #1A202C; margin-bottom: 8px; }
        .course-level { display: inline-block; background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); color: white; padding: 5px 14px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; }
        .course-body { padding: 28px; }
        .course-description { font-size: 15px; color: #4A5568; line-height: 1.7; margin-bottom: 18px; }
        .course-meta { display: flex; gap: 18px; font-size: 13px; color: #718096; font-weight: 600; padding-top: 18px; border-top: 1px solid #E5E9F2; }
        .meta-item { display: flex; align-items: center; gap: 5px; }

        /* QUICK LINKS */
        .quick-links { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 40px; }
        .quick-link { background: #FFFFFF; border: 1px solid #E5E9F2; border-radius: 10px; padding: 20px; text-decoration: none; color: inherit; display: flex; align-items: center; gap: 16px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
        .quick-link:hover { border-color: #667EEA; background: #F8F9FB; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.12); transform: translateY(-1px); }
        .quick-link-icon { font-size: 32px; flex-shrink: 0; }
        .quick-link-title { font-size: 15px; font-weight: 600; color: #1A202C; margin-bottom: 3px; }
        .quick-link-desc { font-size: 13px; color: #718096; }

        /* BOTTOM TICKER (COURSE UPDATES) */
        #latest-updates-ticker { position: fixed; top: 20px; right: 50%; margin-right: -580px; z-index: 1000; cursor: pointer; background: #FFC107; color: #92400E; padding: 8px 15px; border-radius: 20px; font-size: 14px; font-weight: 600; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); transition: transform 0.2s; border: 2px solid #F59E0B; animation: pulse 2s infinite ease-in-out; text-decoration: none; white-space: nowrap; max-width: 450px; text-overflow: ellipsis; overflow: hidden; display: inline-block; }
        #latest-updates-ticker:hover { background: #FFD54F; transform: scale(1.05); animation: none; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }

        /* POPUPS */
        .clickable-word { cursor: pointer; text-decoration: underline; text-decoration-style: dotted; transition: color 0.2s; }
        .clickable-word:hover { color: #667EEA; }
        #dictionary-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 10001; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }
        #dictionary-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; }

        /* FOOTER */
        .footer { background: #FFFFFF; border-top: 1px solid #E5E9F2; padding: 32px 20px; margin-top: 60px; text-align: center; }
        .footer-text { font-size: 14px; color: #718096; }

        /* RESPONSIVE */
        @media (max-width: 1240px) { #latest-updates-ticker { right: 20px; margin-right: 0; } }
        @media (max-width: 768px) { .user-greeting { display: none; } .course-grid, .quick-links { grid-template-columns: 1fr; } }
        @media (max-width: 480px) { 
            .container { padding: 20px 15px 80px 15px; }
            #latest-updates-ticker { top: auto; bottom: 0; right: 0; left: 0; margin-right: 0; border-radius: 0; width: 100%; text-align: center; border: none; border-top: 2px solid #F59E0B; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <span class="logo">üòé</span>
                <a href="/" class="site-title">English For Cool Dudes</a>
                
                <div id="logged-out-buttons" class="header-buttons" style="display: none;">
                    <a href="/login/" class="header-button login">Login</a>
                    <a href="/signup/" class="header-button signup">Sign Up</a>
                </div>

                <div id="logged-in-buttons" class="header-buttons" style="display: none;">
                    <span class="user-greeting" id="user-greeting">Hey Cool Dude! üëã</span>
                    <a href="/dashboard/" class="header-button dashboard">My Dashboard</a>
                    <button id="logout-btn" class="header-button logout">Sign Out</button>
                </div>
            </div>
        </div>
    </header>

    <div id="dictionary-overlay"></div>
    <div id="dictionary-popup">
        <div id="dictionary-content"></div>
    </div>

    <a href="/phrasals/" id="latest-updates-ticker">
        üß© NEW! INTERMEDIATE: Top 10 Phrasal Verbs For Work üòé
    </a>

    <main class="container">
        <div class="info-box">
            <p id="pulse-ticker-text">Loading Office Activity... üè¢</p>
        </div>

        <div id="repair-shop-widget">
            <div class="repair-content">
                <div class="repair-text">
                    <h3 id="repair-title">üîß The Repair Shop</h3>
                    <p id="repair-desc">Checking for vocabulary that needs fixing...</p>
                </div>
                <button id="start-repair-btn" class="repair-btn" style="display:none;">
                    üõ†Ô∏è Start Quick Repair (2 min)
                </button>
            </div>
        </div>

        <section class="section">
            <div class="section-header">
                <span class="section-icon">üíº</span>
                <h2 class="section-title">Specialized English</h2>
            </div>
            <div class="course-grid">
                <a href="/business/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üíº</span>
                        <h3 class="course-title">Business English</h3>
                        <span class="course-level">Professional</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">Master professional communication for meetings, emails, presentations, and business negotiations.</p>
                        <div class="course-meta">
                            <span class="meta-item">üìö Multiple lessons</span>
                            <span class="meta-item">‚è±Ô∏è Self-paced</span>
                        </div>
                    </div>
                </a>
                <a href="/tax/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üí∞</span>
                        <h3 class="course-title">Tax English</h3>
                        <span class="course-level">Specialist</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">Learn tax terminology, concepts, and documentation language for accounting professionals.</p>
                        <div class="course-meta">
                            <span class="meta-item">üìö Multiple lessons</span>
                            <span class="meta-item">‚è±Ô∏è Self-paced</span>
                        </div>
                    </div>
                </a>
                <a href="/legal/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">‚öñÔ∏è</span>
                        <h3 class="course-title">Legal English</h3>
                        <span class="course-level">Specialist</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">Navigate legal terminology, contracts, and documentation with confidence and precision.</p>
                        <div class="course-meta">
                            <span class="meta-item">üìö Multiple lessons</span>
                            <span class="meta-item">‚è±Ô∏è Self-paced</span>
                        </div>
                    </div>
                </a>
            </div>
        </section>

        <section class="section">
            <div class="section-header">
                <span class="section-icon">üìñ</span>
                <h2 class="section-title">General English Courses</h2>
            </div>
            <div class="course-grid">
                <a href="/beginner/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üå±</span>
                        <h3 class="course-title">Beginner Course</h3>
                        <span class="course-level">A1-A2</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">Start your English journey. Learn basic grammar, vocabulary, and everyday conversation skills.</p>
                        <div class="course-meta">
                            <span class="meta-item">üìö Foundation level</span>
                            <span class="meta-item">‚è±Ô∏è Step by step</span>
                        </div>
                    </div>
                </a>
                <a href="/intermediate/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üöÄ</span>
                        <h3 class="course-title">Intermediate Course</h3>
                        <span class="course-level">B1-B2</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">Build confidence with complex grammar and expand your vocabulary for real-world situations.</p>
                        <div class="course-meta">
                            <span class="meta-item">üìö Expanding skills</span>
                            <span class="meta-item">‚è±Ô∏è Progressive</span>
                        </div>
                    </div>
                </a>
                <a href="/advanced/" class="course-card">
                    <div class="course-header">
                        <span class="course-icon">üéØ</span>
                        <h3 class="course-title">Advanced Course</h3>
                        <span class="course-level">C1-C2</span>
                    </div>
                    <div class="course-body">
                        <p class="course-description">Master sophisticated expressions, idioms, and achieve native-like fluency in British English.</p>
                        <div class="course-meta">
                            <span class="meta-item">üìö Mastery level</span>
                            <span class="meta-item">‚è±Ô∏è Advanced</span>
                        </div>
                    </div>
                </a>
            </div>
        </section>

        <section class="section">
            <div class="section-header">
                <span class="section-icon">‚òï</span>
                <h2 class="section-title">The Break Room</h2>
            </div>
            <div class="quick-links">
                <a href="/games/" class="quick-link">
                    <span class="quick-link-icon">üéÆ</span>
                    <div class="quick-link-text">
                        <div class="quick-link-title">Game Zone</div>
                        <div class="quick-link-desc">Play Taboo, Memory Match & More</div>
                    </div>
                </a>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p class="footer-text">¬© 2025 English For Cool Dudes - üòé</p>
        <div style="margin-top: 10px;">
            <a href="/impressum/" style="color: #667EEA; margin-right: 15px; text-decoration: none;">Impressum</a>
            <a href="/datenschutz/" style="color: #667EEA; text-decoration: none;">Datenschutzerkl√§rung</a>
        </div>
    </footer>

<script>
    const SUPABASE_URL = 'https://knwgmrgwbpchqyqxbxea.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtud2dtcmd3YnBjaHF5cXhieGVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MDkyODgsImV4cCI6MjA3ODA4NTI4OH0.qnp2ScwSE77_idmPhpLE98sr46WvLpKtg6refFfC7s8';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // --- 1. DICTIONARY FUNCTIONS ---
    function showDictionary(word, definition, type) {
        document.getElementById('dictionary-popup').style.display = 'block';
        document.getElementById('dictionary-overlay').style.display = 'block';
        const content = document.getElementById('dictionary-content');
        content.innerHTML = `
            <h3 style="color: #667EEA; font-size: 20px; margin-bottom: 10px; font-weight: 600;">${word} <span style="font-size: 14px; color: #718096; font-weight: 600;">(${type})</span></h3>
            <p style="color: #4A5568; line-height: 1.7; margin-bottom: 20px;">${definition}</p>
            <button onclick="closeDictionary()" style="background: #E5E9F2; color: #4A5568; border: none; padding: 10px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px; margin-top: 20px; ">Close</button>
        `;
    }

    function closeDictionary() {
        document.getElementById('dictionary-popup').style.display = 'none';
        document.getElementById('dictionary-overlay').style.display = 'none';
    }
    document.getElementById('dictionary-overlay').addEventListener('click', closeDictionary);

    // --- 2. THE "BRAIN BOOST" ALGORITHM (Spaced Repetition) ---
    async function checkForMistakesOnHomepage() {
        try {
            const { data: { user } = {} } = await supabase.auth.getUser();
            if (!user) {
                document.getElementById('repair-shop-widget').style.display = 'none';
                return;
            }

            // 1. Define "Spaced Repetition" Timeframe (Lessons completed > 24 hours ago)
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const isoYesterday = yesterday.toISOString();

            // 2. Fetch Mistakes (Priority A)
            const { data: mistakes } = await supabase
                .from('user_mistakes')
                .select('word, definition, word_type, lesson, lesson_link')
                .eq('user_id', user.id)
                .limit(5);

            let practiceBatch = mistakes || [];

            // 3. Fetch Spaced Review Words (Priority B) - Only if we have space left
            if (practiceBatch.length < 5) {
                const slotsNeeded = 5 - practiceBatch.length;
                
                // Fetch lessons completed BEFORE yesterday
                const { data: oldLessons } = await supabase
                    .from('lessons')
                    .select('vocabulary')
                    .eq('user_id', user.id)
                    .lt('completed_at', isoYesterday) 
                    .limit(5); // Grab a few recent "old" lessons

                if (oldLessons && oldLessons.length > 0) {
                    let poolOfKnownWords = [];
                    
                    // Extract words
                    oldLessons.forEach(lesson => {
                        if(Array.isArray(lesson.vocabulary)) {
                            lesson.vocabulary.forEach(v => {
                                // Don't add if it's already in the mistake list
                                const isAlreadyInBatch = practiceBatch.some(pb => pb.word === v.word);
                                if (!isAlreadyInBatch) poolOfKnownWords.push(v);
                            });
                        }
                    });

                    // Shuffle and slice
                    poolOfKnownWords = poolOfKnownWords.sort(() => 0.5 - Math.random()).slice(0, slotsNeeded);
                    
                    // Add to batch
                    poolOfKnownWords.forEach(w => {
                        practiceBatch.push({
                            word: w.word,
                            definition: w.definition,
                            word_type: w.type || 'word',
                            lesson: 'Review',
                            is_review: true // Logic: Don't delete this from mistakes table
                        });
                    });
                }
            }

            // 4. Render Widget
            const widget = document.getElementById('repair-shop-widget');
            const title = document.getElementById('repair-title');
            const desc = document.getElementById('repair-desc');
            const btn = document.getElementById('start-repair-btn');

            if (practiceBatch.length > 0) {
                widget.style.display = 'block';
                // Positive Blue Styling
                widget.style.background = '#F0F9FF'; 
                widget.style.borderColor = '#BAE6FD';
                widget.style.borderLeft = '4px solid #0EA5E9'; 

                title.innerHTML = `üöÄ Daily Brain Boost`;
                title.style.color = '#0369A1';
                
                const mistakeCount = practiceBatch.filter(x => !x.is_review).length;
                const reviewCount = practiceBatch.filter(x => x.is_review).length;
                
                desc.innerHTML = `Strengthen your memory:<br>
                                  <span style="font-size:12px; color:#64748B;">
                                  (üéØ ${mistakeCount} Focus Words + üß† ${reviewCount} Spaced Reviews)
                                  </span>`;
                
                btn.style.display = 'inline-flex';
                btn.innerHTML = "‚ö° Boost My English (2 min)";
                btn.style.background = '#0EA5E9'; 
                
                btn.onclick = () => startPractice(practiceBatch);
            } else {
                widget.style.display = 'none';
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }

    // --- 3. PRACTICE GAME LOGIC ---
    function startPractice(batch) {
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateGapSentence(word, definition) {
            // === THE MASTER SENTENCE BANK ===
            // This is the lookup table to convert DB words into Context Sentences
            const sentencePatterns = {
                'redistribution': [`The government supports wealth <span class="practice-gap" data-answer="${word}">____</span> to help the poor.`, `Critics argue that excessive <span class="practice-gap" data-answer="${word}">____</span> discourages hard work.`],
                'liquidity': [`The company has a serious <span class="practice-gap" data-answer="${word}">____</span> problem; they have assets but no cash.`, `Real estate usually has lower <span class="practice-gap" data-answer="${word}">____</span> than stocks.`],
                'assets': [`The wealthy often hide their <span class="practice-gap" data-answer="${word}">____</span> in offshore accounts.`, `Her total <span class="practice-gap" data-answer="${word}">____</span> include three houses.`],
                'inequality': [`The wealth tax aims to reduce social <span class="practice-gap" data-answer="${word}">____</span>.`, `Economic <span class="practice-gap" data-answer="${word}">____</span> has grown significantly.`],
                'capital flight': [`High taxes can trigger massive <span class="practice-gap" data-answer="${word}">____</span>.`, `France experienced <span class="practice-gap" data-answer="${word}">____</span> when millionaires moved.`],
                'suspended': [`The wealth tax was <span class="practice-gap" data-answer="${word}">____</span> in 1997.`, `Trading was <span class="practice-gap" data-answer="${word}">____</span> for an hour today.`],
                'revenue': [`The state needs more tax <span class="practice-gap" data-answer="${word}">____</span>.`, `Corporate <span class="practice-gap" data-answer="${word}">____</span> fell by 10% this quarter.`],
                'unfair': [`Many business owners feel the valuation method is <span class="practice-gap" data-answer="${word}">____</span>.`, `It is <span class="practice-gap" data-answer="${word}">____</span> to tax money twice.`],
                'ecosystem': [`Alibaba combines Amazon and Google into one digital <span class="practice-gap" data-answer="${word}">____</span>.`, `Apple has created a closed <span class="practice-gap" data-answer="${word}">____</span>.`],
                'monopolistic': [`The company was fined for <span class="practice-gap" data-answer="${word}">____</span> practices.`, `Regulators prevent <span class="practice-gap" data-answer="${word}">____</span> control.`],
                'antitrust': [`Authorities launched an <span class="practice-gap" data-answer="${word}">____</span> investigation.`, `Standard Oil was broken up due to <span class="practice-gap" data-answer="${word}">____</span> laws.`],
                'ipo': [`In 2014, Alibaba held a massive <span class="practice-gap" data-answer="${word}">____</span> on the NYSE.`, `The startup is preparing for its <span class="practice-gap" data-answer="${word}">____</span>.`],
                'intensifying': [`Competition from TikTok is <span class="practice-gap" data-answer="${word}">____</span> rapidly.`, `The pressure is <span class="practice-gap" data-answer="${word}">____</span>.`],
                'dividends': [`Investing in Cloud has paid real <span class="practice-gap" data-answer="${word}">____</span>.`, `Shareholders received their quarterly <span class="practice-gap" data-answer="${word}">____</span>.`],
                'restructure': [`They decided to <span class="practice-gap" data-answer="${word}">____</span> the business.`, `We need to <span class="practice-gap" data-answer="${word}">____</span> the department.`],
                'weighed': [`The units can run fast without being <span class="practice-gap" data-answer="${word}">____</span> down.`, `He felt <span class="practice-gap" data-answer="${word}">____</span> down by the workload.`],
                'elevator pitch': [`You have 30 seconds; give me your <span class="practice-gap" data-answer="${word}">____</span>.`, `A good <span class="practice-gap" data-answer="${word}">____</span> explains the solution quickly.`],
                'value proposition': [`Our <span class="practice-gap" data-answer="${word}">____</span> is that we save customers time.`, `Explain your <span class="practice-gap" data-answer="${word}">____</span> to investors.`],
                'hook': [`Start with a strong <span class="practice-gap" data-answer="${word}">____</span> to grab attention.`, `His <span class="practice-gap" data-answer="${word}">____</span> was a shocking statistic.`],
                'concise': [`Be <span class="practice-gap" data-answer="${word}">____</span>; investors don't have time.`, `The report was clear and <span class="practice-gap" data-answer="${word}">____</span>.`],
                'persuasive': [`She is very <span class="practice-gap" data-answer="${word}">____</span> and can sell anything.`, `You need a <span class="practice-gap" data-answer="${word}">____</span> argument.`],
                'usp': [`Our <span class="practice-gap" data-answer="${word}">____</span> is that we are 50% cheaper.`, `What is your <span class="practice-gap" data-answer="${word}">____</span>?`],
                'investors': [`We are presenting to <span class="practice-gap" data-answer="${word}">____</span> next week.`, `Angel <span class="practice-gap" data-answer="${word}">____</span> provide capital.`],
                'scalable': [`Is your business model <span class="practice-gap" data-answer="${word}">____</span> globally?`, `Software is more <span class="practice-gap" data-answer="${word}">____</span> than services.`],
                'traction': [`We have gained significant <span class="practice-gap" data-answer="${word}">____</span> with 5,000 users.`, `The product is failing to get <span class="practice-gap" data-answer="${word}">____</span>.`],
                'funding': [`They raised $1 million in seed <span class="practice-gap" data-answer="${word}">____</span>.`, `Without <span class="practice-gap" data-answer="${word}">____</span>, we cannot expand.`],
                'target audience': [`Who is your <span class="practice-gap" data-answer="${word}">____</span>?`, `Understanding your <span class="practice-gap" data-answer="${word}">____</span> is key.`],
                'call to action': [`Don't forget the <span class="practice-gap" data-answer="${word}">____</span> in your email.`, `A "Sign Up" button is a <span class="practice-gap" data-answer="${word}">____</span>.`],
                'pitch deck': [`Send me your <span class="practice-gap" data-answer="${word}">____</span>.`, `A standard <span class="practice-gap" data-answer="${word}">____</span> has 10 slides.`],
                'chip butty': [`He ate a <span class="practice-gap" data-answer="${word}">____</span> for lunch.`, `A <span class="practice-gap" data-answer="${word}">____</span> is a fry sandwich.`],
                'bangers': [`We had <span class="practice-gap" data-answer="${word}">____</span> and mash.`, `The butcher sells pork <span class="practice-gap" data-answer="${word}">____</span>.`],
                'mash': [`I like <span class="practice-gap" data-answer="${word}">____</span> with butter.`, `Sausage and <span class="practice-gap" data-answer="${word}">____</span> is classic.`],
                'cuppa': [`Have a nice hot <span class="practice-gap" data-answer="${word}">____</span>.`, `I need a <span class="practice-gap" data-answer="${word}">____</span> in the morning.`],
                'biscuit': [`He dipped his <span class="practice-gap" data-answer="${word}">____</span> in tea.`, `Want a chocolate <span class="practice-gap" data-answer="${word}">____</span>?`],
                'gravy': [`Pour hot <span class="practice-gap" data-answer="${word}">____</span> over the beef.`, `Swimming in <span class="practice-gap" data-answer="${word}">____</span>.`],
                'pudding': [`What's for <span class="practice-gap" data-answer="${word}">____</span>?`, `Yorkshire <span class="practice-gap" data-answer="${word}">____</span> is savory.`],
                'full english': [`We ate a <span class="practice-gap" data-answer="${word}">____</span> breakfast.`, `A <span class="practice-gap" data-answer="${word}">____</span> has beans and toast.`],
                'roast': [`Sunday <span class="practice-gap" data-answer="${word}">____</span> dinner.`, `The <span class="practice-gap" data-answer="${word}">____</span> chicken was good.`],
                'yorkshire pudding': [`The <span class="practice-gap" data-answer="${word}">____</span> rises in the oven.`, `Serve <span class="practice-gap" data-answer="${word}">____</span> with beef.`],
                'longevity': [`The <span class="practice-gap" data-answer="${word}">____</span> of the tortoise is amazing.`, `Diet affects <span class="practice-gap" data-answer="${word}">____</span>.`],
                'resides': [`The President <span class="practice-gap" data-answer="${word}">____</span> in the White House.`, `Jonathan <span class="practice-gap" data-answer="${word}">____</span> on the island.`],
                'documented': [`His age is well <span class="practice-gap" data-answer="${word}">____</span>.`, `We have <span class="practice-gap" data-answer="${word}">____</span> the process.`],
                'hatched': [`The bird <span class="practice-gap" data-answer="${word}">____</span> yesterday.`, `He <span class="practice-gap" data-answer="${word}">____</span> in 1832.`],
                'veterinarian': [`Take the dog to a <span class="practice-gap" data-answer="${word}">____</span>.`, `The <span class="practice-gap" data-answer="${word}">____</span> checks his health.`],
                'cataracts': [`Older animals develop <span class="practice-gap" data-answer="${word}">____</span>.`, `Blindness caused by <span class="practice-gap" data-answer="${word}">____</span>.`],
                'senses': [`Dogs have strong <span class="practice-gap" data-answer="${word}">____</span> of smell.`, `His <span class="practice-gap" data-answer="${word}">____</span> declined.`],
                'iconic': [`The Eiffel Tower is <span class="practice-gap" data-answer="${word}">____</span>.`, `Jonathan is <span class="practice-gap" data-answer="${word}">____</span>.`],
                'governor': [`The <span class="practice-gap" data-answer="${word}">____</span> lives here.`, `She was elected <span class="practice-gap" data-answer="${word}">____</span>.`],
                'status': [`High social <span class="practice-gap" data-answer="${word}">____</span>.`, `His <span class="practice-gap" data-answer="${word}">____</span> is confirmed.`],
                'celebrity': [`He is a local <span class="practice-gap" data-answer="${word}">____</span>.`, `Meet the famous <span class="practice-gap" data-answer="${word}">____</span>.`],
                'verify': [`Please <span class="practice-gap" data-answer="${word}">____</span> your email.`, `Photos <span class="practice-gap" data-answer="${word}">____</span> his age.`],
                'catch up': [`I need to <span class="practice-gap" data-answer="${word}">____</span> on emails.`, `I will <span class="practice-gap" data-answer="${word}">____</span> with you later.`],
                'put off': [`Don't <span class="practice-gap" data-answer="${word}">____</span> your work.`, `We had to <span class="practice-gap" data-answer="${word}">____</span> the meeting.`],
                'call off': [`They had to <span class="practice-gap" data-answer="${word}">____</span> the concert.`, `Decided to <span class="practice-gap" data-answer="${word}">____</span> the strike.`],
                'look into': [`I will <span class="practice-gap" data-answer="${word}">____</span> that error.`, `Please <span class="practice-gap" data-answer="${word}">____</span> suppliers.`],
                'run out of': [`We have <span class="practice-gap" data-answer="${word}">____</span> milk.`, `If we <span class="practice-gap" data-answer="${word}">____</span> time.`],
                'set up': [`<span class="practice-gap" data-answer="${word}">____</span> the Wi-Fi.`, `Can you <span class="practice-gap" data-answer="${word}">____</span> a meeting?`],
                'fill in': [`Can you <span class="practice-gap" data-answer="${word}">____</span> for him?`, `Please <span class="practice-gap" data-answer="${word}">____</span> the form.`],
                'get along': [`I <span class="practice-gap" data-answer="${word}">____</span> well with her.`, `Important to <span class="practice-gap" data-answer="${word}">____</span> with colleagues.`],
                'turn down': [`I had to <span class="practice-gap" data-answer="${word}">____</span> the job.`, `Please <span class="practice-gap" data-answer="${word}">____</span> the music.`],
                'burn out': [`You will <span class="practice-gap" data-answer="${word}">____</span> if you work too hard.`, `Avoid suffering from <span class="practice-gap" data-answer="${word}">____</span>.`],
                'tortoise': [`Jonathan is a <span class="practice-gap" data-answer="${word}">____</span>.`, `A <span class="practice-gap" data-answer="${word}">____</span> moves slowly.`],
                'island': [`St Helena is an <span class="practice-gap" data-answer="${word}">____</span>.`, `Desert <span class="practice-gap" data-answer="${word}">____</span>.`],
                'shell': [`Hard <span class="practice-gap" data-answer="${word}">____</span> protects body.`, `Sea <span class="practice-gap" data-answer="${word}">____</span>.`],
                'born': [`He was <span class="practice-gap" data-answer="${word}">____</span> in 1832.`, `She was <span class="practice-gap" data-answer="${word}">____</span> in London.`],
                'slow': [`Tortoises are <span class="practice-gap" data-answer="${word}">____</span>.`, `Drive <span class="practice-gap" data-answer="${word}">____</span>.`],
                'history': [`He lived through <span class="practice-gap" data-answer="${word}">____</span>.`, `Studying <span class="practice-gap" data-answer="${word}">____</span>.`],
                'famous': [`He is <span class="practice-gap" data-answer="${word}">____</span>.`, `A <span class="practice-gap" data-answer="${word}">____</span> actor.`],
                'healthy': [`He eats <span class="practice-gap" data-answer="${word}">____</span> food.`, `Keeping <span class="practice-gap" data-answer="${word}">____</span>.`],
                'grass': [`He eats <span class="practice-gap" data-answer="${word}">____</span>.`, `Keep off the <span class="practice-gap" data-answer="${word}">____</span>.`],
                'sleep': [`He likes to <span class="practice-gap" data-answer="${word}">____</span> in sun.`, `Get enough <span class="practice-gap" data-answer="${word}">____</span>.`],
                'visitor': [`A <span class="practice-gap" data-answer="${word}">____</span> came to see him.`, `Sign in as a <span class="practice-gap" data-answer="${word}">____</span>.`],
                'record': [`World <span class="practice-gap" data-answer="${word}">____</span> holder.`, `Broke the <span class="practice-gap" data-answer="${word}">____</span>.`],
                'budget': [`Stick to the <span class="practice-gap" data-answer="${word}">____</span>.`, `Over <span class="practice-gap" data-answer="${word}">____</span>.`],
                'expense': [`Travel <span class="practice-gap" data-answer="${word}">____</span>.`, `Filed an <span class="practice-gap" data-answer="${word}">____</span> report.`],
                'profit': [`Made a huge <span class="practice-gap" data-answer="${word}">____</span>.`, `Sold at a <span class="practice-gap" data-answer="${word}">____</span>.`],
                'tax': [`Income <span class="practice-gap" data-answer="${word}">____</span>.`, `Sales <span class="practice-gap" data-answer="${word}">____</span>.`],
                'deposit': [`<span class="practice-gap" data-answer="${word}">____</span> this check.`, `Security <span class="practice-gap" data-answer="${word}">____</span>.`],
                'withdraw': [`<span class="practice-gap" data-answer="${word}">____</span> cash.`, `Cannot <span class="practice-gap" data-answer="${word}">____</span> more.`],
                'salary': [`Monthly <span class="practice-gap" data-answer="${word}">____</span>.`, `Higher <span class="practice-gap" data-answer="${word}">____</span>.`],
                'transfer': [`<span class="practice-gap" data-answer="${word}">____</span> money.`, `Bank <span class="practice-gap" data-answer="${word}">____</span>.`],
                'interest': [`Pays 2% <span class="practice-gap" data-answer="${word}">____</span>.`, `High <span class="practice-gap" data-answer="${word}">____</span> rates.`],
                'loan': [`Bank <span class="practice-gap" data-answer="${word}">____</span>.`, `Student <span class="practice-gap" data-answer="${word}">____</span>.`],
                'account': [`Savings <span class="practice-gap" data-answer="${word}">____</span>.`, `Bank <span class="practice-gap" data-answer="${word}">____</span>.`],
                'balance': [`Bank <span class="practice-gap" data-answer="${word}">____</span> is zero.`, `Check your <span class="practice-gap" data-answer="${word}">____</span>.`],
                'conspirators': [`The <span class="practice-gap" data-answer="${word}">____</span> met in secret.`, `Arrested the <span class="practice-gap" data-answer="${word}">____</span>.`],
                'effigies': [`Burn <span class="practice-gap" data-answer="${word}">____</span>.`, `<span class="practice-gap" data-answer="${word}">____</span> displayed.`],
                'commemorates': [`Holiday <span class="practice-gap" data-answer="${word}">____</span> event.`, `Ceremony <span class="practice-gap" data-answer="${word}">____</span> heroes.`],
                'assembled': [`Team <span class="practice-gap" data-answer="${word}">____</span>.`, `He <span class="practice-gap" data-answer="${word}">____</span> a group.`],
                'uncovered': [`Investigators <span class="practice-gap" data-answer="${word}">____</span> evidence.`, `Journalist <span class="practice-gap" data-answer="${word}">____</span> scandal.`],
                'shed': [`Country <span class="practice-gap" data-answer="${word}">____</span> its past.`, `<span class="practice-gap" data-answer="${word}">____</span> reputation.`],
                'charismatic': [`<span class="practice-gap" data-answer="${word}">____</span> leader.`, `<span class="practice-gap" data-answer="${word}">____</span> personality.`],
                'treason': [`Executed for <span class="practice-gap" data-answer="${word}">____</span>.`, `Considered <span class="practice-gap" data-answer="${word}">____</span>.`],
                'persecution': [`Religious <span class="practice-gap" data-answer="${word}">____</span>.`, `<span class="practice-gap" data-answer="${word}">____</span> of minorities.`],
                'gunpowder': [`Barrels of <span class="practice-gap" data-answer="${word}">____</span>.`, `Stored <span class="practice-gap" data-answer="${word}">____</span>.`],
                'radicalization': [`<span class="practice-gap" data-answer="${word}">____</span> of youth.`, `His <span class="practice-gap" data-answer="${word}">____</span> happened gradually.`],
                'vestige': [`Last <span class="practice-gap" data-answer="${word}">____</span> of castle.`, `Only a <span class="practice-gap" data-answer="${word}">____</span> remains.`],
                'pageantry': [`Royal <span class="practice-gap" data-answer="${word}">____</span>.`, `British <span class="practice-gap" data-answer="${word}">____</span>.`],
                'audit': [`Check records with an <span class="practice-gap" data-answer="${word}">____</span>.`, `External <span class="practice-gap" data-answer="${word}">____</span>.`],
                'financial statements': [`Prepare <span class="practice-gap" data-answer="${word}">____</span>.`, `Review <span class="practice-gap" data-answer="${word}">____</span>.`],
                'annual report': [`Summarizes performance in <span class="practice-gap" data-answer="${word}">____</span>.`, `Published <span class="practice-gap" data-answer="${word}">____</span>.`],
                'scrutiny': [`Under intense <span class="practice-gap" data-answer="${word}">____</span>.`, `Careful <span class="practice-gap" data-answer="${word}">____</span>.`],
                'settled': [`Liabilities <span class="practice-gap" data-answer="${word}">____</span>.`, `Dispute <span class="practice-gap" data-answer="${word}">____</span>.`],
                'verify': [`<span class="practice-gap" data-answer="${word}">____</span> the source.`, `<span class="practice-gap" data-answer="${word}">____</span> the number.`],
                'paramount': [`Security is <span class="practice-gap" data-answer="${word}">____</span>.`, `Of <span class="practice-gap" data-answer="${word}">____</span> importance.`],
                'review': [`Board will <span class="practice-gap" data-answer="${word}">____</span> earnings.`, `Internal <span class="practice-gap" data-answer="${word}">____</span>.`],
                'discrepancies': [`Found <span class="practice-gap" data-answer="${word}">____</span> in ledgers.`, `Explain the <span class="practice-gap" data-answer="${word}">____</span>.`],
                'inventories': [`Valuation of <span class="practice-gap" data-answer="${word}">____</span>.`, `Warehouse <span class="practice-gap" data-answer="${word}">____</span>.`],
                'remote audits': [`<span class="practice-gap" data-answer="${word}">____</span> are common.`, `Prefer <span class="practice-gap" data-answer="${word}">____</span>.`],
                'prevalent': [`Issue is <span class="practice-gap" data-answer="${word}">____</span>.`, `Most <span class="practice-gap" data-answer="${word}">____</span> method.`],
                'ledgers': [`General <span class="practice-gap" data-answer="${word}">____</span>.`, `Electronic <span class="practice-gap" data-answer="${word}">____</span>.`],
                'onus': [`The <span class="practice-gap" data-answer="${word}">____</span> is on taxpayer.`, `Legal <span class="practice-gap" data-answer="${word}">____</span>.`],
                'accessible': [`Readily <span class="practice-gap" data-answer="${word}">____</span>.`, `Data more <span class="practice-gap" data-answer="${word}">____</span>.`],
                'opinion': [`Audit <span class="practice-gap" data-answer="${word}">____</span>.`, `Qualified <span class="practice-gap" data-answer="${word}">____</span>.`],
                'unqualified opinion': [`<span class="practice-gap" data-answer="${word}">____</span> means fair.`, `Best result is <span class="practice-gap" data-answer="${word}">____</span>.`],
                'qualified opinion': [`<span class="practice-gap" data-answer="${word}">____</span> implies misstatements.`, `<span class="practice-gap" data-answer="${word}">____</span> led to adjustment.`],
                'implications': [`Understand <span class="practice-gap" data-answer="${word}">____</span>.`, `Political <span class="practice-gap" data-answer="${word}">____</span>.`],
                'cream of the crop': [`Only the <span class="practice-gap" data-answer="${word}">____</span> invited.`, `Selected the <span class="practice-gap" data-answer="${word}">____</span>.`],
                'take the biscuit': [`His excuse <span class="practice-gap" data-answer="${word}">____</span>.`, `That joke <span class="practice-gap" data-answer="${word}">____</span>.`],
                'spill the beans': [`Don't <span class="practice-gap" data-answer="${word}">____</span>.`, `He <span class="practice-gap" data-answer="${word}">____</span> about product.`],
                'not my cup of tea': [`Art is <span class="practice-gap" data-answer="${word}">____</span>.`, `Football is <span class="practice-gap" data-answer="${word}">____</span>.`],
                'bring home the bacon': [`Man <span class="practice-gap" data-answer="${word}">____</span>.`, `Works to <span class="practice-gap" data-answer="${word}">____</span>.`],
                'monetary stability': [`Maintain <span class="practice-gap" data-answer="${word}">____</span>.`, `Ensure <span class="practice-gap" data-answer="${word}">____</span>.`],
                'inflation': [`High <span class="practice-gap" data-answer="${word}">____</span>.`, `Control <span class="practice-gap" data-answer="${word}">____</span>.`],
                'confidence': [`Public <span class="practice-gap" data-answer="${word}">____</span>.`, `Need <span class="practice-gap" data-answer="${word}">____</span>.`],
                'banknotes': [`Print <span class="practice-gap" data-answer="${word}">____</span>.`, `Issue <span class="practice-gap" data-answer="${word}">____</span>.`],
                'vault': [`Underground <span class="practice-gap" data-answer="${word}">____</span>.`, `Bank <span class="practice-gap" data-answer="${word}">____</span>.`],
                'governor': [`The <span class="practice-gap" data-answer="${word}">____</span> is ranking official.`, `<span class="practice-gap" data-answer="${word}">____</span> leads committee.`],
                'regulation': [`Banking <span class="practice-gap" data-answer="${word}">____</span>.`, `Strict <span class="practice-gap" data-answer="${word}">____</span>.`],
                'stimulate': [`<span class="practice-gap" data-answer="${word}">____</span> economy.`, `<span class="practice-gap" data-answer="${word}">____</span> borrowing.`],
                'crucial': [`Trust is <span class="practice-gap" data-answer="${word}">____</span>.`, `It is <span class="practice-gap" data-answer="${word}">____</span>.`],
                'adapt': [`<span class="practice-gap" data-answer="${word}">____</span> to regulation.`, `<span class="practice-gap" data-answer="${word}">____</span> strategy.`],
                'set': [`<span class="practice-gap" data-answer="${word}">____</span> interest rate.`, `<span class="practice-gap" data-answer="${word}">____</span> framework.`],
                'central': [`<span class="practice-gap" data-answer="${word}">____</span> bank.`, `<span class="practice-gap" data-answer="${word}">____</span> theme.`],
                'candy': [`Collected <span class="practice-gap" data-answer="${word}">____</span>.`, `Want <span class="practice-gap" data-answer="${word}">____</span>?`],
                'door': [`Open <span class="practice-gap" data-answer="${word}">____</span>.`, `Knock on <span class="practice-gap" data-answer="${word}">____</span>.`],
                'bag': [`Put in <span class="practice-gap" data-answer="${word}">____</span>.`, `Carry a <span class="practice-gap" data-answer="${word}">____</span>.`],
                'costume': [`Ghost <span class="practice-gap" data-answer="${word}">____</span>.`, `Wear a <span class="practice-gap" data-answer="${word}">____</span>.`],
                'trick or treat': [`Shout <span class="practice-gap" data-answer="${word}">____</span>.`, `Say <span class="practice-gap" data-answer="${word}">____</span>.`],
                'vat': [`Rate of <span class="practice-gap" data-answer="${word}">____</span>.`, `Import <span class="practice-gap" data-answer="${word}">____</span>.`],
                'digital services': [`Streaming is <span class="practice-gap" data-answer="${word}">____</span>.`, `Tax <span class="practice-gap" data-answer="${word}">____</span>.`],
                'place of supply': [`<span class="practice-gap" data-answer="${word}">____</span> rules.`, `<span class="practice-gap" data-answer="${word}">____</span> is where customer lives.`],
                'jurisdiction': [`Legal <span class="practice-gap" data-answer="${word}">____</span>.`, `Which <span class="practice-gap" data-answer="${word}">____</span>?`],
                'reverse charge mechanism': [`<span class="practice-gap" data-answer="${word}">____</span> shifts responsibility.`, `Use <span class="practice-gap" data-answer="${word}">____</span>.`],
                'b2b': [`<span class="practice-gap" data-answer="${word}">____</span> transactions.`, `<span class="practice-gap" data-answer="${word}">____</span> marketing.`],
                'b2c': [`<span class="practice-gap" data-answer="${word}">____</span> sales.`, `<span class="practice-gap" data-answer="${word}">____</span> transaction.`],
                'remittance': [`Send <span class="practice-gap" data-answer="${word}">____</span>.`, `Money <span class="practice-gap" data-answer="${word}">____</span>.`],
                'compliance': [`Full <span class="practice-gap" data-answer="${word}">____</span>.`, `Maintain <span class="practice-gap" data-answer="${word}">____</span>.`],
                'threshold': [`Sales <span class="practice-gap" data-answer="${word}">____</span>.`, `Tax-free <span class="practice-gap" data-answer="${word}">____</span>.`],
                'intangibles': [`Software is <span class="practice-gap" data-answer="${word}">____</span>.`, `Taxed as <span class="practice-gap" data-answer="${word}">____</span>.`],
                'exempt': [`Food is <span class="practice-gap" data-answer="${word}">____</span>.`, `Charities <span class="practice-gap" data-answer="${word}">____</span>.`],
                'liable': [`<span class="practice-gap" data-answer="${word}">____</span> for damages.`, `Personally <span class="practice-gap" data-answer="${word}">____</span>.`],
                'mechanism': [`New <span class="practice-gap" data-answer="${word}">____</span>.`, `Useful <span class="practice-gap" data-answer="${word}">____</span>.`],
                'impounded': [`Car <span class="practice-gap" data-answer="${word}">____</span>.`, `Police <span class="practice-gap" data-answer="${word}">____</span> vehicle.`],
                'duped': [`People <span class="practice-gap" data-answer="${word}">____</span>.`, `Scammers <span class="practice-gap" data-answer="${word}">____</span> her.`],
                'phishing': [`<span class="practice-gap" data-answer="${word}">____</span> attempt.`, `<span class="practice-gap" data-answer="${word}">____</span> scams.`],
                'red flags': [`Raised <span class="practice-gap" data-answer="${word}">____</span>.`, `Several <span class="practice-gap" data-answer="${word}">____</span>.`],
                'authorization': [`Enter <span class="practice-gap" data-answer="${word}">____</span> code.`, `2-factor <span class="practice-gap" data-answer="${word}">____</span>.`],
                'transmit': [`<span class="practice-gap" data-answer="${word}">____</span> signal.`, `<span class="practice-gap" data-answer="${word}">____</span> data.`],
                'legitimate': [`Website looked <span class="practice-gap" data-answer="${word}">____</span>.`, `<span class="practice-gap" data-answer="${word}">____</span> reason.`],
                'authenticated': [`User <span class="practice-gap" data-answer="${word}">____</span>.`, `Card <span class="practice-gap" data-answer="${word}">____</span>.`],
                'proof of concept': [`Built a <span class="practice-gap" data-answer="${word}">____</span>.`, `Need a <span class="practice-gap" data-answer="${word}">____</span>.`],
                'tokenized': [`Number is <span class="practice-gap" data-answer="${word}">____</span>.`, `Stores <span class="practice-gap" data-answer="${word}">____</span> values.`],
                'illicit': [`<span class="practice-gap" data-answer="${word}">____</span> activities.`, `<span class="practice-gap" data-answer="${word}">____</span> trade.`],
                'tradition': [`Christmas <span class="practice-gap" data-answer="${word}">____</span>.`, `Family <span class="practice-gap" data-answer="${word}">____</span>.`],
                'advent calendar': [`Open the <span class="practice-gap" data-answer="${word}">____</span>.`, `Chocolate <span class="practice-gap" data-answer="${word}">____</span>.`],
                'chocolate': [`Sweet <span class="practice-gap" data-answer="${word}">____</span>.`, `Dark <span class="practice-gap" data-answer="${word}">____</span>.`],
                'count': [`<span class="practice-gap" data-answer="${word}">____</span> the days.`, `Can you <span class="practice-gap" data-answer="${word}">____</span>?`],
                'december': [`Month of <span class="practice-gap" data-answer="${word}">____</span>.`, `Cold in <span class="practice-gap" data-answer="${word}">____</span>.`],
                'surprise': [`Big <span class="practice-gap" data-answer="${word}">____</span>.`, `Nice <span class="practice-gap" data-answer="${word}">____</span>.`],
                'christmas eve': [`On <span class="practice-gap" data-answer="${word}">____</span>.`, `Before <span class="practice-gap" data-answer="${word}">____</span>.`],
                'discount': [`20% <span class="practice-gap" data-answer="${word}">____</span>.`, `Student <span class="practice-gap" data-answer="${word}">____</span>.`],
                'receipt': [`Keep the <span class="practice-gap" data-answer="${word}">____</span>.`, `Lost the <span class="practice-gap" data-answer="${word}">____</span>.`],
                'cash': [`Pay with <span class="practice-gap" data-answer="${word}">____</span>.`, `No <span class="practice-gap" data-answer="${word}">____</span>.`],
                'expensive': [`Too <span class="practice-gap" data-answer="${word}">____</span>.`, `Very <span class="practice-gap" data-answer="${word}">____</span>.`],
                'cheap': [`Very <span class="practice-gap" data-answer="${word}">____</span>.`, `Buy <span class="practice-gap" data-answer="${word}">____</span> things.`],
                'price tag': [`Look at <span class="practice-gap" data-answer="${word}">____</span>.`, `No <span class="practice-gap" data-answer="${word}">____</span>.`],
                'customer': [`Happy <span class="practice-gap" data-answer="${word}">____</span>.`, `New <span class="practice-gap" data-answer="${word}">____</span>.`],
                'sale': [`Big <span class="practice-gap" data-answer="${word}">____</span>.`, `On <span class="practice-gap" data-answer="${word}">____</span>.`],
                'anticipation': [`Build <span class="practice-gap" data-answer="${word}">____</span>.`, `Full of <span class="practice-gap" data-answer="${word}">____</span>.`],
                'origin': [`Latin <span class="practice-gap" data-answer="${word}">____</span>.`, `Unknown <span class="practice-gap" data-answer="${word}">____</span>.`],
                'commercialized': [`Too <span class="practice-gap" data-answer="${word}">____</span>.`, `Highly <span class="practice-gap" data-answer="${word}">____</span>.`],
                'symbolize': [`Roses <span class="practice-gap" data-answer="${word}">____</span> love.`, `Flags <span class="practice-gap" data-answer="${word}">____</span> country.`],
                'heritage': [`Cultural <span class="practice-gap" data-answer="${word}">____</span>.`, `Rich <span class="practice-gap" data-answer="${word}">____</span>.`],
                'alternative': [`Find an <span class="practice-gap" data-answer="${word}">____</span>.`, `Good <span class="practice-gap" data-answer="${word}">____</span>.`],
                'countdown': [`Final <span class="practice-gap" data-answer="${word}">____</span>.`, `Start the <span class="practice-gap" data-answer="${word}">____</span>.`],
                'luxury': [`<span class="practice-gap" data-answer="${word}">____</span> car.`, `Pure <span class="practice-gap" data-answer="${word}">____</span>.`],
                'retailer': [`Online <span class="practice-gap" data-answer="${word}">____</span>.`, `High street <span class="practice-gap" data-answer="${word}">____</span>.`],
                'transaction': [`Bank <span class="practice-gap" data-answer="${word}">____</span>.`, `Secure <span class="practice-gap" data-answer="${word}">____</span>.`],
                'warranty': [`1 year <span class="practice-gap" data-answer="${word}">____</span>.`, `Under <span class="practice-gap" data-answer="${word}">____</span>.`],
                'refund': [`Full <span class="practice-gap" data-answer="${word}">____</span>.`, `Ask for <span class="practice-gap" data-answer="${word}">____</span>.`],
                'impulse': [`<span class="practice-gap" data-answer="${word}">____</span> buy.`, `Control <span class="practice-gap" data-answer="${word}">____</span>.`],
                'consumer': [`<span class="practice-gap" data-answer="${word}">____</span> rights.`, `Smart <span class="practice-gap" data-answer="${word}">____</span>.`],
                'bargain': [`Real <span class="practice-gap" data-answer="${word}">____</span>.`, `Love a <span class="practice-gap" data-answer="${word}">____</span>.`],
                'promotion': [`Special <span class="practice-gap" data-answer="${word}">____</span>.`, `Sales <span class="practice-gap" data-answer="${word}">____</span>.`]
            };

            const normalizedWord = word.toLowerCase();

            if (sentencePatterns[normalizedWord]) {
                const patterns = sentencePatterns[normalizedWord];
                return patterns[Math.floor(Math.random() * patterns.length)];
            }
            if (definition && definition.length > 3) {
                return `<strong>Definition:</strong> "${definition}" <br> Word: <span class="practice-gap" data-answer="${word}">____</span>`;
            }
            return `The word is: <span class="practice-gap" data-answer="${word}">____</span>`;
        }

        const practiceItems = batch.map(w => {
            const sentence = generateGapSentence(w.word, w.definition);
            return sentence ? { word: w.word, sentence: sentence, is_review: w.is_review } : null;
        }).filter(item => item !== null); 

        // Generate sentences HTML
        let sentencesHTML = practiceItems.map((item, index) => {
            const badge = item.is_review 
                ? `<span style="background:#DCFCE7; color:#166534; font-size:10px; padding:2px 6px; border-radius:4px; font-weight:700; margin-left:8px;">MEMORY CHECK</span>` 
                : `<span style="background:#FEF2F2; color:#991B1B; font-size:10px; padding:2px 6px; border-radius:4px; font-weight:700; margin-left:8px;">FOCUS</span>`;
            
            return `
                <div style="margin-bottom: 20px; font-size: 17px; background: #FFF; padding: 15px; border-radius: 8px; border: 1px solid #E5E9F2;">
                    ${index + 1}. ${item.sentence} ${badge}
                </div>
            `;
        }).join('');

        // --- POPUP UI ---
        const practicePopup = document.createElement('div');
        practicePopup.style.cssText = `
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 30px; border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 10000;
            max-width: 700px; width: 90%; max-height: 85vh; overflow-y: auto;
        `;

        const overlay = document.createElement('div');
        overlay.id = 'mistake-reminder-overlay-practice';
        overlay.style.cssText = `
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 9999;
        `;

        const shuffledWordsForBank = shuffleArray(practiceItems.map(item => ({ word: item.word })));

        practicePopup.innerHTML = `
            <h2 style="color: #0EA5E9; margin-bottom: 15px; font-size: 24px; font-weight: 600;"> üöÄ Daily Brain Boost </h2>
            <p style="color: #666; margin-bottom: 20px;">Complete the gaps to strengthen your memory:</p>

            <div style="background: #F0F9FF; border: 2px solid #0EA5E9; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                <p style="font-weight: 600; margin-bottom: 10px; color: #0369A1;">Word Bank:</p>
                <div id="practice-word-bank" style="display: flex; flex-wrap: wrap; gap: 8px;">
                    ${shuffledWordsForBank.map(w => `
                        <span class="practice-word" data-word="${w.word}" style="
                            background: #0EA5E9; color: white; padding: 8px 14px;
                            border-radius: 6px; cursor: pointer; font-weight: 600;
                            transition: all 0.2s; user-select: none;
                        ">${w.word}</span>
                    `).join('')}
                </div>
            </div>

            <div id="practice-sentences">${sentencesHTML}</div>

            <p id="practice-feedback" style="font-weight: 600; font-size: 18px; margin: 20px 0; text-align: center; color: #4A5568; min-height: 25px;"></p>
            
            <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                <button id="check-practice-btn" style="
                    background: #10B981; color: white; border: none; padding: 12px 24px;
                    border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;
                    flex: 1; min-width: 140px; transition: background-color 0.2s;
                ">‚úÖ Check Answers</button>
                
                <button id="close-practice-btn" style="
                    background: #E5E9F2; color: #4A5568; border: none; padding: 12px 24px;
                    border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;
                    flex: 1; min-width: 140px;
                ">Close</button>
            </div>
        `;

        document.body.appendChild(overlay);
        document.body.appendChild(practicePopup);

        // --- INTERACTION LOGIC (Select/Fill) ---
        let selectedWord = null;
        document.querySelectorAll('.practice-word').forEach(wordEl => {
            wordEl.addEventListener('click', () => {
                if (wordEl.classList.contains('used')) return;
                if (selectedWord) selectedWord.style.boxShadow = 'none';
                selectedWord = wordEl;
                selectedWord.style.boxShadow = '0 0 0 3px #0EA5E9';
            });
        });

        document.querySelectorAll('.practice-gap').forEach(gap => {
            gap.style.borderBottom = '2px dashed #999';
            gap.style.padding = '0 5px'; gap.style.cursor = 'pointer';
            gap.style.minWidth = '80px'; gap.style.display = 'inline-block';
            gap.style.textAlign = 'center'; gap.style.fontWeight = '600';
            gap.style.color = '#0369A1'; gap.style.background = '#F0F9FF';
            gap.style.borderColor = '#BAE6FD'; gap.style.borderRadius = '4px';

            gap.addEventListener('click', () => {
                if (!selectedWord) return;
                if (gap.dataset.filled === 'true') {
                    const oldWordEl = document.querySelector(`.practice-word[data-word="${gap.dataset.filledWord}"]`);
                    if (oldWordEl) {
                        oldWordEl.classList.remove('used');
                        oldWordEl.style.opacity = '1.0'; oldWordEl.style.pointerEvents = 'auto';
                    }
                }
                gap.textContent = selectedWord.dataset.word;
                gap.dataset.filled = 'true';
                gap.dataset.filledWord = selectedWord.dataset.word;
                gap.style.background = '#FDE047'; gap.style.borderStyle = 'solid'; gap.style.borderColor = '#EAB308';
                gap.style.color = '#854D0E';

                selectedWord.classList.add('used');
                selectedWord.style.opacity = '0.3'; selectedWord.style.pointerEvents = 'none';
                selectedWord.style.boxShadow = 'none';
                selectedWord = null;
            });
        });

        // --- CHECKING & SAVING LOGIC ---
        document.getElementById('check-practice-btn').addEventListener('click', async () => {
            let correct = 0, total = 0;
            const wordsToDelete = [];

            document.querySelectorAll('.practice-gap').forEach(gap => {
                total++;
                if (gap.dataset.filledWord === gap.dataset.answer) {
                    correct++;
                    gap.style.background = '#10B981'; gap.style.color = 'white'; gap.style.borderColor = '#10B981';
                    // Only delete if it was a MISTAKE (not a review word)
                    const originalItem = batch.find(b => b.word === gap.dataset.answer);
                    if (originalItem && !originalItem.is_review) {
                        wordsToDelete.push(gap.dataset.answer);
                    }
                } else {
                    gap.style.background = '#DC2626'; gap.style.color = 'white'; gap.style.borderColor = '#DC2626';
                }
            });

            const feedback = document.getElementById('practice-feedback');
            
            // Delete repaired mistakes from DB
            if (wordsToDelete.length > 0) {
                try {
                    const { data: { user } } = await supabase.auth.getUser();
                    if (user) {
                        const deletePromises = wordsToDelete.map(word => 
                            supabase.from('user_mistakes').delete().eq('user_id', user.id).eq('word', word)
                        );
                        await Promise.all(deletePromises);
                        checkForMistakesOnHomepage(); // Refresh widget
                    }
                } catch (err) { console.error("Error repairing words:", err); }
            }

            if (correct === total) {
                feedback.innerHTML = 'üéâ Amazing! Memory Boosted!'; feedback.style.color = '#10B981';
            } else {
                feedback.innerHTML = `You got ${correct}/${total}. Keep practicing!`; feedback.style.color = '#F59E0B';
            }
            
            document.getElementById('check-practice-btn').style.pointerEvents = 'none';
            document.getElementById('check-practice-btn').style.opacity = '0.6';
        });

        const closeFn = () => { practicePopup.remove(); overlay.remove(); };
        document.getElementById('close-practice-btn').addEventListener('click', closeFn);
        overlay.addEventListener('click', closeFn);
    }
    
    // --- 4. OFFICE PULSE (RESTORED) ---
    async function loadOfficePulse() {
        const pulseText = document.getElementById('pulse-ticker-text');
        if(!pulseText) return;

        // Fetch Recent Activity Feed
        const { data: feed } = await supabase.from('office_pulse').select('*');
        const messages = [];

        if (feed && feed.length > 0) {
            feed.forEach(item => {
                const time = getTimeAgo(new Date(item.completed_at));
                const link = item.lesson_link || '#'; 
                messages.push(`ü•≥ ${time}: A Cool Dude finished <a href="${link}" target="_blank">${item.lesson_title}</a> (+${item.word_count} words)`);
            });
        } else {
            messages.push("üöÄ Be the first Cool Dude to complete a lesson today!");
        }

        if (messages.length > 0) pulseText.innerHTML = messages[0];

        if (messages.length > 1) {
            let msgIndex = 1; 
            setInterval(() => {
                pulseText.style.opacity = 0;
                setTimeout(() => {
                    pulseText.innerHTML = messages[msgIndex];
                    pulseText.style.opacity = 1;
                    msgIndex = (msgIndex + 1) % messages.length;
                }, 500);
            }, 5000);
        }
    }

    // --- HELPER FUNCTIONS ---
    function getTimeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);
        let interval = seconds / 31536000;
        if (interval > 1) return Math.floor(interval) + " years ago";
        interval = seconds / 2592000;
        if (interval > 1) return Math.floor(interval) + " months ago";
        interval = seconds / 86400;
        if (interval > 1) return Math.floor(interval) + " days ago";
        interval = seconds / 3600;
        if (interval > 1) return Math.floor(interval) + " hours ago";
        interval = seconds / 60;
        if (interval > 1) return Math.floor(interval) + " mins ago";
        return "Just now";
    }

    // --- AUTH ---
    async function initializeAuthHeader() {
        const loggedOutButtons = document.getElementById('logged-out-buttons');
        const loggedInButtons = document.getElementById('logged-in-buttons');
        const logoutBtn = document.getElementById('logout-btn');
        const userGreeting = document.getElementById('user-greeting');

         try {
            const { data: { user } } = await supabase.auth.getUser();
            if (user) {
                let userName = 'Cool Dude';
                if (user.user_metadata && user.user_metadata.full_name) userName = user.user_metadata.full_name.split(' ')[0];
                else if (user.email) userName = user.email.split('@')[0];
                
                if (userGreeting) userGreeting.textContent = `Hey ${userName}! üëã`;
                if (loggedInButtons) loggedInButtons.style.display = 'flex';
                if (loggedOutButtons) loggedOutButtons.style.display = 'none';
            } else {
                if (loggedOutButtons) loggedOutButtons.style.display = 'flex';
                if (loggedInButtons) loggedInButtons.style.display = 'none';
            }
        } catch (err) { console.error('Error checking auth:', err); }

        if (logoutBtn) {
            logoutBtn.addEventListener('click', async () => {
                await supabase.auth.signOut();
                window.location.reload();
            });
        }
    }
</script>
<script src="tickerData.js"></script>
<script> 
    // --- MAIN INIT ---
    document.addEventListener('DOMContentLoaded', async () => {
        await initializeAuthHeader();
        loadOfficePulse();
        // Safe check for the ticker
        if(typeof startTickerAnimation === 'function') startTickerAnimation();
        setTimeout(() => checkForMistakesOnHomepage(), 1500);
    });
</script>
</body>
</html>
