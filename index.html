<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <title>English For Cool Dudes - Master English with Gamified Learning</title>

    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/init-auth.js"></script>
    <style>
        :root {
            --blue:         #1CB0F6;
            --blue-shadow:  #1899D6;
            --yellow:       #FFC800;
            --yellow-shadow:#E5B400;
            --green:        #58CC02;
            --green-shadow: #58A700;
            --punch:        #FF4B4B;
            --punch-shadow: #EA2B2B;
            --purple:       #CE82FF;
            --purple-shadow:#A559D9;
            --teal:         #2BDECC;
            --bg:           #F7F9FA;
            --ink:          #4B4B4B;
            --ink-bold:     #111827;
            --ink-3:        #AFAFAF;
            --white:        #FFFFFF;
            --border:       #E5E5E5;
            --border-heavy: #CECECE;
            --r:            24px;
            --rsm:          16px;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }
        body { background:var(--bg); color:var(--ink); font-family:'Nunito',-apple-system,system-ui,sans-serif; line-height:1.5; overflow-x:hidden; }
        a { color:inherit; text-decoration:none; }
        @keyframes up    { from{opacity:0;transform:translateY(22px)} to{opacity:1;transform:translateY(0)} }
        @keyframes flick { 0%,100%{transform:rotate(-4deg) scale(1)} 50%{transform:rotate(4deg) scale(1.12)} }
        @keyframes shim  { 0%{background-position:-400px 0} 100%{background-position:400px 0} }
        @keyframes nudge { 0%,100%{transform:translateX(0)} 30%{transform:translateX(5px)} }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
        @keyframes popin { 0%{opacity:0;transform:scale(.88)} 70%{transform:scale(1.03)} 100%{opacity:1;transform:scale(1)} }
        .u1{animation:up .44s ease both .04s} .u2{animation:up .44s ease both .14s}
        .u3{animation:up .44s ease both .24s} .u4{animation:up .44s ease both .34s}
        .u5{animation:up .44s ease both .44s} .u6{animation:up .44s ease both .54s}
        .header { background:var(--white); border-bottom:2px solid var(--border); position:sticky; top:0; z-index:200; padding:0 20px; height:60px; display:flex; align-items:center; }
        .hc { max-width:900px; width:100%; margin:0 auto; display:flex; align-items:center; justify-content:space-between; }
        .hl { display:flex; align-items:center; gap:10px; }
        .logo { width:40px; height:40px; border-radius:12px; background:var(--yellow); border:2px solid var(--border-heavy); display:flex; align-items:center; justify-content:center; font-size:22px; flex-shrink:0; box-shadow:0 3px 0 var(--border-heavy); }
        .site-title { font-size:18px; font-weight:900; color:var(--ink-bold); letter-spacing:-.4px; }
        @media(max-width:380px){ .site-title{display:none} }
        #header-auth-container { display:flex; align-items:center; gap:8px; }
        .page { max-width:900px; margin:0 auto; padding:24px 16px 96px; display:flex; flex-direction:column; gap:20px; }
        .sk { background:linear-gradient(90deg,#EBEBEB 25%,#F5F5F5 50%,#EBEBEB 75%); background-size:400px 100%; animation:shim 1.4s infinite; border-radius:var(--rsm); }
        .chunky-card { background:var(--white); border:2px solid var(--border-heavy); border-bottom:6px solid var(--border-heavy); border-radius:var(--r); padding:20px; }
        .hero { background:var(--blue); border:2px solid var(--blue-shadow); border-bottom:6px solid var(--blue-shadow); border-radius:var(--r); padding:24px 20px; position:relative; overflow:hidden; }
        .hero::after { content:'ğŸ˜'; position:absolute; bottom:-10px; right:10px; font-size:100px; opacity:.15; pointer-events:none; transform:rotate(-15deg); }
        .eyebrow { display:inline-block; background:var(--yellow); color:var(--ink-bold); font-size:12px; font-weight:900; text-transform:uppercase; letter-spacing:1.5px; padding:4px 12px; border-radius:8px; margin-bottom:14px; border:2px solid var(--yellow-shadow); }
        .big-title { font-size:clamp(30px,7vw,50px); font-weight:900; color:var(--white); line-height:1.1; letter-spacing:-1px; margin-bottom:10px; position:relative; z-index:1; }
        .big-title .yellow { color:var(--yellow); text-shadow:0 3px 0 var(--yellow-shadow); }
        .hero-sub { font-size:16px; font-weight:700; color:rgba(255,255,255,.9); margin-bottom:24px; max-width:340px; position:relative; z-index:1; }
        .guest-btns { display:flex; gap:12px; flex-wrap:wrap; position:relative; z-index:1; }
        .btn-yellow { display:inline-flex; align-items:center; gap:6px; padding:14px 24px; background:var(--yellow); color:var(--ink-bold); font-size:16px; font-weight:900; border-radius:var(--rsm); border:2px solid var(--yellow-shadow); border-bottom:4px solid var(--yellow-shadow); cursor:pointer; letter-spacing:-.3px; transition:transform .1s,border-bottom-width .1s; }
        .btn-yellow:active { border-bottom-width:2px; transform:translateY(2px); }
        .btn-white { display:inline-flex; align-items:center; gap:6px; padding:14px 20px; background:var(--white); color:var(--ink-bold); font-size:16px; font-weight:900; border-radius:var(--rsm); border:2px solid var(--border-heavy); border-bottom:4px solid var(--border-heavy); cursor:pointer; letter-spacing:-.3px; transition:transform .1s,border-bottom-width .1s; }
        .btn-white:active { border-bottom-width:2px; transform:translateY(2px); }
        .hero-top { display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:18px; position:relative; z-index:1; }
        .greet { font-size:13px; font-weight:800; color:rgba(255,255,255,.8); text-transform:uppercase; letter-spacing:1px; margin-bottom:2px; }
        .uname { font-size:clamp(22px,5vw,34px); font-weight:900; color:var(--white); letter-spacing:-1px; line-height:1.1; text-shadow:0 2px 0 var(--blue-shadow); }
        .streak-block { text-align:center; flex-shrink:0; background:var(--white); border:2px solid var(--border-heavy); border-bottom:4px solid var(--border-heavy); border-radius:var(--rsm); padding:10px 16px; min-width:80px; }
        .sfire { font-size:32px; display:block; line-height:1; animation:flick 1.8s ease-in-out infinite; }
        .snum  { font-size:24px; font-weight:900; color:var(--punch); display:block; line-height:1.1; margin-top:4px; }
        .sword { font-size:10px; font-weight:900; color:var(--ink-3); text-transform:uppercase; letter-spacing:1px; }
        .xp-wrap { position:relative; z-index:1; margin-bottom:18px; background:rgba(255,255,255,.2); padding:12px; border-radius:var(--rsm); }
        .xp-row  { display:flex; justify-content:space-between; font-size:13px; font-weight:800; margin-bottom:8px; color:var(--white); }
        .xp-track{ height:16px; background:rgba(0,0,0,.15); border-radius:99px; overflow:hidden; border:2px solid rgba(0,0,0,.1); }
        .xp-fill { height:100%; width:0%; border-radius:99px; background:var(--yellow); border-top:4px solid rgba(255,255,255,.4); transition:width 1.3s cubic-bezier(.4,0,.2,1); }
        .hero-cta { display:flex; align-items:center; justify-content:space-between; width:100%; padding:16px 20px; background:var(--green); color:var(--white); font-size:18px; font-weight:900; border-radius:var(--rsm); border:2px solid var(--green-shadow); border-bottom:6px solid var(--green-shadow); cursor:pointer; letter-spacing:-.3px; transition:transform .1s,border-bottom-width .1s; position:relative; z-index:1; }
        .hero-cta:active { border-bottom-width:2px; transform:translateY(4px); }
        .cta-arrow { font-size:24px; font-weight:900; flex-shrink:0; animation:nudge 2s ease-in-out infinite; }
        .stat-row { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:16px; position:relative; z-index:1; }
        .stat-pill { background:rgba(255,255,255,.2); border:2px solid rgba(255,255,255,.3); border-radius:var(--rsm); padding:12px 8px; text-align:center; }
        .sn { display:block; font-size:22px; font-weight:900; color:var(--white); line-height:1; }
        .sl { font-size:10px; font-weight:900; color:rgba(255,255,255,.8); text-transform:uppercase; letter-spacing:1px; margin-top:4px; display:block; }
        .streak-banner { display:flex; align-items:center; gap:14px; background:var(--yellow); border:2px solid var(--yellow-shadow); border-bottom:5px solid var(--yellow-shadow); border-radius:var(--r); padding:16px 20px; cursor:pointer; transition:transform .1s,border-bottom-width .1s; }
        .streak-banner:active { border-bottom-width:2px; transform:translateY(3px); }
        .sb-icon  { font-size:32px; flex-shrink:0; animation:flick 1.8s ease-in-out infinite; }
        .sb-body  { flex:1; }
        .sb-title { font-size:16px; font-weight:900; color:var(--ink-bold); letter-spacing:-.3px; }
        .sb-sub   { font-size:13px; font-weight:700; color:rgba(0,0,0,.6); margin-top:2px; }
        .sb-arrow { font-size:24px; font-weight:900; color:var(--ink-bold); opacity:.5; animation:nudge 2s ease-in-out infinite; }
        .widget-row { display:grid; grid-template-columns:1fr; gap:16px; align-items:stretch; }
        @media(min-width:620px){ .widget-row { grid-template-columns:1fr 1fr; } }
        .dc-card { background:linear-gradient(135deg,#1CB0F6 0%,#0d8fd4 100%); border:2px solid #1899D6; border-bottom:6px solid #1899D6; border-radius:var(--r); padding:20px; display:flex; flex-direction:column; gap:14px; position:relative; overflow:hidden; height:100%; }
        .dc-card::after { content:'ğŸ†'; position:absolute; right:-8px; bottom:-14px; font-size:90px; opacity:.15; pointer-events:none; }
        .dc-eyebrow { font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:1.5px; color:rgba(255,255,255,.8); }
        .dc-title   { font-size:20px; font-weight:900; color:var(--white); letter-spacing:-.3px; }
        .dc-desc    { font-size:13px; font-weight:700; color:rgba(255,255,255,.9); }
        .dc-bar-wrap{ background:rgba(255,255,255,.25); border-radius:99px; height:10px; overflow:hidden; }
        .dc-bar     { height:100%; background:var(--yellow); border-radius:99px; transition:width .8s ease; }
        .dc-xp      { font-size:14px; font-weight:900; color:var(--yellow); }
        .dc-complete-badge { position:absolute; top:12px; right:12px; background:var(--green); color:var(--white); font-size:11px; font-weight:900; padding:4px 10px; border-radius:8px; border:2px solid var(--green-shadow); }
        .dc-btn { background:var(--yellow); color:var(--ink-bold); font-size:13px; font-weight:900; padding:10px 16px; border-radius:var(--rsm); border:2px solid var(--yellow-shadow); border-bottom:4px solid var(--yellow-shadow); white-space:nowrap; cursor:pointer; transition:transform .1s,border-bottom-width .1s; }
        .dc-btn:active { border-bottom-width:2px; transform:translateY(2px); }
        .picks-card { background:var(--white); border:2px solid var(--border-heavy); border-bottom:6px solid var(--border-heavy); border-radius:var(--r); padding:20px; display:flex; flex-direction:column; gap:12px; }
        .picks-top  { display:flex; align-items:center; gap:10px; }
        .picks-icon { font-size:32px; animation:float 3s ease-in-out infinite; }
        .picks-heading { font-size:16px; font-weight:900; color:var(--ink-bold); }
        .picks-sub     { font-size:13px; font-weight:700; color:var(--ink-3); margin-top:2px; }
        #picks-desc { flex:1; background:var(--bg); border:2px solid var(--border); border-radius:var(--rsm); padding:12px; min-height:80px; display:flex; flex-direction:column; gap:6px; transition:opacity .3s,transform .3s; }
        .picks-name { font-size:15px; font-weight:900; color:var(--ink-bold); line-height:1.3; }
        .picks-meta { font-size:12px; color:var(--ink-3); font-weight:800; }
        .picks-fact { font-size:12px; color:var(--ink); font-weight:700; margin-top:2px; }
        .picks-badge{ display:inline-block; font-size:10px; font-weight:900; background:var(--yellow); padding:3px 8px; border-radius:6px; border:2px solid var(--yellow-shadow); width:max-content; }
        .picks-go-btn { display:flex; align-items:center; justify-content:center; gap:8px; padding:14px 20px; background:var(--purple); color:var(--white); font-size:15px; font-weight:900; border-radius:var(--rsm); border:2px solid var(--purple-shadow); border-bottom:5px solid var(--purple-shadow); cursor:pointer; letter-spacing:-.2px; transition:transform .1s,border-bottom-width .1s; text-align:center; }
        .picks-go-btn:active { border-bottom-width:2px; transform:translateY(3px); }
        .picks-shuffle { display:flex; align-items:center; justify-content:center; gap:6px; padding:10px; background:var(--bg); color:var(--ink-3); font-size:12px; font-weight:900; border-radius:var(--rsm); border:2px solid var(--border); cursor:pointer; transition:color .15s,border-color .15s; }
        .picks-shuffle:hover { color:var(--ink-bold); border-color:var(--border-heavy); }
        #course-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); z-index:9999; align-items:center; justify-content:center; padding:20px; }
        #course-modal.open { display:flex; }
        .modal-inner { background:var(--white); border-radius:var(--r); border:2px solid var(--border-heavy); border-bottom:6px solid var(--border-heavy); max-width:420px; width:100%; overflow:hidden; animation:popin .3s ease both; }
        .modal-head { background:var(--blue); padding:20px; position:relative; }
        .modal-head-label { font-size:13px; font-weight:900; color:rgba(255,255,255,.8); text-transform:uppercase; letter-spacing:1px; margin-bottom:4px; }
        .modal-head-title { font-size:22px; font-weight:900; color:var(--white); }
        .modal-close { position:absolute; top:12px; right:12px; background:rgba(255,255,255,.2); border:none; color:var(--white); font-size:20px; font-weight:900; width:32px; height:32px; border-radius:8px; cursor:pointer; line-height:1; }
        .modal-list { padding:14px; display:flex; flex-direction:column; gap:8px; }
        .modal-choice { display:flex; align-items:center; gap:12px; padding:12px 14px; border-radius:var(--rsm); border:2px solid var(--border); background:var(--bg); cursor:pointer; transition:border-color .15s,background .15s; }
        .modal-choice:hover { border-color:var(--border-heavy); background:var(--white); }
        .modal-choice span:first-child { font-size:24px; flex-shrink:0; }
        .modal-choice div { flex:1; }
        .modal-choice strong { display:block; font-size:15px; font-weight:900; color:var(--ink-bold); }
        .modal-choice small  { font-size:12px; font-weight:700; color:var(--ink-3); }
        .modal-choice span:last-child { font-size:18px; font-weight:900; color:var(--ink-3); }
        .modal-choice[data-c=green]:hover  { border-color:var(--green);  }
        .modal-choice[data-c=blue]:hover   { border-color:var(--blue);   }
        .modal-choice[data-c=red]:hover    { border-color:var(--punch);  }
        .modal-choice[data-c=purple]:hover { border-color:var(--purple); }
        .modal-choice[data-c=orange]:hover { border-color:var(--yellow); }
        .modal-choice[data-c=teal]:hover   { border-color:var(--teal);   }
        .sec-label { font-size:13px; font-weight:900; color:var(--ink-3); text-transform:uppercase; letter-spacing:1.5px; margin-bottom:12px; display:flex; align-items:center; gap:12px; }
        .sec-label::after { content:''; flex:1; height:2px; background:var(--border); border-radius:2px; }
        .strip { display:flex; gap:14px; overflow-x:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; padding-bottom:10px; scrollbar-width:none; -ms-overflow-style:none; }
        .strip::-webkit-scrollbar { display:none; }
        @media(min-width:600px){ .strip { display:grid; grid-template-columns:repeat(3,1fr); overflow:visible; } }
        .cc { background:var(--white); border:2px solid var(--border-heavy); border-bottom:6px solid var(--border-heavy); border-radius:var(--r); padding:20px 18px; display:flex; flex-direction:column; gap:10px; min-width:230px; flex-shrink:0; scroll-snap-align:start; transition:border-bottom-width .1s,transform .1s; position:relative; cursor:pointer; }
        .cc:active { border-bottom-width:2px; transform:translateY(4px); }
        .cc::before { content:''; position:absolute; top:-2px; left:-2px; right:-2px; height:8px; border-radius:24px 24px 0 0; }
        .cc[data-c=red]::before    { background:var(--punch);  }
        .cc[data-c=orange]::before { background:var(--yellow); }
        .cc[data-c=blue]::before   { background:var(--blue);   }
        .cc[data-c=green]::before  { background:var(--green);  }
        .cc[data-c=purple]::before { background:var(--purple); }
        .cc[data-c=teal]::before   { background:var(--teal);   }
        .cc-top  { display:flex; align-items:center; justify-content:space-between; margin-top:4px; }
        .cc-icon { font-size:32px; line-height:1; }
        .cc-badge{ font-size:10px; font-weight:900; letter-spacing:1px; text-transform:uppercase; padding:4px 10px; border-radius:8px; background:var(--bg); color:var(--ink-3); }
        .cc-title{ font-size:18px; font-weight:900; color:var(--ink-bold); letter-spacing:-.3px; }
        .cc-desc { font-size:13px; font-weight:700; color:var(--ink-3); line-height:1.4; flex:1; }
        .cc-foot { display:flex; align-items:center; justify-content:space-between; margin-top:6px; }
        .cc-meta { font-size:12px; font-weight:800; color:var(--ink-3); }
        .cc-go   { width:30px; height:30px; border-radius:50%; background:var(--border); color:var(--ink-bold); display:flex; align-items:center; justify-content:center; font-size:16px; font-weight:900; }
        .swipe-hint { font-size:12px; font-weight:800; color:var(--ink-3); margin-bottom:8px; display:flex; align-items:center; gap:4px; }
        .swipe-hint span { animation:nudge 2s ease-in-out infinite; display:inline-block; }
        @media(min-width:600px){ .swipe-hint{display:none;} }
        .game-card { background:var(--purple); border:2px solid var(--purple-shadow); border-bottom:6px solid var(--purple-shadow); border-radius:var(--r); padding:24px 20px; display:flex; align-items:center; gap:16px; cursor:pointer; position:relative; overflow:hidden; transition:transform .1s,border-bottom-width .1s; }
        .game-card::after { content:'ğŸ‘¾'; position:absolute; top:-10px; right:-10px; font-size:120px; opacity:.15; pointer-events:none; transform:rotate(15deg); }
        .game-card:active { border-bottom-width:2px; transform:translateY(4px); }
        .g-icon  { width:60px; height:60px; flex-shrink:0; background:rgba(255,255,255,.2); border-radius:16px; display:flex; align-items:center; justify-content:center; font-size:34px; position:relative; z-index:1; }
        .g-body  { flex:1; position:relative; z-index:1; }
        .g-title { font-size:20px; font-weight:900; color:var(--white); letter-spacing:-.4px; margin-bottom:4px; text-shadow:0 2px 0 var(--purple-shadow); }
        .g-sub   { font-size:13px; font-weight:700; color:rgba(255,255,255,.9); }
        .g-pill  { flex-shrink:0; position:relative; z-index:1; background:var(--white); color:var(--purple-shadow); font-size:14px; font-weight:900; padding:12px 20px; border-radius:var(--rsm); text-transform:uppercase; letter-spacing:1px; border:2px solid var(--border-heavy); border-bottom:4px solid var(--border-heavy); }
        .lb-head   { padding:16px 20px; border-bottom:2px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
        .lb-head-t { font-size:16px; font-weight:900; color:var(--ink-bold); }
        .lb-head-a { font-size:13px; font-weight:900; color:var(--blue); text-transform:uppercase; letter-spacing:.5px; }
        .lb-row    { display:flex; align-items:center; gap:14px; padding:13px 20px; border-bottom:2px solid var(--border); }
        .lb-row:last-child { border-bottom:none; }
        .lb-row.you { background:rgba(28,176,246,.08); }
        .lb-rank { font-size:18px; font-weight:900; width:30px; text-align:center; flex-shrink:0; color:var(--ink-3); }
        .lb-av   { width:40px; height:40px; border-radius:12px; background:var(--yellow); border:2px solid var(--border-heavy); color:var(--ink-bold); display:flex; align-items:center; justify-content:center; font-size:18px; font-weight:900; flex-shrink:0; }
        .lb-name { flex:1; font-size:15px; font-weight:800; color:var(--ink-bold); }
        .lb-xp   { font-size:15px; font-weight:900; color:var(--blue); }
        .footer { padding:32px 20px; text-align:center; }
        .footer-text { font-size:14px; font-weight:800; color:var(--ink-3); margin-bottom:12px; }
        .footer a { color:var(--ink-3); font-size:13px; font-weight:800; margin:0 12px; text-decoration:underline; }
    </style>
</head>
<body>

<header class="header">
    <div class="hc">
        <div class="hl">
            <a href="/" class="logo">ğŸ˜</a>
            <a href="/" class="site-title">English For Cool Dudes</a>
        </div>
        <div id="header-auth-container"></div>
    </div>
</header>

<div id="course-modal">
    <div class="modal-inner">
        <div class="modal-head">
            <div class="modal-head-label">Where do you want to go?</div>
            <div class="modal-head-title">Pick your level ğŸ¯</div>
            <button class="modal-close" onclick="closePicker()">Ã—</button>
        </div>
        <div class="modal-list">
            <a href="/beginner/"     class="modal-choice" data-c="green">  <span>ğŸŒ±</span><div><strong>Beginner</strong><small>A1â€“A2 Â· Start from scratch</small></div><span>â€º</span></a>
            <a href="/intermediate/" class="modal-choice" data-c="blue">   <span>ğŸš€</span><div><strong>Intermediate</strong><small>B1â€“B2 Â· Build on the basics</small></div><span>â€º</span></a>
            <a href="/advanced/"     class="modal-choice" data-c="red">    <span>ğŸ¯</span><div><strong>Advanced</strong><small>C1â€“C2 Â· Master the language</small></div><span>â€º</span></a>
            <a href="/business/"     class="modal-choice" data-c="purple"> <span>ğŸ’¼</span><div><strong>Business English</strong><small>Pro Â· Meetings &amp; emails</small></div><span>â€º</span></a>
            <a href="/tax/"          class="modal-choice" data-c="orange"> <span>ğŸ’°</span><div><strong>Tax English</strong><small>Specialist Â· Tax &amp; accounting</small></div><span>â€º</span></a>
            <a href="/legal/"        class="modal-choice" data-c="teal">   <span>âš–ï¸</span><div><strong>Legal English</strong><small>Specialist Â· Contracts &amp; law</small></div><span>â€º</span></a>
        </div>
    </div>
</div>

<div class="page">

    <div class="u1">
        <div class="hero" id="hero-card">
            <div class="sk" style="height:14px;width:38%;margin-bottom:10px;"></div>
            <div class="sk" style="height:48px;width:72%;margin-bottom:24px;"></div>
            <div class="sk" style="height:16px;margin-bottom:8px;border-radius:99px;"></div>
            <div class="sk" style="height:64px;border-radius:16px;margin-top:20px;"></div>
        </div>
    </div>

    <div class="u2" id="sb-wrap" style="display:none;">
        <a href="#" class="streak-banner" id="sb-link">
            <span class="sb-icon">ğŸ”¥</span>
            <div class="sb-body">
                <div class="sb-title" id="sb-title">Don't break your streak!</div>
                <div class="sb-sub"  id="sb-sub">Complete a lesson today to keep it alive â†’</div>
            </div>
            <span class="sb-arrow">â†’</span>
        </a>
    </div>

    <div class="u3 widget-row">
        <div id="dc-card-slot"></div>
        <div class="picks-card">
            <div class="picks-top">
                <div class="picks-icon">ğŸ¯</div>
                <div>
                    <div class="picks-heading">Cool Picks</div>
                    <div class="picks-sub">Your next lesson, chosen for you</div>
                </div>
            </div>
            <div id="picks-desc"><div class="picks-meta">Choosing a lessonâ€¦</div></div>
            <a id="picks-go-link" href="#" class="picks-go-btn">ğŸ‘€ Take Me There</a>
            <button class="picks-shuffle" id="picks-shuffle-btn">ğŸ”€ Different pick</button>
        </div>
    </div>

    <div class="u4">
        <div class="sec-label">The Main Path</div>
        <p class="swipe-hint">Swipe <span>â†’</span></p>
        <div class="strip">
            <a href="beginner/" class="cc" data-c="green">
                <div class="cc-top"><span class="cc-icon">ğŸŒ±</span><span class="cc-badge">A1â€“A2</span></div>
                <div class="cc-title">Beginner</div>
                <div class="cc-desc">Start your English journey from scratch.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Foundation</span><span class="cc-go">â€º</span></div>
            </a>
            <a href="intermediate/" class="cc" data-c="blue">
                <div class="cc-top"><span class="cc-icon">ğŸš€</span><span class="cc-badge">B1â€“B2</span></div>
                <div class="cc-title">Intermediate</div>
                <div class="cc-desc">Complex grammar for real-world situations.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Expanding</span><span class="cc-go">â€º</span></div>
            </a>
            <a href="advanced/" class="cc" data-c="red">
                <div class="cc-top"><span class="cc-icon">ğŸ¯</span><span class="cc-badge">C1â€“C2</span></div>
                <div class="cc-title">Advanced</div>
                <div class="cc-desc">Idioms and native-like British fluency.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Mastery</span><span class="cc-go">â€º</span></div>
            </a>
        </div>
    </div>

    <div class="u5" id="specialized-tracks">
        <div class="sec-label">Specialized Tracks</div>
        <p class="swipe-hint">Swipe <span>â†’</span></p>
        <div class="strip">
            <a href="business/" class="cc" data-c="purple">
                <div class="cc-top"><span class="cc-icon">ğŸ’¼</span><span class="cc-badge">Pro</span></div>
                <div class="cc-title">Business English</div>
                <div class="cc-desc">Meetings, emails, presentations and negotiations.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Multiple lessons</span><span class="cc-go">â€º</span></div>
            </a>
            <a href="tax/" class="cc" data-c="orange">
                <div class="cc-top"><span class="cc-icon">ğŸ’°</span><span class="cc-badge">Specialist</span></div>
                <div class="cc-title">Tax English</div>
                <div class="cc-desc">Tax terminology for accounting professionals.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Multiple lessons</span><span class="cc-go">â€º</span></div>
            </a>
            <a href="legal/" class="cc" data-c="teal">
                <div class="cc-top"><span class="cc-icon">âš–ï¸</span><span class="cc-badge">Specialist</span></div>
                <div class="cc-title">Legal English</div>
                <div class="cc-desc">Legal terms and contracts with confidence.</div>
                <div class="cc-foot"><span class="cc-meta">ğŸ“š Multiple lessons</span><span class="cc-go">â€º</span></div>
            </a>
        </div>
    </div>

    <div class="u5">
        <div class="sec-label">The Break Room</div>
        <a href="games/" class="game-card">
            <div class="g-icon">ğŸ®</div>
            <div class="g-body">
                <div class="g-title">Game Zone</div>
                <div class="g-sub">What Am I? Â· Chat Attack Â· Vibe Check</div>
            </div>
            <div class="g-pill">Play â†’</div>
        </a>
    </div>

    <div class="u6" id="lb-section" style="display:none;">
        <div class="sec-label">ğŸ† Top League</div>
        <div class="chunky-card" style="padding:0;overflow:hidden;">
            <div class="lb-head">
                <span class="lb-head-t">This Week's Best</span>
                <a href="/leaderboard/" class="lb-head-a">Full Board â†’</a>
            </div>
            <div id="lb-rows"></div>
        </div>
    </div>

</div>

<footer class="footer">
    <p class="footer-text">Â© 2026 English For Cool Dudes ğŸ˜</p>
    <div>
        <a href="impressum/">Impressum</a>
        <a href="datenschutz/">Privacy</a>
    </div>
</footer>

<script src="/supabase-auth-gamified.js"></script>
<script src="/main-gamified.js"></script>
<script src="/coolPicks-enhanced.js"></script>

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function greet() {
    const h = new Date().getHours();
    return h < 12 ? 'Good morning' : h < 18 ? 'Good afternoon' : 'Good evening';
}

function getTimeUntilMidnight() {
    const now = new Date(), mid = new Date(now);
    mid.setHours(24, 0, 0, 0);
    const diff = mid - now;
    return `${Math.floor(diff/3600000)}h ${Math.floor((diff%3600000)/60000)}m`;
}

function getLastLessonUrl() {
    const url = localStorage.getItem('efcd_last_lesson_url');
    if (!url) return null;
    const bad = ['beginner/', '/beginner/', 'beginner', '/beginner'];
    return bad.includes(url.trim()) ? null : url;
}
function getLastLessonName() {
    return localStorage.getItem('efcd_last_lesson_name') || null;
}
/** True when the user has already fully completed the last stored lesson */
function isLastLessonDone() {
    return localStorage.getItem('efcd_last_lesson_done') === 'true';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COURSE PICKER MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function openPicker() { document.getElementById('course-modal').classList.add('open'); }
function closePicker() { document.getElementById('course-modal').classList.remove('open'); }
document.getElementById('course-modal').addEventListener('click', function(e) {
    if (e.target === this) closePicker();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COOL PICKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const PICKS_LESSONS = [
    { url:'/chineserobotsbeginner/', time:'5 mins', name:'Pre-Intermediate: Chinese Robots on TV',  category:'beginner', icon:'ğŸ¤–', fact:'AI now stars in Chinese prime-time TV!' },
    { url:'/pancakedaybeginner/',    time:'4 mins', name:'Beginner: Pancake Day!',                  category:'beginner', icon:'ğŸ¥', fact:'Brits toss pancakes every Shrove Tuesday.' },
    { url:'/coffee/',                time:'7 mins', name:'Beginner: The Legend of Coffee',           category:'beginner', icon:'â˜•', fact:'Coffee was discovered by a goat herder in Ethiopia.' },
    { url:'/invisibleofficegame/',   time:'8 mins', name:'Tax: Invisible Office',                   category:'tax',      icon:'ğŸ¢', fact:'Remote work has changed tax residency rules worldwide.' },
    { url:'/transferpricing/',       time:'9 mins', name:'The Transfer Pricing Trap',               category:'tax',      icon:'ğŸ’¸', fact:'Transfer pricing costs governments billions each year.' },
    { url:'/flyingtaxis/',           time:'9 mins', name:'Advanced: Flying Taxis',                  category:'advanced', icon:'ğŸš•', fact:'eVTOLs could be in commercial use by 2026.' },
    { url:'/sandwich/',              time:'5 mins', name:'Beginner: The Earl of Sandwich',          category:'beginner', icon:'ğŸ¥ª', fact:'The 4th Earl invented the sandwich to keep gambling!' },
    { url:'/aivideos/',              time:'11 mins', name:'Advanced: AI Videos',                   category:'advanced', icon:'ğŸ¬', fact:'Sora can generate 60-second photorealistic videos.' },
    { url:'/muskman/',      time:'12 mins', name:'Intermediate: Elon Musk'\'s Big Bet',  category:'intermediate', icon:'ğŸš€', fact:'SpaceX is valued at more than the Dutch economy!' },
];

let currentPickIdx = -1;

function getRandomPickIdx() {
    if (PICKS_LESSONS.length <= 1) return 0;
    let idx;
    do { idx = Math.floor(Math.random() * PICKS_LESSONS.length); } while (idx === currentPickIdx);
    return idx;
}

function renderPick() {
    currentPickIdx = getRandomPickIdx();
    const pick = PICKS_LESSONS[currentPickIdx];
    const desc   = document.getElementById('picks-desc');
    const goLink = document.getElementById('picks-go-link');
    if (!desc || !goLink) return;
    desc.style.opacity   = '0';
    desc.style.transform = 'translateY(-8px)';
    setTimeout(() => {
        desc.innerHTML = `
            <div class="picks-badge">âš¡ ${pick.time}</div>
            <div class="picks-name">${pick.icon} ${pick.name}</div>
            <div class="picks-fact">ğŸ’¡ ${pick.fact}</div>
        `;
        goLink.href = pick.url;
        goLink.onclick = null;
        goLink.textContent = 'ğŸ‘€ Take Me There';
        desc.style.transition = 'opacity .4s, transform .4s';
        desc.style.opacity    = '1';
        desc.style.transform  = 'translateY(0)';
    }, 280);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DAILY CHALLENGE WIDGET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderDC() {
    const slot = document.getElementById('dc-card-slot');
    if (!slot) return;

    const lastUrl      = getLastLessonUrl();
    const lastNm       = getLastLessonName();
    const lastDone     = isLastLessonDone();
    // Only show "Continue" if there is a lesson AND it hasn't been completed yet
    const showContinue = !!(lastUrl && !lastDone);
    const ctaLabel     = showContinue ? `â–¶ Continue: ${lastNm}` : 'â–¶ Pick a Lesson';

    if (window.DailyChallenges) {
        const challenge   = window.DailyChallenges.getTodaysChallenge();
        const today       = new Date().toDateString();
        let progress      = 0;
        try {
            const stored = localStorage.getItem('dailyChallenge');
            if (stored) {
                const d = JSON.parse(stored);
                if (d.date === today && d.challengeId === challenge.id) progress = d.progress || 0;
            }
        } catch(_) {}

        const isComplete  = progress >= challenge.target;
        const progressPct = Math.min(100, Math.round((progress / challenge.target) * 100));
        const ctaBtnId    = 'dc-cta-btn';
        const ctaBtnHref  = showContinue ? lastUrl : '#';
        const ctaBtnText  = isComplete ? 'âœ“ Done Today!' : ctaLabel;

        slot.innerHTML = `
            <div class="dc-card">
                ${isComplete ? '<div class="dc-complete-badge">âœ“ Done!</div>' : ''}
                <div class="dc-eyebrow">Today's Challenge</div>
                <div style="display:flex;align-items:center;gap:12px;">
                    <span style="font-size:44px;animation:float 3s ease-in-out infinite;display:block;">${challenge.icon}</span>
                    <div>
                        <div class="dc-title">${challenge.title}</div>
                        <div class="dc-desc">${challenge.description}</div>
                    </div>
                </div>
                <div>
                    <div class="dc-bar-wrap"><div class="dc-bar" style="width:${progressPct}%"></div></div>
                    <div style="display:flex;justify-content:space-between;margin-top:6px;">
                        <span style="font-size:12px;font-weight:800;color:rgba(255,255,255,.8);">${progress} / ${challenge.target}</span>
                        <span style="font-size:12px;font-weight:800;color:rgba(255,255,255,.7);" id="dc-timer">â° ${getTimeUntilMidnight()}</span>
                    </div>
                </div>
                <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
                    <div class="dc-xp">ğŸ +${challenge.xpReward} XP</div>
                    <a id="${ctaBtnId}" href="${ctaBtnHref}" class="dc-btn">${ctaBtnText}</a>
                </div>
            </div>`;

        // Wire button to picker if no continue target
        if (!showContinue) {
            const dcBtn = document.getElementById(ctaBtnId);
            if (dcBtn) dcBtn.addEventListener('click', e => { e.preventDefault(); openPicker(); });
        }

    } else {
        slot.innerHTML = `
            <div class="dc-card">
                <div class="dc-eyebrow">Today's Challenge</div>
                <div style="display:flex;align-items:center;gap:12px;">
                    <span style="font-size:44px;">ğŸ¯</span>
                    <div><div class="dc-title">Complete a lesson</div><div class="dc-desc">Any lesson earns you bonus XP today</div></div>
                </div>
                <a id="dc-cta-btn" href="#" class="dc-btn">â–¶ Pick a Lesson</a>
            </div>`;
        document.getElementById('dc-cta-btn').addEventListener('click', e => { e.preventDefault(); openPicker(); });
    }

    setInterval(() => {
        const el = document.getElementById('dc-timer');
        if (el) el.textContent = `â° ${getTimeUntilMidnight()}`;
    }, 60000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HERO â€” LOGGED IN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderUser(stats, user) {
    const profile   = window.EFCD_Auth.getCurrentUser();
    let rawName     = profile?.name || user.user_metadata?.full_name || user.email?.split('@')[0] || 'Dude';
    let firstName   = rawName.split(' ')[0];
    firstName       = firstName.charAt(0).toUpperCase() + firstName.slice(1);
    const finalName = `Cool ${firstName}`;

    const streak  = stats?.streak || 0;
    const xp      = stats?.xp || 0;
    const level   = stats?.level || 1;
    const lessons = stats?.lessonsCompleted || 0;
    const badges  = stats?.achievementCount || 0;
    const xpIn    = xp % 500;
    const xpPct   = Math.min(100, Math.round((xpIn / 500) * 100));
    const xpLeft  = 500 - xpIn;

    const lastUrl      = getLastLessonUrl();
    const lastNm       = getLastLessonName();
    const lastDone     = isLastLessonDone();
    // showContinue: we have a lesson URL AND it hasn't been completed yet
    const showContinue = !!(lastUrl && lastNm && !lastDone);

    const ctaText = showContinue
        ? `ğŸš€ Continue: ${lastNm}`
        : lastUrl
            ? 'ğŸ‰ Find Your Next Lesson'
            : 'ğŸš€ Start a Lesson';

    document.getElementById('hero-card').innerHTML = `
        <div class="hero-top">
            <div>
                <div class="greet">${greet()}</div>
                <div class="uname">${finalName}</div>
            </div>
            <div class="streak-block">
                <span class="sfire">ğŸ”¥</span>
                <span class="snum">${streak}</span>
                <span class="sword">Day Streak</span>
            </div>
        </div>
        <div class="xp-wrap">
            <div class="xp-row"><span>Level ${level}</span><span>${xpLeft} XP to Level ${level+1}</span></div>
            <div class="xp-track"><div class="xp-fill" id="xf"></div></div>
        </div>
        <a id="hero-cta-link" href="${showContinue ? lastUrl : '#'}" class="hero-cta">
            <span>${ctaText}</span>
            <span class="cta-arrow">â€º</span>
        </a>
        <div class="stat-row">
            <div class="stat-pill"><span class="sn">${lessons}</span><span class="sl">Lessons</span></div>
            <div class="stat-pill"><span class="sn">${xp.toLocaleString()}</span><span class="sl">Total XP</span></div>
            <div class="stat-pill"><span class="sn">${badges}</span><span class="sl">Badges</span></div>
        </div>`;

    // Hero CTA opens picker when no continue target
    if (!showContinue) {
        document.getElementById('hero-cta-link').addEventListener('click', e => {
            e.preventDefault(); openPicker();
        });
    }

    requestAnimationFrame(() => setTimeout(() => {
        const f = document.getElementById('xf');
        if (f) f.style.width = xpPct + '%';
    }, 80));

    // Streak banner
    if (streak > 0) {
        const wrap  = document.getElementById('sb-wrap');
        const title = document.getElementById('sb-title');
        const sub   = document.getElementById('sb-sub');
        const link  = document.getElementById('sb-link');
        if (wrap)  wrap.style.display = 'block';
        if (title) title.textContent  = `ğŸ”¥ ${streak}-day streak â€” don't lose it!`;
        // Streak banner: continue if in progress, pick next if done
        if (sub) sub.textContent = showContinue
            ? `Tap to continue: ${lastNm} â†’`
            : 'Pick a new lesson to keep your streak alive â†’';
        if (link) {
            if (showContinue) {
                link.href    = lastUrl;
                link.onclick = null;
            } else {
                link.href    = '#';
                link.onclick = e => { e.preventDefault(); openPicker(); };
            }
        }
    }

    tryLeaderboard();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HERO â€” GUEST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderGuest() {
    document.getElementById('hero-card').innerHTML = `
        <div class="eyebrow">100% Free Setup</div>
        <div class="big-title">Learn English.<br><span class="yellow">Stay Cool.</span></div>
        <div class="hero-sub">Earn XP, build streaks, and unlock badges. Real lessons that are actually fun.</div>
        <div class="guest-btns">
            <a href="/signup/" class="btn-yellow">ğŸš€ Start Free</a>
            <a href="/login/"  class="btn-white">Log In</a>
        </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEADERBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function tryLeaderboard() {
    if (!window.EFCD_Auth?.getLeaderboard) return;
    try {
        const data = await window.EFCD_Auth.getLeaderboard(5);
        if (!data?.length) return;
        const me  = window.EFCD_Auth.getCurrentUser();
        const em  = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','4','5'];
        const rows = data.map((e, i) => {
            const you      = me && e.user_id === me.id;
            const metaName = e.raw_user_meta_data?.full_name || e.raw_user_meta_data?.name || e.display_name || 'Cool Dude';
            return `<div class="lb-row${you?' you':''}">
                <span class="lb-rank">${em[i]}</span>
                <div class="lb-av">${metaName[0].toUpperCase()}</div>
                <span class="lb-name">${metaName}${you?' <small style="color:var(--blue)">(you)</small>':''}</span>
                <span class="lb-xp">${(e.xp||0).toLocaleString()} XP</span>
            </div>`;
        }).join('');
        document.getElementById('lb-rows').innerHTML = rows;
        document.getElementById('lb-section').style.display = 'block';
    } catch(_) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function boot() {
    if (typeof window.efcdReady === 'undefined') { setTimeout(boot, 50); return; }
    window.efcdReady.then(async () => {
        try {
            await window.EFCD_Auth.initAuth();
            const user = window.EFCD_Auth.getCurrentUser();
            if (user) { renderUser(window.EFCD_Auth.getUserStats(), user); }
            else       { renderGuest(); }
            if (window.EFCD_UI) {
                window.EFCD_UI.updateHeaderUI();
                window.EFCD_UI.showWelcomeMessage();
            }
        } catch(e) {
            console.error('Boot error:', e);
            renderGuest();
        }
        renderDC();
        renderPick();
        document.getElementById('picks-shuffle-btn')?.addEventListener('click', renderPick);
        setInterval(renderPick, 20000);
    }).catch(() => { renderGuest(); renderDC(); renderPick(); });
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', boot);
} else {
    boot();
}
</script>

</body>
</html>
