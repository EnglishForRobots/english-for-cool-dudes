<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <title>ğŸ­ Satire in the Spotlight â€” English For Cool Dudes</title>

    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/init-auth.js"></script>

    <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOKENS â€” exact homepage / Elon lesson system
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
        --blue:         #1CB0F6;
        --blue-shadow:  #1899D6;
        --yellow:       #FFC800;
        --yellow-shadow:#E5B400;
        --green:        #58CC02;
        --green-shadow: #58A700;
        --punch:        #FF4B4B;
        --punch-shadow: #EA2B2B;
        --purple:       #CE82FF;
        --purple-shadow:#A559D9;
        --teal:         #2BDECC;
        --teal-shadow:  #1FBFAF;
        --bg:           #F7F9FA;
        --white:        #FFFFFF;
        --ink:          #4B4B4B;
        --ink-bold:     #111827;
        --ink-3:        #AFAFAF;
        --border:       #E5E5E5;
        --border-heavy: #CECECE;
        --r:            24px;
        --rsm:          16px;
        --rxs:          10px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }
    body {
        background: var(--bg);
        color: var(--ink);
        font-family: 'Nunito', -apple-system, system-ui, sans-serif;
        line-height: 1.5;
        overflow-x: hidden;
        padding-bottom: 84px;
    }
    @media(min-width:768px){ body { padding-bottom: 0; } }
    a { color: inherit; text-decoration: none; }
    button { font-family: inherit; cursor: pointer; }

    /* â”€â”€ ANIMATIONS â”€â”€ */
    @keyframes up      { from{opacity:0;transform:translateY(22px)} to{opacity:1;transform:translateY(0)} }
    @keyframes popin   { 0%{opacity:0;transform:scale(.88)} 70%{transform:scale(1.03)} 100%{opacity:1;transform:scale(1)} }
    @keyframes flick   { 0%,100%{transform:rotate(-4deg) scale(1)} 50%{transform:rotate(4deg) scale(1.12)} }
    @keyframes shim    { 0%{background-position:-400px 0} 100%{background-position:400px 0} }
    @keyframes slideIn { from{opacity:0;transform:translateX(28px)} to{opacity:1;transform:translateX(0)} }
    @keyframes slideOut{ from{opacity:1;transform:translateX(0)} to{opacity:0;transform:translateX(-28px)} }
    @keyframes confetti{ 0%{opacity:1;transform:translateY(0) rotate(0deg)} 100%{opacity:0;transform:translateY(130px) rotate(400deg)} }
    @keyframes float   { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
    @keyframes gavel   { 0%{transform:rotate(-30deg)} 50%{transform:rotate(10deg)} 100%{transform:rotate(-30deg)} }

    .u1{animation:up .44s ease both .04s} .u2{animation:up .44s ease both .14s}
    .u3{animation:up .44s ease both .24s} .u4{animation:up .44s ease both .34s}

    /* â”€â”€ HEADER â”€â”€ */
    .header {
        background: var(--white); border-bottom: 2px solid var(--border);
        position: sticky; top: 0; z-index: 200;
        padding: 0 20px; height: 60px; display: flex; align-items: center;
    }
    .hc { max-width: 900px; width: 100%; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
    .hl { display: flex; align-items: center; gap: 10px; }
    .logo {
        width: 40px; height: 40px; border-radius: 12px;
        background: var(--punch); border: 2px solid var(--punch-shadow);
        display: flex; align-items: center; justify-content: center;
        font-size: 22px; flex-shrink: 0;
        box-shadow: 0 3px 0 var(--punch-shadow);
        transition: transform .1s, box-shadow .1s;
    }
    .logo:active { transform: translateY(2px); box-shadow: 0 1px 0 var(--punch-shadow); }
    .site-title { font-size: 18px; font-weight: 900; color: var(--ink-bold); letter-spacing: -.4px; }
    @media(max-width:380px){ .site-title{display:none} }
    .hdr-stats { display: flex; align-items: center; gap: 8px; }
    .hdr-pill {
        display: flex; align-items: center; gap: 5px;
        background: var(--bg); border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy);
        padding: 5px 12px; border-radius: var(--rxs);
        font-size: 14px; font-weight: 900; color: var(--ink-bold);
    }

    /* â”€â”€ PAGE â”€â”€ */
    .page { max-width: 900px; margin: 0 auto; padding: 24px 16px; display: flex; flex-direction: column; gap: 16px; }

    /* â”€â”€ LESSON BANNER â€” punch/red for satire theme â”€â”€ */
    .lesson-banner {
        background: var(--punch);
        border: 2px solid var(--punch-shadow);
        border-bottom: 6px solid var(--punch-shadow);
        border-radius: var(--r);
        padding: 24px 20px 20px;
        position: relative; overflow: hidden;
    }
    .lesson-banner::after {
        content: 'ğŸ­';
        position: absolute; bottom: -16px; right: 8px;
        font-size: 120px; opacity: .12; pointer-events: none;
        transform: rotate(-10deg);
    }
    .lesson-eyebrow {
        display: inline-block;
        background: var(--yellow); color: var(--ink-bold);
        font-size: 12px; font-weight: 900;
        text-transform: uppercase; letter-spacing: 1.5px;
        padding: 4px 12px; border-radius: 8px;
        border: 2px solid var(--yellow-shadow);
        margin-bottom: 12px;
    }
    .lesson-title {
        font-size: clamp(24px, 6vw, 38px);
        font-weight: 900; color: var(--white);
        letter-spacing: -1px; line-height: 1.1;
        margin-bottom: 6px; position: relative; z-index: 1;
        text-shadow: 0 2px 0 var(--punch-shadow);
    }
    .lesson-sub { font-size: 15px; font-weight: 700; color: rgba(255,255,255,.9); position: relative; z-index: 1; }

    .prog-wrap { margin-top: 18px; position: relative; z-index: 1; background: rgba(255,255,255,.2); padding: 12px; border-radius: var(--rsm); }
    .prog-row  { display: flex; justify-content: space-between; font-size: 13px; font-weight: 800; color: var(--white); margin-bottom: 8px; }
    .prog-track{ height: 16px; background: rgba(0,0,0,.15); border-radius: 99px; overflow: hidden; border: 2px solid rgba(0,0,0,.1); }
    .prog-fill { height: 100%; width: 0%; border-radius: 99px; background: var(--yellow); border-top: 4px solid rgba(255,255,255,.4); transition: width .7s cubic-bezier(.4,0,.2,1); }

    /* â”€â”€ SECTION CARDS â”€â”€ */
    .sec-card {
        background: var(--white);
        border: 2px solid var(--border-heavy);
        border-bottom: 6px solid var(--border-heavy);
        border-radius: var(--r);
        overflow: hidden;
        opacity: 0; transform: translateY(16px);
        transition: opacity .4s ease, transform .4s ease;
        scroll-margin-top: 72px;
    }
    .sec-card.visible { opacity: 1; transform: translateY(0); }

    .sec-card::before {
        content: ''; display: block; height: 8px;
        border-radius: var(--r) var(--r) 0 0;
        margin: -2px -2px 0;
    }
    .strip-yellow::before { background: var(--yellow); }
    .strip-blue::before   { background: var(--blue);   }
    .strip-green::before  { background: var(--green);  }
    .strip-purple::before { background: var(--purple); }
    .strip-punch::before  { background: var(--punch);  }
    .strip-teal::before   { background: var(--teal);   }
    .strip-red::before    { background: var(--punch);  }

    .sec-head {
        padding: 14px 20px 12px;
        border-bottom: 2px solid var(--border);
        display: flex; align-items: center; justify-content: space-between; gap: 10px;
    }
    .sec-head-left { display: flex; align-items: center; gap: 10px; }
    .sec-head-icon {
        width: 40px; height: 40px; border-radius: 12px;
        display: flex; align-items: center; justify-content: center;
        font-size: 20px; flex-shrink: 0;
        background: var(--bg); border: 2px solid var(--border-heavy);
        border-bottom: 3px solid var(--border-heavy);
    }
    .sec-head-title { font-size: 16px; font-weight: 900; color: var(--ink-bold); letter-spacing: -.3px; }
    .sec-head-sub   { font-size: 12px; font-weight: 700; color: var(--ink-3); margin-top: 1px; }
    .sec-body { padding: 20px; }
    @media(min-width:768px){ .sec-body { padding: 24px; } }

    /* â”€â”€ SEC DIVIDERS â”€â”€ */
    .sec-label {
        font-size: 13px; font-weight: 900; color: var(--ink-3);
        text-transform: uppercase; letter-spacing: 1.5px;
        display: flex; align-items: center; gap: 12px;
    }
    .sec-label::after { content: ''; flex: 1; height: 2px; background: var(--border); border-radius: 2px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       âš–ï¸  ON TRIAL â€” the opener
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .trial-intro {
        background: var(--bg); border: 2px solid var(--border);
        border-left: 5px solid var(--punch);
        border-radius: 0 var(--rsm) var(--rsm) 0;
        padding: 16px; margin-bottom: 18px;
        font-size: 14px; font-weight: 700; color: var(--ink); line-height: 1.6;
    }
    .trial-intro strong { color: var(--punch-shadow); }

    .trial-sides { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 18px; }
    @media(max-width:480px){ .trial-sides { grid-template-columns: 1fr; } }

    .trial-side {
        border: 2px solid var(--border-heavy); border-radius: var(--rsm);
        overflow: hidden;
    }
    .trial-side-head {
        padding: 10px 14px;
        font-size: 13px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px;
    }
    .trial-side.prosecution .trial-side-head { background: rgba(255,75,75,.1); color: var(--punch-shadow); border-bottom: 2px solid rgba(255,75,75,.2); }
    .trial-side.defence     .trial-side-head { background: rgba(88,204,2,.08); color: var(--green-shadow); border-bottom: 2px solid rgba(88,204,2,.2); }
    .trial-side-body { padding: 12px 14px; background: var(--white); }
    .trial-point {
        font-size: 13px; font-weight: 700; color: var(--ink);
        padding: 7px 0 7px 22px; position: relative;
        border-bottom: 1px solid var(--border); line-height: 1.4;
    }
    .trial-point:last-child { border-bottom: none; }
    .trial-side.prosecution .trial-point::before { content: 'âš–ï¸'; position: absolute; left: 0; font-size: 12px; top: 8px; }
    .trial-side.defence     .trial-point::before { content: 'ğŸ¨'; position: absolute; left: 0; font-size: 12px; top: 8px; }

    .verdict-question {
        background: var(--ink-bold); border: 2px solid var(--border-heavy);
        border-radius: var(--rsm); padding: 18px 20px; margin-bottom: 14px; text-align: center;
    }
    .vq-title { font-size: 13px; font-weight: 900; color: var(--yellow); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 8px; }
    .vq-text  { font-size: 17px; font-weight: 900; color: var(--white); line-height: 1.3; }

    .verdict-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 14px; }
    .verdict-btn {
        display: flex; align-items: center; justify-content: center; gap: 6px;
        padding: 14px 10px; min-height: 56px;
        font-size: 15px; font-weight: 900; font-family: inherit;
        border-radius: var(--rsm); border: 2px solid;
        border-bottom-width: 5px;
        -webkit-appearance: none;
        transition: transform .1s, border-bottom-width .1s;
        touch-action: manipulation;
    }
    .verdict-btn:active { border-bottom-width: 2px; transform: translateY(3px); }
    .verdict-btn.guilty     { background: rgba(255,75,75,.08);  border-color: var(--punch-shadow); color: var(--punch-shadow); }
    .verdict-btn.notguilty  { background: rgba(88,204,2,.08);   border-color: var(--green-shadow); color: var(--green-shadow); }
    .verdict-btn.sel-guilty    { background: var(--punch) !important; color: var(--white) !important; border-color: var(--punch-shadow) !important; }
    .verdict-btn.sel-notguilty { background: var(--green) !important; color: var(--white) !important; border-color: var(--green-shadow) !important; }
    .verdict-btn:disabled { opacity: .8; cursor: default; }

    .trial-reveal {
        background: var(--white); border: 2px solid var(--border-heavy);
        border-radius: var(--rsm); overflow: hidden;
        display: none; animation: up .25s ease both;
    }
    .trial-reveal.show { display: block; }
    .trial-verdict-banner {
        padding: 14px 18px;
        font-size: 17px; font-weight: 900;
        background: var(--blue); color: var(--white);
    }
    .trial-verdict-body {
        padding: 14px 18px;
        font-size: 14px; font-weight: 700; color: var(--ink);
        line-height: 1.65; border-top: 2px solid var(--border);
    }
    .trial-verdict-body a.voc-link {
        color: var(--blue); font-weight: 900;
        border-bottom: 2.5px solid rgba(28,176,246,.4);
        cursor: pointer;
    }

    .trial-next-btn {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; margin-top: 14px; padding: 15px;
        background: var(--punch); color: var(--white);
        font-size: 16px; font-weight: 900; font-family: inherit;
        border: 2px solid var(--punch-shadow); border-bottom: 5px solid var(--punch-shadow);
        border-radius: var(--rsm);
        transition: transform .1s, border-bottom-width .1s;
        animation: float 3s ease-in-out infinite;
        touch-action: manipulation;
    }
    .trial-next-btn:active { border-bottom-width: 2px; transform: translateY(3px); }

    .trial-done {
        text-align: center; padding: 32px 20px;
        animation: popin .4s cubic-bezier(.175,.885,.32,1.275) both;
    }
    .trial-done-icon  { font-size: 60px; display: block; margin-bottom: 10px; animation: gavel 1.5s ease-in-out 2; }
    .trial-done-title { font-size: 22px; font-weight: 900; color: var(--ink-bold); margin-bottom: 8px; }
    .trial-done-sub   { font-size: 14px; font-weight: 700; color: var(--ink-3); margin-bottom: 22px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ğŸ“° READING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .fact-box {
        background: var(--ink-bold); border: 2px solid var(--border-heavy);
        border-bottom: 4px solid #000; border-radius: var(--rsm);
        padding: 16px; margin-bottom: 16px;
    }
    .fact-title { font-size: 11px; font-weight: 900; color: var(--yellow); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px; }
    .fact-item {
        font-size: 13px; font-weight: 700; color: rgba(255,255,255,.85);
        padding: 7px 0 7px 20px; position: relative;
        border-bottom: 1px solid rgba(255,255,255,.08); line-height: 1.4;
    }
    .fact-item:last-child { border-bottom: none; }
    .fact-item::before { content: 'â– '; position: absolute; left: 0; color: var(--yellow); font-size: .65em; top: 11px; }

    .reading-text {
        background: var(--white);
        border-left: 5px solid var(--punch);
        border-radius: 0 var(--rsm) var(--rsm) 0;
        padding: 18px 20px; font-size: 15px; line-height: 1.85;
        color: var(--ink-bold);
    }
    .reading-text p { margin-bottom: 1.1em; }
    .reading-text p:last-child { margin-bottom: 0; }

    /* vocab highlight in reading â€” clickable */
    .v-word {
        color: var(--punch-shadow); font-weight: 900;
        border-bottom: 2.5px solid rgba(255,75,75,.4);
        cursor: pointer;
    }

    /* discussion box */
    .discussion {
        background: var(--bg); border: 2px solid var(--border);
        border-left: 5px solid var(--blue);
        border-radius: 0 var(--rsm) var(--rsm) 0;
        padding: 14px 16px; margin-top: 16px;
    }
    .discussion-title { font-size: 12px; font-weight: 900; color: var(--blue-shadow); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
    .disc-item {
        font-size: 14px; font-weight: 700; color: var(--ink);
        padding: 7px 0 7px 26px; position: relative;
        border-bottom: 1px solid var(--border); line-height: 1.4;
    }
    .disc-item:last-child { border-bottom: none; }
    .disc-item::before { content: 'ğŸ’¬'; position: absolute; left: 0; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUESTION BOXES & OPTIONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .q-box {
        background: var(--bg); border: 2px solid var(--border);
        border-radius: var(--rsm); padding: 15px; margin-bottom: 10px;
    }
    .q-text { font-size: 15px; font-weight: 800; color: var(--ink-bold); margin-bottom: 10px; line-height: 1.4; }

    .opt-btn {
        display: block; width: 100%; text-align: left;
        padding: 13px 15px; min-height: 50px; margin-top: 7px;
        background: var(--white);
        border: 2px solid var(--border-heavy);
        border-bottom: 5px solid var(--border-heavy);
        border-radius: var(--rsm);
        font-size: 14px; font-weight: 800; color: var(--ink);
        font-family: inherit; -webkit-appearance: none;
        transition: transform .1s, border-bottom-width .1s;
        cursor: pointer; touch-action: manipulation;
    }
    .opt-btn:active   { border-bottom-width: 2px; transform: translateY(3px); }
    .opt-btn.selected { border-color: var(--punch); border-bottom-color: var(--punch-shadow); color: var(--punch-shadow); background: rgba(255,75,75,.05); }
    .opt-btn.correct  { background: var(--green)  !important; color: var(--white) !important; border-color: var(--green-shadow) !important; }
    .opt-btn.incorrect{ background: var(--punch)  !important; color: var(--white) !important; border-color: var(--punch-shadow) !important; }

    /* â”€â”€ WORD BANK â”€â”€ */
    .word-bank { background: var(--bg); border: 2px solid var(--border); border-radius: var(--rsm); padding: 14px; margin-bottom: 14px; }
    .wb-label  { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px; }
    .wb-words  { display: flex; flex-wrap: wrap; gap: 8px; }
    .wb-word {
        background: var(--white); color: var(--punch-shadow);
        padding: 8px 14px; border-radius: var(--rsm);
        border: 2px solid var(--punch-shadow);
        border-bottom: 4px solid var(--punch-shadow);
        font-weight: 900; font-size: 13px; font-family: inherit;
        -webkit-appearance: none; touch-action: manipulation;
        transition: transform .1s, border-bottom-width .1s;
    }
    .wb-word:active { border-bottom-width: 2px; transform: translateY(2px); }
    .wb-word.sel  { background: var(--punch); color: var(--white); }
    .wb-word.used { opacity: .22; pointer-events: none; }

    .gap-sents { font-size: 15px; font-weight: 700; line-height: 3.6; color: var(--ink); }
    .gap {
        display: inline-block; text-align: center; min-width: 112px;
        background: var(--white); border: 2px dashed var(--punch);
        border-radius: var(--rsm); padding: 4px 10px; margin: 0 3px;
        font-weight: 900; color: var(--punch-shadow); font-size: 13px;
        cursor: pointer; min-height: 34px; transition: background .15s;
    }
    .gap.correct  { background: var(--green) !important; border-color: var(--green-shadow) !important; border-style: solid; color: var(--white); pointer-events: none; }
    .gap.incorrect{ background: var(--punch) !important; border-color: var(--punch-shadow) !important; border-style: solid; color: var(--white); }

    /* â”€â”€ WORD FORMS â”€â”€ */
    .wf-item   { margin-bottom: 16px; }
    .wf-prompt { font-weight: 800; color: var(--ink-bold); margin-bottom: 7px; font-size: 14px; font-style: italic; line-height: 1.4; }
    .wf-input {
        width: 100%; padding: 13px 15px; min-height: 50px;
        background: var(--white);
        border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy);
        border-radius: var(--rsm);
        font-size: 16px; font-weight: 800; color: var(--ink-bold);
        font-family: inherit; transition: border-color .2s;
    }
    .wf-input:focus { outline: none; border-color: var(--punch); border-bottom-color: var(--punch-shadow); }
    .wf-input::placeholder { color: var(--ink-3); font-weight: 700; }
    .wf-input.ok  { border-color: var(--green-shadow) !important; background: rgba(88,204,2,.06); color: var(--green-shadow); }
    .wf-input.bad { border-color: var(--punch-shadow) !important; background: rgba(255,75,75,.06); color: var(--punch-shadow); }

    /* â”€â”€ GRAMMAR â”€â”€ */
    .gram-expl {
        background: var(--bg); border: 2px solid var(--border);
        border-left: 5px solid var(--purple);
        border-radius: 0 var(--rsm) var(--rsm) 0;
        padding: 16px; margin-bottom: 16px;
    }
    .gram-expl h4 { font-size: 11px; font-weight: 900; color: var(--purple-shadow); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 8px; }
    .gram-expl p  { font-size: 14px; font-weight: 700; color: var(--ink); margin-bottom: 8px; line-height: 1.5; }
    .gram-ex { padding: 8px 12px; margin: 5px 0; background: rgba(206,130,255,.1); border-left: 3px solid var(--purple); border-radius: 0 8px 8px 0; font-size: 13px; font-weight: 700; line-height: 1.5; }
    .gram-ex strong { color: var(--purple-shadow); font-weight: 900; }

    .gram-card {
        background: var(--bg); border: 2px solid var(--border);
        border-radius: var(--rsm); padding: 15px; margin-bottom: 10px;
    }
    @media(min-width:640px){ .gram-card { display: flex; align-items: center; gap: 16px; } }
    .gc-body { margin-bottom: 10px; flex: 1; }
    @media(min-width:640px){ .gc-body { margin-bottom: 0; } }
    .gc-sent { font-weight: 800; color: var(--ink-bold); font-size: 15px; margin-bottom: 4px; line-height: 1.4; }
    .gc-hint { font-size: 12px; font-weight: 700; color: var(--ink-3); font-style: italic; }
    .gram-sel {
        width: 100%; padding: 12px 14px; min-height: 48px;
        background: var(--white); border: 2px solid var(--border-heavy);
        border-bottom: 4px solid var(--border-heavy);
        border-radius: var(--rsm); font-size: 15px; font-weight: 800;
        color: var(--ink); font-family: inherit; -webkit-appearance: none;
        transition: border-color .15s;
    }
    @media(min-width:640px){ .gram-sel { width: auto; min-width: 220px; } }
    .gram-sel.correct  { background: var(--green); color: var(--white); border-color: var(--green-shadow); }
    .gram-sel.incorrect{ background: var(--punch); color: var(--white); border-color: var(--punch-shadow); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ğŸ“° FAKE NEWS OR REAL?
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .fn-intro {
        background: var(--ink-bold); border: 2px solid var(--border-heavy);
        border-radius: var(--rsm); padding: 16px; margin-bottom: 16px;
        font-size: 14px; font-weight: 700; color: rgba(255,255,255,.85); line-height: 1.6;
    }
    .fn-intro strong { color: var(--yellow); }
    .fn-card {
        background: var(--bg); border: 2px solid var(--border);
        border-radius: var(--rsm); padding: 16px; margin-bottom: 12px;
    }
    .fn-headline {
        font-size: 16px; font-weight: 900; color: var(--ink-bold);
        line-height: 1.3; margin-bottom: 12px;
        padding-bottom: 12px; border-bottom: 2px solid var(--border);
    }
    .fn-headline .fn-source {
        display: block; font-size: 11px; font-weight: 900; color: var(--ink-3);
        text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;
    }
    .fn-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .fn-btn {
        display: flex; align-items: center; justify-content: center; gap: 5px;
        padding: 11px 8px; min-height: 46px;
        font-size: 14px; font-weight: 900; font-family: inherit;
        border-radius: var(--rsm); border: 2px solid;
        border-bottom-width: 4px;
        -webkit-appearance: none;
        transition: transform .1s, border-bottom-width .1s;
        touch-action: manipulation;
    }
    .fn-btn:active { border-bottom-width: 2px; transform: translateY(2px); }
    .fn-btn.real   { background: rgba(88,204,2,.08);  border-color: var(--green-shadow); color: var(--green-shadow); }
    .fn-btn.satire { background: rgba(255,75,75,.08); border-color: var(--punch-shadow); color: var(--punch-shadow); }
    .fn-btn.sel-real   { background: var(--green) !important; color: var(--white) !important; border-color: var(--green-shadow) !important; }
    .fn-btn.sel-satire { background: var(--punch) !important; color: var(--white) !important; border-color: var(--punch-shadow) !important; }
    .fn-btn:disabled { opacity: .8; cursor: default; }

    .fn-reveal {
        margin-top: 10px; padding: 12px 14px;
        border: 2px solid var(--border-heavy);
        border-radius: var(--rsm); background: var(--white);
        font-size: 13px; font-weight: 700; color: var(--ink);
        line-height: 1.55; display: none; animation: up .2s ease both;
    }
    .fn-reveal.show { display: block; }
    .fn-reveal .fn-verd {
        font-size: 14px; font-weight: 900;
        padding: 8px 12px; border-radius: var(--rxs); margin-bottom: 8px;
        display: inline-block;
    }
    .fn-verd.right { background: rgba(88,204,2,.1); color: var(--green-shadow); }
    .fn-verd.wrong { background: rgba(255,75,75,.1); color: var(--punch-shadow); }

    .fn-done {
        text-align: center; padding: 28px 20px;
        animation: popin .4s cubic-bezier(.175,.885,.32,1.275) both;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BUTTONS (check / reveal / reset)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn-row { margin-top: 18px; display: flex; flex-direction: column; gap: 10px; align-items: stretch; }
    @media(min-width:640px){ .btn-row { flex-direction: row; justify-content: center; align-items: center; } }

    .btn-check, .btn-reveal, .btn-reset {
        padding: 13px 24px; min-height: 50px;
        font-size: 15px; font-weight: 900; font-family: inherit;
        border-radius: var(--rsm); border: 2px solid;
        border-bottom-width: 5px; -webkit-appearance: none;
        transition: transform .1s, border-bottom-width .1s;
        touch-action: manipulation;
    }
    @media(min-width:640px){ .btn-check,.btn-reveal,.btn-reset { width: auto; } }
    .btn-check:active, .btn-reveal:active, .btn-reset:active { border-bottom-width: 2px; transform: translateY(3px); }
    .btn-check  { background: var(--punch);  color: var(--white); border-color: var(--punch-shadow); }
    .btn-reveal { background: rgba(206,130,255,.15); color: var(--purple-shadow); border-color: var(--purple); }
    .btn-reset  { background: var(--bg); color: var(--ink-3); border-color: var(--border-heavy); }

    .result {
        margin-top: 12px; padding: 13px 16px;
        border-radius: var(--rsm); font-weight: 800; font-size: 15px;
        border: 2px solid; display: none;
    }
    .result.ok  { background: rgba(88,204,2,.09);  color: var(--green-shadow); border-color: var(--green-shadow); }
    .result.bad { background: rgba(255,75,75,.09); color: var(--punch-shadow); border-color: var(--punch-shadow); }

    /* go button â€” green */
    .go-btn {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; margin-top: 18px; padding: 16px;
        background: var(--green); color: var(--white);
        font-size: 16px; font-weight: 900; font-family: inherit;
        border: 2px solid var(--green-shadow); border-bottom: 5px solid var(--green-shadow);
        border-radius: var(--rsm);
        transition: transform .1s, border-bottom-width .1s;
        touch-action: manipulation;
    }
    .go-btn:active { border-bottom-width: 2px; transform: translateY(3px); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VOCAB GLOSSARY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .voc-grid { display: grid; grid-template-columns: 1fr; gap: 8px; }
    @media(min-width:600px){ .voc-grid { grid-template-columns: 1fr 1fr; } }
    .voc-item {
        background: var(--bg); border: 2px solid var(--border);
        border-radius: var(--rsm); padding: 12px 14px;
        display: flex; flex-direction: column; gap: 3px;
        cursor: pointer; transition: border-color .15s;
    }
    .voc-item:hover { border-color: var(--punch); }
    .voc-item-word { font-size: 15px; font-weight: 900; color: var(--punch-shadow); }
    .voc-item-type { font-size: 10px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 1px; }
    .voc-item-def  { font-size: 13px; font-weight: 700; color: var(--ink); line-height: 1.45; margin-top: 2px; }

    /* â”€â”€ HINT SYSTEM â”€â”€ */
    .hint-btn {
        display: inline-flex; align-items: center; gap: 4px;
        font-size: 12px; font-weight: 900; color: var(--ink-3);
        background: none; border: none; padding: 4px 0;
        cursor: pointer; font-family: inherit; transition: color .15s;
    }
    .hint-btn:hover { color: var(--purple-shadow); }
    .hint-text {
        font-size: 12px; font-weight: 700; color: var(--purple-shadow);
        background: rgba(206,130,255,.1); border: 1px solid rgba(206,130,255,.3);
        border-radius: 8px; padding: 6px 10px; margin-top: 6px;
        display: none; line-height: 1.4;
    }
    .hint-text.show { display: block; }

    /* â”€â”€ BOTTOM NAV â”€â”€ */
    .bot-nav {
        position: fixed; bottom: 0; left: 0; right: 0;
        background: var(--white); border-top: 2px solid var(--border);
        padding: 10px 16px;
        padding-bottom: calc(10px + env(safe-area-inset-bottom));
        display: flex; align-items: center; gap: 10px; z-index: 200;
    }
    @media(min-width:768px){ .bot-nav { display: none; } }
    .bn-btn {
        flex: 1; background: var(--bg); color: var(--ink-bold);
        border: 2px solid var(--border-heavy); border-bottom: 4px solid var(--border-heavy);
        padding: 12px; border-radius: var(--rsm);
        font-weight: 900; font-size: 15px; min-height: 50px;
        font-family: inherit; -webkit-appearance: none;
        transition: transform .1s, border-bottom-width .1s;
        touch-action: manipulation;
    }
    .bn-btn:active { border-bottom-width: 2px; transform: translateY(2px); }
    .bn-btn.primary { flex: 2; background: var(--punch); color: var(--white); border-color: var(--punch-shadow); }
    .bn-btn:disabled { opacity: .35; cursor: not-allowed; }
    .bn-ind { font-size: 12px; font-weight: 900; color: var(--ink-3); white-space: nowrap; text-align: center; min-width: 40px; }

    /* â”€â”€ VOCAB POPUP â”€â”€ */
    #voc-popup {
        position: fixed; bottom: 76px; left: 12px; right: 12px;
        background: var(--white);
        border: 2px solid var(--border-heavy);
        border-bottom: 6px solid var(--border-heavy);
        border-top: 4px solid var(--punch);
        padding: 18px 18px 20px; border-radius: var(--r) var(--r) var(--rsm) var(--rsm);
        z-index: 500; display: none;
        box-shadow: 0 -8px 32px rgba(0,0,0,.12);
        animation: up .22s ease both;
        max-height: 46vh; overflow-y: auto;
    }
    @media(min-width:768px){
        #voc-popup { position: fixed; bottom: 24px; right: 24px; left: auto; max-width: 310px; border-radius: var(--r); }
    }
    .vp-close {
        position: absolute; top: 10px; right: 10px;
        width: 32px; height: 32px; border-radius: var(--rxs);
        background: var(--bg); border: 2px solid var(--border-heavy);
        font-size: 18px; font-weight: 900; color: var(--ink-3);
        display: flex; align-items: center; justify-content: center;
        -webkit-appearance: none; cursor: pointer;
    }
    .voc-word { font-size: 22px; font-weight: 900; color: var(--punch-shadow); letter-spacing: -.4px; margin-bottom: 2px; }
    .voc-type { font-size: 11px; font-weight: 900; color: var(--ink-3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
    .voc-def  { font-size: 14px; font-weight: 700; color: var(--ink); line-height: 1.65; margin-bottom: 14px; }
    .voc-hear {
        width: 100%; padding: 13px;
        background: var(--punch); color: var(--white);
        border: 2px solid var(--punch-shadow); border-bottom: 5px solid var(--punch-shadow);
        border-radius: var(--rsm); font-size: 15px; font-weight: 900; font-family: inherit;
        transition: transform .1s, border-bottom-width .1s; cursor: pointer;
    }
    .voc-hear:active { border-bottom-width: 2px; transform: translateY(3px); }

    /* â”€â”€ BADGES â”€â”€ */
    .badge-wrap { position: fixed; top: 70px; right: 12px; display: flex; flex-direction: column; gap: 8px; z-index: 999; }
    .badge {
        background: var(--white);
        border: 2px solid var(--border-heavy); border-bottom: 4px solid var(--border-heavy);
        border-left: 4px solid var(--punch);
        padding: 10px 14px; border-radius: var(--rsm);
        display: flex; align-items: center; gap: 8px;
        transform: translateX(240px); opacity: 0;
        transition: transform .4s, opacity .4s;
        box-shadow: 0 4px 14px rgba(0,0,0,.1);
    }
    .badge.show { transform: translateX(0); opacity: 1; }
    .badge-icon { font-size: 22px; }
    .badge-text { font-size: 13px; font-weight: 900; color: var(--ink-bold); }

    /* confetti */
    .confetti-dot {
        position: fixed; width: 10px; height: 10px; border-radius: 3px;
        pointer-events: none; z-index: 9999;
        animation: confetti .9s ease-out both;
    }
    </style>
</head>
<body>

<!-- â”€â”€ HEADER â”€â”€ -->
<header class="header">
    <div class="hc">
        <div class="hl">
            <a href="/" class="logo">ğŸ­</a>
            <a href="/" class="site-title">English For Cool Dudes</a>
        </div>
        <div class="hdr-stats">
            <div class="hdr-pill">ğŸ”¥ <span id="hdr-streak">0</span></div>
            <div class="hdr-pill">âš¡ <span id="hdr-xp">0</span> XP</div>
        </div>
    </div>
</header>

<div class="badge-wrap" id="badge-wrap"></div>
<div id="voc-popup">
    <button class="vp-close" onclick="closeVoc()">Ã—</button>
    <div id="vp-body"></div>
</div>

<div class="page">

    <!-- LESSON BANNER -->
    <div class="lesson-banner u1">
        <div class="lesson-eyebrow">âš¡ Advanced Â· Current Affairs</div>
        <div class="lesson-title">Satire in the Spotlight</div>
        <div class="lesson-sub">Art, power, and papier-mÃ¢chÃ© â€” a German artist on trial in Moscow!</div>
        <div class="prog-wrap">
            <div class="prog-row">
                <span id="prog-label">0 / 8 sections</span>
                <span id="prog-pct">0%</span>
            </div>
            <div class="prog-track"><div class="prog-fill" id="prog-fill"></div></div>
        </div>
    </div>

    <!-- SECTIONS injected by JS -->
    <div id="sections"></div>

</div>

<!-- Mobile bottom nav -->
<nav class="bot-nav">
    <button class="bn-btn" id="bn-prev" onclick="prevSec()" disabled>â† Back</button>
    <span class="bn-ind" id="bn-ind">1/8</span>
    <button class="bn-btn primary" id="bn-next" onclick="nextSec()">Next â†’</button>
</nav>

<script src="/supabase-auth-gamified.js"></script>
<script src="/daily-challenges-system.js"></script>
<script src="/word-match-game.js"></script>

<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LESSON DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const L = {
    title:      "ğŸ­ Satire in the Spotlight",
    lessonId:   "carnival-satire",
    lessonLink: "/carnival-satire/",
    levelPage:  "/advanced/",
    level:      "Advanced",

    vocabulary: [
        { word:"Satirists",    type:"noun",
          definition:"People who use humour, irony, or exaggeration to criticise people or ideas." },
        { word:"Sculptor",     type:"noun",
          definition:"An artist who makes three-dimensional works of art by carving or shaping materials." },
        { word:"Discrediting", type:"verb",
          definition:"Damaging the reputation or good opinion of someone or something." },
        { word:"Extradition",  type:"noun",
          definition:"The process of sending a person accused of a crime back to the country where the crime was committed." },
        { word:"Unprecedented",type:"adjective",
          definition:"Never having happened or existed before." },
        { word:"In absentia",  type:"phrase",
          definition:"Latin phrase meaning 'while absent' â€” a trial held without the accused being present." },
        { word:"Satirical",    type:"adjective",
          definition:"Using satire â€” using humour and criticism to expose problems or foolishness." },
        { word:"Dismantles",   type:"verb",
          definition:"Takes something apart, piece by piece." },
        { word:"Extremists",   type:"noun",
          definition:"People who hold views far outside what is normally accepted, often dangerously so." },
        { word:"Recurring",    type:"adjective",
          definition:"Happening again and again, repeatedly." }
    ],

    /* â”€â”€ âš–ï¸ ON TRIAL â€” 3 rounds â”€â”€ */
    trial: [
        {
            question: "Should Jacques Tilly be found GUILTY of spreading false information about Russia?",
            prosecution: [
                "Tilly's floats were seen by millions and portrayed Russia's army negatively",
                "Russia says the artwork damaged its reputation during wartime",
                "He has repeatedly targeted Putin â€” this is not accidental"
            ],
            defence: [
                "The artwork was created on German soil, under German law",
                "Satire is a protected form of expression in democracies",
                "Carnival's 'fools' freedom' has allowed political mockery since the 19th century"
            ],
            verdict: "âš–ï¸ Most legal experts say: NOT GUILTY. Creating satirical art in Germany is fully legal under German and European law. Russia has no jurisdiction over German citizens for artwork made in Germany.",
            explain: `This is why the case is called <span class="voc-link" data-voc="Unprecedented">unprecedented</span> â€” it's the first time Russia has put a German citizen on trial for art made on German soil. Even if the trial finds him guilty, Tilly is safe in Germany.`
        },
        {
            question: "Is Russia's real goal JUSTICE â€” or is it SILENCING a critic?",
            prosecution: [
                "Every country has the right to protect its military reputation",
                "The charges follow specific Russian laws passed in 2022",
                "Tilly's floats included what Russia calls 'false information'"
            ],
            defence: [
                "The trial is happening in absentia â€” Tilly wasn't even invited to defend himself",
                "No other country faces prosecution for mocking Putin",
                "Timing: charges came just after floats criticising the Ukraine war"
            ],
            verdict: "ğŸ” Most observers say: SILENCING. Trying someone in absentia, in another country, for art, is seen internationally as political intimidation â€” not a genuine legal process.",
            explain: `A trial <span class="voc-link" data-voc="In absentia">in absentia</span> means Tilly was never in the courtroom. <span class="voc-link" data-voc="Extradition">Extradition</span> from Germany to Russia is essentially impossible â€” so Russia knows it will never imprison him. The trial sends a message, not a sentence.`
        },
        {
            question: "Could Tilly be ARRESTED if he travels abroad?",
            prosecution: [
                "Russia has issued an international arrest warrant",
                "Some countries DO have extradition treaties with Russia",
                "Interpol could theoretically be asked to act"
            ],
            defence: [
                "Most Western countries would refuse to extradite him",
                "Germany has confirmed it will not extradite Tilly",
                "Interpol generally does not process politically-motivated requests"
            ],
            verdict: "âš ï¸ YES â€” but only in countries with extradition agreements with Russia. He is safe in Germany and most of the EU, but would need to check carefully before any international travel.",
            explain: `<span class="voc-link" data-voc="Extradition">Extradition</span> agreements vary by country. Tilly's team says he checks the legal situation before every international trip. Most European nations, the US, Canada and Australia would not extradite him â€” but some others might.`
        }
    ],

    /* â”€â”€ ğŸ¬ VIDEO â”€â”€ */
    videoUrl: "https://www.youtube-nocookie.com/embed/quBjeKV4vWI?si=82BmlJymBH6jUjfC",
    videoIntro: "Watch this DW documentary about Jacques Tilly, the German sculptor whose carnival floats have landed him in serious trouble with Russia. Pay attention to the key events, people, and legal arguments mentioned.",
    discussion: [
        "Have you ever seen political cartoons or satire in your country? What did you think?",
        "Should artists be allowed to mock political leaders? Where is the line?",
        "Why do you think Russia is putting a German artist on trial?"
    ],

    /* â”€â”€ ğŸ“° READING â”€â”€ */
    facts: [
        "DÃ¼sseldorf's Rose Monday parade is one of the largest carnival events in Germany",
        "Jacques Tilly has been building satirical floats since the 1980s",
        "Russia charged Tilly in December â€” the trial has been postponed multiple times",
        "The tradition of political satire at carnival dates back to the 19th century"
    ],
    reading: `<p>Jacques Tilly is a German <span class="v-word" data-voc="Sculptor">sculptor</span> based in DÃ¼sseldorf. For decades, he has been one of Germany's most famous <span class="v-word" data-voc="Satirists">satirists</span>, creating giant papier-mÃ¢chÃ© figures that mock politicians, <span class="v-word" data-voc="Extremists">extremists</span>, and powerful people around the world.</p>
<p>Every year, his <span class="v-word" data-voc="Satirical">satirical</span> floats appear in the Rose Monday parade â€” the highlight of the Rhineland carnival season. The tradition dates to the 19th century, when carnival's so-called "fools' freedom" allowed people to challenge those in power more openly than usual.</p>
<p>This year, however, Tilly's art has had real-world consequences. Russian authorities have accused him of <span class="v-word" data-voc="Discrediting">discrediting</span> the Russian army and spreading false information. He is now on trial in Moscow â€” <span class="v-word" data-voc="In absentia">in absentia</span>, meaning without being present in the courtroom.</p>
<p>This is an <span class="v-word" data-voc="Unprecedented">unprecedented</span> case: Russia is putting a German citizen on trial for artwork created on German soil. Because Tilly lives in Germany, he would only face arrest if he travels to countries with <span class="v-word" data-voc="Extradition">extradition</span> agreements with Russia.</p>
<p>Putin has been a <span class="v-word" data-voc="Recurring">recurring</span> target of Tilly's work â€” from the relationship between the Kremlin and the Russian Orthodox Church, to Russia's war in Ukraine. The day after each Rose Monday parade, Tilly's team <span class="v-word" data-voc="Dismantles">dismantles</span> the floats â€” but the debate over artistic freedom continues long after.</p>`,

    /* â”€â”€ EXERCISES â”€â”€ */
    exercises: [
        {
            type:"trueFalse", col:"green", icon:"âœ…",
            title:"True or False?",
            sub:"All answers are in the reading above",
            questions:[
                { q:"Jacques Tilly is a French sculptor living in Paris.",                           a:false },
                { q:"The Rose Monday parade takes place in Germany's Rhineland region.",             a:true  },
                { q:"Tilly was arrested in Germany after the charges were filed.",                   a:false },
                { q:"The tradition of political satire at carnival dates back to the 19th century.", a:true  },
                { q:"The floats are kept on display in a museum after the parade.",                  a:false }
            ]
        },
        {
            type:"multipleChoice", col:"blue", icon:"ğŸ¯",
            title:"Comprehension Check",
            sub:"Choose the best answer â€” all answers are in the reading above",
            questions:[
                { q:"Why is the case against Jacques Tilly described as 'unprecedented'?",
                  opts:["Because it is the first time an artist has been arrested at a carnival parade",
                        "Because Russia is putting a German citizen on trial for artwork made in Germany",
                        "Because Tilly refused to appear in a Russian court in person"],
                  correct:1 },
                { q:"What does 'in absentia' mean in the context of Tilly's trial?",
                  opts:["The trial is happening without Tilly being present",
                        "The trial has been cancelled permanently",
                        "Tilly has been found not guilty"],
                  correct:0 },
                { q:"What is the 'fools' freedom' mentioned in the text?",
                  opts:["A law that allows carnival performers to break traffic rules",
                        "A tradition where satire was used to challenge authority more freely",
                        "A prize given to the best carnival float each year"],
                  correct:1 },
                { q:"When would Tilly actually be at risk of arrest?",
                  opts:["If he publishes more satirical artwork online",
                        "If he travels to a country that has an extradition agreement with Russia",
                        "If Russia sends police to Germany"],
                  correct:1 }
            ]
        },
        {
            type:"gapFill", col:"purple", icon:"ğŸ§©",
            title:"Fill the Gaps",
            sub:"Select a word from the bank, then tap a blank to fill it",
            wordBank:["dismantles","recurring","satirical","unprecedented","extradition","discrediting"],
            sentences:[
                { t:"Russia accused Tilly of ___ the Russian army.",                              a:"discrediting"  },
                { t:"Tilly would only be arrested in countries with ___ agreements with Russia.", a:"extradition"   },
                { t:"Putting a German citizen on trial for German artwork is ___.",               a:"unprecedented" },
                { t:"Putin has been a ___ target in Tilly's work.",                              a:"recurring"     },
                { t:"After Rose Monday, Tilly's team ___ the floats.",                           a:"dismantles"    },
                { t:"The ___ floats are built in secret in the weeks before the parade.",        a:"satirical"     }
            ]
        },
        {
            type:"wordForms", col:"punch", icon:"ğŸ”¤",
            title:"Word Forms",
            sub:"Complete each sentence with the correct form of the word",
            questions:[
                { p:"The artist creates works of ___. (satirist â†’ the art form itself)",                    a:"satire"     },
                { p:"His sculptures are full of ___. (creative â†’ the noun form)",                           a:"creativity" },
                { p:"Russia has ___ him of spreading false information. (accusation â†’ past tense verb)",    a:"accused"    },
                { p:"The floats were built with great ___. (secret â†’ the noun: done in ___)",              a:"secrecy"    }
            ]
        },
        {
            type:"grammar", col:"teal", icon:"ğŸ“–",
            title:"Grammar: Present Perfect vs Past Simple",
            sub:"Choose the correct tense â€” remember the rule below",
            explanation:{
                heading:"Present Perfect vs Past Simple",
                text:"Use <strong>Past Simple</strong> for finished actions at a specific time in the past. Use <strong>Present Perfect</strong> for actions connected to the present, or when no specific time is given.",
                examples:[
                    { label:"âœ… Past Simple:",     text:`Tilly <strong>built</strong> the floats last month. <em>(specific time)</em>` },
                    { label:"âœ… Present Perfect:", text:`Russia <strong>has charged</strong> Tilly with spreading false information. <em>(still relevant now)</em>` }
                ]
            },
            questions:[
                { s:"Jacques Tilly ___ satirical floats since the 1980s.",
                  hint:"Ongoing action from past to now â†’ Present Perfect",
                  opts:["made","has made","makes"], a:"has made" },
                { s:"Russia ___ Tilly of spreading false information.",
                  hint:"Past action with a result in the present â†’ Present Perfect",
                  opts:["accused","is accused","has accused"], a:"has accused" },
                { s:"The team ___ the floats the day after the parade.",
                  hint:"Specific time in the past â†’ Past Simple",
                  opts:["has dismantled","dismantles","dismantled"], a:"dismantled" },
                { s:"The tradition of carnival satire ___ in the 19th century.",
                  hint:"A finished event at a specific past time â†’ Past Simple",
                  opts:["begins","began","has begun"], a:"began" }
            ]
        }
    ],

    /* â”€â”€ ğŸ“° FAKE NEWS OR REAL? â”€â”€ */
    fakeNews: [
        {
            source:"Russia Today (RT)",
            headline:"\"German sculptor charged with discrediting the Russian armed forces after depicting Putin in carnival float\"",
            isReal: true,
            verdict:"âœ… REAL!",
            explain:"This is a real story â€” Russia Today reported on Tilly's charges. RT is Russian state media, so they framed it as a legal matter, not censorship."
        },
        {
            source:"The DÃ¼sseldorf Daily (fictional)",
            headline:"\"Jacques Tilly wins Nobel Peace Prize for services to satirical papier-mÃ¢chÃ©\"",
            isReal: false,
            verdict:"ğŸ­ SATIRE!",
            explain:"There is no Nobel Prize for papier-mÃ¢chÃ© â€” this is a fictional satirical headline. Tilly has, however, received real German cultural awards for his work."
        },
        {
            source:"DW News",
            headline:"\"Russian court finds German carnival artist guilty in absentia â€” sentence: 5 years\"",
            isReal: false,
            verdict:"ğŸ­ SATIRE! (for nowâ€¦)",
            explain:"At the time of writing, no verdict has been delivered. The trial has been postponed multiple times. This headline is plausible but fictional â€” which shows how satire and reality can blur."
        },
        {
            source:"BBC News",
            headline:"\"Art vs autocracy: Why Russia is putting European satirists on trial\"",
            isReal: true,
            verdict:"âœ… REAL!",
            explain:"BBC has reported extensively on the broader trend of Russia targeting foreign critics and satirists. Headlines like this are real â€” this is genuine journalism about the issue."
        },
        {
            source:"The Onion (US satire site)",
            headline:"\"Putin unveils rival float depicting himself as beloved gentle grandfather\"",
            isReal: false,
            verdict:"ğŸ­ SATIRE!",
            explain:"The Onion is America's most famous satire publication. This headline mocks Putin's self-image â€” it's pure satire, but written to feel almost plausible. That's what great satire does."
        },
        {
            source:"Reuters",
            headline:"\"Germany says it will not extradite carnival float artist to Russia\"",
            isReal: true,
            verdict:"âœ… REAL!",
            explain:"Germany has publicly confirmed it will not extradite Tilly. This is exactly the kind of factual, dry headline Reuters publishes â€” and it's completely real."
        }
    ],

    badges:[
        { icon:"ğŸ­", text:"Satire Scholar!"   },
        { icon:"âš–ï¸", text:"Jury Duty Pro!"   },
        { icon:"ğŸ—ï¸", text:"News Detective!"  },
        { icon:"ğŸ¯", text:"Perfect Score!"   },
        { icon:"ğŸ“š", text:"Word Power!"      },
        { icon:"ğŸŒ", text:"Global Thinker!"  },
        { icon:"âœŠ", text:"Free Speech Hero!" }
    ],

    grammar:[
        { question:"has made",    answer:"has made",    explanation:"Present perfect for ongoing actions" },
        { question:"has accused", answer:"has accused", explanation:"Present perfect for past with present relevance" },
        { question:"dismantled",  answer:"dismantled",  explanation:"Past simple for specific past time" },
        { question:"began",       answer:"began",       explanation:"Past simple for completed past event" }
    ]
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let curSec    = 0;
let doneSecs  = 0;
let selWord   = null;
let trialIdx  = 0;
let trialVoted = false;
let fnVoted   = []; // tracks which fn items have been answered

// Sections: 0=trial, 1=video, 2=reading, 3..7=exercises, 8=fakeNews
const TOTAL = 3 + L.exercises.length + 1; // trial + video + reading + exercises + fakeNews

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function build() {
    const wrap = document.getElementById('sections');
    let html = '';

    // 0 â€” On Trial
    html += secCard(0, true, 'strip-punch', buildTrial());

    // 1 â€” Video
    html += secCard(1, false, 'strip-blue', buildVideo());

    // 2 â€” Reading
    html += secCard(2, false, 'strip-yellow', buildReading());

    // 3..7 â€” Exercises
    html += `<div class="sec-label">ğŸ“ Practice Exercises</div>`;
    L.exercises.forEach((ex, i) => {
        const n = i + 3;
        html += secCard(n, false, `strip-${ex.col}`,
            head(ex.icon, ex.title, ex.sub, n) +
            `<div class="sec-body">${buildExercise(ex, n)}</div>`);
    });

    // Last â€” Fake News
    const fnIdx = 3 + L.exercises.length;
    html += `<div class="sec-label">ğŸ“° Fake News or Real?</div>`;
    html += secCard(fnIdx, false, 'strip-teal', buildFakeNews(fnIdx));

    // Vocab Glossary (always visible)
    html += `<div class="sec-label">ğŸ“– Vocabulary Glossary</div>`;
    html += buildGlossary();

    wrap.innerHTML = html;
    updateNav(); updateProg();
    setTimeout(wireAll, 60);
}

function secCard(n, visible, strip, inner) {
    return `<div class="sec-card${visible?' visible':''} ${strip}" data-sec="${n}">${inner}</div>`;
}

function head(icon, title, sub, n, extra='') {
    return `<div class="sec-head">
        <div class="sec-head-left">
            <div class="sec-head-icon">${icon}</div>
            <div><div class="sec-head-title">${title}</div><div class="sec-head-sub">${sub}</div></div>
        </div>${extra}
    </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   âš–ï¸ ON TRIAL BUILDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildTrial() {
    return head('âš–ï¸', 'On Trial', 'Read both sides â€” then you decide the verdict', 0) +
        `<div class="sec-body">
            <div class="trial-intro">
                <strong>ğŸ­ Jacques Tilly</strong> is a German satirical artist on trial in Russia â€” for art he made in Germany. Russia says he <em>discredited</em> their army. Tilly says he was just doing what satirists have done for centuries.<br><br>
                Read the arguments below. Then play judge.
            </div>
            <div id="trial-slot">${renderTrial(0)}</div>
        </div>`;
}

function renderTrial(idx) {
    const t = L.trial[idx];
    const isLast = idx === L.trial.length - 1;
    const prosHTML = t.prosecution.map(p => `<div class="trial-point">${p}</div>`).join('');
    const defHTML  = t.defence.map(d => `<div class="trial-point">${d}</div>`).join('');

    return `<div id="trial-card-${idx}">
        <div class="trial-sides">
            <div class="trial-side prosecution">
                <div class="trial-side-head">ğŸ”´ Prosecution (Russia)</div>
                <div class="trial-side-body">${prosHTML}</div>
            </div>
            <div class="trial-side defence">
                <div class="trial-side-head">ğŸŸ¢ Defence (Tilly)</div>
                <div class="trial-side-body">${defHTML}</div>
            </div>
        </div>
        <div class="verdict-question">
            <div class="vq-title">âš–ï¸ You Be The Judge â€” Round ${idx+1} of ${L.trial.length}</div>
            <div class="vq-text">${t.question}</div>
        </div>
        <div class="verdict-btns">
            <button class="verdict-btn guilty"    onclick="trialVote(${idx}, 'guilty')">ğŸ‘¨â€âš–ï¸ Guilty</button>
            <button class="verdict-btn notguilty" onclick="trialVote(${idx}, 'notguilty')">ğŸ•Šï¸ Not Guilty</button>
        </div>
        <div class="trial-reveal" id="tr-rev-${idx}">
            <div class="trial-verdict-banner">${t.verdict}</div>
            <div class="trial-verdict-body">${t.explain}</div>
            <button class="trial-next-btn" onclick="${isLast ? 'trialFinish()' : 'trialNext('+idx+')'}">
                ${isLast ? 'ğŸ¬ Watch The Video â†’' : 'Next Round â†’'}
            </button>
        </div>
    </div>`;
}

function trialVote(idx, choice) {
    if (trialVoted) return;
    trialVoted = true;
    const card = document.getElementById(`trial-card-${idx}`);
    card.querySelectorAll('.verdict-btn').forEach(b => b.disabled = true);
    const clicked = card.querySelector(`.verdict-btn.${choice}`);
    if (clicked) clicked.classList.add(`sel-${choice}`);
    document.getElementById(`tr-rev-${idx}`).classList.add('show');
}

function trialNext(idx) {
    trialVoted = false;
    const next = idx + 1;
    const slot = document.getElementById('trial-slot');
    slot.style.opacity = '0'; slot.style.transform = 'translateX(20px)';
    setTimeout(() => {
        slot.innerHTML = renderTrial(next);
        slot.style.transition = 'opacity .3s, transform .3s';
        slot.style.opacity = '1'; slot.style.transform = 'translateX(0)';
        // rewire voc-links in the new content
        wireVocLinks();
    }, 220);
}

function trialFinish() {
    doneSecs = Math.max(doneSecs, 1); updateProg(); burst(); showBadge(rndBadge());
    document.getElementById('trial-slot').innerHTML = `
        <div class="trial-done">
            <span class="trial-done-icon">ğŸ­</span>
            <div class="trial-done-title">You've heard the case!</div>
            <div class="trial-done-sub">Now watch the documentary to see the full story â€” then read and practise.</div>
            <button class="trial-next-btn" onclick="goTo(1)">ğŸ¬ Watch The Video â†’</button>
        </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ¬ VIDEO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildVideo() {
    const discHTML = L.discussion.map(d => `<div class="disc-item">${d}</div>`).join('');
    return head('ğŸ¬', '1. Watch: The German Satirist Challenging Putin',
                'DW documentary â€” pay attention to key events and legal arguments', 1) +
        `<div class="sec-body">
            <p style="font-size:14px;font-weight:700;color:var(--ink);margin-bottom:14px;font-style:italic;">${L.videoIntro}</p>
            <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:var(--rsm);border:2px solid var(--border-heavy);background:#000;margin-bottom:16px;">
                <iframe src="${L.videoUrl}" title="Video" frameborder="0"
                    allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture;web-share"
                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen
                    style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>
            </div>
            <div class="discussion">
                <div class="discussion-title">ğŸ’¬ Discussion Questions</div>
                ${discHTML}
            </div>
            <button class="go-btn" onclick="completeSec(1)">Continue to Reading â†’</button>
        </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“° READING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildReading() {
    const factsHTML = L.facts.map(f => `<div class="fact-item">${f}</div>`).join('');
    return head('ğŸ“°', '2. Reading: The Story of Jacques Tilly',
                'Tap any red word to see the definition', 2) +
        `<div class="sec-body">
            <div class="fact-box">
                <div class="fact-title">ğŸ“Œ Key Facts</div>
                ${factsHTML}
            </div>
            <div class="reading-text">${L.reading}</div>
            <button class="go-btn" style="margin-top:16px;" onclick="completeSec(2)">Got It â€” Start Exercises â†’</button>
        </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXERCISE BUILDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildExercise(ex, n) {
    if (ex.type === 'trueFalse')      return buildTF(ex, n);
    if (ex.type === 'multipleChoice') return buildMC(ex, n);
    if (ex.type === 'gapFill')        return buildGF(ex, n);
    if (ex.type === 'wordForms')      return buildWF(ex, n);
    if (ex.type === 'grammar')        return buildGR(ex, n);
    return '';
}

function buildTF(ex, n) {
    const qs = ex.questions.map((q, qi) => `
        <div class="q-box">
            <p class="q-text">${qi+1}. ${q.q}</p>
            <div class="opt-grp">
                <button class="opt-btn" data-correct="${q.a===true}">ğŸ‘ True</button>
                <button class="opt-btn" data-correct="${q.a===false}">ğŸ‘ False</button>
            </div>
        </div>`).join('');
    return qs + btnRow(n, false);
}

function buildMC(ex, n) {
    const qs = ex.questions.map((q, qi) => {
        const opts = q.opts.map((o, oi) =>
            `<button class="opt-btn" data-correct="${oi===q.correct}">${o}</button>`).join('');
        return `<div class="q-box"><p class="q-text">${qi+1}. ${q.q}</p><div class="opt-grp">${opts}</div></div>`;
    }).join('');
    return qs + btnRow(n, false);
}

function buildGF(ex, n) {
    const bank  = ex.wordBank.map(w =>
        `<button class="wb-word" data-word="${w}">${w}</button>`).join('');
    const sents = ex.sentences.map((s, si) => {
        const pts = s.t.split('___');
        return `<p style="margin-bottom:.3em">${si+1}. ${pts[0]}<span class="gap" data-answer="${s.a}"></span>${pts[1]||''}</p>`;
    }).join('');
    return `<p style="font-size:13px;font-weight:800;color:var(--ink-3);margin-bottom:12px;">Select a word from the bank, then tap a blank</p>
        <div class="word-bank"><div class="wb-label">Word Bank</div><div class="wb-words">${bank}</div></div>
        <div class="gap-sents">${sents}</div>` + btnRow(n, false);
}

function buildWF(ex, n) {
    const items = ex.questions.map((q, qi) => {
        const hint = q.a[0] + '_'.repeat(Math.max(0, q.a.length - 1));
        return `<div class="wf-item">
            <p class="wf-prompt">${qi+1}. ${q.p}</p>
            <input type="text" class="wf-input" data-answer="${q.a}" placeholder="Type your answerâ€¦">
            <button class="hint-btn" onclick="toggleHint(this)">ğŸ’¡ Hint</button>
            <div class="hint-text">${hint} &nbsp;(${q.a.length} letters)</div>
        </div>`;
    }).join('');
    return items + btnRow(n, true);
}

function buildGR(ex, n) {
    const ex2   = ex.explanation;
    const egs   = (ex2.examples||[]).map(e =>
        `<div class="gram-ex"><strong>${e.label}</strong> ${e.text}</div>`).join('');
    const expl  = `<div class="gram-expl"><h4>${ex2.heading}</h4><p>${ex2.text}</p>${egs}</div>`;
    const cards = ex.questions.map((q, qi) => {
        const opts = q.opts.map(o => `<option value="${o}">${o}</option>`).join('');
        return `<div class="gram-card">
            <div class="gc-body">
                <p class="gc-sent">${qi+1}. ${q.s}</p>
                <p class="gc-hint">ğŸ’¡ ${q.hint}</p>
            </div>
            <select class="gram-sel" data-answer="${q.a}">
                <option value="">Chooseâ€¦</option>${opts}
            </select>
        </div>`;
    }).join('');
    return expl + cards + btnRow(n, false);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“° FAKE NEWS OR REAL?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildFakeNews(n) {
    fnVoted = new Array(L.fakeNews.length).fill(false);
    const cards = L.fakeNews.map((item, i) => `
        <div class="fn-card" id="fn-card-${i}">
            <div class="fn-headline">
                <span class="fn-source">${item.source}</span>
                ${item.headline}
            </div>
            <div class="fn-btns">
                <button class="fn-btn real"   onclick="fnVote(${i}, true)"  id="fn-real-${i}">âœ… Real News</button>
                <button class="fn-btn satire" onclick="fnVote(${i}, false)" id="fn-sat-${i}">ğŸ­ Satire</button>
            </div>
            <div class="fn-reveal" id="fn-rev-${i}">
                <div class="fn-verd" id="fn-verd-${i}"></div>
                <div>${item.explain}</div>
            </div>
        </div>`).join('');

    return head('ğŸ“°', 'Fake News or Real?',
                'Can you tell journalism from satire?', n) +
        `<div class="sec-body">
            <div class="fn-intro">
                <strong>ğŸ¯ The challenge:</strong> Some of these headlines are real. Some are satire. Some are fictional but totally plausible. Read each one carefully â€” then decide.<br><br>
                This is the hardest exercise in the lesson. There's no word bank. Use everything you've read and watched. Good luck!
            </div>
            <div id="fn-cards">${cards}</div>
            <div id="fn-score" class="result" style="display:none;"></div>
            <div id="fn-done-btn" style="display:none;">
                <button class="go-btn" style="margin-top:4px;" onclick="completeSec(${n})">ğŸ Finish the Lesson â†’</button>
            </div>
        </div>`;
}

function fnVote(i, choseReal) {
    if (fnVoted[i]) return;
    fnVoted[i] = true;
    const item = L.fakeNews[i];
    const correct = choseReal === item.isReal;
    const realBtn = document.getElementById(`fn-real-${i}`);
    const satBtn  = document.getElementById(`fn-sat-${i}`);
    realBtn.disabled = true; satBtn.disabled = true;

    if (choseReal) realBtn.classList.add('sel-real');
    else           satBtn.classList.add('sel-satire');
    if (!correct) {
        // Show which was right
        if (item.isReal) realBtn.classList.add('sel-real');
        else             satBtn.classList.add('sel-satire');
    }

    const rev  = document.getElementById(`fn-rev-${i}`);
    const verd = document.getElementById(`fn-verd-${i}`);
    rev.classList.add('show');
    verd.textContent = item.verdict;
    verd.className   = `fn-verd ${correct ? 'right' : 'wrong'}`;
    if (correct) burst();

    // Check if all answered
    if (fnVoted.every(v => v)) {
        const score = fnVoted.filter((_, idx) => {
            const realBtn = document.getElementById(`fn-real-${idx}`);
            return realBtn.classList.contains('sel-real') === L.fakeNews[idx].isReal;
        }).length;
        const scoreEl = document.getElementById('fn-score');
        const doneBtn = document.getElementById('fn-done-btn');
        scoreEl.style.display = 'block';
        const perfect = score === L.fakeNews.length;
        scoreEl.className = `result ${perfect ? 'ok' : 'bad'}`;
        scoreEl.textContent = perfect
            ? `ğŸ‰ ${score}/${L.fakeNews.length} â€” Master media detective! You can tell real from satire!`
            : `${score}/${L.fakeNews.length} â€” Not bad! Real vs satire is genuinely hard. Review the reveals above.`;
        doneBtn.style.display = 'block';
        if (perfect) { showBadge(rndBadge()); setTimeout(burst, 300); }
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VOCAB GLOSSARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildGlossary() {
    const items = L.vocabulary.map(w => `
        <div class="voc-item" onclick="showVoc('${w.word}')">
            <div class="voc-item-word">${w.word}</div>
            <div class="voc-item-type">${w.type}</div>
            <div class="voc-item-def">${w.definition}</div>
        </div>`).join('');
    return `<div class="sec-card visible strip-teal">
        <div class="sec-head">
            <div class="sec-head-left">
                <div class="sec-head-icon">ğŸ“š</div>
                <div><div class="sec-head-title">All 10 Vocab Words</div>
                <div class="sec-head-sub">Always visible â€” tap any word to hear it in British English</div></div>
            </div>
        </div>
        <div class="sec-body"><div class="voc-grid">${items}</div></div>
    </div>`;
}

function btnRow(n, hasReveal) {
    return `<div class="btn-row">
        <button class="btn-check"  onclick="checkSec(${n})">Check Answers</button>
        ${hasReveal ? `<button class="btn-reveal" onclick="revealWF(${n})">Reveal All</button>` : ''}
        <button class="btn-reset"  onclick="resetSec(${n})">Reset</button>
    </div>
    <div id="res-${n}" class="result"></div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goTo(n) {
    curSec = n;
    const el = document.querySelector(`.sec-card[data-sec="${n}"]`);
    if (el) { el.classList.add('visible'); el.scrollIntoView({behavior:'smooth',block:'start'}); }
    updateNav();
}
function nextSec() { if (curSec < TOTAL-1) { curSec++; goTo(curSec); } else finishLesson(); }
function prevSec() { if (curSec > 0) { curSec--; goTo(curSec); } }

function completeSec(n) {
    doneSecs = Math.max(doneSecs, n + 1);
    updateProg();
    if (n >= TOTAL-1) { finishLesson(); return; }
    const next = document.querySelector(`.sec-card[data-sec="${n+1}"]`);
    if (next) { next.classList.add('visible'); next.scrollIntoView({behavior:'smooth',block:'start'}); }
    if (Math.random() < .3) showBadge(rndBadge());
    curSec = n+1; updateNav();
}

function updateNav() {
    document.getElementById('bn-prev').disabled = curSec === 0;
    document.getElementById('bn-next').textContent = curSec >= TOTAL-1 ? 'ğŸ Finish' : 'Next â†’';
    document.getElementById('bn-ind').textContent  = `${curSec+1}/${TOTAL}`;
}
function updateProg() {
    const pct = Math.round((doneSecs/TOTAL)*100);
    document.getElementById('prog-fill').style.width  = pct + '%';
    document.getElementById('prog-label').textContent = `${doneSecs} / ${TOTAL} sections`;
    document.getElementById('prog-pct').textContent   = pct + '%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHECKERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function checkSec(n) {
    const exIdx = n - 3;
    const type  = L.exercises[exIdx]?.type;
    if (type === 'trueFalse' || type === 'multipleChoice') checkOpts(n);
    else if (type === 'gapFill')   checkGF(n);
    else if (type === 'wordForms') checkWF(n);
    else if (type === 'grammar')   checkGR(n);
}

function checkOpts(n) {
    const groups = secEl(n).querySelectorAll('.opt-grp');
    let ok=0, blank=0;
    groups.forEach(g => {
        const sel = g.querySelector('.opt-btn.selected');
        if (!sel) { blank++; return; }
        g.querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('correct','incorrect'));
        sel.dataset.correct==='true' ? (sel.classList.add('correct'), ok++) : sel.classList.add('incorrect');
    });
    if (blank) return showErr(n, 'Please answer all questions first!');
    showRes(n, ok, groups.length, 'ğŸ‰ All correct!', 'wrong answers in red â€” try again!');
}

function checkGF(n) {
    const gaps = secEl(n).querySelectorAll('.gap'); let ok=0;
    gaps.forEach(g => {
        g.classList.remove('correct','incorrect');
        const v = (g.textContent||'').trim().toLowerCase();
        if (v === g.dataset.answer.toLowerCase()) { g.classList.add('correct'); ok++; }
        else if (v) g.classList.add('incorrect');
    });
    showRes(n, ok, gaps.length, 'âœ¨ All gaps correct!', 'red gaps are wrong â€” click to clear and retry');
}

function checkWF(n) {
    const inputs = secEl(n).querySelectorAll('.wf-input'); let ok=0;
    inputs.forEach(i => {
        i.classList.remove('ok','bad');
        if (!i.value.trim()) return;
        i.value.trim().toLowerCase()===i.dataset.answer.toLowerCase()
            ? (i.classList.add('ok'), ok++) : i.classList.add('bad');
    });
    showRes(n, ok, inputs.length, 'ğŸ¯ Word Forms Champion!', 'red boxes are wrong â€” check spelling!');
}

function checkGR(n) {
    const sels = secEl(n).querySelectorAll('.gram-sel'); let ok=0;
    sels.forEach(s => {
        s.classList.remove('correct','incorrect');
        if (!s.value) return;
        s.value===s.dataset.answer ? (s.classList.add('correct'), ok++) : s.classList.add('incorrect');
    });
    showRes(n, ok, sels.length, 'ğŸ“– Grammar Ace!', 'red dropdowns are wrong â€” try again!');
}

function revealWF(n) {
    secEl(n).querySelectorAll('.wf-input').forEach(i => { i.value=i.dataset.answer; i.classList.add('ok'); i.classList.remove('bad'); });
    hideRes(n);
}

function resetSec(n) {
    const exIdx = n - 3;
    const ex    = L.exercises[exIdx];
    if (!ex) return;
    if (ex.type==='trueFalse'||ex.type==='multipleChoice')
        secEl(n).querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('selected','correct','incorrect'));
    if (ex.type==='gapFill') {
        secEl(n).querySelectorAll('.gap').forEach(g=>{g.textContent='';g.classList.remove('correct','incorrect');});
        secEl(n).querySelectorAll('.wb-word').forEach(w=>w.classList.remove('sel','used'));
        selWord=null;
    }
    if (ex.type==='wordForms') secEl(n).querySelectorAll('.wf-input').forEach(i=>{i.value='';i.classList.remove('ok','bad');});
    if (ex.type==='grammar')   secEl(n).querySelectorAll('.gram-sel').forEach(s=>{s.value='';s.classList.remove('correct','incorrect');});
    hideRes(n);
}

function showRes(n, ok, total, yep, nope) {
    const el = document.getElementById(`res-${n}`); if (!el) return;
    const perfect = ok===total;
    el.style.display='block';
    el.className = `result ${perfect?'ok':'bad'}`;
    el.textContent = perfect ? yep : `${ok}/${total} correct â€” ${nope}`;
    if (perfect) { burst(); if(Math.random()<.5)showBadge(rndBadge()); setTimeout(()=>completeSec(n), 1400); }
}
function showErr(n, msg) { const e=document.getElementById(`res-${n}`); if(e){e.style.display='block';e.className='result bad';e.textContent=msg;} }
function hideRes(n)       { const e=document.getElementById(`res-${n}`); if(e){e.style.display='none';} }
function secEl(n)         { return document.querySelector(`.sec-card[data-sec="${n}"]`); }

/* â”€â”€ GAP CLICK â”€â”€ */
function gapClick(gap) {
    if (gap.classList.contains('correct')) return;
    if (gap.textContent.trim()) {
        const w = Array.from(gap.closest('.sec-card').querySelectorAll('.wb-word'))
            .find(b => b.dataset.word===gap.textContent.trim());
        if (w) w.classList.remove('used');
        gap.textContent=''; gap.classList.remove('incorrect');
    } else if (selWord) {
        gap.textContent=selWord.dataset.word;
        selWord.classList.add('used'); selWord.classList.remove('sel');
        selWord=null;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIRE ALL INTERACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function wireVocLinks() {
    document.querySelectorAll('.voc-link').forEach(el => {
        el.addEventListener('click', e => { e.stopPropagation(); showVoc(el.dataset.voc); });
    });
}

function wireAll() {
    // Option groups
    document.querySelectorAll('.opt-grp').forEach(g => {
        g.addEventListener('click', e => {
            const btn = e.target.closest('.opt-btn');
            if (!btn || g.querySelector('.opt-btn.correct')) return;
            g.querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('selected','incorrect'));
            btn.classList.add('selected');
        });
    });

    // Word bank
    document.querySelectorAll('.wb-word').forEach(w => {
        w.addEventListener('click', () => {
            if (w.classList.contains('used')) return;
            if (w.classList.contains('sel')) { w.classList.remove('sel'); selWord=null; }
            else { document.querySelectorAll('.wb-word').forEach(b=>b.classList.remove('sel')); w.classList.add('sel'); selWord=w; }
        });
    });

    // Gaps
    document.querySelectorAll('.gap').forEach(g => g.addEventListener('click', ()=>gapClick(g)));

    // Vocab links in trial reveals + reading
    wireVocLinks();

    // v-word spans in reading
    document.querySelectorAll('.v-word').forEach(el => {
        el.addEventListener('click', e => { e.stopPropagation(); showVoc(el.dataset.voc); });
    });

    // Glossary items
    document.querySelectorAll('.voc-item').forEach(el => {
        el.addEventListener('click', () => showVoc(el.querySelector('.voc-item-word').textContent));
    });

    // Close popup on outside click
    document.addEventListener('click', e => {
        if (!e.target.closest('#voc-popup') &&
            !e.target.classList.contains('v-word') &&
            !e.target.classList.contains('voc-link') &&
            !e.target.closest('.voc-item')) closeVoc();
    });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VOCAB POPUP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showVoc(word) {
    const w = L.vocabulary.find(v => v.word.toLowerCase()===word.toLowerCase());
    if (!w) return;
    document.getElementById('vp-body').innerHTML = `
        <div class="voc-word">${w.word}</div>
        <div class="voc-type">${w.type}</div>
        <div class="voc-def">${w.definition}</div>
        <button class="voc-hear" onclick="speak('${w.word}')">ğŸ”Š Hear It (British English)</button>`;
    document.getElementById('voc-popup').style.display='block';
}
function closeVoc() { document.getElementById('voc-popup').style.display='none'; }
function speak(word) {
    const u = new SpeechSynthesisUtterance(word);
    u.lang='en-GB'; u.rate=.85;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CELEBRATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const COLOURS = ['#FFC800','#58CC02','#1CB0F6','#FF4B4B','#CE82FF','#2BDECC'];

function burst() {
    for (let i=0; i<18; i++) {
        const d = document.createElement('div');
        d.className = 'confetti-dot';
        d.style.cssText = `
            left:${25+Math.random()*50}vw;
            top:${15+Math.random()*35}vh;
            background:${COLOURS[Math.floor(Math.random()*COLOURS.length)]};
            animation-delay:${Math.random()*.35}s;
            animation-duration:${.65+Math.random()*.6}s;
            transform:rotate(${Math.random()*360}deg);`;
        document.body.appendChild(d);
        setTimeout(()=>d.remove(), 1300);
    }
}

function showBadge(b) {
    const el = document.createElement('div');
    el.className = 'badge';
    el.innerHTML = `<span class="badge-icon">${b.icon}</span><span class="badge-text">${b.text}</span>`;
    document.getElementById('badge-wrap').appendChild(el);
    setTimeout(()=>el.classList.add('show'), 80);
    setTimeout(()=>{ el.classList.remove('show'); setTimeout(()=>el.remove(), 400); }, 2800);
}

function rndBadge() { return L.badges[Math.floor(Math.random()*L.badges.length)]; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleHint(btn) {
    const hint = btn.nextElementSibling;
    if (!hint) return;
    hint.classList.toggle('show');
    btn.textContent = hint.classList.contains('show') ? 'ğŸ™ˆ Hide hint' : 'ğŸ’¡ Hint';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FINISH LESSON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function finishLesson() {
    doneSecs=TOTAL; updateProg();
    localStorage.setItem('efcd_last_lesson_done', 'true');
    if (!window.EFCD_Auth?.getCurrentUser()) {
        if (confirm('ğŸ­ Lesson complete!\n\nSign up free to save your XP, streaks and badges.\n\nOK = Sign up | Cancel = Keep browsing'))
            window.location.href='/signup/';
        else if (typeof showWordMatchGame==='function')
            showWordMatchGame(L.vocabulary, ()=>window.location.href=L.levelPage);
        else window.location.href=L.levelPage;
        return;
    }
    const result = await window.EFCD_Auth.completeLesson({
        lessonId:L.lessonId, lessonTitle:L.title, lessonLevel:L.level,
        lessonLink:L.lessonLink, vocabulary:L.vocabulary, grammar:L.grammar,
        perfectScore:true,
        completionTime:Math.floor((Date.now()-performance.timing.navigationStart)/1000)
    });
    if (typeof showWordMatchGame==='function')
        showWordMatchGame(L.vocabulary, gr=>showEndScreen(result, gr));
    else showEndScreen(result, null);
}

function showEndScreen(res, game) {
    const xp = (res?.xpEarned||0)+((game?.bonusXP)||0);
    const ov = document.createElement('div');
    ov.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;animation:up .3s ease both;';
    ov.innerHTML=`
        <div style="background:var(--white);border:2px solid var(--border-heavy);border-bottom:8px solid var(--border-heavy);border-radius:var(--r);max-width:420px;width:100%;overflow:hidden;animation:popin .4s cubic-bezier(.175,.885,.32,1.275) both;">
            <div style="background:var(--punch);padding:28px 20px 24px;text-align:center;position:relative;">
                <button onclick="this.closest('div').parentElement.parentElement.remove()" style="position:absolute;top:10px;right:10px;background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.3);border-radius:var(--rxs);color:var(--white);font-size:20px;font-weight:900;width:34px;height:34px;cursor:pointer;font-family:inherit;line-height:1;display:flex;align-items:center;justify-content:center;">Ã—</button>
                <div style="font-size:68px;margin-bottom:8px;">ğŸ­</div>
                <div style="font-size:13px;font-weight:900;color:rgba(255,255,255,.8);text-transform:uppercase;letter-spacing:2px;margin-bottom:4px;">Lesson Complete!</div>
                <div style="font-size:28px;font-weight:900;color:var(--white);letter-spacing:-1px;text-shadow:0 3px 0 var(--punch-shadow);">Satire Scholar! âœŠ</div>
            </div>
            <div style="padding:20px;display:flex;flex-direction:column;gap:14px;">
                <div style="background:var(--bg);border:2px solid var(--border-heavy);border-bottom:4px solid var(--border-heavy);border-radius:var(--rsm);padding:18px;text-align:center;">
                    <div style="font-size:48px;font-weight:900;color:var(--punch);">+${xp} XP</div>
                    ${res?.leveledUp?`<div style="color:var(--green-shadow);font-weight:900;font-size:16px;margin-top:6px;">ğŸŠ LEVEL UP â†’ Level ${res.newLevel}!</div>`:''}
                    ${res?.newStreak>0?`<div style="color:var(--ink-3);font-weight:800;font-size:14px;margin-top:4px;">ğŸ”¥ ${res.newStreak}-day streak!</div>`:''}
                </div>
                <a href="${L.levelPage}" style="display:flex;align-items:center;justify-content:center;gap:8px;padding:15px;background:var(--green);color:var(--white);font-size:16px;font-weight:900;border-radius:var(--rsm);border:2px solid var(--green-shadow);border-bottom:5px solid var(--green-shadow);">Next Lesson â†’</a>
                <a href="/dashboard-gamified/" style="display:flex;align-items:center;justify-content:center;padding:13px;background:var(--bg);color:var(--ink-3);font-size:14px;font-weight:800;border-radius:var(--rsm);border:2px solid var(--border-heavy);border-bottom:3px solid var(--border-heavy);">View Dashboard</a>
            </div>
        </div>`;
    document.body.appendChild(ov);
    burst(); setTimeout(burst, 300);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS â€” efcdReady-safe
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initStats() {
    localStorage.setItem('efcd_last_lesson_url',  window.location.pathname);
    localStorage.setItem('efcd_last_lesson_name', "Satire in the Spotlight");
    localStorage.setItem('efcd_last_lesson_done', 'false');

    function tryInit() {
        if (typeof window.efcdReady==='undefined') { setTimeout(tryInit, 50); return; }
        window.efcdReady.then(async () => {
            if (!window.EFCD_Auth) return;
            await window.EFCD_Auth.initAuth();
            const user = window.EFCD_Auth.getCurrentUser();
            if (user) {
                const s = window.EFCD_Auth.getUserStats();
                document.getElementById('hdr-streak').textContent = s?.streak||0;
                document.getElementById('hdr-xp').textContent     = (s?.xp||0).toLocaleString();
            }
        }).catch(()=>{});
    }
    tryInit();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
build();
initStats();
</script>
</body>
</html>
