
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="apple-touch-icon" href="/images/icon-180.png" sizes="180x180">
    <link rel="icon" type="image/png" href="/images/icon-192.png" sizes="192x192">

    <link rel="manifest" href="/manifest.json">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Intermediate English Lesson - Greetings</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- BRANDING & LAYOUT STYLES (Based on Rebrand Example) --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: #F8F9FA; /* Light background */
            color: #343A40; /* Dark text */
            line-height: 1.6;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
        }

        .game-container {
            max-width: 960px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Utility classes for easy color reference */
        .brand-primary { color: #007BFF; } /* Blue */
        .brand-secondary { color: #28A745; } /* Green */
        .bg-brand-primary { background-color: #007BFF; }
        .bg-brand-secondary { background-color: #28A745; }

        /* Custom Card Style */
        .lesson-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }
        
        /* Stats Bar Custom Styles */
        .stats-bar {
            border-radius: 12px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #007BFF; /* Primary color for values */
        }

        /* Progress Bar */
        .progress-bar-bg {
            background-color: #E9ECEF;
            height: 10px;
            border-radius: 5px;
        }

        .progress-fill {
            background-color: #28A745; /* Green for progress */
            transition: width 0.5s ease-out;
            border-radius: 5px;
        }

        /* Activity Instructions */
        .activity-instructions {
            border-left: 4px solid #FFC107; /* Yellow accent */
            background-color: #FFF3CD;
            color: #856404;
            padding: 1rem;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        /* Match/Option Items */
        .match-item, .option {
            transition: all 0.2s ease;
            user-select: none;
            cursor: pointer;
            border: 2px solid #E9ECEF;
        }

        .match-item:hover:not(.correct):not(.disabled),
        .option:hover:not(.correct):not(.disabled) {
            border-color: #007BFF; /* Blue hover */
        }
        
        /* General Selection Style for Match/Option/Word/Gap */
        .selected {
            background-color: #E6F7FF !important; /* Light blue background */
            border-color: #007BFF !important;
            color: #007BFF !important;
            font-weight: 600;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5); /* Blue glow */
        }
        
        /* Correct/Incorrect feedback for matches/options */
        .correct {
            background-color: #D4EDDA !important; /* Light green */
            border-color: #28A745 !important;
            color: #155724 !important;
        }

        .incorrect {
            background-color: #F8D7DA !important; /* Light red */
            border-color: #DC3545 !important;
            color: #721C24 !important;
            animation: none !important; /* Remove shake if used */
        }
        
        /* Word Bank Click Styles */
        .word-item-drag { /* Reusing the old D&D class for styling consistency */
            background-color: #007BFF;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.4);
            transition: background-color 0.2s;
            cursor: pointer;
            border: 2px solid transparent; /* Required for the selected border */
        }

        .word-item-drag:hover:not(.used) {
            background-color: #0056b3;
        }

        .word-item-drag.used {
            background-color: #E9ECEF;
            color: #6C757D;
            cursor: not-allowed;
            border-color: #CED4DA !important;
            box-shadow: none;
        }

        .gap-fill-drop-zone {
            border-bottom: 3px solid #007BFF;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .gap-fill-drop-zone.filled {
            color: #343A40;
            background-color: #F8F9FA;
            border-bottom: 3px solid #28A745;
            font-weight: 600;
            min-width: 120px !important;
            padding: 2px 5px;
        }
        
        .gap-fill-drop-zone.selected {
            background-color: #E6F7FF !important;
            border-bottom-color: #007BFF !important;
            box-shadow: 0 3px 0 rgba(0, 123, 255, 0.5);
        }

        .gap-fill-drop-zone.correct-answer {
            border-bottom-color: #28A745 !important;
            background-color: #D4EDDA !important;
        }

        .gap-fill-drop-zone.incorrect-answer {
            border-bottom-color: #DC3545 !important;
            background-color: #F8D7DA !important;
        }

        /* Buttons */
        .btn-primary {
            background-color: #007BFF;
            transition: background-color 0.2s;
        }
        .btn-primary:hover:not(:disabled) { background-color: #0056b3; }

        .btn-success {
            background-color: #28A745;
            transition: background-color 0.2s;
        }
        .btn-success:hover:not(:disabled) { background-color: #1e7e34; }

        .btn-warning {
            background-color: #FFC107;
            color: #343A40;
            transition: background-color 0.2s;
        }
        .btn-warning:hover:not(:disabled) { background-color: #e0a800; }

        .btn:disabled { opacity: 0.6; cursor: not-allowed; }

        /* General Feedback/Animations */
        .hidden { display: none !important; }
        
        .points-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #28A745;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 1000;
            animation: pointsFloat 2s ease-out forwards;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.5);
        }

        @keyframes pointsFloat {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            30% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -80px) scale(1); }
        }

        .sticker {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 5rem;
            opacity: 0;
            animation: stickerPop 1s forwards;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes stickerPop {
            0% { transform: translate(-50%, -50%) scale(0.5) rotate(-20deg); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2) rotate(10deg); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0; }
        }

        /* New Global Header Styles from agile.html */
        .header {
            background: #FFFFFF;
            border-bottom: 1px solid #E5E9F2;
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        .header-wrapper {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.header-link {
    display: flex;
    align-items: center;
    gap: 15px;
    text-decoration: none;
    color: #2C3E50;
}

.header-link:hover {
    opacity: 0.9;
}
        .header-content:hover {
             opacity: 0.9;
        }
        .logo {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .site-title {
            font-size: 20px;
            font-weight: 600;
            color: #1A202C;
            letter-spacing: -0.02em;
        }

    </style>
</head>
<body>
    <header class="header">
    <div class="header-wrapper">
        <a href="/beginner/" class="header-link">
            <div class="logo">üòé</div> 
            <span class="site-title">English For Cool Dudes</span> 
        </a>
    </div>
</header>
    <div class="game-container">
        <div class="text-center pt-6 pb-2">
            <h1 class="text-3xl font-extrabold text-gray-800 mb-2">ü§ù English Adventure: Greetings ü§ù</h1>
            </div>

        <div class="stats-bar p-4 md:p-6 mb-6">
            <div class="progress-bar-bg mb-4">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <div class="flex justify-around text-center">
                <div class="stat-item">
                    <div class="stat-value" id="totalPoints">0</div>
                    <div class="text-sm text-gray-600">Points</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="streak">0</div>
                    <div class="text-sm text-gray-600">Streak</div>
                </div>
          
            </div>
        </div>

        <div class="achievement hidden bg-yellow-100 text-yellow-800 p-3 rounded-lg font-bold text-center mb-4" id="achievement"></div>
        <div class="timer hidden fixed top-4 right-4 bg-red-600 text-white p-2 rounded-full font-bold z-50" id="timer">‚è∞ 30s</div>

        <div class="lesson-card" id="activity1">
            <h2 class="text-2xl font-bold brand-primary mb-4">üéØ Activity 1: Greetings & Replies</h2>
            <div class="activity-instructions mb-6">
                Match the common greeting with the correct reply. Tap on a phrase from the left column, then tap on its matching reply from the right column!
            </div>
            
            <div class="grid grid-cols-2 gap-4 md:gap-8 matching-container">
                <div class="matching-column">
                    <h4 class="text-lg font-semibold brand-primary mb-3 p-2 bg-blue-50 rounded-lg">üîµ Greetings</h4>
                    <div class="match-item vocabulary p-3 rounded-lg shadow-sm" data-match="1">How's it going?</div>
                    <div class="match-item vocabulary p-3 rounded-lg shadow-sm" data-match="2">Nice to meet you.</div>
                    <div class="match-item vocabulary p-3 rounded-lg shadow-sm" data-match="3">What have you been up to?</div>
                    <div class="match-item vocabulary p-3 rounded-lg shadow-sm" data-match="4">Good morning!</div>
                    <div class="match-item vocabulary p-3 rounded-lg shadow-sm" data-match="5">I'm so sorry.</div>
                    <div class="match-item vocabulary p-3 rounded-lg shadow-sm" data-match="6">Can you help me?</div>
                </div>
                
                <div class="matching-column">
                    <h4 class="text-lg font-semibold text-yellow-800 mb-3 p-2 bg-yellow-50 rounded-lg">üü° Replies</h4>
                    <div class="match-item definition p-3 rounded-lg shadow-sm" data-match="5">That's alright.</div>
                    <div class="match-item definition p-3 rounded-lg shadow-sm" data-match="3">Not much, just working a lot.</div>
                    <div class="match-item definition p-3 rounded-lg shadow-sm" data-match="1">It's going well, thanks!</div>
                    <div class="match-item definition p-3 rounded-lg shadow-sm" data-match="6">Sure, what do you need?</div>
                    <div class="match-item definition p-3 rounded-lg shadow-sm" data-match="2">You too.</div>
                    <div class="match-item definition p-3 rounded-lg shadow-sm" data-match="4">Morning! How are you?</div>
                </div>
            </div>
            
            <div class="text-center mt-6 text-lg font-semibold text-gray-700">
                <span id="matchScore">Matches: 0/6</span>
            </div>
            
            <div class="feedback-message mt-4 p-3 rounded-lg text-center hidden" id="matching-feedback"></div>
            <div class="text-center mt-6">
                <button class="btn next-activity-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="matching-next" onclick="nextActivity()" style="display:none;">Continue to Next Activity ‚û°Ô∏è</button>
            </div>
        </div>

        <div class="lesson-card hidden" id="activity2">
            <h2 class="text-2xl font-bold brand-primary mb-4">üìñ Activity 2: Reading Comprehension</h2>
            <div class="activity-instructions mb-6">
                Read the short dialogue, then answer the questions below.
            </div>
            
            <div class="p-4 bg-gray-50 border-l-4 border-brand-primary rounded-lg italic mb-6">
                <strong class="brand-primary not-italic">Making Plans</strong><br><br>
                **Leo:** Hey Sarah, how's it going? I'm calling to see if you want to hang out this weekend.<br>
                **Sarah:** Hi Leo! It's going well, thanks. I'd love to! I'm a bit busy on Saturday morning, but what about the afternoon?<br>
                **Leo:** That works for me! My brother is in town, so maybe we could all catch a movie? The new superhero film is out.<br>
                **Sarah:** Oh, that sounds fantastic! I've been looking forward to that. We should meet up around 3 PM at the cinema. I can't wait!<br>
                **Leo:** Me too! See you Saturday!
            </div>

            <div class="question-container mb-6" id="reading-q1">
                <div class="text-lg font-semibold mb-3">1. Why is Leo calling Sarah?</div>
                <div class="options grid gap-3">
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="correct">To make plans for the weekend.</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">To borrow some money.</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">To talk about the weather.</div>
                </div>
            </div>
            
            <div class="question-container mb-6" id="reading-q2">
                <div class="text-lg font-semibold mb-3">2. Which part of Saturday is Sarah available?</div>
                <div class="options grid gap-3">
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">The morning.</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="correct">The afternoon.</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">All day.</div>
                </div>
            </div>

            <div class="question-container mb-6" id="reading-q3">
                <div class="text-lg font-semibold mb-3">3. What does Sarah mean when she says she "can't wait"?</div>
                <div class="options grid gap-3">
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">She is not able to wait.</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="correct">She is very excited for the movie.</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">She has to leave soon.</div>
                </div>
            </div>
            
            <div class="feedback-message mt-4 p-3 rounded-lg text-center hidden" id="reading-feedback"></div>
            <div class="text-center mt-6">
                <button class="btn check-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="reading-check-btn" onclick="checkReadingAnswers()">Check Answers ‚úì</button>
                <button class="btn next-activity-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="reading-next" onclick="nextActivity()" style="display:none;">Continue to Next Activity ‚û°Ô∏è</button>
                <button class="btn try-again-btn bg-yellow-500 text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="reading-retry" onclick="retryActivity(2)" style="display:none;">Try Again üîÑ</button>
            </div>
        </div>

        <div class="lesson-card hidden" id="activity3">
            <h2 class="text-2xl font-bold brand-primary mb-4">üí¨ Activity 3: Conversation Gap-Fill</h2>
            <div class="activity-instructions mb-6">
                **Click** a word from the bank, then **click** the gap to fill it. Click a filled gap to remove the word.
            </div>
            
            <div class="word-bank-drag flex flex-wrap gap-3 p-4 bg-gray-50 border-2 border-dashed border-brand-primary rounded-lg mb-6" id="wordBankConversation">
                <div class="word-bank-title w-full font-bold brand-primary mb-2">üìù Word Bank - Click the words:</div>
                <span class="word-item-drag py-2 px-4 rounded-full font-bold" data-word="for ages">for ages</span>
                <span class="word-item-drag py-2 px-4 rounded-full font-bold" data-word="anything interesting">anything interesting</span>
                <span class="word-item-drag py-2 px-4 rounded-full font-bold" data-word="just been">just been</span>
                <span class="word-item-drag py-2 px-4 rounded-full font-bold" data-word="a while">a while</span>
                <span class="word-item-drag py-2 px-4 rounded-full font-bold" data-word="up to">up to</span>
            </div>
            
            <div class="p-4 bg-blue-50 border-l-4 border-brand-primary rounded-lg">
                <div class="gap-sentence mb-4 text-gray-700">**A:** Hey, long time no see! It's been <span class="gap-fill-drop-zone inline-block min-w-[80px] text-center px-2 py-1 font-bold" data-correct="a while"></span>.</div>
                <div class="gap-sentence mb-4 text-gray-700">**B:** I know! I've been so busy. What have you been <span class="gap-fill-drop-zone inline-block min-w-[80px] text-center px-2 py-1 font-bold" data-correct="up to"></span>?</div>
                <div class="gap-sentence mb-4 text-gray-700">**A:** Not much, really. I've <span class="gap-fill-drop-zone inline-block min-w-[80px] text-center px-2 py-1 font-bold" data-correct="just been"></span> working a lot. Have you seen <span class="gap-fill-drop-zone inline-block min-w-[80px] text-center px-2 py-1 font-bold" data-correct="anything interesting"></span> lately?</div>
                <div class="gap-sentence text-gray-700">**B:** Oh yes, I went to a great concert! We should catch up properly soon, I haven't seen you <span class="gap-fill-drop-zone inline-block min-w-[80px] text-center px-2 py-1 font-bold" data-correct="for ages"></span>.</div>
            </div>
            <div class="feedback-message mt-4 p-3 rounded-lg text-center hidden" id="conversation-feedback"></div>
            <div class="text-center mt-6">
                <button class="btn check-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="conversation-check-btn" onclick="checkConversationFill()">Check Answers ‚úì</button>
                <button class="btn next-activity-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="conversation-next" onclick="nextActivity()" style="display:none;">Continue to Next Activity ‚û°Ô∏è</button>
                <button class="btn try-again-btn bg-yellow-500 text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="conversation-retry" onclick="retryActivity(3)" style="display:none;">Try Again üîÑ</button>
            </div>
        </div>

        <div class="lesson-card hidden" id="activity4">
            <h2 class="text-2xl font-bold brand-primary mb-4">‚ñ∂Ô∏è Watch and Learn!</h2>
            <div class="activity-instructions mb-6">
                Before the next activity, let's watch a short video to learn new ways to greet people.
            </div>
            <div class="relative w-full pb-[56.25%] mb-6">
                <iframe class="absolute top-0 left-0 w-full h-full rounded-xl" src="https://www.youtube.com/embed/I_tRSrPru94" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <div class="text-center mt-6">
                <a href="https://www.youtube.com/watch?v=I_tRSrPru94" target="_blank" class="inline-block bg-red-600 text-white font-bold py-2 px-6 rounded-full shadow-md hover:bg-red-700 transition duration-200">Watch on YouTube ‚ÜóÔ∏è</a>
                <button class="btn next-activity-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200 ml-4" id="video-next" onclick="nextActivity()">Continue to Next Activity ‚û°Ô∏è</button>
            </div>
        </div>

        <div class="lesson-card hidden" id="activity5">
            <h2 class="text-2xl font-bold brand-primary mb-4">üí¨ Activity 5: Greetings & Goodbyes</h2>
            <div class="activity-instructions mb-6">
                Based on the video, select the best response to each situation.
            </div>
            
            <div class="question-container mb-6" id="greetings-q1">
                <div class="text-lg font-semibold mb-3">1. You meet a friend you haven't seen in a year. You say:</div>
                <div class="options grid gap-3">
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="correct">Long time no see!</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">How are you doing?</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">See you later!</div>
                </div>
            </div>
            
            <div class="question-container mb-6" id="greetings-q2">
                <div class="text-lg font-semibold mb-3">2. Your boss is leaving the office for the day. You say:</div>
                <div class="options grid gap-3">
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">Gotta run!</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="correct">Have a good evening.</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">What's up?</div>
                </div>
            </div>

            <div class="question-container mb-6" id="greetings-q3">
                <div class="text-lg font-semibold mb-3">3. You see a colleague in the hallway. You say:</div>
                <div class="options grid gap-3">
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="correct">How's your day going?</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">It was nice meeting you.</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">Cheerio!</div>
                </div>
            </div>
            
            <div class="feedback-message mt-4 p-3 rounded-lg text-center hidden" id="greetings-feedback"></div>
            <div class="text-center mt-6">
                <button class="btn check-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="greetings-check-btn" onclick="checkGreetingsQuiz()">Check Answers ‚úì</button>
                <button class="btn next-activity-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="greetings-next" onclick="nextActivity()" style="display:none;">Continue to Next Activity ‚û°Ô∏è</button>
                <button class="btn try-again-btn bg-yellow-500 text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="greetings-retry" onclick="retryActivity(5)" style="display:none;">Try Again üîÑ</button>
            </div>
        </div>
        
        <div class="lesson-card hidden" id="activity6">
            <h2 class="text-2xl font-bold brand-primary mb-4">üìù Activity 6: Advanced Gap-Fill</h2>
            <div class="activity-instructions mb-6">
                Fill in the gaps with the most natural word from the list below.
            </div>

            <div class="word-bank-drag flex flex-wrap gap-3 p-4 bg-gray-50 border-2 border-dashed border-brand-primary rounded-lg mb-6" id="wordBankAdvanced">
                <div class="word-bank-title w-full font-bold brand-primary mb-2">üìù Word Bank - Click the words:</div>
                <span class="word-item-drag py-2 px-4 rounded-full font-bold" data-word="cheerio">cheerio</span>
                <span class="word-item-drag py-2 px-4 rounded-full font-bold" data-word="pleasure">pleasure</span>
                <span class="word-item-drag py-2 px-4 rounded-full font-bold" data-word="lately">lately</span>
                <span class="word-item-drag py-2 px-4 rounded-full font-bold" data-word="keeping">keeping</span>
                <span class="word-item-drag py-2 px-4 rounded-full font-bold" data-word="well">well</span>
            </div>

            <div class="p-4 bg-blue-50 border-l-4 border-brand-primary rounded-lg">
                <div class="gap-sentence mb-4 text-gray-700">**C:** Good to see you! How have you been <span class="gap-fill-drop-zone inline-block min-w-[80px] text-center px-2 py-1 font-bold" data-correct="keeping"></span>?</div>
                <div class="gap-sentence mb-4 text-gray-700">**D:** Not too bad, thanks. And you? What have you been up to <span class="gap-fill-drop-zone inline-block min-w-[80px] text-center px-2 py-1 font-bold" data-correct="lately"></span>?</div>
                <div class="gap-sentence mb-4 text-gray-700">**C:** I've been <span class="gap-fill-drop-zone inline-block min-w-[80px] text-center px-2 py-1 font-bold" data-correct="well"></span>. It was a <span class="gap-fill-drop-zone inline-block min-w-[80px] text-center px-2 py-1 font-bold" data-correct="pleasure"></span> seeing you!</div>
                <div class="gap-sentence text-gray-700">**D:** You too! <span class="gap-fill-drop-zone inline-block min-w-[80px] text-center px-2 py-1 font-bold" data-correct="Cheerio"></span>!</div>
            </div>
            
            <div class="feedback-message mt-4 p-3 rounded-lg text-center hidden" id="advanced-feedback"></div>
            <div class="text-center mt-6">
                <button class="btn check-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="advanced-check-btn" onclick="checkAdvancedFill()">Check Answers ‚úì</button>
                <button class="btn next-activity-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="advanced-next" onclick="nextActivity()" style="display:none;">Continue to Next Activity ‚û°Ô∏è</button>
                <button class="btn try-again-btn bg-yellow-500 text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="advanced-retry" onclick="retryActivity(6)" style="display:none;">Try Again üîÑ</button>
            </div>
        </div>
        
        <div class="lesson-card hidden" id="activity7">
            <h2 class="text-2xl font-bold brand-primary mb-4">üèÜ Final Quiz: Review</h2>
            <div class="activity-instructions mb-6">
                Choose the most appropriate word or phrase to complete the sentence.
            </div>

            <div class="question-container mb-6" id="final-q1">
                <div class="text-lg font-semibold mb-3">1. After a long trip, someone might say, "I'm so glad to be ______."</div>
                <div class="options grid gap-3">
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">doing great</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="correct">back home</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">a pleasure</div>
                </div>
            </div>
            
            <div class="question-container mb-6" id="final-q2">
                <div class="text-lg font-semibold mb-3">2. A formal way to start a letter to a business contact is "Dear Mr. Smith, it is a great ______."</div>
                <div class="options grid gap-3">
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="correct">pleasure</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">up to</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">cheerio</div>
                </div>
            </div>

            <div class="question-container mb-6" id="final-q3">
                <div class="text-lg font-semibold mb-3">3. When saying goodbye informally, you could say, "I've ______!"</div>
                <div class="options grid gap-3">
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">been well</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">been a pleasure</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="correct">gotta run</div>
                </div>
            </div>
            
            <div class="question-container mb-6" id="final-q4">
                <div class="text-lg font-semibold mb-3">4. A polite response when someone apologizes for a small mistake is, "That's ______."</div>
                <div class="options grid gap-3">
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">a long time</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="wrong">going well</div>
                    <div class="option p-3 rounded-lg shadow-sm" data-answer="correct">alright</div>
                </div>
            </div>
            
            <div class="feedback-message mt-4 p-3 rounded-lg text-center hidden" id="final-feedback"></div>
            <div class="text-center mt-6">
                <button class="btn check-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="final-check-btn" onclick="checkFinalQuiz()">Check Answers ‚úì</button>
                <button class="btn next-activity-btn bg-brand-primary text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="final-next" onclick="endGame()" style="display:none;">Finish Lesson üéâ</button>
                <button class="btn try-again-btn bg-yellow-500 text-white font-bold py-2 px-6 rounded-full shadow-md hover:shadow-lg transition duration-200" id="final-retry" onclick="retryActivity(7)" style="display:none;">Try Again üîÑ</button>
            </div>
        </div>

        <div class="text-center mt-10 p-6 bg-white rounded-lg shadow-lg hidden" id="end-screen">
            <h2 class="text-4xl font-extrabold text-green-600 mb-4">Lesson Complete!</h2>
            <p class="text-xl text-gray-700 mb-6">You've finished the Greetings lesson and earned a total of <span class="font-bold text-green-600" id="finalPoints">0</span> points!</p>
            <p class="text-gray-600">Great job improving your English! You are now one cool dude.</p>
        </div>

    </div> <div class="points-animation" id="points-animation" style="display: none;">+20</div>
    <div class="sticker" id="sticker" style="display: none;">üëç</div>

    <script>
        // --- GAME STATE & CONSTANTS ---
        let currentActivity = 1;
        const totalActivities = 7;
        let totalPoints = 0;
        let streak = 0;
        const maxStreak = 5;

        // --- UTILITY FUNCTIONS ---
        function showPointsAnimation(points) {
            const anim = document.getElementById('points-animation');
            anim.textContent = `+${points}`;
            anim.style.display = 'block';
            setTimeout(() => {
                anim.style.display = 'none';
            }, 2000);
        }

        function showSticker(type) {
            const sticker = document.getElementById('sticker');
            if (type === 'great') {
                sticker.textContent = 'üèÜ';
                sticker.style.color = '#FFD700'; // Gold
            } else if (type === 'oops') {
                sticker.textContent = 'üò¨';
                sticker.style.color = '#DC3545'; // Red
            }
            sticker.style.display = 'block';
            // Trigger animation by resetting and then setting it
            sticker.style.animation = 'none';
            sticker.offsetHeight; /* trigger reflow */
            sticker.style.animation = 'stickerPop 1s forwards';

            setTimeout(() => {
                sticker.style.display = 'none';
            }, 1000);
        }

        function updateStats() {
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('streak').textContent = streak;
            const progress = (currentActivity - 1) / totalActivities * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function showFeedback(activityId, isCorrect, message) {
            const feedbackElement = document.getElementById(`${activityId}-feedback`);
            if (!feedbackElement) return;

            feedbackElement.textContent = message;
            feedbackElement.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800');
            
            if (isCorrect) {
                feedbackElement.classList.add('bg-green-100', 'text-green-800');
            } else {
                feedbackElement.classList.add('bg-red-100', 'text-red-800');
            }
        }

        function hideFeedback(activityId) {
            const feedbackElement = document.getElementById(`${activityId}-feedback`);
            if (feedbackElement) {
                feedbackElement.classList.add('hidden');
            }
        }

        function nextActivity() {
            // Hide current activity
            document.getElementById(`activity${currentActivity}`).classList.add('hidden');
            
            currentActivity++;
            updateStats();

            if (currentActivity > totalActivities) {
                endGame();
                return;
            }
            
            // Show next activity
            document.getElementById(`activity${currentActivity}`).classList.remove('hidden');

            // Hide the 'next' button for the new activity (if it has one)
            const nextButton = document.getElementById(getActivityNextButtonId(currentActivity));
            if (nextButton) {
                // Keep the 'next' button visible for Activity 4 (Video)
                if (currentActivity !== 4) { 
                    nextButton.style.display = 'none';
                }
            }
            
            // Ensure check button is visible for next activity (if it has one)
            const checkButton = document.getElementById(getActivityCheckButtonId(currentActivity));
            if (checkButton) checkButton.style.display = 'inline-block';
            
            // Hide feedback and retry button
            hideFeedback(getActivityFeedbackId(currentActivity));
            const retryButton = document.getElementById(getActivityRetryButtonId(currentActivity));
            if (retryButton) retryButton.style.display = 'none';
        }

        function getActivityNextButtonId(id) {
            if (id === 1) return 'matching-next';
            if (id === 2) return 'reading-next';
            if (id === 3) return 'conversation-next';
            if (id === 4) return 'video-next';
            if (id === 5) return 'greetings-next';
            if (id === 6) return 'advanced-next';
            if (id === 7) return 'final-next';
        }

        function getActivityCheckButtonId(id) {
            if (id === 2) return 'reading-check-btn';
            if (id === 3) return 'conversation-check-btn';
            if (id === 5) return 'greetings-check-btn';
            if (id === 6) return 'advanced-check-btn';
            if (id === 7) return 'final-check-btn';
            return null;
        }
        
        function getActivityRetryButtonId(id) {
            if (id === 2) return 'reading-retry';
            if (id === 3) return 'conversation-retry';
            if (id === 5) return 'greetings-retry';
            if (id === 6) return 'advanced-retry';
            if (id === 7) return 'final-retry';
            return null;
        }

        function getActivityFeedbackId(id) {
            if (id === 1) return 'matching';
            if (id === 2) return 'reading';
            if (id === 3) return 'conversation';
            if (id === 5) return 'greetings';
            if (id === 6) return 'advanced';
            if (id === 7) return 'final';
            return null;
        }

        function retryActivity(id) {
            const activityElement = document.getElementById(`activity${id}`);
            const checkButton = document.getElementById(getActivityCheckButtonId(id));
            const nextButton = document.getElementById(getActivityNextButtonId(id));
            const retryButton = document.getElementById(getActivityRetryButtonId(id));

            hideFeedback(getActivityFeedbackId(id));
            if (checkButton) checkButton.style.display = 'inline-block';
            if (nextButton) nextButton.style.display = 'none';
            if (retryButton) retryButton.style.display = 'none';

            // Specific reset logic based on activity type
            if (id === 2 || id === 5 || id === 7) {
                // Reading/Quiz (select one) reset
                activityElement.querySelectorAll('.option').forEach(option => {
                    option.classList.remove('selected', 'correct', 'incorrect', 'disabled');
                });
            } else if (id === 3 || id === 6) {
                // Gap-Fill reset
                activityElement.querySelectorAll('.gap-fill-drop-zone.filled').forEach(gap => {
                    const word = gap.textContent;
                    gap.textContent = '';
                    gap.classList.remove('filled', 'selected', 'correct-answer', 'incorrect-answer');
                    // Re-enable word bank item
                    const wordBankItem = activityElement.querySelector(`.word-item-drag[data-word="${word}"]`);
                    if (wordBankItem) {
                        wordBankItem.classList.remove('used');
                    }
                });
            } else if (id === 1) {
                // Matching reset (though matching auto-advances, this is for completeness)
                initializeMatchingGame();
            }
            
            // Re-enable interactions if they were disabled
            activityElement.querySelectorAll('.match-item, .option, .word-item-drag').forEach(item => {
                item.classList.remove('disabled');
                item.style.pointerEvents = 'auto';
            });
        }
        
        function endGame() {
            document.getElementById(`activity${totalActivities}`).classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('finalPoints').textContent = totalPoints;
            
            // Hide progress and stats bar when game is officially over
            document.querySelector('.stats-bar').classList.add('hidden');
            document.querySelector('.text-center.pt-6.pb-2').classList.add('hidden'); // Also hide local title/level
        }

        // --- ACTIVITY 1: MATCHING GAME LOGIC (Retaining the "auto-reset" logic) ---
        let selectedMatchItem = null;
        let selectedDefinitionItem = null;
        let correctMatches = 0;
        const totalMatches = 6;

        function initializeMatchingGame() {
            correctMatches = 0;
            document.getElementById('matchScore').textContent = `Matches: 0/${totalMatches}`;
            
            // Clear any old state
            const items = document.querySelectorAll('#activity1 .match-item');
            items.forEach(item => {
                item.classList.remove('selected', 'correct', 'disabled');
                item.style.pointerEvents = 'auto'; // Re-enable clicks
            });
            hideFeedback('matching');

            const vocabularyItems = document.querySelectorAll('#activity1 .matching-column:first-child .match-item');
            const definitionItems = document.querySelectorAll('#activity1 .matching-column:last-child .match-item');

            vocabularyItems.forEach(item => item.onclick = () => selectMatchItem(item, 'vocabulary'));
            definitionItems.forEach(item => item.onclick = () => selectMatchItem(item, 'definition'));

            // Ensure items are shuffled on init
            shuffleItems(definitionItems);
        }

        function shuffleItems(items) {
            const parent = items[0].parentNode;
            const fragment = document.createDocumentFragment();
            // Convert NodeList to Array for shuffling
            let itemsArray = Array.from(items);
            
            for (let i = itemsArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [itemsArray[i], itemsArray[j]] = [itemsArray[j], itemsArray[i]];
            }

            itemsArray.forEach(item => fragment.appendChild(item));
            parent.appendChild(fragment);
        }

        function selectMatchItem(item, type) {
            if (item.classList.contains('correct') || item.classList.contains('disabled')) return;

            // Deselect all items of the same type
            document.querySelectorAll(`#activity1 .matching-column:nth-child(${type === 'vocabulary' ? 1 : 2}) .match-item`).forEach(i => i.classList.remove('selected'));

            // Select the current item
            item.classList.add('selected');
            
            if (type === 'vocabulary') {
                selectedMatchItem = item;
            } else {
                selectedDefinitionItem = item;
            }

            // Attempt to match if one of each type is selected
            if (selectedMatchItem && selectedDefinitionItem) {
                checkMatch();
            }
        }

        function checkMatch() {
            const matchIdVocab = selectedMatchItem.getAttribute('data-match');
            const matchIdDef = selectedDefinitionItem.getAttribute('data-match');
            
            if (matchIdVocab === matchIdDef) {
                // Correct Match
                correctMatches++;
                totalPoints += 50;
                streak++;
                updateStats();
                showPointsAnimation(50);
                showSticker('great');

                selectedMatchItem.classList.remove('selected');
                selectedDefinitionItem.classList.remove('selected');

                selectedMatchItem.classList.add('correct', 'disabled');
                selectedDefinitionItem.classList.add('correct', 'disabled');
                
                selectedMatchItem.style.pointerEvents = 'none';
                selectedDefinitionItem.style.pointerEvents = 'none';

                showFeedback('matching', true, 'Correct match! Keep it up!');

            } else {
                // Incorrect Match - Deselect only, as requested by the user's saved preference
                // The check answers button is hidden, so we only need to deselect on incorrect.
                streak = 0; // Reset streak on incorrect answer
                updateStats();
                
                // Add temporary shake animation and error styling to incorrect pair
                [selectedMatchItem, selectedDefinitionItem].forEach(el => {
                    el.classList.add('incorrect');
                    el.style.animation = 'shake 0.5s';
                });

                showFeedback('matching', false, 'Not quite! Try again.');

                setTimeout(() => {
                    [selectedMatchItem, selectedDefinitionItem].forEach(el => {
                        el.classList.remove('selected', 'incorrect');
                        el.style.animation = 'none';
                    });
                    selectedMatchItem = null;
                    selectedDefinitionItem = null;
                }, 750); // Small delay before deselecting

                // IMPORTANT: The original user request was to deselect without a check button. 
                // The delay above handles the deselecting. No other action needed.
            }

            document.getElementById('matchScore').textContent = `Matches: ${correctMatches}/${totalMatches}`;

            if (correctMatches === totalMatches) {
                // Final success logic
                totalPoints += 100; // Bonus points for finishing the activity
                updateStats();
                showPointsAnimation(100);
                document.getElementById('matching-feedback').classList.remove('hidden');
                showFeedback('matching', true, 'Amazing! You finished all the matches! üèÜ');
                document.getElementById('matching-next').style.display = 'inline-block';
                // Disable all items just in case
                document.querySelectorAll('#activity1 .match-item').forEach(item => item.classList.add('disabled'));
            }

            // Clear selections for next attempt
            if (matchIdVocab === matchIdDef) {
                selectedMatchItem = null;
                selectedDefinitionItem = null;
            }
        }

        // --- ACTIVITY 2: READING QUIZ LOGIC ---
        function initializeReadingActivity() {
            document.querySelectorAll('#activity2 .options .option').forEach(option => {
                option.onclick = (e) => selectOption(e.target);
            });
        }
        
        function selectOption(option) {
            const container = option.closest('.question-container');
            if (option.classList.contains('disabled')) return;

            // Deselect all other options in this question
            container.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));

            // Select the clicked option
            option.classList.add('selected');
        }

        function checkReadingAnswers() {
            checkQuizAnswers(2, 'reading', 3, 40);
        }

        // --- ACTIVITY 3 & 6: GAP-FILL LOGIC (Conversation & Advanced) ---
        let selectedWordItem = null;
        let selectedGapItem = null;

        function initializeConversationFillActivity() {
            setupGapFillActivity(3);
        }

        function initializeGapFillActivity() {
            setupGapFillActivity(6);
        }

        function setupGapFillActivity(id) {
            const activityElement = document.getElementById(`activity${id}`);
            activityElement.querySelectorAll('.word-item-drag').forEach(word => {
                word.onclick = () => selectWord(word, id);
            });
            activityElement.querySelectorAll('.gap-fill-drop-zone').forEach(gap => {
                gap.onclick = () => selectGap(gap, id);
            });
        }

        function selectWord(word, activityId) {
            if (word.classList.contains('used')) return;

            // Deselect previously selected word in the *same* activity
            const currentSelected = document.querySelector(`#activity${activityId} .word-item-drag.selected`);
            if (currentSelected && currentSelected !== word) {
                currentSelected.classList.remove('selected');
            }

            word.classList.toggle('selected');
            selectedWordItem = word.classList.contains('selected') ? word : null;

            // If a gap is already selected, attempt to place the word
            if (selectedWordItem && selectedGapItem && selectedGapItem.closest(`#activity${activityId}`)) {
                placeWord(activityId);
            }
        }

        function selectGap(gap, activityId) {
            if (gap.classList.contains('correct-answer') || gap.classList.contains('incorrect-answer')) return;

            // Deselect previously selected gap in the *same* activity
            const currentSelected = document.querySelector(`#activity${activityId} .gap-fill-drop-zone.selected`);
            if (currentSelected && currentSelected !== gap) {
                currentSelected.classList.remove('selected');
            }

            gap.classList.toggle('selected');
            selectedGapItem = gap.classList.contains('selected') ? gap : null;

            if (gap.classList.contains('filled') && !gap.classList.contains('selected')) {
                 // Removing word from filled gap
                 const wordToRemove = gap.textContent;
                 gap.textContent = '';
                 gap.classList.remove('filled');
                 
                 // Re-enable word in the word bank
                 const wordBankItem = document.querySelector(`#activity${activityId} .word-item-drag[data-word="${wordToRemove}"]`);
                 if (wordBankItem) {
                     wordBankItem.classList.remove('used');
                 }
                 selectedGapItem = null;
                 return;
            }

            // If a word is already selected, attempt to place the word
            if (selectedWordItem && selectedGapItem && selectedWordItem.closest(`#activity${activityId}`)) {
                placeWord(activityId);
            }
        }

        function placeWord(activityId) {
            if (selectedWordItem && selectedGapItem) {
                // Ensure the gap is empty before filling
                if (selectedGapItem.textContent === '') {
                    selectedGapItem.textContent = selectedWordItem.getAttribute('data-word');
                    selectedGapItem.classList.add('filled');
                    selectedWordItem.classList.add('used');

                    // Clean up
                    selectedWordItem.classList.remove('selected');
                    selectedGapItem.classList.remove('selected');
                    selectedWordItem = null;
                    selectedGapItem = null;
                } else {
                     // If the gap is already filled, we do nothing or clear the selection
                     selectedGapItem.classList.remove('selected');
                     selectedWordItem.classList.remove('selected');
                     selectedWordItem = null;
                     selectedGapItem = null;
                }
            }
        }

        function checkConversationFill() {
            checkGapFill(3, 'conversation', 5, 30);
        }

        function checkAdvancedFill() {
            checkGapFill(6, 'advanced', 4, 35);
        }

        function checkGapFill(activityId, feedbackId, totalGaps, pointsPerCorrect) {
            const gaps = document.querySelectorAll(`#activity${activityId} .gap-fill-drop-zone`);
            let correctCount = 0;
            let allFilled = true;
            
            gaps.forEach(gap => {
                if (!gap.classList.contains('filled')) {
                    allFilled = false;
                    return;
                }
                const correct = gap.getAttribute('data-correct');
                const userGuess = gap.textContent;
                
                gap.classList.remove('correct-answer', 'incorrect-answer');

                if (userGuess === correct) {
                    gap.classList.add('correct-answer');
                    correctCount++;
                } else {
                    gap.classList.add('incorrect-answer');
                }
            });

            const nextButton = document.getElementById(getActivityNextButtonId(activityId));
            const checkButton = document.getElementById(getActivityCheckButtonId(activityId));
            const retryButton = document.getElementById(getActivityRetryButtonId(activityId));

            if (!allFilled) {
                showFeedback(feedbackId, false, 'Please fill all the gaps before checking!');
                return;
            }

            if (correctCount === totalGaps) {
                totalPoints += (correctCount * pointsPerCorrect);
                streak++;
                updateStats();
                showPointsAnimation(correctCount * pointsPerCorrect);
                showSticker('great');
                showFeedback(feedbackId, true, 'Fantastic! All gaps filled correctly! üèÜ');
                if (nextButton) nextButton.style.display = 'inline-block';
                if (checkButton) checkButton.style.display = 'none';
                if (retryButton) retryButton.style.display = 'none';
                
                // Disable all interactions after success
                document.querySelectorAll(`#activity${activityId} .word-item-drag, #activity${activityId} .gap-fill-drop-zone`).forEach(item => {
                    item.style.pointerEvents = 'none';
                });

            } else {
                totalPoints += (correctCount * (pointsPerCorrect * 0.5)); // Half points for partial correct
                streak = 0;
                updateStats();
                showSticker('oops');
                showFeedback(feedbackId, false, `You got ${correctCount} out of ${totalGaps} correct. Review the red ones and try again!`);
                if (retryButton) retryButton.style.display = 'inline-block';
                // Only hide check button if partial scoring is allowed, otherwise keep it visible for re-check
            }
        }

        // --- ACTIVITY 5 & 7: MULTI-CHOICE QUIZ LOGIC ---
        function initializeGreetingsQuiz() {
            document.querySelectorAll('#activity5 .options .option').forEach(option => {
                option.onclick = (e) => selectOption(e.target);
            });
        }
        
        function initializeFinalQuiz() {
            document.querySelectorAll('#activity7 .options .option').forEach(option => {
                option.onclick = (e) => selectOption(e.target);
            });
        }
        
        function checkGreetingsQuiz() {
            checkQuizAnswers(5, 'greetings', 3, 50);
        }

        function checkFinalQuiz() {
            checkQuizAnswers(7, 'final', 4, 50);
        }

        function checkQuizAnswers(activityId, feedbackId, totalQuestions, pointsPerCorrect) {
            const questions = document.querySelectorAll(`#activity${activityId} .question-container`);
            let correctAnswers = 0;
            let allAnswered = true;

            questions.forEach(question => {
                let selectedOption = question.querySelector('.option.selected');
                
                if (!selectedOption) {
                    allAnswered = false;
                    return;
                }

                // Disable all options in the question after selection is made
                question.querySelectorAll('.option').forEach(option => option.classList.add('disabled'));

                selectedOption.classList.remove('selected'); // Remove selection class, will add correct/incorrect
                
                if (selectedOption.getAttribute('data-answer') === 'correct') {
                    selectedOption.classList.add('correct');
                    correctAnswers++;
                } else {
                    selectedOption.classList.add('incorrect');
                    // Find and mark the correct answer in green
                    question.querySelector('.option[data-answer="correct"]').classList.add('correct');
                }
            });

            if (!allAnswered) {
                showFeedback(feedbackId, false, 'Please answer all questions before checking!');
                // Re-enable disabled options if not all answered
                questions.forEach(question => question.querySelectorAll('.option:not(.selected)').forEach(opt => opt.classList.remove('disabled')));
                return;
            }

            const checkButton = document.getElementById(getActivityCheckButtonId(activityId));
            const nextButton = document.getElementById(getActivityNextButtonId(activityId));
            const retryButton = document.getElementById(getActivityRetryButtonId(activityId));


            if (correctAnswers === totalQuestions) {
                totalPoints += (totalQuestions * pointsPerCorrect);
                streak++;
                updateStats();
                showPointsAnimation(totalQuestions * pointsPerCorrect);
                showSticker('great');
                showFeedback(feedbackId, true, 'Amazing! You passed with full marks! üèÜ');
                if (nextButton) nextButton.style.display = 'inline-block';
                if (checkButton) checkButton.style.display = 'none';
                if (retryButton) retryButton.style.display = 'none';

            } else {
                totalPoints += correctAnswers * (pointsPerCorrect * 0.5); // Half points for correct answers
                streak = 0;
                updateStats();
                showSticker('oops');
                showFeedback(feedbackId, false, `You got ${correctAnswers} out of ${totalQuestions} correct. Try again to get full points! üìù`);
                if (retryButton) retryButton.style.display = 'inline-block';
            }
        }

        // --- Initialization ---
        function initializeGame() {
            updateStats();
            initializeMatchingGame();
            initializeReadingActivity();
            initializeConversationFillActivity();
            initializeGreetingsQuiz();
            initializeGapFillActivity();
            initializeFinalQuiz();
            
            // Per user request for Activity 1 (Matching): Ensure 'matching-feedback' is hidden initially.
            // Also, acknowledge the saved preference for deselecting incorrect matches.
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeGame);
    </script>
</body>
</html>
