<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="manifest" href="/manifest.json">
    <title>Vibe Check - English For Cool Dudes</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* --- APP STYLING --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #F3F4F6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
        }

        .phone-mockup {
            margin: 20px 0;
            flex-shrink: 0;
        }

        /* --- HEADER STYLES --- */
        .header {
            width: 100%;
            background: #FFFFFF;
            border-bottom: 1px solid #E2E8F0;
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
            display: flex;
            justify-content: center;
            z-index: 100;
        }

        .header-content {
            width: 100%;
            max-width: 1000px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 36px; height: 36px;
            background: linear-gradient(135deg, #0EA5E9 0%, #8B5CF6 100%);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px;
        }

        .site-title {
            font-size: 20px; font-weight: 600; color: #0F172A; text-decoration: none;
        }

        .phone-mockup {
            width: 100%; max-width: 400px; height: 100%; max-height: 850px;
            background: #FFFFFF; display: flex; flex-direction: column;
            position: relative; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }

        @media (min-width: 640px) {
            .phone-mockup {
                height: 90vh; border-radius: 30px; border: 8px solid #1F2937;
            }
        }

        /* --- ANIMATIONS --- */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        
        .shake-screen {
            animation: shake 0.5s; animation-iteration-count: 1;
        }

        /* Header */
        .chat-header {
            background: #F9FAFB; padding: 15px; border-bottom: 1px solid #E5E7EB;
            display: flex; align-items: center; justify-content: space-between; z-index: 10;
        }
        
        .avatar {
            width: 45px; height: 45px; background: #E5E7EB; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; border: 2px solid #E5E7EB;
        }

        .status-dot {
            width: 10px; height: 10px; background: #10B981;
            border-radius: 50%; display: inline-block; margin-right: 5px;
        }

        /* Vibe Meter */
        .vibe-container {
            width: 80px; height: 10px; background: #E5E7EB; border-radius: 5px; overflow: hidden;
        }
        .vibe-fill {
            height: 100%; background: #10B981; width: 50%; transition: width 0.5s, background-color 0.5s;
        }

        /* Chat Area */
        .chat-area {
            flex: 1; background: #E5E5F7; 
            background-image: radial-gradient(#444cf7 0.5px, transparent 0.5px), radial-gradient(#444cf7 0.5px, #e5e5f7 0.5px);
            background-size: 20px 20px; background-position: 0 0, 10px 10px;
            padding: 20px; overflow-y: auto; display: flex; flex-direction: column;
            gap: 15px; scroll-behavior: smooth;
        }

        /* Bubbles */
        .message {
            max-width: 80%; padding: 12px 16px; border-radius: 18px;
            font-size: 15px; line-height: 1.4; position: relative;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1); word-wrap: break-word;
        }
        
        .msg-npc {
            align-self: flex-start; background: #FFFFFF; color: #1F2937; border-bottom-left-radius: 4px;
        }
        
        .msg-user {
            align-self: flex-end; background: #3B82F6; color: white; border-bottom-right-radius: 4px;
        }

        /* COACH MESSAGE */
        .msg-coach {
            align-self: center; background: rgba(255, 255, 255, 0.95);
            border: 1px dashed #EF4444; color: #EF4444;
            font-size: 12px; font-weight: 700; padding: 8px 14px;
            border-radius: 15px; margin: 5px 0; animation: fadeIn 0.5s;
            text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .typing-indicator {
            align-self: flex-start; background: white; padding: 10px 15px;
            border-radius: 20px; display: none; gap: 5px; width: fit-content;
        }
        .dot { width: 6px; height: 6px; background: #9CA3AF; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        @keyframes popIn { from { opacity: 0; transform: translateY(10px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Input Area */
        .input-area {
            background: #FFFFFF; padding: 15px; border-top: 1px solid #E5E7EB;
            min-height: 80px; display: flex; flex-direction: column; justify-content: center;
        }

        /* Choice Buttons */
        .choices-container { display: flex; flex-direction: column; gap: 8px; }
        .choice-btn {
            background: #F3F4F6; border: 1px solid #E5E7EB; padding: 12px;
            border-radius: 12px; text-align: left; font-size: 14px; cursor: pointer;
            transition: all 0.2s; color: #374151; font-weight: 500;
        }
        .choice-btn:hover { background: #DBEAFE; border-color: #3B82F6; color: #1D4ED8; }

        /* Overlays */
        #game-over-overlay, #menu-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.85);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 50; text-align: center; color: white; padding: 30px;
        }
        
        #menu-overlay { display: flex; background: #111827; }

        .menu-btn {
            background: white; color: #111827; width: 100%; padding: 15px;
            margin-bottom: 15px; border-radius: 12px; font-weight: 700;
            cursor: pointer; transition: transform 0.2s; border: none; font-size: 16px;
        }
        .menu-btn:hover { transform: scale(1.02); background: #F3F4F6; }

        /* Difficulty Toggle */
        .diff-selector {
            background: #374151; padding: 5px; border-radius: 10px; display: flex; gap: 5px; margin-bottom: 30px;
        }
        .diff-opt {
            padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; color: #9CA3AF;
        }
        .diff-opt.active { background: #3B82F6; color: white; }

        .footer {
            background: #FFFFFF;
            border-top: 1px solid #E5E9F2;
            padding: 32px 20px;
            margin-top: 60px;
            text-align: center;
        }

        .footer-text {
            font-size: 14px;
            color: #718096;
        }

    </style>
</head>
<body>

    <header class="header">
        <div class="header-content">
            <div style="display: flex; align-items: center; gap: 15px;">
                <span class="logo">üéÆ</span>
                <a href="/games/" class="site-title">English For Cool Dudes</a>
            </div>
        </div>
    </header>

    <div class="phone-mockup" id="app-container">
        
        <div class="chat-header">
            <div style="display: flex; align-items: center; gap: 10px;">
                <button onclick="showMenu()" style="font-size: 20px; cursor: pointer; background:none; border:none;">‚¨ÖÔ∏è</button>
                <div class="avatar" id="npc-avatar">üíº</div>
                <div>
                    <div style="font-weight: 700; font-size: 15px;" id="npc-name">The Boss</div>
                    <div style="font-size: 11px; color: #6B7280;"><span class="status-dot"></span>Online</div>
                </div>
            </div>
            <div>
                <div style="font-size: 10px; text-transform: uppercase; color: #9CA3AF; font-weight: 700; margin-bottom: 2px;">Vibe Meter</div>
                <div class="vibe-container">
                    <div class="vibe-fill" id="vibe-bar"></div>
                </div>
            </div>
        </div>

        <div class="chat-area" id="chat-area">
            <div class="typing-indicator" id="typing-indicator">
                <div class="dot"></div><div class="dot"></div><div class="dot"></div>
            </div>
        </div>

        <div class="input-area">
            <div class="choices-container" id="choices-area"></div>
        </div>

       <div id="menu-overlay">
            <h1 style="font-size: 32px; font-weight: 800; margin-bottom: 10px;">üí¨ Vibe Check</h1>
            <p style="color: #9CA3AF; margin-bottom: 20px; font-style: italic;">Keep the conversation vibe alive by choosing the best response - and don't get BLOCKED!</p>
            
            <div class="diff-selector">
                <div class="diff-opt active" id="diff-chill" onclick="setDifficulty('chill')">üòé Chill (Normal)</div>
                <div class="diff-opt" id="diff-pro" onclick="setDifficulty('pro')">üî• Pro (Hard)</div>
            </div>
            <p id="diff-desc" style="font-size:12px; color: #6B7280; margin-bottom: 20px; font-style: italic;">Training Mode: Coach ON, 50% Start</p>

            <button class="menu-btn" onclick="pickRandomScenario('business')">üíº Business (5 Stories)</button>
            <button class="menu-btn" onclick="pickRandomScenario('dating')">üåπ Social / Dating (5 Stories)</button>
            <button class="menu-btn" onclick="pickRandomScenario('casual')">üß¢ Slang / Friends (5 Stories)</button>
            
            <button class="menu-btn" style="margin-top: 20px; border: 2px solid #EF4444; color: #EF4444;" onclick="window.location.href='/games/'">üö™ Quit to Break Room</button>
        </div>

        <div id="game-over-overlay">
            <div style="font-size: 60px; margin-bottom: 10px;" id="end-emoji">üö´</div>
            <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 10px;" id="end-title">BLOCKED!</h2>
            <p style="color: #D1D5DB; margin-bottom: 30px;" id="end-reason">Your vibe was way off.</p>
            
            <button class="menu-btn" onclick="restartCurrentScenario()">üîÑ Try Again (Same Story)</button>
            <button class="menu-btn" style="background: transparent; color: white; border: 1px solid white;" onclick="showMenu()">Main Menu</button>
        </div>

    </div>
    <footer class="footer">
    <p class="footer-text">¬© 2026 English For Cool Dudes - üòé</p>
    <div style="margin-top: 10px;">
        <a href="/impressum/" style="color: #667EEA; margin-right: 15px; text-decoration: none;">Impressum</a>
        <a href="/datenschutz/" style="color: #667EEA; text-decoration: none;">Datenschutzerkl√§rung</a>
    </div>
</footer>

    <script>
        // --- GAME CONFIG ---
        let difficulty = 'chill';
        
        // TIMINGS
        const TIME_INITIAL_PAUSE = 600;
        const TIME_TYPING = 2000;
        const TIME_READING = 2000;

        // --- GAME DATA (15 STORIES - ALL MULTIPLE CHOICE) ---
        const scenarioDB = {
            business: [
                {
                    name: "Mr. Sterling", avatar: "üíº", startNode: 1,
                    nodes: {
                        1: { text: "Where is the quarterly report? It was due an hour ago. üò°", type: "choice", options: [
                            { text: "Chill out, I'm doing it.", vibe: -40, feedback: "Too casual/rude for a boss!", next: "fail_rude" },
                            { text: "I'm so sorry! I forgot.", vibe: -20, feedback: "Don't admit you forgot. Be professional.", next: "fail_weak" },
                            { text: "I'm finalizing the details now. It will be in your inbox in 10 mins.", vibe: +10, next: 2 }
                        ]},
                        2: { text: "Fine. Just make sure the budget section is accurate this time.", type: "choice", options: [
                            { text: "It's always accurate.", vibe: -10, feedback: "Too defensive.", next: 3 },
                            { text: "Noted. I've double-checked the figures.", vibe: +20, next: 3 },
                            { text: "Whatever you say.", vibe: -30, feedback: "Passive aggressive attitude.", next: "fail_attitude" }
                        ]},
                        3: { text: "Wait, I see a typo in the email you just sent. You wrote 'We look forward to hare from you'. Fix it.", type: "choice", options: [
                            { text: "I'll correct it to 'hearing' right away.", vibe: +20, next: 4 },
                            { text: "It's fine, they'll understand.", vibe: -30, feedback: "Unprofessional!", next: "fail_sloppy" },
                            { text: "I don't see a mistake.", vibe: -20, feedback: "Pay attention to details.", next: "fail_sloppy" }
                        ]},
                        4: { text: "Better. Are you available for a client call at 5 PM?", type: "choice", options: [
                            { text: "No, I'm going home.", vibe: -50, feedback: "Refusing a request directly is risky.", next: "fail_lazy" },
                            { text: "I can make myself available.", vibe: +20, next: "win" },
                            { text: "I suppose so.", vibe: -10, feedback: "Sounds unenthusiastic.", next: "win" }
                        ]},
                        "win": { text: "Excellent. Send the invite.", end: true, win: true },
                        "fail_rude": { text: "Excuse me? Visit HR immediately. You're fired.", end: true, win: false },
                        "fail_weak": { text: "I need confidence, not apologies. Get out.", end: true, win: false },
                        "fail_attitude": { text: "I don't like your tone. Go home.", end: true, win: false },
                        "fail_lazy": { text: "Then don't bother coming back tomorrow.", end: true, win: false },
                        "fail_sloppy": { text: "Details matter. You're fired.", end: true, win: false }
                    }
                },
                {
                    name: "Mrs. Vance", avatar: "üíº", startNode: 1,
                    nodes: {
                        1: { text: "You wanted to see me about your salary?", type: "choice", options: [
                            { text: "Yeah, I want more money.", vibe: -30, feedback: "Too blunt/greedy.", next: "fail_greedy" },
                            { text: "I'd like to discuss a potential raise.", vibe: +10, next: 2 },
                            { text: "I'm broke, please help.", vibe: -20, feedback: "Too desperate/personal.", next: "fail_beg" }
                        ]},
                        2: { text: "I see. Why do you think you deserve a raise right now?", type: "choice", options: [
                            { text: "I've consistently exceeded my sales targets.", vibe: +20, next: 3 },
                            { text: "Everyone else got one.", vibe: -30, feedback: "Don't compare yourself to others.", next: "fail_compare" },
                            { text: "I just need more money.", vibe: -40, feedback: "Focus on your value, not needs.", next: "fail_beg" }
                        ]},
                        3: { text: "Fair point. Your results have been good. What figure were you thinking?", type: "choice", options: [
                            { text: "10% increase.", vibe: +10, next: 4 },
                            { text: "Double my salary.", vibe: -50, feedback: "Unrealistic expectation.", next: "fail_unreal" },
                            { text: "Whatever you can give.", vibe: -10, feedback: "Undervalues yourself.", next: "fail_weak" }
                        ]},
                        4: { text: "10% is high. We can offer 5%.", type: "choice", options: [
                            { text: "That's an insult.", vibe: -40, feedback: "Very rude reaction.", next: "fail_rude" },
                            { text: "I appreciate the offer, could we meet at 7%?", vibe: +30, next: "win" },
                            { text: "Okay, fine.", vibe: 0, next: "win_weak" }
                        ]},
                        "win": { text: "You drive a hard bargain. 7% it is. Sign here.", end: true, win: true },
                        "win_weak": { text: "Great. 5% effective immediately. Back to work.", end: true, win: true },
                        "fail_greedy": { text: "We don't just hand out cash. Request denied.", end: true, win: false },
                        "fail_beg": { text: "This is a business, not a charity.", end: true, win: false },
                        "fail_unreal": { text: "Get real. Meeting over.", end: true, win: false },
                        "fail_weak": { text: "If you don't value yourself, neither will I. No raise.", end: true, win: false },
                        "fail_rude": { text: "Watch your attitude. Request denied.", end: true, win: false },
                        "fail_compare": { text: "I'm not discussing other people's salaries. Request denied.", end: true, win: false }
                    }
                },
                {
                    name: "Client (John)", avatar: "ü§ù", startNode: 1,
                    nodes: {
                        1: { text: "We received the shipment, but half the items are broken! ü§¨", type: "choice", options: [
                            { text: "Not my problem.", vibe: -50, feedback: "Refusing responsibility.", next: "fail_rude" },
                            { text: "Oh no! Let me look into that immediately.", vibe: +20, next: 2 },
                            { text: "Maybe the postman dropped it.", vibe: -20, feedback: "Making excuses.", next: "fail_excuse" }
                        ]},
                        2: { text: "You better fix this or we are cancelling the contract.", type: "choice", options: [
                            { text: "We'll send a full replacement immediately with express shipping.", vibe: +30, next: 3 },
                            { text: "Would you prefer a refund or replacement?", vibe: +20, next: 3 },
                            { text: "These things happen sometimes.", vibe: -30, feedback: "Don't minimize the problem!", next: "fail_dismiss" }
                        ]},
                        3: { text: "A replacement sounds acceptable. When will it arrive?", type: "choice", options: [
                            { text: "Whenever the truck gets there.", vibe: -30, feedback: "Too vague/lazy.", next: "fail_lazy" },
                            { text: "We are shipping it express today.", vibe: +30, next: "win" },
                            { text: "Next week maybe.", vibe: -10, feedback: "Too slow.", next: "fail_slow" }
                        ]},
                        "win": { text: "Okay. Send me the tracking number. Thanks for fixing it.", end: true, win: true },
                        "fail_rude": { text: "Wow. I'm calling your manager.", end: true, win: false },
                        "fail_excuse": { text: "I don't care whose fault it is. Fix it or we leave.", end: true, win: false },
                        "fail_lazy": { text: "Unacceptable. Contract cancelled.", end: true, win: false },
                        "fail_slow": { text: "Too slow. We are going to a competitor.", end: true, win: false },
                        "fail_dismiss": { text: "Not good enough. We're done here.", end: true, win: false }
                    }
                },
                {
                    name: "HR Manager", avatar: "üìã", startNode: 1,
                    nodes: {
                        1: { text: "Thanks for coming in. Tell me, what is your biggest weakness?", type: "choice", options: [
                            { text: "I work too hard.", vibe: -10, feedback: "A clich√© answer.", next: 2 },
                            { text: "Sometimes I focus too much on details.", vibe: +20, next: 2 },
                            { text: "I'm lazy in the mornings.", vibe: -40, feedback: "Never admit to being lazy!", next: "fail_lazy" }
                        ]},
                        2: { text: "Interesting. And why do you want to work here?", type: "choice", options: [
                            { text: "Your company has an excellent reputation and I want to grow my skills.", vibe: +30, next: 3 },
                            { text: "I need a job.", vibe: -40, feedback: "Show genuine interest!", next: "fail_generic" },
                            { text: "The salary is good.", vibe: -20, feedback: "Money shouldn't be your only motivation.", next: "fail_money" }
                        ]},
                        3: { text: "Good answer. Do you have any questions for me?", type: "choice", options: [
                            { text: "No, I'm good.", vibe: -20, feedback: "Always ask a question!", next: "fail_interest" },
                            { text: "How much vacation do I get?", vibe: -10, feedback: "Don't ask about perks first.", next: "fail_perks" },
                            { text: "What does a typical day look like?", vibe: +20, next: "win" }
                        ]},
                        "win": { text: "Great question! Let me introduce you to the team. You're hired!", end: true, win: true },
                        "fail_lazy": { text: "We need energetic people here. Goodbye.", end: true, win: false },
                        "fail_interest": { text: "You don't seem very interested. We'll call you.", end: true, win: false },
                        "fail_perks": { text: "You should care about the work, not just the vacation.", end: true, win: false },
                        "fail_generic": { text: "We need people who are passionate about what we do.", end: true, win: false },
                        "fail_money": { text: "We want team members who care about more than just the paycheck.", end: true, win: false }
                    }
                },
                {
                    name: "Karen", avatar: "üòí", startNode: 1,
                    nodes: {
                        1: { text: "Did you see what Mike is wearing today? So unprofessional.", type: "choice", options: [
                            { text: "Yeah, he looks like a clown.", vibe: -20, feedback: "Don't gossip!", next: "fail_gossip" },
                            { text: "I think he looks fine.", vibe: +10, next: 2 },
                            { text: "I'm trying to focus on my work.", vibe: +20, next: 2 }
                        ]},
                        2: { text: "You're no fun. Anyway, are you going to the meeting?", type: "choice", options: [
                            { text: "Yes, I'll be there.", vibe: +20, next: 3 },
                            { text: "Do I have to?", vibe: -10, feedback: "Show more enthusiasm.", next: 3 },
                            { text: "What meeting?", vibe: -20, feedback: "Stay informed!", next: "fail_clueless" }
                        ]},
                        3: { text: "I'm thinking of skipping it. It's so boring. You should skip it too.", type: "choice", options: [
                            { text: "Okay, let's skip it.", vibe: -40, feedback: "Bad influence!", next: "fail_skip" },
                            { text: "I can't, it's important.", vibe: +20, next: "win" },
                            { text: "Maybe...", vibe: -10, feedback: "Be decisive.", next: 3 }
                        ]},
                        "win": { text: "Fine, be a teacher's pet. See you there.", end: true, win: true },
                        "fail_gossip": { text: "Exactly! I'm going to tell everyone you said that.", end: true, win: false },
                        "fail_skip": { text: "The boss noticed we were missing. We are in big trouble.", end: true, win: false },
                        "fail_clueless": { text: "How do you not know? It's been on the calendar for a week.", end: true, win: false }
                    }
                }
            ],
            dating: [
                {
                    name: "Sarah", avatar: "üåπ", startNode: 1,
                    nodes: {
                        1: { text: "Hey! Just saw your profile. You seem fun. üòä", type: "choice", options: [
                            { text: "I know.", vibe: -20, feedback: "Too arrogant.", next: 2 },
                            { text: "Hey! Thanks, you too. How's your week going?", vibe: +20, next: 2 },
                            { text: "Send pics.", vibe: -100, feedback: "CREEPY. Don't do this.", next: "fail_creep" }
                        ]},
                        2: { text: "It's been okay! Just super busy with work. I need a break lol.", type: "choice", options: [
                            { text: "Jobs are boring.", vibe: -10, feedback: "Negative vibe.", next: 3 },
                            { text: "That sucks. You should quit.", vibe: -20, feedback: "Bad advice.", next: 3 },
                            { text: "I hear that. We should do something fun then!", vibe: +20, next: 3 }
                        ]},
                        3: { text: "Exactly! I love Italian food btw. üçù", type: "choice", options: [
                            { text: "Would you like to get Italian dinner this weekend?", vibe: +30, next: 4 },
                            { text: "Me too! I know a great place.", vibe: +20, next: 4 },
                            { text: "I don't really like Italian.", vibe: -30, feedback: "You just missed an easy connection!", next: "fail_mismatch" }
                        ]},
                        4: { text: "Ooh I'd love that! Saturday night? ü•Ç", type: "choice", options: [
                            { text: "Saturday works perfectly.", vibe: +20, next: "win" },
                            { text: "Maybe. I might be busy.", vibe: -30, feedback: "Playing too hard to get.", next: "fail_cold" },
                            { text: "If you pay.", vibe: -50, feedback: "Very cheap/rude.", next: "fail_cheap" }
                        ]},
                        "win": { text: "Great! Can't wait! See you then üòò", end: true, win: true },
                        "fail_creep": { text: "Uhh... blocked.", end: true, win: false },
                        "fail_cold": { text: "Okay nevermind then...", end: true, win: false },
                        "fail_cheap": { text: "Wow. Bye.", end: true, win: false },
                        "fail_mismatch": { text: "Oh... well this probably won't work out then.", end: true, win: false }
                    }
                },
                {
                    name: "Jessica", avatar: "üç∑", startNode: 1,
                    nodes: {
                        1: { text: "That dinner was delicious! üòã Here comes the check.", type: "choice", options: [
                            { text: "You paying?", vibe: -40, feedback: "Cheap/Rude.", next: "fail_cheap" },
                            { text: "Let me get this.", vibe: +20, next: 2 },
                            { text: "Let's split it.", vibe: 0, next: 3 } 
                        ]},
                        2: { text: "Are you sure? It's kind of expensive.", type: "choice", options: [
                            { text: "My treat. Don't worry about it.", vibe: +30, next: 3 },
                            { text: "Let's split it 50/50 then.", vibe: +10, next: 3 },
                            { text: "Actually, can you pay?", vibe: -40, feedback: "Don't backtrack now!", next: "fail_backtrack" }
                        ]},
                        3: { text: "Okay, all sorted! So... what do you want to do now?", type: "choice", options: [
                            { text: "Your place?", vibe: -50, feedback: "Moving too fast!", next: "fail_fast" },
                            { text: "We could grab a drink at a jazz bar?", vibe: +20, next: "win" },
                            { text: "I'm going home.", vibe: -20, feedback: "Boring ending.", next: "fail_boring" }
                        ]},
                        "win": { text: "I love jazz! Let's go! üé∑", end: true, win: true },
                        "fail_cheap": { text: "Wow... okay. I'll pay for myself and leave.", end: true, win: false },
                        "fail_fast": { text: "Whoa, slow down. I'm going home alone.", end: true, win: false },
                        "fail_boring": { text: "Oh. Okay. Goodnight then.", end: true, win: false },
                        "fail_backtrack": { text: "Seriously? That's disappointing. I'm going home.", end: true, win: false }
                    }
                },
                {
                    name: "Tom", avatar: "üé∏", startNode: 1,
                    nodes: {
                        1: { text: "Hey! Are you new to the city?", type: "choice", options: [
                            { text: "Yes, I just moved here.", vibe: +10, next: 2 },
                            { text: "Who asks?", vibe: -30, feedback: "Too aggressive.", next: "fail_aggro" },
                            { text: "No.", vibe: -10, next: 2 }
                        ]},
                        2: { text: "Cool! I'm playing a gig at a bar downtown tonight. You should come!", type: "choice", options: [
                            { text: "That sounds awesome! What time?", vibe: +30, next: 3 },
                            { text: "Maybe. Where is it?", vibe: +10, next: 3 },
                            { text: "I'm not really into live music.", vibe: -30, feedback: "You're killing the vibe.", next: "fail_negative" }
                        ]},
                        3: { text: "It starts at 9PM at The Blue Note. Bring friends!", type: "choice", options: [
                            { text: "I don't have friends.", vibe: -20, feedback: "A bit awkward.", next: "fail_awkward" },
                            { text: "Awesome, I'll be there!", vibe: +20, next: "win" },
                            { text: "I hate loud music.", vibe: -40, feedback: "Buzzkill.", next: "fail_rude" }
                        ]},
                        "win": { text: "Sick! See you there! ü§ò", end: true, win: true },
                        "fail_aggro": { text: "Whoa, relax. Just asking.", end: true, win: false },
                        "fail_awkward": { text: "Oh... uh, okay. Maybe next time.", end: true, win: false },
                        "fail_rude": { text: "Nevermind then.", end: true, win: false },
                        "fail_negative": { text: "Oh well. Your loss.", end: true, win: false }
                    }
                },
                {
                    name: "Stranger (Lily)", avatar: "‚òï", startNode: 1,
                    nodes: {
                        1: { text: "Excuse me, I think you have my coffee? I ordered the Latte.", type: "choice", options: [
                            { text: "No, this is mine.", vibe: -20, feedback: "A bit rude/defensive.", next: 2 },
                            { text: "Oh! I'm so sorry, let me check.", vibe: +20, next: 2 },
                            { text: "Get your own.", vibe: -50, feedback: "Extremely rude!", next: "fail_rude" }
                        ]},
                        2: { text: "It says 'Lily' on the cup. My name is Lily.", type: "choice", options: [
                            { text: "Wait, that's my name too! What a coincidence", vibe: +30, next: 3 },
                            { text: "Oh my gosh! I'm so sorry. I didn't see the name.", vibe: +20, next: 3 },
                            { text: "Well, I grabbed it first.", vibe: -40, feedback: "Don't be difficult!", next: "fail_stubborn" }
                        ]},
                        3: { text: "Oh... really? Well, mistakes happen. The line is so long though...", type: "choice", options: [
                            { text: "Yeah, bye.", vibe: -30, feedback: "Dismissive.", next: "fail_awkward" },
                            { text: "I'll buy you a new one. It's the least I can do.", vibe: +30, next: "win" },
                            { text: "You should wait in line then.", vibe: -20, feedback: "Not friendly.", next: "fail_rude" }
                        ]},
                        "win": { text: "That is so nice of you! I'd love that. Thanks!", end: true, win: true },
                        "fail_rude": { text: "Ugh, people these days.", end: true, win: false },
                        "fail_awkward": { text: "Okay... weirdo.", end: true, win: false },
                        "fail_stubborn": { text: "Wow. Really mature.", end: true, win: false }
                    }
                },
                {
                    name: "Mike", avatar: "üíª", startNode: 1,
                    nodes: {
                        1: { text: "Hey... long time no see. Sorry I disappeared for 2 weeks.", type: "choice", options: [
                            { text: "You are the worst.", vibe: -40, feedback: "Too aggressive immediately.", next: "fail_angry" },
                            { text: "Yeah, what happened?", vibe: +10, next: 2 },
                            { text: "I didn't notice.", vibe: -10, feedback: "Playing it too cool.", next: 2 }
                        ]},
                        2: { text: "My phone broke and I lost all my contacts. I felt so bad! üò≠", type: "choice", options: [
                            { text: "No worries! These things happen.", vibe: +20, next: 3 },
                            { text: "I thought you were ghosting me!", vibe: +10, next: 3 },
                            { text: "That's a terrible excuse.", vibe: -40, feedback: "Too harsh!", next: "fail_harsh" }
                        ]},
                        3: { text: "I promise it's the truth! Can I make it up to you with a drink?", type: "choice", options: [
                            { text: "No thanks, bye.", vibe: -20, feedback: "End of story.", next: "fail_cold" },
                            { text: "One drink. But you are paying.", vibe: +20, next: "win" },
                            { text: "Okay, but no more disappearing.", vibe: +30, next: "win" }
                        ]},
                        "win": { text: "Deal! I'll pick you up at 8. üöó", end: true, win: true },
                        "fail_angry": { text: "Whoa, chill. I won't bother you again.", end: true, win: false },
                        "fail_cold": { text: "Message received. Have a nice life.", end: true, win: false },
                        "fail_harsh": { text: "You know what? Forget I asked.", end: true, win: false }
                    }
                }
            ],
            casual: [
                {
                    name: "Alex", avatar: "üß¢", startNode: 1,
                    nodes: {
                        1: { text: "Yo! What are you up to today?", type: "choice", options: [
                            { text: "I am currently working.", vibe: -10, feedback: "Too formal for 'Yo'", next: 2 },
                            { text: "Not much, just chilling. You?", vibe: +20, next: 2 },
                            { text: "Go away.", vibe: -50, feedback: "Just mean.", next: "fail_mean" }
                        ]},
                        2: { text: "Just finished at the gym. I'm starving. üçî", type: "choice", options: [
                            { text: "Let's grab some food! I'm hungry too.", vibe: +30, next: 3 },
                            { text: "Want to get lunch together?", vibe: +20, next: 3 },
                            { text: "Cool story.", vibe: -40, feedback: "Sarcastic and rude.", next: "fail_sarcastic" }
                        ]},
                        3: { text: "Yes! Burger King? My treat.", type: "choice", options: [
                            { text: "I prefer a 5-star restaurant.", vibe: -30, feedback: "Snobbish.", next: "fail_snob" },
                            { text: "Sounds good, let's go!", vibe: +20, next: "win" },
                            { text: "No, I'm on a diet.", vibe: -10, feedback: "Boring response.", next: "fail_boring" }
                        ]},
                        "win": { text: "Sweet. Meet you there in 10 mins! üçü", end: true, win: true },
                        "fail_mean": { text: "Rude...", end: true, win: false },
                        "fail_snob": { text: "Since when are you so fancy? Forget it.", end: true, win: false },
                        "fail_boring": { text: "Ugh, you're no fun.", end: true, win: false },
                        "fail_sarcastic": { text: "Whatever, dude.", end: true, win: false }
                    }
                },
                {
                    name: "Sam", avatar: "üéÆ", startNode: 1,
                    nodes: {
                        1: { text: "Dude, are you watching the game tonight?", type: "choice", options: [
                            { text: "Which game?", vibe: 0, next: 2 },
                            { text: "Yeah! It's gonna be epic.", vibe: +20, next: 2 },
                            { text: "Sports are a waste of time.", vibe: -40, feedback: "Don't ruin the fun.", next: "fail_buzzkill" }
                        ]},
                        2: { text: "United vs City! It's the final! I'm watching at home.", type: "choice", options: [
                            { text: "Can I come over and watch with you?", vibe: +30, next: 3 },
                            { text: "Nice! Mind if I join?", vibe: +20, next: 3 },
                            { text: "Who cares about soccer?", vibe: -50, feedback: "Don't insult their interests!", next: "fail_insult" }
                        ]},
                        3: { text: "Yeah for sure! Bring some snacks though.", type: "choice", options: [
                            { text: "I will arrive with provisions.", vibe: -20, feedback: "You sound like a robot.", next: "fail_robot" },
                            { text: "I'll bring chips and beer.", vibe: +20, next: "win" },
                            { text: "No, you buy them.", vibe: -30, feedback: "Cheap.", next: "fail_cheap" }
                        ]},
                        "win": { text: "Legend! Door is open. ‚öΩ", end: true, win: true },
                        "fail_buzzkill": { text: "You must be fun at parties...", end: true, win: false },
                        "fail_robot": { text: "Why are you talking like a textbook? üòÇ", end: true, win: false },
                        "fail_cheap": { text: "Bro, don't be cheap. Forget it.", end: true, win: false },
                        "fail_insult": { text: "Wow. Don't bother coming over then.", end: true, win: false }
                    }
                },
                {
                    name: "Lisa", avatar: "‚úàÔ∏è", startNode: 1,
                    nodes: {
                        1: { text: "I'm so bored. We should do something this weekend.", type: "choice", options: [
                            { text: "I agree.", vibe: -10, feedback: "A bit stiff.", next: 2 },
                            { text: " Totally! Any ideas?", vibe: +20, next: 2 },
                            { text: "I am busy studying grammar.", vibe: -30, feedback: "Boring!", next: "fail_nerd" }
                        ]},
                        2: { text: "I was thinking maybe a road trip? Or the beach?", type: "choice", options: [
                            { text: "Beach sounds perfect!", vibe: +30, next: 3 },
                            { text: "Either one works for me!", vibe: +20, next: 3 },
                            { text: "Both sound boring.", vibe: -40, feedback: "Then suggest something!", next: "fail_negative" }
                        ]},
                        3: { text: "Beach sounds perfect! But I don't have a car. üöó", type: "choice", options: [
                            { text: "We can take the train.", vibe: +20, next: "win" },
                            { text: "I can drive us.", vibe: +30, next: "win" },
                            { text: "Then we can't go.", vibe: -40, feedback: "Unhelpful.", next: "fail_lazy" }
                        ]},
                        "win": { text: "Awesome plan! I'll pack the sunscreen. ‚òÄÔ∏è", end: true, win: true },
                        "fail_nerd": { text: "Okay... have fun with that.", end: true, win: false },
                        "fail_lazy": { text: "Wow, helpful. Nevermind.", end: true, win: false },
                        "fail_negative": { text: "Well, you think of something then. Bye.", end: true, win: false }
                    }
                },
                {
                    name: "Roommate (Ben)", avatar: "üè†", startNode: 1,
                    nodes: {
                        1: { text: "Dude. The kitchen is a mess. Are you ever going to wash your dishes?", type: "choice", options: [
                            { text: "Relax, I'll do it later.", vibe: -20, feedback: "Procrastinating makes it worse.", next: 2 },
                            { text: "Sorry! I was super busy. I'll do it now.", vibe: +20, next: 2 },
                            { text: "They aren't my dishes.", vibe: -30, feedback: "Don't lie!", next: "fail_lie" }
                        ]},
                        2: { text: "You said you'd do it 'later' three days ago. It smells bad.", type: "choice", options: [
                            { text: "You're right. I'll clean it right now.", vibe: +30, next: 3 },
                            { text: "I promise I'll do it tonight after work.", vibe: +20, next: 3 },
                            { text: "It's not that bad.", vibe: -30, feedback: "Don't deny the problem!", next: "fail_denial" }
                        ]},
                        3: { text: "Fine. But if it's not clean by tonight, I'm throwing them out.", type: "choice", options: [
                            { text: "You wouldn't dare.", vibe: -50, feedback: "Don't challenge an angry roommate.", next: "fail_fight" },
                            { text: "Understood. I'm on it.", vibe: +20, next: "win" },
                            { text: "Chill out.", vibe: -10, feedback: "Dismissive.", next: "win" }
                        ]},
                        "win": { text: "Good. Thanks, man.", end: true, win: true },
                        "fail_lie": { text: "I saw you eating that pasta. Don't lie to me.", end: true, win: false },
                        "fail_fight": { text: "Watch me. *Crash* There go your plates.", end: true, win: false },
                        "fail_denial": { text: "Yes it is. I'm done being patient.", end: true, win: false }
                    }
                },
                {
                    name: "Tourist", avatar: "üó∫Ô∏è", startNode: 1,
                    nodes: {
                        1: { text: "Excuse me! Do you speak English? I am very lost.", type: "choice", options: [
                            { text: "No.", vibe: -20, feedback: "Unhelpful.", next: "fail_rude" },
                            { text: "Yeah, what's up?", vibe: +20, next: 2 },
                            { text: "I'm busy.", vibe: -30, feedback: "Rude.", next: "fail_rude" }
                        ]},
                        2: { text: "I am looking for the train station. Google Maps is not working!", type: "choice", options: [
                            { text: "Go straight two blocks, then turn left.", vibe: +30, next: 3 },
                            { text: "It's that way, about 5 minutes walking.", vibe: +20, next: 3 },
                            { text: "I have no idea.", vibe: -20, feedback: "At least try to help!", next: "fail_unhelpful" }
                        ]},
                        3: { text: "Okay, go straight and turn left. Is it far?", type: "choice", options: [
                            { text: "Nah, it's like a 5 min walk.", vibe: +20, next: "win" },
                            { text: "Yes, you should take a taxi.", vibe: +10, next: "win" },
                            { text: "I don't know.", vibe: -10, feedback: "Then why did you give directions?", next: "fail_confused" }
                        ]},
                        "win": { text: "Thank you so much! You saved me! üôè", end: true, win: true },
                        "fail_rude": { text: "Oh... okay. Sorry to bother you.", end: true, win: false },
                        "fail_confused": { text: "I am more confused now. Bye.", end: true, win: false },
                        "fail_unhelpful": { text: "Okay, I'll ask someone else.", end: true, win: false }
                    }
                }
            ]
        };

        // --- STATE ---
        let currentCategory = null;
        let activeScenarioIndex = 0; 
        let currentScenarioData = null; 
        let currentNodeId = 1;
        let vibe = 50; 

        // --- DOM ELEMENTS ---
        const chatArea = document.getElementById('chat-area');
        const choicesArea = document.getElementById('choices-area');
        const vibeBar = document.getElementById('vibe-bar');
        const typingIndicator = document.getElementById('typing-indicator');
        const appContainer = document.getElementById('app-container');
        const diffDesc = document.getElementById('diff-desc');

        // --- INIT ---
        function showMenu() {
            document.getElementById('menu-overlay').style.display = 'flex';
            document.getElementById('game-over-overlay').style.display = 'none';
        }

        function setDifficulty(level) {
            difficulty = level;
            document.getElementById('diff-chill').classList.remove('active');
            document.getElementById('diff-pro').classList.remove('active');
            document.getElementById(`diff-${level}`).classList.add('active');
            
            if (level === 'chill') {
                diffDesc.innerText = "Training Mode: Coach ON, 50% Start";
            } else {
                diffDesc.innerText = "Survival Mode: Coach OFF, 20% Start";
            }
        }

        function pickRandomScenario(category) {
            currentCategory = category;
            const scenariosList = scenarioDB[category];
            activeScenarioIndex = Math.floor(Math.random() * scenariosList.length);
            startScenario(scenariosList[activeScenarioIndex]);
        }

        function restartCurrentScenario() {
            if (currentCategory !== null) {
                const scenariosList = scenarioDB[currentCategory];
                startScenario(scenariosList[activeScenarioIndex]);
            } else {
                showMenu();
            }
        }

        function startScenario(data) {
            currentScenarioData = data;
            currentNodeId = data.startNode;
            vibe = (difficulty === 'chill') ? 50 : 20;
            
            document.getElementById('menu-overlay').style.display = 'none';
            document.getElementById('game-over-overlay').style.display = 'none';
            
            document.getElementById('npc-name').innerText = data.name;
            document.getElementById('npc-avatar').innerText = data.avatar;
            chatArea.innerHTML = ''; 
            updateVibeUI();
            
            chatArea.appendChild(typingIndicator);
            processNode();
        }

        // --- GAME LOOP ---
        function processNode() {
            const node = currentScenarioData.nodes[currentNodeId];
            choicesArea.innerHTML = '';

            setTimeout(() => {
                typingIndicator.style.display = 'flex';
                scrollToBottom();

                setTimeout(() => {
                    typingIndicator.style.display = 'none';
                    addMessage(node.text, 'npc');

                    if (node.end) {
                        setTimeout(() => triggerGameOver(node.win), 2000);
                        return;
                    }

                    setTimeout(() => {
                        if (node.type === 'choice') {
                            showChoices(node.options);
                        }
                    }, TIME_READING);

                }, TIME_TYPING); 
            }, TIME_INITIAL_PAUSE); 
        }

        // --- INPUT HANDLERS ---
        function showChoices(options) {
            options.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'choice-btn';
                btn.innerText = opt.text;
                btn.onclick = () => handleChoice(opt);
                choicesArea.appendChild(btn);
            });
            scrollToBottom();
        }

        function handleChoice(option) {
            addMessage(option.text, 'user');
            choicesArea.innerHTML = '';
            
            let vibeChange = option.vibe;
            if (difficulty === 'pro' && vibeChange < 0) {
                vibeChange *= 1.5;
            }

            updateVibe(vibeChange, option.feedback);
            
            if (vibe <= 0) {
                setTimeout(() => triggerGameOver(false), 1500);
                return;
            }

            currentNodeId = option.next;
            processNode();
        }

        // --- UI HELPERS ---
        function addMessage(text, type) {
            const div = document.createElement('div');
            div.className = `message msg-${type}`;
            div.innerText = text;
            chatArea.insertBefore(div, typingIndicator);
            scrollToBottom();
        }

        function updateVibe(amount, feedback) {
            vibe += amount;
            if (vibe > 100) vibe = 100;
            if (vibe < 0) vibe = 0;
            updateVibeUI();

            if (amount < 0) {
                shakeScreen();
                if (feedback) {
                    if (difficulty === 'chill') {
                        showCoachMessage(feedback);
                    }
                }
            }
        }

        function shakeScreen() {
            appContainer.classList.add('shake-screen');
            setTimeout(() => { appContainer.classList.remove('shake-screen'); }, 500);
        }

        function showCoachMessage(text) {
            const div = document.createElement('div');
            div.className = 'msg-coach';
            div.innerText = text; 
            chatArea.insertBefore(div, typingIndicator);
            scrollToBottom();
        }

        function updateVibeUI() {
            vibeBar.style.width = vibe + '%';
            if (vibe > 60) vibeBar.style.background = '#10B981'; 
            else if (vibe > 30) vibeBar.style.background = '#F59E0B'; 
            else vibeBar.style.background = '#EF4444'; 
        }

        function scrollToBottom() {
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function triggerGameOver(win) {
            const overlay = document.getElementById('game-over-overlay');
            const title = document.getElementById('end-title');
            const reason = document.getElementById('end-reason');
            const emoji = document.getElementById('end-emoji');

            overlay.style.display = 'flex';
            
            if (win) {
                emoji.innerText = "üéâ";
                title.innerText = "VIBE CHECK PASSED!";
                title.style.color = "#10B981";
                reason.innerText = "You kept the conversation flowing perfectly.";
            } else {
                emoji.innerText = "üö´";
                title.innerText = "BLOCKED";
                title.style.color = "#EF4444";
                reason.innerText = "Your vibe dropped to zero. Conversation over.";
                reason.style.fontWeight = "normal"; 
                reason.style.color = "#D1D5DB";
            }
        }

    </script>
</body>
</html>
